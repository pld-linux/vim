To: vim-dev@vim.org
Subject: Patch 6.2.531
Fcc: outbox
From: Bram Moolenaar <Bram@moolenaar.net>
Mime-Version: 1.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 8bit
------------

Patch 6.2.531
Problem:    In silent ex mode no messages are given, which makes debugging
	    very difficult.
Solution:   Do output messages when 'verbose' is set.
Files:	    src/message.c, src/ui.c


*** ../vim-6.2.530/src/message.c	Fri Apr 16 22:03:45 2004
--- src/message.c	Wed May  5 12:30:46 2004
***************
*** 1761,1772 ****
      if (msg_use_printf())
      {
  #ifdef WIN3264
! 	if (!silent_mode)
  	    mch_settmode(TMODE_COOK);	/* handle '\r' and '\n' correctly */
  #endif
  	while (*s != NUL && (maxlen < 0 || (int)(s - str) < maxlen))
  	{
! 	    if (!silent_mode)
  	    {
  		p = &buf[0];
  		/* NL --> CR NL translation (for Unix, not for "--version") */
--- 1761,1772 ----
      if (msg_use_printf())
      {
  #ifdef WIN3264
! 	if (!(silent_mode && p_verbose == 0))
  	    mch_settmode(TMODE_COOK);	/* handle '\r' and '\n' correctly */
  #endif
  	while (*s != NUL && (maxlen < 0 || (int)(s - str) < maxlen))
  	{
! 	    if (!(silent_mode && p_verbose == 0))
  	    {
  		p = &buf[0];
  		/* NL --> CR NL translation (for Unix, not for "--version") */
***************
*** 1806,1812 ****
  	msg_didout = TRUE;	    /* assume that line is not empty */
  
  #ifdef WIN3264
! 	if (!silent_mode)
  	    mch_settmode(TMODE_RAW);
  #endif
  	return;
--- 1806,1812 ----
  	msg_didout = TRUE;	    /* assume that line is not empty */
  
  #ifdef WIN3264
! 	if (!(silent_mode && p_verbose == 0))
  	    mch_settmode(TMODE_RAW);
  #endif
  	return;
*** ../vim-6.2.530/src/ui.c	Fri Apr  2 14:07:44 2004
--- src/ui.c	Wed May  5 12:31:49 2004
***************
*** 33,40 ****
      }
  #endif
  #ifndef NO_CONSOLE
!     /* Don't output anything in silent mode ("ex -s") */
!     if (!silent_mode)
      {
  #ifdef FEAT_MBYTE
  	char_u	*tofree = NULL;
--- 33,40 ----
      }
  #endif
  #ifndef NO_CONSOLE
!     /* Don't output anything in silent mode ("ex -s") unless 'verbose' set */
!     if (!(silent_mode && p_verbose == 0))
      {
  #ifdef FEAT_MBYTE
  	char_u	*tofree = NULL;
*** ../vim-6.2.530/src/version.c	Wed May  5 11:56:50 2004
--- src/version.c	Wed May  5 12:36:41 2004
***************
*** 643,644 ****
--- 643,646 ----
  {   /* Add new patch number below this line */
+ /**/
+     531,
  /**/

-- 
hundred-and-one symptoms of being an internet addict:
116. You are living with your boyfriend who networks your respective
     computers so you can sit in separate rooms and email each other

 /// Bram Moolenaar -- Bram@Moolenaar.net -- http://www.Moolenaar.net   \\\
///        Sponsor Vim, vote for features -- http://www.Vim.org/sponsor/ \\\
\\\              Project leader for A-A-P -- http://www.A-A-P.org        ///
 \\\  Buy at Amazon and help AIDS victims -- http://ICCF.nl/click1.html ///
