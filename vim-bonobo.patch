diff -urN aaa/vim62/src/container.c vim62/src/container.c
--- aaa/vim62/src/container.c	2003-08-08 00:48:17.000000000 +0200
+++ vim62/src/container.c	2003-08-08 11:38:21.000000000 +0200
@@ -1,3 +1,6 @@
+#include "auto/config.h"
+
+#ifdef FEAT_GUI_COMPONENT
 
 #include <bonobo.h>
 #include <glib.h>
@@ -264,3 +267,4 @@
 
     return 0;
 }
+#endif /* FEAT_GUI_COMPONENT */
diff -urN aaa/vim62/src/fileio.c vim62/src/fileio.c
--- aaa/vim62/src/fileio.c	2003-08-08 00:48:17.000000000 +0200
+++ vim62/src/fileio.c	2003-08-08 13:59:35.000000000 +0200
@@ -3427,7 +3427,11 @@
      * (this may happen when the user reached his quotum for number of files).
      * Appending will fail if the file does not exist and forceit is FALSE.
      */
+#ifdef FEAT_GUI_COMPONENT
     while (write_pstream && (fd = mch_open((char *)wfname, O_WRONLY | O_EXTRA | (append
+#else
+    while ((fd = mch_open((char *)wfname, O_WRONLY | O_EXTRA | (append
+#endif
 			? (forceit ? (O_APPEND | O_CREAT) : O_APPEND)
 			: (O_CREAT | O_TRUNC))
 			, 0666)) < 0)
diff -urN aaa/vim62/src/gtkhtml_editor.c vim62/src/gtkhtml_editor.c
--- aaa/vim62/src/gtkhtml_editor.c	2003-08-08 00:48:17.000000000 +0200
+++ vim62/src/gtkhtml_editor.c	2003-08-08 11:38:32.000000000 +0200
@@ -1,3 +1,7 @@
+#include "auto/config.h"
+
+#ifdef FEAT_GUI_COMPONENT
+
 #include <bonobo.h>
 
 #include "gtkhtml_editor.h"
@@ -187,3 +191,4 @@
 
 	return ee;
 }
+#endif /* FEAT_GUI_COMPONENT */
diff -urN aaa/vim62/src/gtkhtml_editor_common.c vim62/src/gtkhtml_editor_common.c
--- aaa/vim62/src/gtkhtml_editor_common.c	2003-08-08 00:48:17.000000000 +0200
+++ vim62/src/gtkhtml_editor_common.c	2003-08-08 11:38:47.000000000 +0200
@@ -2,6 +2,10 @@
  * This file was generated by orbit-idl-2 - DO NOT EDIT!
  */
 
+#include "auto/config.h"
+
+#ifdef FEAT_GUI_COMPONENT
+
 #include <string.h>
 #define ORBIT2_STUBS_API
 #define ORBIT_IDL_C_COMMON
@@ -304,3 +308,4 @@
 				    FALSE},
    {2, 2, GNOME_GtkHTML_Editor_Engine__base_itypes, FALSE}
 };
+#endif /* FEAT_GUI_COMPONENT */
diff -urN aaa/vim62/src/gtkhtml_editor_skels.c vim62/src/gtkhtml_editor_skels.c
--- aaa/vim62/src/gtkhtml_editor_skels.c	2003-08-08 00:48:17.000000000 +0200
+++ vim62/src/gtkhtml_editor_skels.c	2003-08-08 11:38:59.000000000 +0200
@@ -2,6 +2,10 @@
  * This file was generated by orbit-idl-2 - DO NOT EDIT!
  */
 
+#include "auto/config.h"
+
+#ifdef FEAT_GUI_COMPONENT
+
 #include <string.h>
 #define ORBIT2_STUBS_API
 #include "gtkhtml.h"
@@ -656,3 +660,4 @@
    POA_Bonobo_Unknown__fini(servant, env);
    PortableServer_ServantBase__fini(servant, env);
 }
+#endif /* FEAT_GUI_COMPONENT */
diff -urN aaa/vim62/src/gtkhtml_editor_stubs.c vim62/src/gtkhtml_editor_stubs.c
--- aaa/vim62/src/gtkhtml_editor_stubs.c	2003-08-08 00:48:17.000000000 +0200
+++ vim62/src/gtkhtml_editor_stubs.c	2003-08-08 11:39:10.000000000 +0200
@@ -2,6 +2,10 @@
  * This file was generated by orbit-idl-2 - DO NOT EDIT!
  */
 
+#include "auto/config.h"
+
+#ifdef FEAT_GUI_COMPONENT
+
 #include <string.h>
 #define ORBIT2_STUBS_API
 #include "gtkhtml.h"
@@ -494,3 +498,4 @@
    }
    return _ORBIT_retval;
 }
+#endif /* FEAT_GUI_COMPONENT */
diff -urN aaa/vim62/src/gui_gtk_x11.c vim62/src/gui_gtk_x11.c
--- aaa/vim62/src/gui_gtk_x11.c	2003-08-08 00:48:17.000000000 +0200
+++ vim62/src/gui_gtk_x11.c	2003-08-08 14:04:56.000000000 +0200
@@ -24,7 +24,7 @@
 #include "vim.h"
 #ifdef FEAT_GUI_GNOME
 /* Gnome redefines _() and N_().  Grrr... */
-# ifdef _
+/*# ifdef _
 #  undef _
 # endif
 # ifdef N_
@@ -35,7 +35,7 @@
 # endif
 # ifdef bindtextdomain
 #  undef bindtextdomain
-# endif
+# endif */
 # if defined(FEAT_GETTEXT) && !defined(ENABLE_NLS)
 #  define ENABLE_NLS	/* so the texts in the dialog boxes are translated */
 # endif
@@ -2696,7 +2696,7 @@
     return cursor;
 }
 
-#if defined(GTK2_MULTIHEAD) && !defined(FEAT_GUI_COMPONENT)
+#if defined(HAVE_GTK_MULTIHEAD) && !defined(FEAT_GUI_COMPONENT)
 /*ARGSUSED1*/
     static void
 mainwin_screen_changed_cb(GtkWidget  *widget,
@@ -3038,9 +3038,10 @@
 
 #ifndef FEAT_GUI_COMPONENT
     gtk_widget_set_name(gui.mainwin, "vim-main-window");
+#else
+    gui.vbox = vbox;
 #endif
     vbox = gtk_vbox_new(FALSE, 0);
-    gui.vbox = vbox;
 
 #ifdef HAVE_GTK2
     /* Create the PangoContext used for drawing all text. */
diff -urN aaa/vim62/src/vim_bonobo_control.c vim62/src/vim_bonobo_control.c
--- aaa/vim62/src/vim_bonobo_control.c	2003-08-08 00:48:18.000000000 +0200
+++ vim62/src/vim_bonobo_control.c	2003-08-08 02:15:09.000000000 +0200
@@ -5,9 +5,13 @@
  *   Jason Hildebrand <jason@peaceworks.ca>
  *
  */
+
 #include <stdio.h>
 
 #include "vim.h"
+
+#ifdef FEAT_GUI_COMPONENT
+
 #include "vim_bonobo_control.h"
 #include "gtkhtml_editor.h"
 
@@ -408,4 +412,4 @@
 
 	return vim_control_construct (control);
 }
-
+#endif /* FEAT_GUI_COMPONENT */
diff -urN aaa/vim62/src/vim_bonobo_factory.c vim62/src/vim_bonobo_factory.c
--- aaa/vim62/src/vim_bonobo_factory.c	2003-08-08 00:48:18.000000000 +0200
+++ vim62/src/vim_bonobo_factory.c	2003-08-08 02:15:17.000000000 +0200
@@ -7,6 +7,9 @@
  */
 
 #include "vim.h"
+
+#ifdef FEAT_GUI_COMPONENT
+
 #include "version.h"
 #include <bonobo/bonobo-generic-factory.h>
 #include "vim_bonobo_control.h"
@@ -70,4 +73,4 @@
     }
     return 1;
 }
-
+#endif /* FEAT_GUI_COMPONENT */
diff -urN aaa/vim62/src/vim_bonobo_main.c vim62/src/vim_bonobo_main.c
--- aaa/vim62/src/vim_bonobo_main.c	2003-08-08 00:48:18.000000000 +0200
+++ vim62/src/vim_bonobo_main.c	2003-08-08 11:40:13.000000000 +0200
@@ -1,5 +1,9 @@
 /* -*- Mode: C; tab-width: 8; indent-tabs-mode: t; c-basic-offset: 8 -*- */
 
+#include "auto/config.h"
+
+#ifdef FEAT_GUI_COMPONENT
+
 #include <glib/gmain.h>
 #include <glib-object.h>
 
@@ -58,3 +62,4 @@
 {
     g_main_context_iteration(NULL, may_block);
 }
+#endif /* FEAT_GUI_COMPONENT */
diff -urN aaa/vim62/src/Vim_Control.server vim62/src/Vim_Control.server
--- aaa/vim62/src/Vim_Control.server	2003-08-08 00:48:17.000000000 +0200
+++ vim62/src/Vim_Control.server	2003-08-08 13:16:31.000000000 +0200
@@ -1,6 +1,6 @@
 <oaf_info>
 
-<oaf_server iid="OAFIID:Vim_Control_Factory" type="exe" location="/home/jdhildeb/projects/gnome-vim/vim/src/vim">
+<oaf_server iid="OAFIID:Vim_Control_Factory" type="exe" location="/usr/bin/gvim.gnome"">
   <oaf_attribute name="repo_ids" type="stringv">
     <item value="IDL:Bonobo/GenericFactory:1.0"/>
   </oaf_attribute>
