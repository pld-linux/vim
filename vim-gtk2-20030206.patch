Index: runtime/menu.vim
===================================================================
RCS file: /cvsroot/vim/vim/runtime/menu.vim,v
retrieving revision 1.76
diff -u -3 -p -r1.76 menu.vim
--- runtime/menu.vim	19 Nov 2002 23:53:46 -0000	1.76
+++ runtime/menu.vim	6 Feb 2003 17:52:16 -0000
@@ -695,6 +695,7 @@ func! s:BMMunge(fname, bnum)
   endif
   let name = name2 . "\t" . <SID>BMTruncName(fnamemodify(name,':h'))
   let name = escape(name, "\\. \t|")
+  let name = substitute(name, "&", "&&", "g")
   let name = substitute(name, "\n", "^@", "g")
   return name
 endfunc
Index: runtime/doc/gui.txt
===================================================================
RCS file: /cvsroot/vim/vim/runtime/doc/gui.txt,v
retrieving revision 1.58
diff -u -3 -p -r1.58 gui.txt
--- runtime/doc/gui.txt	13 May 2002 15:35:02 -0000	1.58
+++ runtime/doc/gui.txt	6 Feb 2003 17:52:17 -0000
@@ -493,7 +493,8 @@ which when selected, performs the operat
 Special characters in a menu name:
 
 	&	The next character is the shortcut key.  Make sure each
-		shortcut key is only used once in a (sub)menu.
+		shortcut key is only used once in a (sub)menu.  If you want to
+		insert a literal "&" in the menu name use "&&".
 	<Tab>	Separates the menu name from right-aligned text.  This can be
 		used to show the equivalent typed command.  The text "<Tab>"
 		can be used here for convenience.  If you are using a real
@@ -576,7 +577,8 @@ When no or zero priority is given, 500 i
 The priority for the PopUp menu is not used.
 
 The Help menu will be placed on the far right side of the menu bar on systems
-which support this (Motif and GTK+).
+which support this (Motif and GTK+).  For GTK+ 2, this is not done anymore
+because right-aligning the Help menu is now discouraged UI design.
 
 You can use a priority higher than 9999, to make it go after the Help menu,
 but that is non-standard and is discouraged.  The highest possible priority is
@@ -644,8 +646,10 @@ level.  Vim interprets the items in this
     toolbar button image.  Note that the exact filename is OS-specific: For
     example, under Win32 the command >
 	:amenu ToolBar.Hello :echo "hello"<CR>
-<   would find the file 'hello.bmp'.  Under GTK+/X11 it is 'Hello.xpm'.
-    For MS-Windows the bitmap is scaled to fit the button.
+<   would find the file 'hello.bmp'.  Under GTK+/X11 it is 'Hello.xpm'.  With
+    GTK+ 2 the files 'Hello.png', 'Hello.xpm' and 'Hello.bmp' are checked for
+    existence, and the first one found would be used.
+    For MS-Windows and GTK+ 2 the bitmap is scaled to fit the button.
     For others the size of the default pixmaps used is 20 by 20 pixels.
     For MS-Windows the bitmap should have 16 colors with the standard pallete.
     The light grey pixels will be changed to the Window frame color and the
@@ -826,8 +830,10 @@ The tip is defined like this: >
 And delete it with: >
 	:tunmenu MyMenu.Hello
 
-When using the GTK GUI, and Vim has already opened the GUI window, the tooltip
-must be defined before the ToolBar menu.  Otherwise it won't show up.
+When using the GTK+ 1.2 GUI, and Vim has already opened the GUI window, the
+tooltip must be defined before the ToolBar menu.  Otherwise it won't show up.
+In the GTK+ 2 port the tooltip is now updated on the fly, so this is no longer
+necessary.
 
 Tooltips are currently only supported for the X11 and Win32 GUI. However, they
 should appear for the other gui platforms in the not too distant future.
Index: runtime/doc/gui_x11.txt
===================================================================
RCS file: /cvsroot/vim/vim/runtime/doc/gui_x11.txt,v
retrieving revision 1.57
diff -u -3 -p -r1.57 gui_x11.txt
--- runtime/doc/gui_x11.txt	25 Mar 2002 17:00:32 -0000	1.57
+++ runtime/doc/gui_x11.txt	6 Feb 2003 17:52:17 -0000
@@ -315,14 +315,15 @@ internally.  Look in the GTK documentati
 	--sync
 	--gdk-debug
 	--gdk-no-debug
-	--no-xshm
-	--xim-preedit
-	--xim-status
+	--no-xshm	(not in GTK+ 2)
+	--xim-preedit	(not in GTK+ 2)
+	--xim-status	(not in GTK+ 2)
 	--gtk-debug
 	--gtk-no-debug
 	--g-fatal-warnings
 	--gtk-module
 	--display	(GTK+ counterpart of -display; works the same way.)
+	--screen	(The screen number; for GTK+ 2.2 multihead support.)
 
 As for colors, vim's color settings (for syntax highlighting) is still
 done the traditional vim way.  See |:highlight| for more help.
@@ -365,7 +366,8 @@ application to spawn the Vim correctly. 
 http://www.gtk.org/api/
 
 Note that this feature requires the latest GTK version.  GTK 1.2.10 still has
-a small problem.
+a small problem.  The socket feature has not yet been tested with GTK+ 2 --
+feel free to volunteer.
 
 ==============================================================================
 6. GNOME version				*gui-gnome* *Gnome* *GNOME*
@@ -373,17 +375,31 @@ a small problem.
 The Gnome GUI works just like the GTK version.  It only looks a bit different.
 See |GTK| above for how it works.
 
+On the other hand, the GNOME 2 GUI looks barely different from the GTK+ 2
+version but implements an important feature that is not available in plain
+GTK+ 2:  Interaction with the session manager.
+
+On logout, Vim will show the usual exit confirmation dialog if any buffers are
+still modified.  Clicking [Cancel] will stop the logout process.  Otherwise
+the current session is stored to disk by using the |:mksession| command, and
+restored the next time you log in.
+
+Note that the Session.vim file is written to a separate sub-directory of
+$HOME/.gnome2 (the exact filename is based on a per-save unique key).  Your
+own session files will not be touched at all.
+
 These are the different looks:
-- Uses GNOME dialogs.
+- Uses GNOME dialogs (GNOME 1 only).  The GNOME 2 GUI uses the same nice
+  dialogs as the GTK+ 2 version.
 - Uses the GNOME dock, so that the toolbar and menubar can be moved to
   different locations other than the top (e.g., the toolbar can be placed on
-  the left, right, top, or bottom).  The positioning of the menubar and
-  toolbar isn't saved right now; I think that's for GNOME session management
-  which isn't supported (yet).
+  the left, right, top, or bottom).  The placement of the menubar and
+  toolbar is only saved in the GNOME 2 version.
 - That means the menubar and toolbar handles are back!  Yeah!  And the
   resizing grid still works too.
 
 Gnome is automatically compiled with if it was found by configure.
+(FIXME: Is this still true?  Use --enable-gnome-check to force it to.)
 
 ==============================================================================
 7. Compiling						*gui-x11-compiling*
@@ -399,6 +415,12 @@ you can already successful compile, buil
 reason for this is because the compiler flags (CFLAGS) and link flags
 (LDFLAGS) are obtained through the 'gtk-config' shell script.
 
+If you want to build with GTK+ 2 support pass the --enable-gtk2-check argument
+to ./configure.  Optionally, support for GNOME 2 will be compiled if the
+--enable-gnome-check option is also given.  Note that the support for GTK+ 2
+is still experimental.  However, many people have reported that it works just
+fine for them.
+
 Otherwise, if you are using Motif or Athena, when you have the Motif or Athena
 files in a directory where configure doesn't look, edit the Makefile to enter
 the names of the directories.  Search for "GUI_INC_LOC" for an example to set
@@ -411,8 +433,15 @@ if using v1.0.6.  For instance, there ar
 Using a version from GTK+'s CVS tree may or may not work, and is therefore not
 supported and not recommended.
 
+For the experimental GTK+ 2 GUI, using the latest release in the GTK+ 2.0 or
+GTK+ 2.2 series is recommended.  CVS HEAD seems to work fine most of time as
+well.
+
 Lastly, although GTK+ has supposedly been ported to the Win32 platform, this
-has not been tested with Vim and is also unsupported.
+has not been tested with Vim and is also unsupported.  Also, it's unlikely to
+even compile since GTK+ GUI uses parts of the generic X11 code.  This might
+change in distant future; particularly because getting rid of the X11 centric
+code parts is also required for GTK+ framebuffer support.
 
 							*gui-x11-motif*
 For Motif, you need at least Motif version 1.2 and/or X11R5.  Motif 2.0 and
Index: runtime/doc/mbyte.txt
===================================================================
RCS file: /cvsroot/vim/vim/runtime/doc/mbyte.txt,v
retrieving revision 1.7
diff -u -3 -p -r1.7 mbyte.txt
--- runtime/doc/mbyte.txt	25 Mar 2002 17:00:33 -0000	1.7
+++ runtime/doc/mbyte.txt	6 Feb 2003 17:52:18 -0000
@@ -105,6 +105,12 @@ is the difficult part.  It depends on th
 a few other things.  See the chapters on fonts: |mbyte-fonts-X11| for
 X-Windows and |mbyte-fonts-MSwin| for MS-Windows.
 
+For GTK+ 2, you can skip the rest of this section.  The options 'guifontset'
+and 'guifontwide' do no longer exist.  You only need to set 'guifont' and
+everything should "just work".  If your system comes with Xft2 and fontconfig
+and the current font does not contain a certain glyph, a different font will
+be used automatically if available.
+
 For X11 you can set the 'guifontset' option to a list of fonts that together
 cover the characters that are used.  Example for Korean: >
 
@@ -493,6 +499,11 @@ For Vim you may need to set 'encoding' t
 Unfortunately, using fonts in X11 is complicated.  The name of a single-byte
 font is a long string.  For multi-byte fonts we need several of these...
 
+Note: Most of this is no longer relevant for GTK+ 2.  Selecting a font via
+its XLFD is not supported anymore; see |'guifont'| for an example of how to
+set the font.  Do yourself a favour and ignore the |XLFD| and |fontset|
+sections below.
+
 First of all, Vim only accepts fixed-width fonts for displaying text.  You
 cannot use proportionally spaced fonts.  This excludes many of the available
 (and nicer looking) fonts.  However, for menus and tooltips any font can be
@@ -991,7 +1002,7 @@ The length of the two items together mus
 
 It's possible to have more than one character in the first column.  This works
 like a dead key.  Example: >
-	'a	á
+	'a	Ã¡
 Since Vim doesn't know if the next character after a quote is really an "a",
 it will wait for the next character.  To be able to insert a single quote,
 also add this line: >
@@ -1175,7 +1186,8 @@ Vim has comprehensive UTF-8 support.  It
 
 Double-width characters are supported.  This works best with 'guifontwide' or
 'guifontset'.  When using only 'guifont' the wide characters are drawn in the
-normal width and a space to fill the gap.
+normal width and a space to fill the gap.  Note that the 'guifontwide' and
+'guifontset' options are no longer relevant for the GTK+ 2 GUI.
 
 Up to two combining characters can be used.  The combining character is drawn
 on top of the preceding character.  When editing text a composing character is
@@ -1222,6 +1234,8 @@ doesn't always work.  See the system spe
 
 
 USING UTF-8 IN X-Windows				*utf-8-in-xwindows*
+
+Note: This section does not apply to the GTK+ 2 GUI.
 
 You need to specify a font to be used.  For double-wide characters another
 font is required, which is exactly twice as wide.  There are three ways to do
Index: runtime/doc/options.txt
===================================================================
RCS file: /cvsroot/vim/vim/runtime/doc/options.txt,v
retrieving revision 1.67
diff -u -3 -p -r1.67 options.txt
--- runtime/doc/options.txt	9 Jan 2003 21:14:38 -0000	1.67
+++ runtime/doc/options.txt	6 Feb 2003 17:52:23 -0000
@@ -1842,6 +1842,14 @@ A jump table for the options with a shor
 	It should normally be kept at its default value, or set when Vim
 	starts up.  See |multibyte|.
 
+	NOTE: For GTK+ 2 it is highly recommended to set 'encoding' to
+	"utf-8".  Although care has been taken to allow different values of
+	'encoding', "utf-8" is the natural choice for the environment and
+	avoids unnecessary conversion overhead.  "utf-8" has not been made
+	the default to prevent different behaviour of the GUI and terminal
+	versions, and to avoid changing the encoding of newly created files
+	without your knowledge (in case 'fileencodings' is empty).
+
 	The character encoding of files can be different from 'encoding'.
 	This is specified with 'fileencoding'.  The conversion is done with
 	iconv() or as specified with 'charconvert'.
@@ -2554,6 +2562,9 @@ A jump table for the options with a shor
 	    :set guifont=Screen15,\ 7x13,font\\,with\\,commas
 <	will make vim try to use the font "Screen15" first, and if it fails it
 	will try to use "7x13" and then "font,with,commas" instead.
+	For the GTK+ 2 GUI the font name looks like this: >
+	    :set guifont=Andale\ Mono\ 11
+<	That's all.  XLFDs are no longer accepted.
 								*E236*
 	Note that the fonts must be mono-spaced (all characters have the same
 	width).
@@ -2596,6 +2607,7 @@ A jump table for the options with a shor
 			{not in Vi}
 			{only available when compiled with GUI enabled and
 			with the |+xfontset| feature}
+			{not available in the GTK+ 2 GUI}
 	When not empty, specifies two (or more) fonts to be used.  The first
 	one for normal English, the second one for your special language.  See
 	|xfontset|.
@@ -2612,12 +2624,16 @@ A jump table for the options with a shor
 	fontset names.
 	This example works on many X11 systems: >
 		:set guifontset=-*-*-medium-r-normal--16-*-*-*-c-*-*-*
-<
+<	Note that in the GTK+ 2 version, there is no longer a difference
+	between 'guifont' and 'guifontset'.  Setting 'guifont' is sufficient
+	and internationalized text will "just work".
+
 						*'guifontwide'* *'gfw'* *E231*
 'guifontwide' 'gfw'	string	(default "")
 			global
 			{not in Vi}
 			{only available when compiled with GUI enabled}
+			{not available in the GTK+ 2 GUI}
 	When not empty, specifies a comma-separated list of fonts to be used
 	for double-width characters.  The first font that can be loaded is
 	used.
@@ -5436,6 +5452,10 @@ A jump table for the options with a shor
 	encoding the keyboard produces and the display will understand.  For
 	the GUI it only applies to the keyboard ('encoding' is used for the
 	display).
+	Note: This does not apply to the GTK+ 2 GUI.  After the GUI has been
+	successfully initialized, 'termencoding' is forcibly set to "utf-8".
+	Any attempts to set a different value will be rejected, and an error
+	message is shown.
 	When empty, the same encoding is used as for the 'encoding' option.
 	This is the normal value.
 	Not all combinations for 'termencoding' and 'encoding' are valid.  See
@@ -5674,6 +5694,17 @@ A jump table for the options with a shor
 		tooltips	Tooltips are active for toolbar buttons.
 	Tooltips refer to the popup help text which appears after the mouse
 	cursor is placed over a toolbar button for a brief moment.
+
+	In the GTK+ 2 GUI, a few additional option values are available:
+		horiz		The button text is placed on the right of
+				the icon rather than below.
+		large		Use large toolbar icons.
+		medium		Use medium-sized toolbar icons.
+		small		Use small toolbar icons (default).
+		tiny		Use tiny toolbar icons.
+	The exact dimensions in pixels of the various icon sizes depend on
+	the current theme.  Common dimensions are large=32x32, medium=24x24,
+	small=20x20 and tiny=16x16.
 
 	If you want the toolbar to be shown with icons as well as text, do the
 	following: >
Index: src/config.h.in
===================================================================
RCS file: /cvsroot/vim/vim/src/config.h.in,v
retrieving revision 1.27
diff -u -3 -p -r1.27 config.h.in
--- src/config.h.in	6 Jan 2003 21:11:14 -0000	1.27
+++ src/config.h.in	6 Feb 2003 17:52:23 -0000
@@ -317,6 +317,9 @@
 /* Define if you use GTK and want GNOME support. */
 #undef FEAT_GUI_GNOME
 
+/* Define if GTK+ 2 is available. */
+#undef HAVE_GTK2
+
 /* Define if your X has own locale library */
 #undef X_LOCALE
 
Index: src/configure
===================================================================
RCS file: /cvsroot/vim/vim/src/configure,v
retrieving revision 1.10
diff -u -3 -p -r1.10 configure
--- src/configure	30 Jul 2000 23:10:57 -0000	1.10
+++ src/configure	6 Feb 2003 17:52:23 -0000
@@ -1,4 +1,4 @@
 #! /bin/sh
 # run the automatically generated configure script
 CONFIG_STATUS=auto/config.status \
-	auto/configure "$@" --srcdir="${srcdir-.}" --cache-file=auto/config.cache
+	auto/configure "$@" --srcdir="${srcdir-.}" --cache-file=/dev/null
Index: src/configure.in
===================================================================
RCS file: /cvsroot/vim/vim/src/configure.in,v
retrieving revision 1.65
diff -u -3 -p -r1.65 configure.in
--- src/configure.in	6 Jan 2003 21:11:16 -0000	1.65
+++ src/configure.in	6 Feb 2003 17:52:24 -0000
@@ -740,6 +740,7 @@ AC_ARG_ENABLE(gui,
 if test "x$BEOS" = "xyes"; then
 
   SKIP_GTK=YES
+  SKIP_GTK2=YES
   SKIP_GNOME=YES
   SKIP_MOTIF=YES
   SKIP_ATHENA=YES
@@ -758,6 +759,7 @@ if test "x$BEOS" = "xyes"; then
 
 elif test "x$QNX" = "xyes" -a "x$with_x" = "xno" ; then
   SKIP_GTK=YES
+  SKIP_GTK2=YES
   SKIP_GNOME=YES
   SKIP_MOTIF=YES
   SKIP_ATHENA=YES
@@ -777,6 +779,7 @@ elif test "x$QNX" = "xyes" -a "x$with_x"
 else
 
   SKIP_GTK=
+  SKIP_GTK2=
   SKIP_GNOME=
   SKIP_MOTIF=
   SKIP_ATHENA=
@@ -825,6 +828,17 @@ if test "x$SKIP_GNOME" != "xYES" -a "$en
   fi
 fi
 
+if test "x$SKIP_GTK2" != "xYES"; then
+  AC_MSG_CHECKING(whether or not to look for GTK2)
+  AC_ARG_ENABLE(gtk2-check,
+	[  --enable-gtk2-check     If GTK GUI, check for GTK2 (experimental) [default=no]],
+	, enable_gtk2_check="no")
+  AC_MSG_RESULT($enable_gtk2_check);
+  if test "x$enable_gtk2_check" = "xno"; then
+    SKIP_GTK2=YES
+  fi
+fi
+
 if test "x$SKIP_MOTIF" != "xYES" -a "$enable_gui" != "motif"; then
   AC_MSG_CHECKING(whether or not to look for Motif)
   AC_ARG_ENABLE(motif-check,
@@ -860,72 +874,96 @@ dnl Test for GTK, and define GTK_CFLAGS 
 dnl
 AC_DEFUN(AM_PATH_GTK,
 [
-  if test "X$GTK_CONFIG" != "X"; then
-
+  if test "X$GTK_CONFIG" != "Xno" -o "X$PKG_CONFIG" != "Xno"; then
+  {
     min_gtk_version=ifelse([$1], ,0.99.7,$1)
     AC_MSG_CHECKING(for GTK - version >= $min_gtk_version)
     no_gtk=""
-    if test "$GTK_CONFIG" = "no" ; then
-      no_gtk=yes
-    else
+    if test "X$SKIP_GTK2" != "XYES" -a "X$PKG_CONFIG" != "Xno"; then
+    {
+      dnl We should be using PKG_CHECK_MODULES() instead of this hack.
+      dnl But I guess the dependency on pkgconfig.m4 is not wanted or
+      dnl something like that.
+      if $PKG_CONFIG --exists gtk+-2.0; then
+        GTK_CFLAGS=`$PKG_CONFIG --cflags gtk+-2.0`
+        GTK_LIBS=`$PKG_CONFIG --libs gtk+-2.0`
+        gtk_major_version=`$PKG_CONFIG --modversion gtk+-2.0 | \
+               sed 's/\([[0-9]]*\)\.\([[0-9]]*\)\.\([[0-9]]*\)/\1/'`
+        gtk_minor_version=`$PKG_CONFIG --modversion gtk+-2.0 | \
+               sed 's/\([[0-9]]*\)\.\([[0-9]]*\)\.\([[0-9]]*\)/\2/'`
+        gtk_micro_version=`$PKG_CONFIG --modversion gtk+-2.0 | \
+               sed 's/\([[0-9]]*\)\.\([[0-9]]*\)\.\([[0-9]]*\)/\3/'`
+      else
+        no_gtk=yes
+      fi
+    }
+    elif test "X$GTK_CONFIG" != "Xno"; then
+    {
       GTK_CFLAGS=`$GTK_CONFIG $gtk_config_args --cflags`
       GTK_LIBS=`$GTK_CONFIG $gtk_config_args --libs`
-      gtk_config_major_version=`$GTK_CONFIG $gtk_config_args --version | \
-	     sed 's/\([[0-9]]*\).\([[0-9]]*\).\([[0-9]]*\)/\1/'`
-      gtk_config_minor_version=`$GTK_CONFIG $gtk_config_args --version | \
-	     sed 's/\([[0-9]]*\).\([[0-9]]*\).\([[0-9]]*\)/\2/'`
-      gtk_config_micro_version=`$GTK_CONFIG $gtk_config_args --version | \
-	     sed 's/\([[0-9]]*\).\([[0-9]]*\).\([[0-9]]*\)/\3/'`
-      if test "x$enable_gtktest" = "xyes" ; then
-	ac_save_CFLAGS="$CFLAGS"
-	ac_save_LIBS="$LIBS"
-	CFLAGS="$CFLAGS $GTK_CFLAGS"
-	LIBS="$LIBS $GTK_LIBS"
-
-	dnl
-	dnl Now check if the installed GTK is sufficiently new. (Also sanity
-	dnl checks the results of gtk-config to some extent
-	dnl
-	rm -f conf.gtktest
-	AC_TRY_RUN([
+      gtk_major_version=`$GTK_CONFIG $gtk_config_args --version | \
+	     sed 's/\([[0-9]]*\)\.\([[0-9]]*\)\.\([[0-9]]*\)/\1/'`
+      gtk_minor_version=`$GTK_CONFIG $gtk_config_args --version | \
+	     sed 's/\([[0-9]]*\)\.\([[0-9]]*\)\.\([[0-9]]*\)/\2/'`
+      gtk_micro_version=`$GTK_CONFIG $gtk_config_args --version | \
+	     sed 's/\([[0-9]]*\)\.\([[0-9]]*\)\.\([[0-9]]*\)/\3/'`
+    }
+    else
+      no_gtk=yes
+    fi
+
+    if test "x$enable_gtktest" = "xyes" -a "x$no_gtk" = "x"; then
+    {
+      ac_save_CFLAGS="$CFLAGS"
+      ac_save_LIBS="$LIBS"
+      CFLAGS="$CFLAGS $GTK_CFLAGS"
+      LIBS="$LIBS $GTK_LIBS"
+
+      dnl
+      dnl Now check if the installed GTK is sufficiently new. (Also sanity
+      dnl checks the results of gtk-config to some extent
+      dnl
+      rm -f conf.gtktest
+      AC_TRY_RUN([
 #include <gtk/gtk.h>
 #include <stdio.h>
 
 int
 main ()
 {
-  int major, minor, micro;
-  char *tmp_version;
+int major, minor, micro;
+char *tmp_version;
 
-  system ("touch conf.gtktest");
+system ("touch conf.gtktest");
 
-  /* HP/UX 9 (%@#!) writes to sscanf strings */
-  tmp_version = g_strdup("$min_gtk_version");
-  if (sscanf(tmp_version, "%d.%d.%d", &major, &minor, &micro) != 3) {
-     printf("%s, bad version string\n", "$min_gtk_version");
-     exit(1);
-   }
-
-  if ((gtk_major_version > major) ||
-      ((gtk_major_version == major) && (gtk_minor_version > minor)) ||
-      ((gtk_major_version == major) && (gtk_minor_version == minor) &&
-				       (gtk_micro_version >= micro)))
-  {
-      return 0;
-  }
-  return 1;
+/* HP/UX 9 (%@#!) writes to sscanf strings */
+tmp_version = g_strdup("$min_gtk_version");
+if (sscanf(tmp_version, "%d.%d.%d", &major, &minor, &micro) != 3) {
+   printf("%s, bad version string\n", "$min_gtk_version");
+   exit(1);
+ }
+
+if ((gtk_major_version > major) ||
+    ((gtk_major_version == major) && (gtk_minor_version > minor)) ||
+    ((gtk_major_version == major) && (gtk_minor_version == minor) &&
+                                     (gtk_micro_version >= micro)))
+{
+    return 0;
+}
+return 1;
 }
 ],, no_gtk=yes,[echo $ac_n "cross compiling; assumed OK... $ac_c"])
-	CFLAGS="$ac_save_CFLAGS"
-	LIBS="$ac_save_LIBS"
-      fi
+      CFLAGS="$ac_save_CFLAGS"
+      LIBS="$ac_save_LIBS"
+    }
     fi
     if test "x$no_gtk" = x ; then
-      AC_MSG_RESULT(yes)
+      AC_MSG_RESULT(yes; found version $gtk_major_version.$gtk_minor_version.$gtk_micro_version)
       ifelse([$2], , :, [$2])
     else
+    {
       AC_MSG_RESULT(no)
-      if test "$GTK_CONFIG" = "no" ; then
+      if test "X$GTK_CONFIG" = "Xno" ; then
 	:
       else
 	if test -f conf.gtktest ; then
@@ -936,7 +974,9 @@ main ()
       GTK_CFLAGS=""
       GTK_LIBS=""
       ifelse([$3], , :, [$3])
+    }
     fi
+  }
   else
     GTK_CFLAGS=""
     GTK_LIBS=""
@@ -983,7 +1023,24 @@ AC_DEFUN([GNOME_INIT_HOOK],
     fi,
     want_gnome=yes)
 
-  if test "x$want_gnome" = xyes; then
+  if test "x$want_gnome" = xyes -a $gtk_major_version -ge 2; then
+  {
+    AC_MSG_CHECKING(for libgnomeui-2.0)
+    if $PKG_CONFIG --exists libgnomeui-2.0; then
+      AC_MSG_RESULT(yes)
+      GNOME_LIBS=`$PKG_CONFIG --libs-only-l libgnomeui-2.0`
+      GNOME_LIBDIR=`$PKG_CONFIG --libs-only-L libgnomeui-2.0`
+      GNOME_INCLUDEDIR=`$PKG_CONFIG --cflags libgnomeui-2.0`
+      $1
+    else
+      AC_MSG_RESULT(not found)
+      if test "x$2" = xfail; then
+	AC_MSG_ERROR(Could not find libgnomeui-2.0 via pkg-config)
+      fi
+    fi
+  }
+  elif test "x$want_gnome" = xyes; then
+  {
     AC_PATH_PROG(GNOME_CONFIG,gnome-config,no)
     if test "$GNOME_CONFIG" = "no"; then
       no_gnome_config="yes"
@@ -1026,6 +1083,7 @@ AC_DEFUN([GNOME_INIT_HOOK],
 	fi
       fi
     fi
+  }
   fi
 ])
 
@@ -1078,10 +1136,13 @@ if test -z "$SKIP_GTK"; then
   else
     AC_MSG_RESULT(Using GTK configuration program $GTK_CONFIG)
   fi
+  if test "X$PKG_CONFIG" = "X"; then
+    AC_PATH_PROG(PKG_CONFIG, pkg-config, no)
+  fi
 
   dnl We require at least GTK 1.1.16.  1.0.6 doesn't work.  1.1.1 to 1.1.15
   dnl were test versions.
-  if test "X$GTK_CONFIG" != "X"; then
+  if test "X$GTK_CONFIG" != "Xno" -o "X$PKG_CONFIG" != "Xno"; then
     AM_PATH_GTK(1.1.16,
 		[GTK_LIBNAME="$GTK_LIBS"
 		GUI_INC_LOC="$GTK_CFLAGS"], )
@@ -1094,20 +1155,27 @@ if test -z "$SKIP_GTK"; then
   fi
   dnl Give a warning if GTK is older than 1.2.3
   if test "x$GUITYPE" = "xGTK"; then
-    if test $gtk_config_major_version = 1 -a $gtk_config_minor_version -lt 2 -o $gtk_config_major_version = 1 -a $gtk_config_minor_version = 2 -a $gtk_config_micro_version -lt 3; then
+    if test $gtk_major_version = 1 -a $gtk_minor_version -lt 2 -o $gtk_major_version = 1 -a $gtk_minor_version = 2 -a $gtk_micro_version -lt 3; then
       AC_MSG_RESULT(this GTK version is old; version 1.2.3 or later is recommended)
     else
+    {
+      if test $gtk_major_version -ge 2; then
+	AC_DEFINE(HAVE_GTK2)
+      fi
       dnl
       dnl if GTK exists, and it's not the 1.0.x series, then check for GNOME.
       dnl
       if test -z "$SKIP_GNOME"; then
+      {
 	GNOME_INIT_HOOK([have_gnome=yes])
 	if test x$have_gnome = xyes ; then
 	  AC_DEFINE(FEAT_GUI_GNOME)
 	  GUI_INC_LOC="$GUI_INC_LOC $GNOME_INCLUDEDIR"
 	  GTK_LIBNAME="$GTK_LIBNAME $GNOME_LIBDIR $GNOME_LIBS"
 	fi
+      }
       fi
+    }
     fi
   fi
 fi
@@ -1279,6 +1347,14 @@ if test -z "$SKIP_ATHENA" -o -z "$SKIP_M
 		  AC_MSG_RESULT(no; xim has been disabled); enable_xim = "no")
   fi
   CPPFLAGS=$cppflags_save
+
+  dnl This was in to disable XIM when gtk2 was the gui, since XIM wasn't 
+  dnl building with gtk2.  It's better now, though, so this is commented out.
+  dnl if test "x$enable_xim" = "xauto" -a "x$GUITYPE" = "xGTK" -a $gtk_major_version = "2"; then
+  dnl AC_MSG_RESULT(GTK2 GUI selected; xim has been disabled (it's broken for gtk2))
+  dnl enable_xim="no"
+  dnl fi
+    
 
   dnl automatically enable XIM when hangul input isn't enabled
   if test "$enable_xim" = "auto" -a ! "$enable_hangulinput" = "yes" \
Index: src/feature.h
===================================================================
RCS file: /cvsroot/vim/vim/src/feature.h,v
retrieving revision 1.48
diff -u -3 -p -r1.48 feature.h
--- src/feature.h	27 Sep 2002 23:58:01 -0000	1.48
+++ src/feature.h	6 Feb 2003 17:52:24 -0000
@@ -541,6 +541,10 @@
 # define FEAT_SESSION
 #endif
 
+#if defined(FEAT_SESSION) && defined(FEAT_GUI_GNOME) && defined(HAVE_GTK2)
+# define USE_GNOME_SESSION /* use GNOME session support if available */
+#endif
+
 /*
  * +multi_lang		Multi language support. ":menutrans", ":language", etc.
  * +gettext		Message translations (requires +multi_lang)
@@ -561,7 +565,8 @@
  * Disabled for EBCDIC:
  * Multibyte support doesn't work on OS390 Unix currently.
  */
-#if defined(FEAT_BIG) && !defined(FEAT_MBYTE) && !defined(WIN16) \
+#if (defined(FEAT_BIG) || defined(HAVE_GTK2)) \
+	&& !defined(FEAT_MBYTE) && !defined(WIN16) \
 	&& SIZEOF_INT >= 4 && !defined(EBCDIC)
 # define FEAT_MBYTE
 #endif
@@ -626,7 +631,7 @@
  * +xfontset		X fontset support.  For outputting wide characters.
  */
 #ifndef FEAT_XFONTSET
-# if defined(FEAT_MBYTE) && defined(HAVE_X11)
+# if defined(FEAT_MBYTE) && defined(HAVE_X11) && !defined(HAVE_GTK2)
 #  define FEAT_XFONTSET
 # else
 /* #  define FEAT_XFONTSET */
Index: src/fileio.c
===================================================================
RCS file: /cvsroot/vim/vim/src/fileio.c,v
retrieving revision 1.97
diff -u -3 -p -r1.97 fileio.c
--- src/fileio.c	3 Feb 2003 18:45:11 -0000	1.97
+++ src/fileio.c	6 Feb 2003 17:52:27 -0000
@@ -708,7 +708,11 @@ readfile(fname, sfname, from, lines_to_s
     }
     else if (curbuf->b_help)
     {
-	fenc = (char_u *)"latin1";	/* help files are latin1 */
+	/* Help files are latin1 or utf-8 (e.g. mbyte.txt).
+	 * Try utf-8 first since reading as latin1 always succeeds.
+	 */
+	fenc_next = (char_u *)"latin1";
+	fenc = (char_u *)"utf-8";
 	fenc_alloced = FALSE;
     }
     else if (*p_fencs == NUL)
Index: src/globals.h
===================================================================
RCS file: /cvsroot/vim/vim/src/globals.h,v
retrieving revision 1.69
diff -u -3 -p -r1.69 globals.h
--- src/globals.h	19 Nov 2002 23:51:47 -0000	1.69
+++ src/globals.h	6 Feb 2003 17:52:27 -0000
@@ -617,10 +617,14 @@ EXTERN int* (*iconv_errno) (void);
 
 #ifdef FEAT_XIM
 # ifdef FEAT_GUI_GTK
+#  ifdef HAVE_GTK2
+EXTERN GtkIMContext	*xic INIT(= NULL);
+#  else
 EXTERN GdkICAttr	*xic_attr INIT(= NULL);
 EXTERN GdkIC		*xic INIT(= NULL);
 EXTERN colnr_T		preedit_start_col INIT(= MAXCOL);
 EXTERN char		*draw_feedback INIT(= NULL);
+#  endif
 # else
 EXTERN XIC		xic INIT(= NULL);
 # endif
Index: src/gui.c
===================================================================
RCS file: /cvsroot/vim/vim/src/gui.c,v
retrieving revision 1.68
diff -u -3 -p -r1.68 gui.c
--- src/gui.c	5 Jan 2003 16:56:53 -0000	1.68
+++ src/gui.c	6 Feb 2003 17:52:29 -0000
@@ -13,7 +13,7 @@
 /* Structure containing all the GUI information */
 gui_T gui;
 
-#ifdef FEAT_MBYTE
+#if defined(FEAT_MBYTE) && !defined(HAVE_GTK2)
 static void set_guifontwide __ARGS((char_u *font_name));
 #endif
 static void gui_check_pos __ARGS((void));
@@ -166,6 +166,11 @@ gui_start()
 # endif
 #endif
 
+#if defined(MAY_FORK) && defined(USE_GNOME_SESSION)
+    if (gui.in_use && dofork)
+        gui_mch_forked(); /* tell the session manager our new PID */
+#endif
+
 #ifdef FEAT_AUTOCMD
     /* If the GUI started successfully, trigger the GUIEnter event */
     if (gui.in_use)
@@ -228,18 +233,22 @@ gui_init_check()
     gui.border_width = 0;
 
     gui.norm_font = NOFONT;
+#ifndef HAVE_GTK2
     gui.bold_font = NOFONT;
     gui.ital_font = NOFONT;
     gui.boldital_font = NOFONT;
-#ifdef FEAT_XFONTSET
+# ifdef FEAT_XFONTSET
     gui.fontset = NOFONTSET;
+# endif
 #endif
 
 #ifdef FEAT_MENU
-# ifdef FONTSET_ALWAYS
+# ifndef HAVE_GTK2
+#  ifdef FONTSET_ALWAYS
     gui.menu_fontset = NOFONTSET;
-# else
+#  else
     gui.menu_font = NOFONT;
+#  endif
 # endif
     gui.menu_is_active = TRUE;	    /* default: include menu */
 # ifndef FEAT_GUI_GTK
@@ -449,7 +458,7 @@ gui_init()
 	    gui_init_font(*p_guifont == NUL ? hl_get_font_name()
 						  : p_guifont, FALSE) == FAIL)
 	goto error2;
-#ifdef FEAT_MBYTE
+#if defined(FEAT_MBYTE) && !defined(HAVE_GTK2)
     if (gui_get_wide_font() == FAIL)
 	EMSG(_("E231: 'guifontwide' invalid"));
 #endif
@@ -618,7 +627,7 @@ gui_init_font(font_list, fontset)
 		 * longer be used! */
 		if (gui_mch_init_font(font_name, FALSE) == OK)
 		{
-#ifdef FEAT_MBYTE
+#if defined(FEAT_MBYTE) && !defined(HAVE_GTK2)
 		    /* If it's a Unicode font, try setting 'guifontwide' to a
 		     * similar double-width font. */
 		    if ((p_guifontwide == NULL || *p_guifontwide == NUL)
@@ -645,13 +654,15 @@ gui_init_font(font_list, fontset)
 
     if (ret == OK)
     {
+#ifndef HAVE_GTK2
 	/* Set normal font as current font */
-#ifdef FEAT_XFONTSET
+# ifdef FEAT_XFONTSET
 	if (gui.fontset != NOFONTSET)
 	    gui_mch_set_fontset(gui.fontset);
 	else
-#endif
+# endif
 	    gui_mch_set_font(gui.norm_font);
+#endif
 	gui_set_shellsize(FALSE,
 #ifdef MSWIN
 		TRUE
@@ -664,7 +675,7 @@ gui_init_font(font_list, fontset)
     return ret;
 }
 
-#if defined(FEAT_MBYTE) || defined(PROTO)
+#if (defined(FEAT_MBYTE) && !defined(HAVE_GTK2)) || defined(PROTO)
 /*
  * Try setting 'guifontwide' to a font twice as wide as "name".
  */
@@ -1741,7 +1752,7 @@ gui_outstr_nowrap(s, len, flags, fg, bg,
     long_u	hl_mask_todo;
     guicolor_T	fg_color;
     guicolor_T	bg_color;
-#ifndef MSWIN16_FASTTEXT
+#if !defined(MSWIN16_FASTTEXT) && !defined(HAVE_GTK2)
     GuiFont	font = NOFONT;
 # ifdef FEAT_XFONTSET
     GuiFontset	fontset = NOFONTSET;
@@ -1784,7 +1795,7 @@ gui_outstr_nowrap(s, len, flags, fg, bg,
 	highlight_mask = gui.highlight_mask;
     hl_mask_todo = highlight_mask;
 
-#ifndef MSWIN16_FASTTEXT
+#if !defined(MSWIN16_FASTTEXT) && !defined(HAVE_GTK2)
     /* Set the font */
     if (aep != NULL && aep->ae_u.gui.font != NOFONT)
 	font = aep->ae_u.gui.font;
@@ -1890,8 +1901,9 @@ gui_outstr_nowrap(s, len, flags, fg, bg,
     if (back != 0 && ((draw_flags & DRAW_BOLD) || (highlight_mask & HL_ITALIC)))
 	return FAIL;
 
-#ifdef RISCOS
-    /* If there's no italic font, then fake it */
+#if defined(RISCOS) || defined(HAVE_GTK2)
+    /* If there's no italic font, then fake it.
+     * For GTK2, we don't need a different font for italic style. */
     if (hl_mask_todo & HL_ITALIC)
 	draw_flags |= DRAW_ITALIC;
 
@@ -1927,7 +1939,9 @@ gui_outstr_nowrap(s, len, flags, fg, bg,
 	int	cl;		/* byte length of current char */
 	int	comping;	/* current char is composing */
 	int	scol = col;	/* screen column */
+# ifndef HAVE_GTK2
 	int	dowide;		/* use 'guifontwide' */
+# endif
 
 	/* Break the string at a composing character, it has to be drawn on
 	 * top of the previous character. */
@@ -1937,14 +1951,16 @@ gui_outstr_nowrap(s, len, flags, fg, bg,
 	{
 	    c = utf_ptr2char(s + i);
 	    cn = utf_char2cells(c);
+# ifndef HAVE_GTK2
 	    if (cn > 1
-# ifdef FEAT_XFONTSET
+#  ifdef FEAT_XFONTSET
 		    && fontset == NOFONTSET
-# endif
+#  endif
 		    && gui.wide_font != NOFONT)
 		dowide = TRUE;
 	    else
 		dowide = FALSE;
+# endif
 	    comping = utf_iscomposing(c);
 	    if (!comping)	/* count cells from non-composing chars */
 		cells += cn;
@@ -1954,19 +1970,26 @@ gui_outstr_nowrap(s, len, flags, fg, bg,
 
 	    /* print the string so far if it's the last character or there is
 	     * a composing character. */
-	    if (i + cl >= len || (comping && i > start) || dowide
-#if defined(FEAT_GUI_X11) || defined(FEAT_GUI_GTK)
+	    if (i + cl >= len || (comping && i > start)
+# ifndef HAVE_GTK2
+                    || dowide
+#  if defined(FEAT_GUI_X11) || defined(FEAT_GUI_GTK)
 		    || (cn > 1
-# ifdef FEAT_XFONTSET
+#   ifdef FEAT_XFONTSET
 			/* No fontset: At least draw char after wide char at
 			 * right position. */
 			&& fontset == NOFONTSET
-# endif
+#   endif
 		       )
-#endif
+#  endif
+# endif
 	       )
 	    {
-		if (comping || dowide)
+		if (comping
+# ifndef HAVE_GTK2
+                        || dowide
+# endif
+                    )
 		    thislen = i - start;
 		else
 		    thislen = i - start + cl;
@@ -1978,6 +2001,7 @@ gui_outstr_nowrap(s, len, flags, fg, bg,
 		}
 		scol += cells;
 		cells = 0;
+# ifndef HAVE_GTK2
 		if (dowide)
 		{
 		    gui_mch_set_font(gui.wide_font);
@@ -1987,16 +2011,17 @@ gui_outstr_nowrap(s, len, flags, fg, bg,
 		    start += cl;
 		}
 
-#if defined(FEAT_GUI_X11) || defined(FEAT_GUI_GTK)
+#  if defined(FEAT_GUI_X11) || defined(FEAT_GUI_GTK)
 		/* No fontset: draw a space to fill the gap after a wide char */
 		if (cn > 1 && (draw_flags & DRAW_TRANSP) == 0
-# ifdef FEAT_XFONTSET
+#   ifdef FEAT_XFONTSET
 			&& fontset == NOFONTSET
-# endif
+#   endif
 			&& !dowide)
 		    gui_mch_draw_string(gui.row, scol - 1, (char_u *)" ",
 							       1, draw_flags);
-#endif
+#  endif
+# endif /* !HAVE_GTK2 */
 	    }
 	    /* Draw a composing char on top of the previous char. */
 	    if (comping)
@@ -2757,9 +2782,9 @@ button_set:
 
     /*
      * We need to make sure this is cleared since Athena doesn't tell us when
-     * he is done dragging.
+     * he is done dragging.  Neither does GTK+ 2 -- at least for now.
      */
-#ifdef FEAT_GUI_ATHENA
+#if defined(FEAT_GUI_ATHENA) || defined(HAVE_GTK2)
     gui.dragged_sb = SBAR_NONE;
 #endif
 }
@@ -3026,7 +3051,7 @@ gui_find_scrollbar(ident)
 /*
  * For most systems: Put a code in the input buffer for a dragged scrollbar.
  *
- * For Win32 and Macintosh:
+ * For Win32, Macintosh and GTK+ 2:
  * Scrollbars seem to grab focus and vim doesn't read the input queue until
  * you stop dragging the scrollbar.  We get here each time the scrollbar is
  * dragged another pixel, but as far as the rest of vim goes, it thinks
Index: src/gui.h
===================================================================
RCS file: /cvsroot/vim/vim/src/gui.h,v
retrieving revision 1.26
diff -u -3 -p -r1.26 gui.h
--- src/gui.h	5 May 2002 03:40:02 -0000	1.26
+++ src/gui.h	6 Feb 2003 17:52:29 -0000
@@ -33,6 +33,9 @@
 #ifdef FEAT_GUI_GTK
 # include <X11/Intrinsic.h>
 # include <gtk/gtk.h>
+# if GTK_CHECK_VERSION(2,1,1)
+#  define GTK2_MULTIHEAD
+# endif
 #endif
 
 #ifdef FEAT_GUI_BEOS
@@ -77,7 +80,7 @@
 # define ALWAYS_USE_GUI
 #endif
 
-#if defined(FEAT_GUI_MSWIN) || defined(FEAT_GUI_MAC)
+#if defined(FEAT_GUI_MSWIN) || defined(FEAT_GUI_MAC) || defined(HAVE_GTK2)
 # define USE_ON_FLY_SCROLL
 #endif
 
@@ -152,7 +155,7 @@
 #define DRAW_TRANSP		0x01	/* draw with transparant bg */
 #define DRAW_BOLD		0x02	/* draw bold text */
 #define DRAW_UNDERL		0x04	/* draw underline text */
-#ifdef RISCOS
+#if defined(RISCOS) || defined(HAVE_GTK2)
 # define DRAW_ITALIC		0x08	/* draw italic text */
 #endif
 #define DRAW_CURSOR		0x10	/* drawing block cursor (win32) */
@@ -229,8 +232,13 @@ typedef long	    guicolor_T;	/* handle f
 				   actual color */
 
 #ifdef FEAT_GUI_GTK
+# ifdef HAVE_GTK2
+  typedef PangoFontDescription	*GuiFont;       /* handle for a GUI font */
+  typedef PangoFontDescription  *GuiFontset;    /* handle for a GUI fontset */
+# else
   typedef GdkFont	*GuiFont;	/* handle for a GUI font */
   typedef GdkFont	*GuiFontset;	/* handle for a GUI fontset */
+# endif
 # define NOFONT		(GuiFont)NULL
 # define NOFONTSET	(GuiFontset)NULL
 #else
@@ -301,19 +309,28 @@ typedef struct Gui
     int		char_ascent;	    /* Ascent of char in pixels */
     int		border_width;	    /* Width of our border around text area */
     int		border_offset;	    /* Total pixel offset for all borders */
+
     GuiFont	norm_font;	    /* Normal font */
+#ifndef HAVE_GTK2
     GuiFont	bold_font;	    /* Bold font */
     GuiFont	ital_font;	    /* Italic font */
     GuiFont	boldital_font;	    /* Bold-Italic font */
-#ifdef FEAT_MENU
-# ifdef FONTSET_ALWAYS
+#else
+    int         font_can_bold;      /* Whether norm_font supports bold weight.
+                                     * The styled font variants are not used. */
+#endif
+
+#ifndef HAVE_GTK2
+# ifdef FEAT_MENU
+#  ifdef FONTSET_ALWAYS
     GuiFontset	menu_fontset;	    /* set of fonts for multi-byte chars */
-# else
+#  else
     GuiFont	menu_font;	    /* menu item font */
+#  endif
 # endif
-#endif
-#ifdef FEAT_MBYTE
+# ifdef FEAT_MBYTE
     GuiFont	wide_font;	    /* 'guifontwide' font */
+# endif
 #endif
 #ifdef FEAT_XFONTSET
     GuiFontset	fontset;	    /* set of fonts for multi-byte chars */
@@ -383,14 +400,21 @@ typedef struct Gui
 # endif
     GdkColor	*fgcolor;	    /* GDK-styled foreground color */
     GdkColor	*bgcolor;	    /* GDK-styled background color */
-
-    GdkFont	*current_font;
+# ifndef HAVE_GTK2
+    GuiFont	current_font;
+# endif
     GdkGC	*text_gc;	    /* cached GC for normal text */
+# ifdef HAVE_GTK2
+    PangoContext     *text_context; /* the context used for all text */
+    PangoFont        *ascii_font;   /* cached font for ASCII strings */
+    PangoGlyphString *ascii_glyphs; /* cached code point -> glyph map */
+# endif
 
     GtkAccelGroup *accel_group;
+# ifndef HAVE_GTK2
     GtkWidget	*fontdlg;	    /* font selection dialog window */
     char_u	*fontname;	    /* font name from font selection dialog */
-
+# endif
     GtkWidget	*filedlg;	    /* file selection dialog */
     char_u	*browse_fname;	    /* file name from filedlg */
 #endif	/* FEAT_GUI_GTK */
@@ -483,7 +507,8 @@ typedef enum
     VW_POS_MOUSE,
     VW_POS_CENTER,
     VW_POS_TOP_CENTER
-} gui_win_pos_T;
+}
+gui_win_pos_T;
 
 #if defined(FEAT_GUI_MOTIF) || defined(FEAT_GUI_GTK) \
 	|| defined(MSWIN_FIND_REPLACE)
Index: src/gui_gtk.c
===================================================================
RCS file: /cvsroot/vim/vim/src/gui_gtk.c,v
retrieving revision 1.39
diff -u -3 -p -r1.39 gui_gtk.c
--- src/gui_gtk.c	28 Oct 2002 23:14:46 -0000	1.39
+++ src/gui_gtk.c	6 Feb 2003 17:52:30 -0000
@@ -14,6 +14,14 @@
  *
  * With GREAT support and continuous encouragements by Andy Kahn and of
  * course Bram Moolenaar!
+ *
+ * Support for GTK+ 2 was added by:
+ *
+ * Â© 2002,2003  Jason Hildebrand  <jason@peaceworks.ca>
+ *              Daniel Elstner  <daniel.elstner@gmx.net>
+ *
+ * Best supporting actor (He helped somewhat, aesthetically speaking):
+ * Maxime Romano <verbophobe@hotmail.com>
  */
 
 #ifdef FEAT_GUI_GTK
@@ -49,7 +57,7 @@
 # include <gnome.h>
 #endif
 
-#if defined(FEAT_GUI_DIALOG)
+#if defined(FEAT_GUI_DIALOG) && !defined(HAVE_GTK2)
 # include "../pixmaps/alert.xpm"
 # include "../pixmaps/error.xpm"
 # include "../pixmaps/generic.xpm"
@@ -57,7 +65,7 @@
 # include "../pixmaps/quest.xpm"
 #endif
 
-#ifdef FEAT_TOOLBAR
+#if defined(FEAT_TOOLBAR) && !defined(HAVE_GTK2)
 /*
  * Icons used by the toolbar code.
  */
@@ -94,7 +102,7 @@
 #include "../pixmaps/tb_vsplit.xpm"
 #include "../pixmaps/tb_maxwidth.xpm"
 #include "../pixmaps/tb_minwidth.xpm"
-#endif
+#endif /* FEAT_TOOLBAR && !HAVE_GTK2 */
 
 #ifdef FEAT_GUI_GTK
 # include <gdk/gdkkeysyms.h>
@@ -106,8 +114,10 @@
 /* define these items to be able to generate prototypes without GTK */
 typedef int GtkWidget;
 # define gpointer int
+# define guint8 int
 # define GdkPixmap int
 # define GdkBitmap int
+# define GtkIconFactory int
 # define GtkToolbar int
 # define GtkAdjustment int
 # define gboolean int
@@ -115,14 +125,209 @@ typedef int GtkWidget;
 # define CancelData int
 #endif
 
+#ifdef HAVE_GTK2
+/*
+ * Convenience macros to convert from 'encoding' to 'termencoding' if
+ * necessary.  If no conversion is necessary the passed-in pointer is
+ * returned as is, without allocating any memory.
+ *
+ * Defining these macros as pure expressions looks a bit tricky but
+ * avoids depending on the context of the macro expansion.  One of the
+ * rare occasions where the comma operator comes in handy :)
+ *
+ * Note that the _FREE() macros also set the pointer to NULL.  That's to
+ * avoid illegal memory access only happening if 'encoding' != utf-8...
+ */
+# define CONVERT_TO_UTF8(String) \
+    ((output_conv.vc_type == CONV_NONE || (String) == NULL) \
+        ? (String) : string_convert(&output_conv, (String), NULL))
+
+# define CONVERT_TO_UTF8_FREE(String) \
+    ((String) = (output_conv.vc_type == CONV_NONE) \
+                    ? NULL : (vim_free(String), NULL))
+
+# define CONVERT_FROM_UTF8(String) \
+    ((input_conv.vc_type == CONV_NONE || (String) == NULL) \
+        ? (String) : string_convert(&input_conv, (String), NULL))
+
+# define CONVERT_FROM_UTF8_FREE(String) \
+    ((String) = (input_conv.vc_type == CONV_NONE) \
+                    ? NULL : (vim_free(String), NULL))
+
+#endif /* HAVE_GTK2 */
+
 static void entry_activate_cb(GtkWidget *widget, GtkWidget *with);
 static void entry_changed_cb(GtkWidget *entry, GtkWidget *dialog);
 static void find_direction_cb(GtkWidget *widget, gpointer data);
-static void find_replace_cb(GtkWidget *widget, unsigned int flags);
+static void find_replace_cb(GtkWidget *widget, gpointer data);
 static void wword_match_cb(GtkWidget *widget, gpointer data);
 static void mcase_match_cb(GtkWidget *widget, gpointer data);
 static void repl_dir_cb(GtkWidget * widget, gpointer data);
 
+#if defined(FEAT_TOOLBAR) && defined(HAVE_GTK2)
+/*
+ * Table from BuiltIn## icon indices to GTK+ stock IDs.  Order must exactly
+ * match toolbar_names[] in menu.c!  All stock icons including the "vim-*"
+ * ones can be overridden in your gtkrc file.
+ */
+static const char * const menu_stock_ids[] =
+{
+    /* 00 */ GTK_STOCK_NEW,
+    /* 01 */ GTK_STOCK_OPEN,
+    /* 02 */ GTK_STOCK_SAVE,
+    /* 03 */ GTK_STOCK_UNDO,
+    /* 04 */ GTK_STOCK_REDO,
+    /* 05 */ GTK_STOCK_CUT,
+    /* 06 */ GTK_STOCK_COPY,
+    /* 07 */ GTK_STOCK_PASTE,
+    /* 08 */ GTK_STOCK_PRINT,
+    /* 09 */ GTK_STOCK_HELP,
+    /* 10 */ GTK_STOCK_FIND,
+    /* 11 */ "vim-save-all",
+    /* 12 */ "vim-session-save",
+    /* 13 */ "vim-session-new",
+    /* 14 */ "vim-session-load",
+    /* 15 */ GTK_STOCK_EXECUTE,
+    /* 16 */ GTK_STOCK_FIND_AND_REPLACE,
+    /* 17 */ GTK_STOCK_CLOSE,               /* FIXME: fuzzy */
+    /* 18 */ "vim-window-maximize",
+    /* 19 */ "vim-window-minimize",
+    /* 20 */ "vim-window-split",
+    /* 21 */ "vim-shell",
+    /* 22 */ GTK_STOCK_GO_BACK,
+    /* 23 */ GTK_STOCK_GO_FORWARD,
+    /* 24 */ "vim-find-help",
+    /* 25 */ GTK_STOCK_CONVERT,
+    /* 26 */ GTK_STOCK_JUMP_TO,
+    /* 27 */ "vim-build-tags",
+    /* 28 */ "vim-window-split-vertical",
+    /* 29 */ "vim-window-maximize-width",
+    /* 30 */ "vim-window-minimize-width",
+    /* 31 */ GTK_STOCK_QUIT
+};
+
+    static void
+add_stock_icon(GtkIconFactory   *factory,
+               const char       *stock_id,
+               const guint8     *inline_data,
+               int              data_length)
+{
+    GdkPixbuf   *pixbuf;
+    GtkIconSet  *icon_set;
+
+    pixbuf = gdk_pixbuf_new_from_inline(data_length, inline_data, FALSE, NULL);
+    icon_set = gtk_icon_set_new_from_pixbuf(pixbuf);
+
+    gtk_icon_factory_add(factory, stock_id, icon_set);
+
+    gtk_icon_set_unref(icon_set);
+    g_object_unref(pixbuf);
+}
+
+    static int
+lookup_menu_iconfile(char_u *iconfile, char_u *buffer, int bufsize)
+{
+    expand_env(iconfile, buffer, bufsize - 1);
+    buffer[bufsize - 1] = NUL;
+
+    if (mch_isFullName(buffer))
+    {
+        return vim_fexists(buffer);
+    }
+    else
+    {
+        char_u tempbuf[MAXPATHL + 1];
+
+        if (gui_find_bitmap(buffer, tempbuf, "png") == OK ||
+            gui_find_bitmap(buffer, tempbuf, "xpm") == OK ||
+            gui_find_bitmap(buffer, tempbuf, "bmp") == OK)
+        {
+            STRNCPY(buffer, tempbuf, bufsize);
+            buffer[bufsize - 1] = NUL;
+            return TRUE;
+        }
+
+        return FALSE;
+    }
+}
+
+    static GtkWidget *
+create_menu_icon(vimmenu_T *menu, GtkIconSize icon_size)
+{
+    GtkWidget *image = NULL;
+
+    if (menu->iconfile != NULL)
+    {
+        char_u buf[MAXPATHL + 1];
+
+        if (lookup_menu_iconfile(menu->iconfile, buf, sizeof(buf)))
+        {
+            GtkIconSet      *icon_set;
+            GtkIconSource   *icon_source;
+
+            icon_set = gtk_icon_set_new();
+            icon_source = gtk_icon_source_new();
+
+            gtk_icon_source_set_filename(icon_source, (const char *)buf);
+            gtk_icon_set_add_source(icon_set, icon_source);
+
+            image = gtk_image_new_from_icon_set(icon_set, icon_size);
+
+            gtk_icon_source_free(icon_source);
+            gtk_icon_set_unref(icon_set);
+        }
+    }
+
+    if (image == NULL)
+    {
+        const char *stock_id;
+
+        if (menu->iconidx >= 0 && menu->iconidx < G_N_ELEMENTS(menu_stock_ids))
+            stock_id = menu_stock_ids[menu->iconidx];
+        else
+            stock_id = GTK_STOCK_MISSING_IMAGE;
+
+        image = gtk_image_new_from_stock(stock_id, icon_size);
+    }
+
+    return image;
+}
+
+#endif /* FEAT_TOOLBAR && HAVE_GTK2 */
+
+#if (defined(FEAT_TOOLBAR) && defined(HAVE_GTK2)) || defined(PROTO)
+
+    void
+gui_gtk_register_stock_icons(void)
+{
+#   include "../pixmaps/stock_icons.h"
+    GtkIconFactory *factory;
+
+    factory = gtk_icon_factory_new();
+#   define ADD_ICON(Name, Data) add_stock_icon(factory, Name, Data, sizeof(Data))
+
+    ADD_ICON("vim-build-tags",            stock_vim_build_tags);
+    ADD_ICON("vim-find-help",             stock_vim_find_help);
+    ADD_ICON("vim-save-all",              stock_vim_save_all);
+    ADD_ICON("vim-session-load",          stock_vim_session_load);
+    ADD_ICON("vim-session-new",           stock_vim_session_new);
+    ADD_ICON("vim-session-save",          stock_vim_session_save);
+    ADD_ICON("vim-shell",                 stock_vim_shell);
+    ADD_ICON("vim-window-maximize",       stock_vim_window_maximize);
+    ADD_ICON("vim-window-maximize-width", stock_vim_window_maximize_width);
+    ADD_ICON("vim-window-minimize",       stock_vim_window_minimize);
+    ADD_ICON("vim-window-minimize-width", stock_vim_window_minimize_width);
+    ADD_ICON("vim-window-split",          stock_vim_window_split);
+    ADD_ICON("vim-window-split-vertical", stock_vim_window_split_vertical);
+
+#   undef ADD_ICON
+    gtk_icon_factory_add_default(factory);
+    g_object_unref(factory);
+}
+
+#endif /* FEAT_TOOLBAR && HAVE_GTK2 */
+
+
 /*
  * Only use accelerators when gtk_menu_ensure_uline_accel_group() is
  * available, which is in version 1.2.1.  That was the first version where
@@ -136,6 +341,99 @@ static void repl_dir_cb(GtkWidget * widg
 
 #if defined(FEAT_MENU) || defined(PROTO)
 
+# ifdef HAVE_GTK2
+/*
+ * Translate VIM mnemonic tagging into GTK+'s and convert to UTF-8
+ * if necessary.  The caller must vim_free() the translated string.
+ */
+    static char_u *
+translate_mnemonic_tag(char_u *name, int use_mnemonic)
+{
+    char_u  *buf;
+    char_u  *psrc;
+    char_u  *pdest;
+    int     n_underscores = 0;
+
+    name = CONVERT_TO_UTF8(name);
+
+    for (psrc = name; *psrc != NUL && *psrc != TAB; ++psrc)
+        if (*psrc == '_')
+            ++n_underscores;
+
+    buf = alloc((psrc - name) + n_underscores + 1);
+    pdest = buf;
+
+    for (psrc = name; *psrc != NUL && *psrc != TAB; ++psrc)
+    {
+        if (*psrc == '_')
+        {
+            *pdest++ = '_';
+            *pdest++ = '_';
+        }
+        else if (*psrc != '&')
+        {
+            *pdest++ = *psrc;
+        }
+        else if (*(psrc + 1) == '&')
+        {
+            *pdest++ = *psrc++;
+        }
+        else if (use_mnemonic)
+        {
+            *pdest++ = '_';
+        }
+    }
+
+    *pdest = NUL;
+
+    CONVERT_TO_UTF8_FREE(name);
+
+    return buf;
+}
+
+/*ARGSUSED*/
+    static void
+menu_item_new(vimmenu_T *menu, GtkWidget *parent_widget, int sub_menu)
+{
+    GtkWidget   *box;
+    char_u      *name;
+    char_u      *actext;
+    int         use_mnemonic;
+
+    /* It would be neat to have image menu items, but that requires major
+     * changes to Vim's menu system.  Not to mention that all the translations
+     * had to be updated.
+     */
+    menu->id = gtk_menu_item_new();
+    box = gtk_hbox_new(FALSE, 20);
+
+    use_mnemonic = (p_wak[0] != 'n' || !GTK_IS_MENU_BAR(parent_widget));
+    name = translate_mnemonic_tag(menu->name, use_mnemonic);
+
+    menu->label = gtk_label_new_with_mnemonic((const char *)name);
+    vim_free(name);
+
+    gtk_box_pack_start(GTK_BOX(box), menu->label, FALSE, FALSE, 0);
+
+    actext = menu->actext;
+
+    if (actext != NULL && actext[0] != NUL)
+    {
+        actext = CONVERT_TO_UTF8(actext);
+
+        gtk_box_pack_end(GTK_BOX(box),
+                         gtk_label_new((const char *)actext),
+                         FALSE, FALSE, 0);
+
+        CONVERT_TO_UTF8_FREE(actext);
+    }
+
+    gtk_container_add(GTK_CONTAINER(menu->id), box);
+    gtk_widget_show_all(menu->id);
+}
+
+# else /* !HAVE_GTK2 */
+
 /*
  * Create a highly customized menu item by hand instead of by using:
  *
@@ -186,6 +484,7 @@ menu_item_new(vimmenu_T *menu, GtkWidget
      * score for each understore that appears in the menu name.
      */
 
+
     /* First count how many underscore's are in the menu name. */
     for (num = 0, tmp = (char *)menu->name; *tmp; tmp++)
 	if (*tmp == '_')
@@ -203,13 +502,13 @@ menu_item_new(vimmenu_T *menu, GtkWidget
 	    break;
 	if (*tmp == '&')
 	{
-# ifdef GTK_USE_ACCEL
+#  ifdef GTK_USE_ACCEL
 	    if (*p_wak != 'n' || !GTK_IS_MENU_BAR(parent_widget))
 	    {
 		name[num] = '_';
 		num++;
 	    }
-# endif
+#  endif
 	}
 	else
 	{
@@ -224,11 +523,12 @@ menu_item_new(vimmenu_T *menu, GtkWidget
     }
     name[num] = '\0';
 
+
     /* let GTK do its thing */
     accel_key = gtk_label_parse_uline(GTK_LABEL(label), name);
     g_free(name);
 
-# ifdef GTK_USE_ACCEL
+#  ifdef GTK_USE_ACCEL
     /* Don't add accelator if 'winaltkeys' is "no". */
     if (accel_key != GDK_VoidSymbol)
     {
@@ -250,11 +550,12 @@ menu_item_new(vimmenu_T *menu, GtkWidget
 		    GTK_ACCEL_LOCKED);
 	}
     }
-# endif
+#  endif /* GTK_USE_ACCEL */
 
     menu->id = widget;
 }
 
+# endif /* !HAVE_GTK2 */
 
 /*ARGSUSED*/
     void
@@ -281,20 +582,25 @@ gui_mch_add_menu(vimmenu_T *menu, int id
 	return;			/* failed */
 
     if (parent == NULL)
-	gtk_menu_bar_insert(GTK_MENU_BAR(gui.menubar), menu->id, idx);
+	gtk_menu_shell_insert(GTK_MENU_SHELL(gui.menubar), menu->id, idx);
     else
     {
 	/* since the tearoff should always appear first, increment idx */
 	++idx;
-	gtk_menu_insert(GTK_MENU(parent->submenu_id), menu->id, idx);
+	gtk_menu_shell_insert(GTK_MENU_SHELL(parent->submenu_id), menu->id, idx);
     }
 
     /*
      * The "Help" menu is a special case, and should be placed at the far
      * right hand side of the menu-bar.  It's detected by its high priority.
+     *
+     * Right-aligning "Help" is considered bad UI design nowadays.
+     * Thus lets disable this for GTK+ 2 to match the environment.
      */
+#ifndef HAVE_GTK2
     if (parent == NULL && menu->priority >= 9999)
 	gtk_menu_item_right_justify(GTK_MENU_ITEM(menu->id));
+#endif
 
     if ((menu->submenu_id = gtk_menu_new()) == NULL)	/* failed */
 	return;
@@ -319,7 +625,7 @@ menu_item_activate(GtkWidget * widget, g
 	gtk_main_quit();
 }
 
-#ifdef FEAT_TOOLBAR
+# if defined(FEAT_TOOLBAR) && !defined(HAVE_GTK2)
 /*
  * These are the pixmaps used for the default buttons.
  * Order must exactly match toolbar_names[] in menu.c!
@@ -415,23 +721,54 @@ pixmap_create_from_file(char_u *fname, G
 		&gui.mainwin->style->bg[GTK_STATE_NORMAL],
 		(const char *)fname);
 }
-#endif
+
+# endif /* FEAT_TOOLBAR && !HAVE_GTK2 */
 
 /*ARGSUSED*/
     void
 gui_mch_add_menu_item(vimmenu_T *menu, int idx)
 {
-    vimmenu_T	*parent = menu->parent;
+    vimmenu_T *parent;
+
+    parent = menu->parent;
 
 # ifdef FEAT_TOOLBAR
     if (menu_is_toolbar(parent->name))
     {
-	if (menu_is_separator(menu->name))
-	{
-	    gtk_toolbar_insert_space(GTK_TOOLBAR(gui.toolbar), idx);
-	}
-	else
-	{
+        GtkToolbar *toolbar;
+
+        toolbar = GTK_TOOLBAR(gui.toolbar);
+        menu->submenu_id = NULL;
+
+        if (menu_is_separator(menu->name))
+        {
+            gtk_toolbar_insert_space(toolbar, idx);
+            menu->id = NULL;
+        }
+        else
+        {
+#  ifdef HAVE_GTK2
+            char_u *text;
+            char_u *tooltip;
+
+            text    = CONVERT_TO_UTF8(menu->dname);
+            tooltip = CONVERT_TO_UTF8(menu->strings[MENU_INDEX_TIP]);
+
+            menu->id = gtk_toolbar_insert_item(
+                           toolbar,
+                           (const char *)text,
+                           (const char *)tooltip,
+                           NULL,
+                           create_menu_icon(menu, gtk_toolbar_get_icon_size(toolbar)),
+                           G_CALLBACK(menu_item_activate),
+                           menu,
+                           idx);
+
+            CONVERT_TO_UTF8_FREE(text);
+            CONVERT_TO_UTF8_FREE(tooltip);
+
+#  else /* !HAVE_GTK2 */
+
 	    GdkPixmap *pixmap = NULL;
 	    GdkBitmap *mask = NULL;
 
@@ -453,7 +790,7 @@ gui_mch_add_menu_item(vimmenu_T *menu, i
 		return; /* should at least have blank pixmap, but if not... */
 
 	    menu->id = gtk_toolbar_insert_item(
-				    GTK_TOOLBAR(gui.toolbar),
+				    toolbar,
 				    (char *)(menu->dname),
 				    (char *)(menu->strings[MENU_INDEX_TIP]),
 				    (char *)(menu->dname),
@@ -461,40 +798,40 @@ gui_mch_add_menu_item(vimmenu_T *menu, i
 				    GTK_SIGNAL_FUNC(menu_item_activate),
 				    (gpointer)menu,
 				    idx);
+#  endif /* !HAVE_GTK2 */
 	}
-	menu->parent = parent;
-	menu->submenu_id = NULL;
-	return;
-    } /* toolbar menu item */
-# endif
-
-    /* No parent, must be a non-menubar menu */
-    if (parent->submenu_id == 0)
-	return;
-
-    /* make place for the possible tearoff handle item */
-    ++idx;
-    if (menu_is_separator(menu->name))
-    {
-	/* Separator: Just add it */
-	menu->id = gtk_menu_item_new();
-	gtk_widget_set_sensitive(menu->id, FALSE);
-	gtk_widget_show(menu->id);
-	gtk_menu_insert(GTK_MENU(parent->submenu_id), menu->id, idx);
-
-	return;
     }
-
-    /* Add textual menu item. */
-    menu_item_new(menu, parent->submenu_id, FALSE);
-    gtk_widget_show(menu->id);
-    gtk_menu_insert(GTK_MENU(parent->submenu_id), menu->id, idx);
-
-    if (menu->id != 0)
-	gtk_signal_connect(GTK_OBJECT(menu->id), "activate",
-		GTK_SIGNAL_FUNC(menu_item_activate), (gpointer) menu);
+    else
+# endif /* FEAT_TOOLBAR */
+    {
+        /* No parent, must be a non-menubar menu */
+        if (parent->submenu_id == NULL)
+            return;
+
+        /* make place for the possible tearoff handle item */
+        ++idx;
+        if (menu_is_separator(menu->name))
+        {
+            /* Separator: Just add it */
+            menu->id = gtk_menu_item_new();
+            gtk_widget_set_sensitive(menu->id, FALSE);
+            gtk_widget_show(menu->id);
+            gtk_menu_insert(GTK_MENU(parent->submenu_id), menu->id, idx);
+
+            return;
+        }
+
+        /* Add textual menu item. */
+        menu_item_new(menu, parent->submenu_id, FALSE);
+        gtk_widget_show(menu->id);
+        gtk_menu_insert(GTK_MENU(parent->submenu_id), menu->id, idx);
+
+        if (menu->id != NULL)
+            gtk_signal_connect(GTK_OBJECT(menu->id), "activate",
+                               GTK_SIGNAL_FUNC(menu_item_activate), menu);
+    }
 }
-#endif
+#endif /* FEAT_MENU */
 
 
     void
@@ -508,6 +845,27 @@ gui_mch_set_text_area_pos(int x, int y, 
 /*
  * Enable or disable accelators for the toplevel menus.
  */
+
+# ifdef HAVE_GTK2
+    void
+gui_gtk_set_mnemonics(int enable)
+{
+    vimmenu_T   *menu;
+    char_u      *name;
+
+    for (menu = root_menu; menu != NULL; menu = menu->next)
+    {
+        if (menu->id == NULL)
+            continue;
+
+        name = translate_mnemonic_tag(menu->name, enable);
+        gtk_label_set_text_with_mnemonic(GTK_LABEL(menu->label), (const char *)name);
+        vim_free(name);
+    }
+}
+
+# else /* !HAVE_GTK2 */
+
 /*ARGSUSED*/
     void
 gui_gtk_set_mnemonics(int enable)
@@ -585,7 +943,7 @@ gui_gtk_set_mnemonics(int enable)
 		    accel_key, GDK_MOD1_MASK);
     }
 }
-
+#endif /* !HAVE_GTK2 */
 
     static void
 recurse_tearoffs(vimmenu_T *menu, int val)
@@ -607,21 +965,25 @@ recurse_tearoffs(vimmenu_T *menu, int va
     }
 }
 
-
     void
 gui_mch_toggle_tearoffs(int enable)
 {
     recurse_tearoffs(root_menu, enable);
 }
-#endif
-
+#endif /* FEAT_MENU */
 
-#ifdef FEAT_TOOLBAR
 
+#if defined(FEAT_TOOLBAR) && !defined(HAVE_GTK2)
 /*
  * Seems like there's a hole in the GTK Toolbar API: there's no provision for
  * removing an item from the toolbar.  Therefore I need to resort to going
  * really deeply into the internal widget structures.
+ *
+ * <danielk> I'm not sure the statement above is true -- at least with
+ * GTK+ 2 one can just call gtk_widget_destroy() and be done with it.
+ * It is true though that you couldn't remove space items before GTK+ 2
+ * (without digging into the internals that is).  But the code below
+ * doesn't seem to handle those either.  Well, it's obsolete anyway.
  */
     static void
 toolbar_remove_item_by_text(GtkToolbar *tb, const char *text)
@@ -658,7 +1020,40 @@ toolbar_remove_item_by_text(GtkToolbar *
 	}
     }
 }
-#endif
+#endif /* FEAT_TOOLBAR && !HAVE_GTK2 */
+
+
+#if defined(FEAT_TOOLBAR) && defined(HAVE_GTK2)
+    void
+gui_mch_menu_set_tip(vimmenu_T *menu)
+{
+    if (menu->id != NULL && menu->parent != NULL &&
+        gui.toolbar != NULL && menu_is_toolbar(menu->parent->name))
+    {
+        char_u *tooltip;
+
+        tooltip = CONVERT_TO_UTF8(menu->strings[MENU_INDEX_TIP]);
+
+        gtk_tooltips_set_tip(GTK_TOOLBAR(gui.toolbar)->tooltips,
+                             menu->id, (const char *)tooltip, NULL);
+
+        CONVERT_TO_UTF8_FREE(tooltip);
+    }
+}
+
+    static int
+get_tool_position(vimmenu_T *menu)
+{
+    vimmenu_T   *node;
+    int         index = 0;
+
+    for (node = menu->parent->children; node != menu; node = node->next)
+        ++index;
+
+    return index;
+}
+#endif /* FEAT_TOOLBAR && HAVE_GTK2 */
+
 
 #if defined(FEAT_MENU) || defined(PROTO)
 /*
@@ -667,26 +1062,32 @@ toolbar_remove_item_by_text(GtkToolbar *
     void
 gui_mch_destroy_menu(vimmenu_T *menu)
 {
-#ifdef FEAT_TOOLBAR
+# ifdef FEAT_TOOLBAR
     if (menu->parent && menu_is_toolbar(menu->parent->name))
     {
-	toolbar_remove_item_by_text(GTK_TOOLBAR(gui.toolbar),
-					    (const char *)menu->dname);
-	return;
+#  ifdef HAVE_GTK2
+        if (menu_is_separator(menu->name))
+            gtk_toolbar_remove_space(GTK_TOOLBAR(gui.toolbar),
+                                     get_tool_position(menu));
+        else
+            gtk_widget_destroy(menu->id);
+#  else
+        toolbar_remove_item_by_text(GTK_TOOLBAR(gui.toolbar),
+                                    (const char *)menu->dname);
+#  endif
     }
-#endif
-
-    if (menu->submenu_id != 0)
-    {
-	gtk_widget_destroy(menu->submenu_id);
-	menu->submenu_id = 0;
-    }
-    if (menu->id != 0)
+    else
+# endif /* FEAT_TOOLBAR */
     {
-	/* parent = gtk_widget_get_parent(menu->id); */
-	gtk_widget_destroy(menu->id);
-	menu->id = 0;
+        if (menu->submenu_id != NULL)
+            gtk_widget_destroy(menu->submenu_id);
+
+        if (menu->id != NULL)
+            gtk_widget_destroy(menu->id);
     }
+
+    menu->submenu_id = NULL;
+    menu->id = NULL;
 }
 #endif /* FEAT_MENU */
 
@@ -738,15 +1139,27 @@ adjustment_value_changed(GtkAdjustment *
     if (did_ask_for_change)
 	return;
 
-    sb = gui_find_scrollbar((long) data);
+    sb = gui_find_scrollbar(GPOINTER_TO_INT(data));
     value = adjustment->value;
 
     /* The dragging argument must be right for the scrollbar to work with
      * closed folds.  This isn't documented, hopefully this will keep on
-     * working in later GTK versions. */
+     * working in later GTK versions.
+     *
+     * GTK2_FIXME: Well, it doesn't work in GTK2. :)
+     * OK, I experimented with GTK_WIDGET_HAS_GRAB() and it seemed to work
+     * to some extent.  But simply setting dragging = TRUE all the time
+     * seems to work better :/
+     */
     if (sb != NULL)
-	dragging = GTK_RANGE((GtkScrollbar *)sb->id)->scroll_type
-							   == GTK_SCROLL_NONE;
+    {
+#ifdef HAVE_GTK2
+        dragging = TRUE;
+#else
+        dragging = (GTK_RANGE(sb->id)->scroll_type == GTK_SCROLL_NONE);
+#endif
+    }
+
     gui_drag_scrollbar(sb, value, dragging);
 
     if (gtk_main_level() > 0)
@@ -771,13 +1184,13 @@ gui_mch_create_scrollbar(scrollbar_T * s
     }
     if (sb->id != NULL)
     {
-	GtkAdjustment *adjustment;
+        GtkAdjustment *adjustment;
 
-	adjustment = gtk_range_get_adjustment(
-		GTK_RANGE((GtkScrollbar *)sb->id));
-	gtk_signal_connect(GTK_OBJECT(adjustment), "value_changed",
-		(GtkSignalFunc)adjustment_value_changed,
-			   (gpointer)sb->ident);
+        adjustment = gtk_range_get_adjustment(GTK_RANGE(sb->id));
+
+        gtk_signal_connect(GTK_OBJECT(adjustment), "value_changed",
+                           GTK_SIGNAL_FUNC(adjustment_value_changed),
+                           GINT_TO_POINTER(sb->ident));
     }
     gui_mch_update();
 }
@@ -786,10 +1199,10 @@ gui_mch_create_scrollbar(scrollbar_T * s
     void
 gui_mch_destroy_scrollbar(scrollbar_T * sb)
 {
-    if (sb->id != 0)
+    if (sb->id != NULL)
     {
-	gtk_widget_destroy(sb->id);
-	sb->id = 0;
+        gtk_widget_destroy(sb->id);
+        sb->id = NULL;
     }
     gui_mch_update();
 }
@@ -872,6 +1285,10 @@ gui_mch_browse(int saving,
     char_u dirbuf[MAXPATHL];
     char_u *p;
 
+# ifdef HAVE_GTK2
+    title = CONVERT_TO_UTF8(title);
+# endif
+
     if (!gui.filedlg)
     {
 	gui.filedlg = gtk_file_selection_new((const gchar *)title);
@@ -894,6 +1311,10 @@ gui_mch_browse(int saving,
     else
 	gtk_window_set_title(GTK_WINDOW(gui.filedlg), (const gchar *)title);
 
+# ifdef HAVE_GTK2
+    CONVERT_TO_UTF8_FREE(title);
+# endif
+
     /* if our pointer is currently hidden, then we should show it. */
     gui_mch_mousehide(FALSE);
 
@@ -912,9 +1333,10 @@ gui_mch_browse(int saving,
 
     gtk_file_selection_set_filename(GTK_FILE_SELECTION(gui.filedlg),
 						      (const gchar *)dirbuf);
-
+# ifndef HAVE_GTK2
     gui_gtk_position_in_parent(GTK_WIDGET(gui.mainwin),
 				       GTK_WIDGET(gui.filedlg), VW_POS_MOUSE);
+# endif
 
     gtk_widget_show(gui.filedlg);
     while (gui.filedlg && GTK_WIDGET_DRAWABLE(gui.filedlg))
@@ -933,7 +1355,7 @@ gui_mch_browse(int saving,
 
 #endif	/* FEAT_BROWSE */
 
-#if defined(FEAT_GUI_DIALOG) || defined(PROTO)
+#if (defined(FEAT_GUI_DIALOG) && !defined(HAVE_GTK2)) || defined(PROTO)
 
 static char_u *dialog_textfield = NULL;
 static GtkWidget *dialog_textentry;
@@ -941,16 +1363,15 @@ static GtkWidget *dialog_textentry;
     static void
 dlg_destroy(GtkWidget *dlg)
 {
-    gchar *p;
-
     if (dialog_textfield != NULL)
     {
-	/* Get the text from the textentry widget. */
-	p = gtk_editable_get_chars(GTK_EDITABLE(dialog_textentry),
-							       0, IOSIZE - 1);
-	STRCPY(dialog_textfield, p);
-	g_free(p);
+        char *text;
+
+        text = gtk_entry_get_text(GTK_ENTRY(dialog_textentry));
+        STRNCPY(dialog_textfield, text, IOSIZE);
+        dialog_textfield[IOSIZE - 1] = NUL;
     }
+
     /* Destroy the dialog, will break the waiting loop. */
     gtk_widget_destroy(dlg);
 }
@@ -1164,13 +1585,12 @@ gui_mch_dialog(	int	type,		/* type of di
     GtkWidget		*frame;
     GtkWidget		*vbox;
     GtkWidget		*table;
-    GtkWidget		*pixmap;
     GtkWidget		*dialogmessage;
     GtkWidget		*action_area;
     GtkWidget		*sub_area;
     GtkWidget		*separator;
     GtkAccelGroup	*accel_group;
-
+    GtkWidget		*pixmap;
     GdkPixmap		*icon = NULL;
     GdkBitmap		*mask = NULL;
     char		**icon_data = NULL;
@@ -1194,10 +1614,10 @@ gui_mch_dialog(	int	type,		/* type of di
 
     if ((type < 0) || (type > VIM_LAST_TYPE))
 	type = VIM_GENERIC;
-
+    
     /* Check 'v' flag in 'guioptions': vertical button placement. */
     vertical = (vim_strchr(p_go, GO_VERTICAL) != NULL);
-
+    
     dialog = gtk_window_new(GTK_WINDOW_DIALOG);
     gtk_window_set_title(GTK_WINDOW(dialog), (const gchar *)title);
     gtk_window_set_transient_for(GTK_WINDOW(dialog), GTK_WINDOW(gui.mainwin));
@@ -1457,8 +1877,250 @@ gui_mch_dialog(	int	type,		/* type of di
     return dialog_status;
 }
 
+#endif /* FEAT_GUI_DIALOG && !HAVE_GTK2 */
+
+
+#if defined(FEAT_GUI_DIALOG) && defined(HAVE_GTK2)
+
+    static GtkWidget *
+create_message_dialog(int type, char_u *title, char_u *message)
+{
+    GtkWidget       *dialog;
+    GtkMessageType  message_type;
+
+    switch (type)
+    {
+        case VIM_ERROR:     message_type = GTK_MESSAGE_ERROR;    break;
+        case VIM_WARNING:   message_type = GTK_MESSAGE_WARNING;  break;
+        case VIM_QUESTION:  message_type = GTK_MESSAGE_QUESTION; break;
+        default:            message_type = GTK_MESSAGE_INFO;     break;
+    }
+
+    message = CONVERT_TO_UTF8(message);
+
+    dialog = gtk_message_dialog_new(GTK_WINDOW(gui.mainwin),
+                                    GTK_DIALOG_DESTROY_WITH_PARENT,
+                                    message_type,
+                                    GTK_BUTTONS_NONE,
+                                    "%s", (const char *)message);
+
+    CONVERT_TO_UTF8_FREE(message);
+
+    if (title != NULL)
+    {
+        title = CONVERT_TO_UTF8(title);
+        gtk_window_set_title(GTK_WINDOW(dialog), (const char *)title);
+        CONVERT_TO_UTF8_FREE(title);
+    }
+    else if (type == VIM_GENERIC)
+    {
+        gtk_window_set_title(GTK_WINDOW(dialog), "VIM");
+    }
+
+    return dialog;
+}
+
+    static char **
+split_button_string(char_u *button_string, int *n_buttons)
+{
+    const char  separator[] = { DLG_BUTTON_SEP, '\0' };
+    char        **buttons;
+    char        **pbutton;
+
+    button_string = CONVERT_TO_UTF8(button_string);
+    buttons = g_strsplit((const char *)button_string, separator, -1);
+    CONVERT_TO_UTF8_FREE(button_string);
+
+    for (pbutton = buttons; *pbutton != NULL; ++pbutton)
+    {
+        char *p;
+
+        for (p = *pbutton; *p != '\0'; ++p)
+            if (*p == '&')
+                *p = '_';
+    }
+
+    *n_buttons = pbutton - buttons;
+
+    return buttons;
+}
+
+    static char **
+split_button_translation(const char *message)
+{
+    const char  *p;
+    char        **buttons;
+    int         n_buttons;
+    int         n_expected = 1;
+
+    for (p = message; *p != '\0'; ++p)
+        if (*p == DLG_BUTTON_SEP)
+            ++n_expected;
+
+    buttons = split_button_string((char_u *)_(message), &n_buttons);
+
+    /* Uh-oh... this should never happen.  But well, we don't wanna
+     * crash if the translation is broken.
+     */
+    if (n_buttons != n_expected)
+    {
+        g_strfreev(buttons);
+        buttons = split_button_string((char_u *)message, &n_buttons);
+    }
+
+    return buttons;
+}
+
+    static int
+button_equal(const char *a, const char *b)
+{
+    while (*a != '\0' && *b != '\0')
+    {
+        if (*a == '_' && *++a == '\0')
+            break;
+        if (*b == '_' && *++b == '\0')
+            break;
+
+        if (g_unichar_tolower(g_utf8_get_char(a)) !=
+            g_unichar_tolower(g_utf8_get_char(b)))
+            return FALSE;
+
+        a = g_utf8_next_char(a);
+        b = g_utf8_next_char(b);
+    }
+
+    return (*a == '\0' && *b == '\0');
+}
+
+    static void
+dialog_add_buttons(GtkDialog *dialog, char_u *button_string)
+{
+    char    **ok;
+    char    **yesnocancel;
+    char    **buttons;
+    int     n_buttons;
+    int     index;
+
+    ok          = split_button_translation(N_("&Ok"));
+    yesnocancel = split_button_translation(N_("&Yes\n&No\n&Cancel"));
+    buttons     = split_button_string(button_string, &n_buttons);
+
+    /* Yes, the buttons are in reversed order to match the GNOME 2 desktop
+     * environment.  Don't hit me -- it's all about consistency.
+     */
+    for (index = n_buttons; index > 0; --index)
+    {
+        const char *label;
+
+        label = buttons[index - 1];
+
+        /* Perform some guesswork to find appropriate stock items for the
+         * buttons.  We have to compare with a sample of the translated
+         * button string to get things right.  Yes, this is hackish :/
+         *
+         * But even the common button labels aren't necessarily translated,
+         * since anyone can create their own dialogs using Vim functions.
+         * Thus we have to check for those too.
+         */
+        if      (button_equal(label, ok[0]))          label = GTK_STOCK_OK;
+        else if (button_equal(label, yesnocancel[0])) label = GTK_STOCK_YES;
+        else if (button_equal(label, yesnocancel[1])) label = GTK_STOCK_NO;
+        else if (button_equal(label, yesnocancel[2])) label = GTK_STOCK_CANCEL;
+        else if (button_equal(label, "Ok"))           label = GTK_STOCK_OK;
+        else if (button_equal(label, "Yes"))          label = GTK_STOCK_YES;
+        else if (button_equal(label, "No"))           label = GTK_STOCK_NO;
+        else if (button_equal(label, "Cancel"))       label = GTK_STOCK_CANCEL;
+
+        gtk_dialog_add_button(dialog, label, index);
+    }
+
+    g_strfreev(buttons);
+    g_strfreev(yesnocancel);
+    g_strfreev(ok);
+}
+
+    static void
+copy_dialog_input(char_u *textfield, const char *input)
+{
+    char_u *text;
+
+    text = CONVERT_FROM_UTF8((char_u *)input);
+    STRNCPY(textfield, text, IOSIZE);
+
+    if (input_conv.vc_type == CONV_NONE)
+    {
+        /* strip trailing partial character; just in case */
+        *g_utf8_find_prev_char((char *)textfield, (char *)textfield + IOSIZE) = NUL;
+    }
+    else
+    {
+        textfield[IOSIZE - 1] = NUL;
+        vim_free(text);
+    }
+}
+
+#endif /* FEAT_GUI_DIALOG && HAVE_GTK2 */
+
+
+#if (defined(FEAT_GUI_DIALOG) && defined(HAVE_GTK2)) || defined(PROTO)
+
+    int
+gui_mch_dialog(int      type,       /* type of dialog */
+               char_u   *title,     /* title of dialog */
+               char_u   *message,   /* message text */
+               char_u   *buttons,   /* names of buttons */
+               int      def_but,    /* default button */
+               char_u   *textfield) /* text for textfield or NULL */
+{
+    GtkWidget   *dialog;
+    GtkWidget   *entry = NULL;
+    int         response;
+
+    dialog = create_message_dialog(type, title, message);
+
+    dialog_add_buttons(GTK_DIALOG(dialog), buttons);
+
+    if (textfield != NULL)
+    {
+        GtkWidget   *alignment;
+        char_u      *text;
+
+        entry = gtk_entry_new();
+        gtk_widget_show(entry);
+
+        text = CONVERT_TO_UTF8(textfield);
+        gtk_entry_set_text(GTK_ENTRY(entry), (const char *)text);
+        CONVERT_TO_UTF8_FREE(text);
+
+        alignment = gtk_alignment_new(0.5, 0.5, 1.0, 1.0);
+        gtk_container_add(GTK_CONTAINER(alignment), entry);
+        gtk_container_set_border_width(GTK_CONTAINER(alignment), 5);
+        gtk_widget_show(alignment);
+
+        gtk_box_pack_start(GTK_BOX(GTK_DIALOG(dialog)->vbox),
+                           alignment, TRUE, FALSE, 0);
+    }
+
+    if (def_but > 0)
+        gtk_dialog_set_default_response(GTK_DIALOG(dialog), def_but);
+
+    response = gtk_dialog_run(GTK_DIALOG(dialog));
+
+    /* GTK_RESPONSE_NONE means the dialog has been programmatically destroyed.
+     */
+    if (response != GTK_RESPONSE_NONE)
+    {
+        if (textfield != NULL)
+            copy_dialog_input(textfield, gtk_entry_get_text(GTK_ENTRY(entry)));
+
+        gtk_widget_destroy(dialog);
+    }
+
+    return MAX(0, response);
+}
+
+#endif /* FEAT_GUI_DIALOG && HAVE_GTK2 */
 
-#endif	/* FEAT_GUI_DIALOG */
 
 #if defined(FEAT_MENU) || defined(PROTO)
     void
@@ -1525,10 +2187,61 @@ find_key_press_event(
     return FALSE;
 }
 
+#ifdef HAVE_GTK2
+    static GtkWidget *
+create_image_button(const char *stock_id, const char *label)
+{
+    char_u      *text;
+    GtkWidget   *box;
+    GtkWidget   *alignment;
+    GtkWidget   *button;
+
+    text = CONVERT_TO_UTF8((char_u *)label);
+
+    box = gtk_hbox_new(FALSE, 3);
+    gtk_box_pack_start(GTK_BOX(box),
+                       gtk_image_new_from_stock(stock_id, GTK_ICON_SIZE_BUTTON),
+                       FALSE, FALSE, 0);
+    gtk_box_pack_start(GTK_BOX(box),
+                       gtk_label_new((const char *)text),
+                       FALSE, FALSE, 0);
+
+    CONVERT_TO_UTF8_FREE(text);
+
+    alignment = gtk_alignment_new(0.5, 0.5, 0.0, 0.0);
+    gtk_container_add(GTK_CONTAINER(alignment), box);
+    gtk_widget_show_all(alignment);
+
+    button = gtk_button_new();
+    gtk_container_add(GTK_CONTAINER(button), alignment);
+
+    return button;
+}
+
+/*
+ * This is currently only used by find_replace_dialog_create(), and
+ * I'd really like to keep it at that.  In other words: don't spread
+ * this nasty hack all over the code.  Think twice.
+ */
+    static const char *
+convert_localized_message(char_u **buffer, const char *message)
+{
+    if (output_conv.vc_type == CONV_NONE)
+        return message;
+
+    vim_free(*buffer);
+    *buffer = string_convert(&output_conv, (char_u *)message, NULL);
+
+    return (const char *)*buffer;
+}
+#endif /* HAVE_GTK2 */
+
     static void
 find_replace_dialog_create(char_u *arg, int do_replace)
 {
+#ifndef HAVE_GTK2
     GtkWidget	*frame;
+#endif
     GtkWidget	*hbox;		/* main top down box */
     GtkWidget	*actionarea;
     GtkWidget	*table;
@@ -1539,23 +2252,39 @@ find_replace_dialog_create(char_u *arg, 
     char_u	*entry_text;
     int		wword = FALSE;
     int		mcase = !p_ic;
+#ifdef HAVE_GTK2
+    char_u      *conv_buffer = NULL;
+#   define CONV(message) convert_localized_message(&conv_buffer, (message))
+#else
+#   define CONV(message) (message)
+#endif
 
     frdp = (do_replace) ? (&repl_widgets) : (&find_widgets);
 
     /* Get the search string to use. */
     entry_text = get_find_dialog_text(arg, &wword, &mcase);
 
+#ifdef HAVE_GTK2
+    if (entry_text != NULL && output_conv.vc_type != CONV_NONE)
+    {
+        char_u *old_text = entry_text;
+        entry_text = string_convert(&output_conv, entry_text, NULL);
+        vim_free(old_text);
+    }
+#endif
+
     /*
      * If the dialog already exists, just raise it.
      */
     if (frdp->dialog)
     {
+#ifndef HAVE_GTK2
 	/* always make the dialog appear where you want it even if the mainwin
 	 * has moved -- dbv */
 	gui_gtk_position_in_parent(GTK_WIDGET(gui.mainwin),
 				      GTK_WIDGET(frdp->dialog), VW_POS_MOUSE);
-
 	gui_gtk_synch_fonts();
+#endif
 	if (!GTK_WIDGET_VISIBLE(frdp->dialog))
 	{
 	    gtk_widget_grab_focus(frdp->what);
@@ -1570,36 +2299,62 @@ find_replace_dialog_create(char_u *arg, 
 	    gtk_toggle_button_set_state(GTK_TOGGLE_BUTTON(frdp->mcase),
 							     (gboolean)mcase);
 	}
+#ifdef HAVE_GTK2
+        gtk_window_present(GTK_WINDOW(frdp->dialog));
+#else
 	gdk_window_raise(frdp->dialog->window);
-
+#endif
 	vim_free(entry_text);
 	return;
     }
 
+#ifdef HAVE_GTK2
+    frdp->dialog = gtk_dialog_new();
+    gtk_dialog_set_has_separator(GTK_DIALOG(frdp->dialog), FALSE);
+    gtk_window_set_transient_for(GTK_WINDOW(frdp->dialog), GTK_WINDOW(gui.mainwin));
+    gtk_window_set_destroy_with_parent(GTK_WINDOW(frdp->dialog), TRUE);
+#else
     frdp->dialog = gtk_window_new(GTK_WINDOW_DIALOG);
+#endif
+
     if (do_replace)
     {
+#ifndef HAVE_GTK2
 	gtk_window_set_wmclass(GTK_WINDOW(frdp->dialog), "searchrepl", "gvim");
-	gtk_window_set_title(GTK_WINDOW(frdp->dialog), _("VIM - Search and Replace..."));
+#endif
+	gtk_window_set_title(GTK_WINDOW(frdp->dialog),
+                             CONV(_("VIM - Search and Replace...")));
     }
     else
     {
+#ifndef HAVE_GTK2
 	gtk_window_set_wmclass(GTK_WINDOW(frdp->dialog), "search", "gvim");
-	gtk_window_set_title(GTK_WINDOW(frdp->dialog), _("VIM - Search..."));
+#endif
+	gtk_window_set_title(GTK_WINDOW(frdp->dialog),
+                             CONV(_("VIM - Search...")));
     }
 
+#ifndef HAVE_GTK2 /* Utter crack.  Shudder. */
     gtk_widget_realize(frdp->dialog);
     gdk_window_set_decorations(frdp->dialog->window,
 	    GDK_DECOR_TITLE | GDK_DECOR_BORDER | GDK_DECOR_RESIZEH);
     gdk_window_set_functions(frdp->dialog->window,
 	    GDK_FUNC_RESIZE | GDK_FUNC_MOVE);
+#endif
 
-    /* this makes it look beter on Motif style window managers */
+#ifndef HAVE_GTK2
+    /* this makes it look better on Motif style window managers */
     frame = gtk_frame_new(NULL);
     gtk_container_add(GTK_CONTAINER(frdp->dialog), frame);
+#endif
 
     hbox = gtk_hbox_new(FALSE, 0);
+#ifdef HAVE_GTK2
+    gtk_container_set_border_width(GTK_CONTAINER(hbox), 10);
+    gtk_container_add(GTK_CONTAINER(GTK_DIALOG(frdp->dialog)->vbox), hbox);
+#else
     gtk_container_add(GTK_CONTAINER(frame), hbox);
+#endif
 
     if (do_replace)
 	table = gtk_table_new(1024, 4, FALSE);
@@ -1608,8 +2363,8 @@ find_replace_dialog_create(char_u *arg, 
     gtk_box_pack_start(GTK_BOX(hbox), table, TRUE, TRUE, 0);
     gtk_container_border_width(GTK_CONTAINER(table), 4);
 
-    tmp = gtk_label_new(_("Find what:"));
-    gtk_misc_set_alignment(GTK_MISC(tmp), (float)1.0, (float)0.5);
+    tmp = gtk_label_new(CONV(_("Find what:")));
+    gtk_misc_set_alignment(GTK_MISC(tmp), 0.0, 0.5);
     gtk_table_attach(GTK_TABLE(table), tmp, 0, 1, 0, 1,
 		     GTK_FILL, GTK_EXPAND, 2, 2);
     frdp->what = gtk_entry_new();
@@ -1626,14 +2381,14 @@ find_replace_dialog_create(char_u *arg, 
 
     if (do_replace)
     {
-	tmp = gtk_label_new(_("Replace with:"));
-	gtk_misc_set_alignment(GTK_MISC(tmp), (float)1.0, (float)0.5);
+	tmp = gtk_label_new(CONV(_("Replace with:")));
+	gtk_misc_set_alignment(GTK_MISC(tmp), 0.0, 0.5);
 	gtk_table_attach(GTK_TABLE(table), tmp, 0, 1, 1, 2,
 			 GTK_FILL, GTK_EXPAND, 2, 2);
 	frdp->with = gtk_entry_new();
 	gtk_signal_connect(GTK_OBJECT(frdp->with), "activate",
 			   GTK_SIGNAL_FUNC(find_replace_cb),
-			   (gpointer) FRD_R_FINDNEXT);
+			   GINT_TO_POINTER(FRD_R_FINDNEXT));
 	gtk_signal_connect_after(GTK_OBJECT(frdp->with), "key_press_event",
 				 GTK_SIGNAL_FUNC(find_key_press_event),
 				 (gpointer) frdp);
@@ -1654,11 +2409,11 @@ find_replace_dialog_create(char_u *arg, 
 	 */
 	gtk_signal_connect(GTK_OBJECT(frdp->what), "activate",
 			   GTK_SIGNAL_FUNC(find_replace_cb),
-			   (gpointer) FRD_FINDNEXT);
+			   GINT_TO_POINTER(FRD_FINDNEXT));
     }
 
     /* whole word only button */
-    frdp->wword = gtk_check_button_new_with_label(_("Match whole word only"));
+    frdp->wword = gtk_check_button_new_with_label(CONV(_("Match whole word only")));
     gtk_toggle_button_set_state(GTK_TOGGLE_BUTTON(frdp->wword),
 							(gboolean)wword);
     gtk_signal_connect(GTK_OBJECT(frdp->wword), "clicked",
@@ -1671,7 +2426,7 @@ find_replace_dialog_create(char_u *arg, 
 			 GTK_FILL, GTK_EXPAND, 2, 2);
 
     /* match case button */
-    frdp->mcase = gtk_check_button_new_with_label(_("Match case"));
+    frdp->mcase = gtk_check_button_new_with_label(CONV(_("Match case")));
     gtk_toggle_button_set_state(GTK_TOGGLE_BUTTON(frdp->mcase),
 							     (gboolean)mcase);
     gtk_signal_connect(GTK_OBJECT(frdp->mcase), "clicked",
@@ -1683,7 +2438,7 @@ find_replace_dialog_create(char_u *arg, 
 	gtk_table_attach(GTK_TABLE(table), frdp->mcase, 0, 1023, 2, 3,
 			 GTK_FILL, GTK_EXPAND, 2, 2);
 
-    tmp = gtk_frame_new(_("Direction"));
+    tmp = gtk_frame_new(CONV(_("Direction")));
     if (do_replace)
 	gtk_table_attach(GTK_TABLE(table), tmp, 1023, 1024, 2, 4,
 			 GTK_FILL, GTK_FILL, 2, 2);
@@ -1695,42 +2450,46 @@ find_replace_dialog_create(char_u *arg, 
     gtk_container_add(GTK_CONTAINER(tmp), vbox);
 
     /* 'Up' and 'Down' buttons */
-    frdp->up = gtk_radio_button_new_with_label(NULL, _("Up"));
+    frdp->up = gtk_radio_button_new_with_label(NULL, CONV(_("Up")));
     gtk_box_pack_start(GTK_BOX(vbox), frdp->up, TRUE, TRUE, 0);
     frdp->down = gtk_radio_button_new_with_label(
 			gtk_radio_button_group(GTK_RADIO_BUTTON(frdp->up)),
-			_("Down"));
+			CONV(_("Down")));
     gtk_toggle_button_set_state(GTK_TOGGLE_BUTTON(frdp->down), TRUE);
-    if (do_replace)
-	gtk_signal_connect(GTK_OBJECT(frdp->down), "clicked",
-			   GTK_SIGNAL_FUNC(repl_dir_cb), NULL);
-    else
-	gtk_signal_connect(GTK_OBJECT(frdp->down), "clicked",
-			   GTK_SIGNAL_FUNC(find_direction_cb), NULL);
+    gtk_signal_connect(GTK_OBJECT(frdp->down), "clicked",
+                       (do_replace) ? GTK_SIGNAL_FUNC(repl_dir_cb)
+                                    : GTK_SIGNAL_FUNC(find_direction_cb),
+                       NULL);
+#ifdef HAVE_GTK2
+    gtk_container_set_border_width(GTK_CONTAINER(vbox), 2);
+#endif
     gtk_box_pack_start(GTK_BOX(vbox), frdp->down, TRUE, TRUE, 0);
 
     /* vbox to hold the action buttons */
     actionarea = gtk_vbutton_box_new();
     gtk_container_border_width(GTK_CONTAINER(actionarea), 2);
+#ifndef HAVE_GTK2
     if (do_replace)
     {
 	gtk_button_box_set_layout(GTK_BUTTON_BOX(actionarea),
 				  GTK_BUTTONBOX_END);
 	gtk_button_box_set_spacing(GTK_BUTTON_BOX(actionarea), 0);
     }
+#endif
     gtk_box_pack_end(GTK_BOX(hbox), actionarea, FALSE, FALSE, 0);
 
     /* 'Find Next' button */
+#ifdef HAVE_GTK2
+    frdp->find = create_image_button(GTK_STOCK_FIND, _("Find Next"));
+#else
     frdp->find = gtk_button_new_with_label(_("Find Next"));
+#endif
     gtk_widget_set_sensitive(frdp->find, sensitive);
-    if (do_replace)
-	gtk_signal_connect(GTK_OBJECT(frdp->find), "clicked",
-			   GTK_SIGNAL_FUNC(find_replace_cb),
-			   (gpointer) FRD_R_FINDNEXT);
-    else
-	gtk_signal_connect(GTK_OBJECT(frdp->find), "clicked",
-			   GTK_SIGNAL_FUNC(find_replace_cb),
-			   (gpointer) FRD_FINDNEXT);
+
+    gtk_signal_connect(GTK_OBJECT(frdp->find), "clicked",
+                       GTK_SIGNAL_FUNC(find_replace_cb),
+                       GINT_TO_POINTER((do_replace) ? FRD_R_FINDNEXT : FRD_FINDNEXT));
+
     GTK_WIDGET_SET_FLAGS(frdp->find, GTK_CAN_DEFAULT);
     gtk_box_pack_start(GTK_BOX(actionarea), frdp->find, FALSE, FALSE, 0);
     gtk_widget_grab_default(frdp->find);
@@ -1738,37 +2497,55 @@ find_replace_dialog_create(char_u *arg, 
     if (do_replace)
     {
 	/* 'Replace' button */
+#ifdef HAVE_GTK2
+        frdp->replace = create_image_button(GTK_STOCK_CONVERT, _("Replace"));
+#else
 	frdp->replace = gtk_button_new_with_label(_("Replace"));
+#endif
 	gtk_widget_set_sensitive(frdp->replace, sensitive);
 	GTK_WIDGET_SET_FLAGS(frdp->replace, GTK_CAN_DEFAULT);
 	gtk_box_pack_start(GTK_BOX(actionarea), frdp->replace, FALSE, FALSE, 0);
 	gtk_signal_connect(GTK_OBJECT(frdp->replace), "clicked",
 			   GTK_SIGNAL_FUNC(find_replace_cb),
-			   (gpointer) FRD_REPLACE);
+			   GINT_TO_POINTER(FRD_REPLACE));
 
 	/* 'Replace All' button */
+#ifdef HAVE_GTK2
+        frdp->all = create_image_button(GTK_STOCK_CONVERT, _("Replace All"));
+#else
 	frdp->all = gtk_button_new_with_label(_("Replace All"));
+#endif
 	gtk_widget_set_sensitive(frdp->all, sensitive);
 	GTK_WIDGET_SET_FLAGS(frdp->all, GTK_CAN_DEFAULT);
 	gtk_box_pack_start(GTK_BOX(actionarea), frdp->all, FALSE, FALSE, 0);
 	gtk_signal_connect(GTK_OBJECT(frdp->all), "clicked",
 			   GTK_SIGNAL_FUNC(find_replace_cb),
-			   (gpointer) FRD_REPLACEALL);
+			   GINT_TO_POINTER(FRD_REPLACEALL));
     }
 
     /* 'Cancel' button */
+#ifdef HAVE_GTK2
+    tmp = gtk_button_new_from_stock(GTK_STOCK_CLOSE);
+#else
     tmp = gtk_button_new_with_label(_("Cancel"));
+#endif
     GTK_WIDGET_SET_FLAGS(tmp, GTK_CAN_DEFAULT);
     gtk_box_pack_end(GTK_BOX(actionarea), tmp, FALSE, FALSE, 0);
     gtk_signal_connect_object(GTK_OBJECT(tmp),
 			      "clicked", GTK_SIGNAL_FUNC(gtk_widget_hide),
 			      GTK_OBJECT(frdp->dialog));
     gtk_signal_connect_object(GTK_OBJECT(frdp->dialog),
-			      "delete_event", GTK_SIGNAL_FUNC(gtk_widget_hide),
+			      "delete_event", GTK_SIGNAL_FUNC(gtk_widget_hide_on_delete),
 			      GTK_OBJECT(frdp->dialog));
 
     tmp = gtk_vseparator_new();
+#ifdef HAVE_GTK2
+    gtk_box_pack_end(GTK_BOX(hbox), tmp, FALSE, FALSE, 10);
+#else
     gtk_box_pack_end(GTK_BOX(hbox), tmp, FALSE, TRUE, 0);
+#endif
+
+#ifndef HAVE_GTK2
     gtk_widget_grab_focus(frdp->what);
 
     /* show the frame and realize the frdp->dialog this gives us a window size
@@ -1777,12 +2554,19 @@ find_replace_dialog_create(char_u *arg, 
     gtk_widget_show_all(frame);
     gui_gtk_position_in_parent(GTK_WIDGET(gui.mainwin),
 				      GTK_WIDGET(frdp->dialog), VW_POS_MOUSE);
-
     gui_gtk_synch_fonts();
+#endif
 
     gtk_widget_show_all(frdp->dialog);
+#ifdef HAVE_GTK2
+    gtk_widget_hide(GTK_DIALOG(frdp->dialog)->action_area);
+#endif
 
     vim_free(entry_text);
+#ifdef HAVE_GTK2
+    vim_free(conv_buffer);
+#endif
+#undef CONV
 }
 
     void
@@ -1792,7 +2576,6 @@ gui_mch_find_dialog(exarg_T *eap)
 	find_replace_dialog_create(eap->arg, FALSE);
 }
 
-
     void
 gui_mch_replace_dialog(exarg_T *eap)
 {
@@ -1801,11 +2584,14 @@ gui_mch_replace_dialog(exarg_T *eap)
 }
 
 
+#ifndef HAVE_GTK2
 /*
  * Synchronize all gui elements, which are dependant upon the
  * main text font used. Those are in esp. the find/replace dialogs.
  * If you don't understand why this should be needed, please try to
- * search for "piê¶æ" in iso8859-2.
+ * search for "piÄÅÄ" in iso8859-2.
+ *
+ * Obsolete with GTK2.
  */
     void
 gui_gtk_synch_fonts(void)
@@ -1824,11 +2610,11 @@ gui_gtk_synch_fonts(void)
 	    /* synch the font with whats used by the text itself */
 	    style = gtk_style_copy(gtk_widget_get_style(frdp->what));
 	    gdk_font_unref(style->font);
-#ifdef FEAT_XFONTSET
+# ifdef FEAT_XFONTSET
 	    if (gui.fontset != NOFONTSET)
 		style->font = gui.fontset;
 	    else
-#endif
+# endif
 		style->font = gui.norm_font;
 	    gdk_font_ref(style->font);
 	    gtk_widget_set_style(frdp->what, style);
@@ -1837,11 +2623,11 @@ gui_gtk_synch_fonts(void)
 	    {
 		style = gtk_style_copy(gtk_widget_get_style(frdp->with));
 		gdk_font_unref(style->font);
-#ifdef FEAT_XFONTSET
+# ifdef FEAT_XFONTSET
 		if (gui.fontset != NOFONTSET)
 		    style->font = gui.fontset;
 		else
-#endif
+# endif
 		    style->font = gui.norm_font;
 		gdk_font_ref(style->font);
 		gtk_widget_set_style(frdp->with, style);
@@ -1850,6 +2636,7 @@ gui_gtk_synch_fonts(void)
 	}
     }
 }
+#endif /* !HAVE_GTK2 */
 
 
 /*
@@ -1857,11 +2644,16 @@ gui_gtk_synch_fonts(void)
  */
 /*ARGSUSED*/
     static void
-find_replace_cb(GtkWidget *widget, unsigned int flags)
+find_replace_cb(GtkWidget *widget, gpointer data)
 {
-    char	*find_text, *repl_text;
-    gboolean	direction_down = TRUE;
-    SharedFindReplace *sfr;
+    int                 flags;
+    char_u              *find_text;
+    char_u              *repl_text;
+    gboolean	        direction_down = TRUE;
+    SharedFindReplace   *sfr;
+    int                 rc;
+
+    flags = GPOINTER_TO_INT(data);
 
     /* Get the search/replace strings from the dialog */
     if (flags == FRD_FINDNEXT)
@@ -1871,20 +2663,30 @@ find_replace_cb(GtkWidget *widget, unsig
     }
     else
     {
-	repl_text = gtk_entry_get_text(GTK_ENTRY(repl_widgets.with));
+	repl_text = (char_u *)gtk_entry_get_text(GTK_ENTRY(repl_widgets.with));
 	sfr = &repl_widgets;
     }
-    find_text = gtk_entry_get_text(GTK_ENTRY(sfr->what));
+
+    find_text = (char_u *)gtk_entry_get_text(GTK_ENTRY(sfr->what));
     direction_down = GTK_TOGGLE_BUTTON(sfr->down)->active;
+
     if (GTK_TOGGLE_BUTTON(sfr->wword)->active)
 	flags |= FRD_WHOLE_WORD;
     if (GTK_TOGGLE_BUTTON(sfr->mcase)->active)
 	flags |= FRD_MATCH_CASE;
 
-    if (gui_do_findrepl((int)flags, (char_u *)find_text, (char_u *)repl_text,
-							 (int)direction_down))
-	if (gtk_main_level() > 0)
-	    gtk_main_quit();	/* make sure cmd will be handled immediately */
+#ifdef HAVE_GTK2
+    repl_text = CONVERT_FROM_UTF8(repl_text);
+    find_text = CONVERT_FROM_UTF8(find_text);
+#endif
+    rc = gui_do_findrepl(flags, find_text, repl_text, direction_down);
+#ifdef HAVE_GTK2
+    CONVERT_FROM_UTF8_FREE(repl_text);
+    CONVERT_FROM_UTF8_FREE(find_text);
+#endif
+
+    if (rc && gtk_main_level() > 0)
+        gtk_main_quit(); /* make sure cmd will be handled immediately */
 }
 
 /* our usual callback function */
@@ -1963,7 +2765,7 @@ mcase_match_cb(GtkWidget * widget, gpoin
     static void
 entry_changed_cb(GtkWidget * entry, GtkWidget * dialog)
 {
-    gchar	*entry_text;
+    const gchar	*entry_text;
     gboolean	nonempty;
 
     entry_text = gtk_entry_get_text(GTK_ENTRY(entry));
@@ -1971,7 +2773,7 @@ entry_changed_cb(GtkWidget * entry, GtkW
     if (!entry_text)
 	return;			/* shouldn't happen */
 
-    nonempty = (strlen(entry_text) != 0);
+    nonempty = (entry_text[0] != '\0');
 
     if (dialog == find_widgets.dialog)
     {
@@ -2014,6 +2816,8 @@ ex_helpfind(eap)
     do_cmdline_cmd((char_u *)"emenu ToolBar.FindHelp");
 }
 
+#ifndef HAVE_GTK2 /* Crack crack crack.  Brrrr. */
+
 /*  gui_gtk_position_in_parent
  *
  *  this function causes a child window to be placed within the boundary of
@@ -2090,3 +2894,6 @@ gui_gtk_position_in_parent(
 
     gtk_widget_set_uposition(child, pos_x, pos_y);
 }
+
+#endif /* !HAVE_GTK2 */
+
Index: src/gui_gtk_f.c
===================================================================
RCS file: /cvsroot/vim/vim/src/gui_gtk_f.c,v
retrieving revision 1.7
diff -u -3 -p -r1.7 gui_gtk_f.c
--- src/gui_gtk_f.c	25 Feb 2002 16:44:39 -0000	1.7
+++ src/gui_gtk_f.c	6 Feb 2003 17:52:30 -0000
@@ -14,9 +14,14 @@
  *	embedded systems related, which seems to cause some serious trouble for
  *	your's in-house developers, maybe we need to talk badly with each other
  *	:-) <dalecki@cs.net.pl> (My native language is polish and I speak
- *	native grade german too. I'm living in Göttingen.de.)
+ *	native grade german too. I'm living in GÃ¶ttingen.de.)
  *	--mdcki"
  *
+ * Support for GTK+ 2 was added by:
+ *
+ * Â© 2002,2003  Jason Hildebrand  <jason@peaceworks.ca>
+ *              Daniel Elstner  <daniel.elstner@gmx.net>
+ *
  * This is a special purspose container widget, which manages arbitrary childs
  * at arbitrary positions width arbitrary sizes.  This finally puts an end on
  * our resizement problems with which we where struggling for such a long time.
@@ -37,7 +42,7 @@ struct _GtkFormChild
     GdkWindow *window;
     gint x;		/* relative subwidget x position */
     gint y;		/* relative subwidget y position */
-    gint mapped : 1;
+    gint mapped;
 };
 
 
@@ -51,8 +56,10 @@ static void gtk_form_size_request(GtkWid
 				  GtkRequisition * requisition);
 static void gtk_form_size_allocate(GtkWidget * widget,
 				   GtkAllocation * allocation);
+#ifndef HAVE_GTK2  /* this isn't needed in gtk2 */
 static void gtk_form_draw(GtkWidget * widget,
 			  GdkRectangle * area);
+#endif
 static gint gtk_form_expose(GtkWidget * widget,
 			    GdkEventExpose * event);
 
@@ -63,6 +70,8 @@ static void gtk_form_forall(GtkContainer
 			    GtkCallback callback,
 			    gpointer callback_data);
 
+static void gtk_form_attach_child_window(GtkForm * form,
+                                         GtkFormChild * child);
 static void gtk_form_realize_child(GtkForm * form,
 				   GtkFormChild * child);
 static void gtk_form_position_child(GtkForm * form,
@@ -82,6 +91,9 @@ static void gtk_form_set_static_gravity(
 
 static void gtk_form_send_configure(GtkForm *form);
 
+static void gtk_form_child_map(GtkWidget *widget, gpointer user_data);
+static void gtk_form_child_unmap(GtkWidget *widget, gpointer user_data);
+
 static GtkWidgetClass *parent_class = NULL;
 
 /* Public interface
@@ -119,9 +131,15 @@ gtk_form_put(GtkForm * form,
 
     form->children = g_list_append(form->children, child);
 
-    gtk_widget_set_parent(child_widget, GTK_WIDGET(form));
+    /* child->window must be created and attached to the widget _before_
+     * it has been realized, or else things will break with GTK2.  Note
+     * that gtk_widget_set_parent() realizes the widget if it's visible
+     * and its parent is mapped.
+     */
     if (GTK_WIDGET_REALIZED(form))
-	gtk_widget_set_parent_window (child->widget, form->bin_window);
+	gtk_form_attach_child_window(form, child);
+
+    gtk_widget_set_parent(child_widget, GTK_WIDGET(form));
     gtk_widget_size_request(child->widget, NULL);
 
     if (GTK_WIDGET_REALIZED(form) && !GTK_WIDGET_REALIZED(child_widget))
@@ -168,7 +186,11 @@ gtk_form_set_size(GtkForm * form, guint 
     form->height = height;
 
     /* signal the change */
+#ifdef HAVE_GTK2
+    gtk_widget_queue_resize(gtk_widget_get_parent(GTK_WIDGET(form)));
+#else
     gtk_container_queue_resize(GTK_CONTAINER(GTK_WIDGET(form)->parent));
+#endif
 }
 
     void
@@ -191,14 +213,18 @@ gtk_form_thaw(GtkForm * form)
 	if (!(--form->freeze_count))
 	{
 	    gtk_form_position_children(form);
+#ifdef HAVE_GTK2
+	    gtk_widget_queue_draw(GTK_WIDGET(form));
+#else
 	    gtk_widget_draw(GTK_WIDGET(form), NULL);
+#endif
 	}
     }
 }
 
 /* Basic Object handling procedures
  */
-    guint
+    GtkType
 gtk_form_get_type(void)
 {
     static guint form_type = 0;
@@ -235,7 +261,9 @@ gtk_form_class_init(GtkFormClass * class
     widget_class->map = gtk_form_map;
     widget_class->size_request = gtk_form_size_request;
     widget_class->size_allocate = gtk_form_size_allocate;
+#ifndef HAVE_GTK2 /* not needed for GTK2 */
     widget_class->draw = gtk_form_draw;
+#endif
     widget_class->expose_event = gtk_form_expose;
 
     container_class->remove = gtk_form_remove;
@@ -312,12 +340,22 @@ gtk_form_realize(GtkWidget * widget)
     {
 	GtkFormChild *child = tmp_list->data;
 
-	gtk_widget_set_parent_window (child->widget, form->bin_window);
+	gtk_form_attach_child_window(form, child);
+
 	if (GTK_WIDGET_VISIBLE(child->widget))
 	    gtk_form_realize_child(form, child);
     }
 }
 
+
+/* After reading the documentation at 
+ * http://developer.gnome.org/doc/API/2.0/gtk/gtk-changes-2-0.html 
+ * I think it should be possible to remove this function when compiling
+ * against gtk-2.0.  It doesn't seem to cause problems, though.
+ *
+ * Well, I reckon at least the gdk_window_show(form->bin_window)
+ * is necessary.  GtkForm is anything but a usual container widget.
+ */
     static void
 gtk_form_map(GtkWidget * widget)
 {
@@ -341,11 +379,7 @@ gtk_form_map(GtkWidget * widget)
 	if (GTK_WIDGET_VISIBLE(child->widget) &&
 	    !GTK_WIDGET_MAPPED(child->widget))
 	    gtk_widget_map(child->widget);
-
-	if (child->window)
-	    gdk_window_show(child->window);
     }
-
 }
 
     static void
@@ -371,9 +405,17 @@ gtk_form_unrealize(GtkWidget * widget)
 
 	if (child->window)
 	{
+            gtk_signal_disconnect_by_func(GTK_OBJECT(child->widget),
+                                          GTK_SIGNAL_FUNC(&gtk_form_child_map), child);
+            gtk_signal_disconnect_by_func(GTK_OBJECT(child->widget),
+                                          GTK_SIGNAL_FUNC(&gtk_form_child_unmap), child);
+
 	    gdk_window_set_user_data(child->window, NULL);
 	    gdk_window_destroy(child->window);
+
+            child->window = NULL;
 	}
+
 	tmp_list = tmp_list->next;
     }
 
@@ -381,6 +423,7 @@ gtk_form_unrealize(GtkWidget * widget)
 	 (* GTK_WIDGET_CLASS (parent_class)->unrealize) (widget);
 }
 
+#ifndef HAVE_GTK2
 /*ARGSUSED*/
     static void
 gtk_form_draw(GtkWidget * widget, GdkRectangle * area)
@@ -411,6 +454,7 @@ gtk_form_draw(GtkWidget * widget, GdkRec
 	}
     }
 }
+#endif /* !HAVE_GTK2 */
 
     static void
 gtk_form_size_request(GtkWidget * widget,
@@ -499,15 +543,36 @@ gtk_form_expose(GtkWidget * widget, GdkE
     if (event->window == form->bin_window)
 	return FALSE;
 
-    tmp_list = form->children;
-    while (tmp_list)
+    for (tmp_list = form->children; tmp_list; tmp_list = tmp_list->next)
     {
-	GtkFormChild *child = tmp_list->data;
-
-	if (event->window == child->window)
-	    return gtk_widget_event(child->widget, (GdkEvent *) event);
-
-	tmp_list = tmp_list->next;
+#ifdef HAVE_GTK2
+	GtkFormChild *formchild = tmp_list->data;
+        GtkWidget *child = formchild->widget;
+
+        /* The following chunk of code is taken from gtkcontainer.c.  The
+         * gtk1.x code synthesized expose events directly on the child widgets, 
+         * which can't be done in gtk2
+         */
+        if (GTK_WIDGET_DRAWABLE(child) &&
+            GTK_WIDGET_NO_WINDOW(child) &&
+            child->window == event->window)
+        {
+            GdkEventExpose child_event;
+            child_event = *event;
+ 
+            child_event.region = gtk_widget_region_intersect(child, event->region);
+            if (!gdk_region_empty(child_event.region))
+            {
+                gdk_region_get_clipbox(child_event.region, &child_event.area);
+                gtk_widget_send_expose(child, (GdkEvent *)&child_event);
+            }
+        }
+#else /* !HAVE_GTK2 */
+        GtkFormChild *child = tmp_list->data;
+
+        if (event->window == child->window)
+            return gtk_widget_event(child->widget, (GdkEvent *) event);
+#endif /* !HAVE_GTK2 */
     }
 
     return FALSE;
@@ -540,6 +605,11 @@ gtk_form_remove(GtkContainer * container
     {
 	if (child->window)
 	{
+            gtk_signal_disconnect_by_func(GTK_OBJECT(child->widget),
+                                          GTK_SIGNAL_FUNC(&gtk_form_child_map), child);
+            gtk_signal_disconnect_by_func(GTK_OBJECT(child->widget),
+                                          GTK_SIGNAL_FUNC(&gtk_form_child_unmap), child);
+
 	    /* FIXME: This will cause problems for reparenting NO_WINDOW
 	     * widgets out of a GtkForm
 	     */
@@ -585,24 +655,23 @@ gtk_form_forall(GtkContainer * container
  */
 
     static void
-gtk_form_realize_child(GtkForm * form,
-		       GtkFormChild * child)
+gtk_form_attach_child_window(GtkForm * form,
+                             GtkFormChild * child)
 {
-    GtkWidget *widget;
-    gint attributes_mask;
-
-    widget = GTK_WIDGET(form);
+    if (child->window)
+        return; /* been there, done that */
 
     if (GTK_WIDGET_NO_WINDOW(child->widget))
     {
-	GdkWindowAttr attributes;
+        GtkWidget       *widget;
+        GdkWindowAttr   attributes;
+        gint            attributes_mask;
 
-	gint x = child->x;
-	gint y = child->y;
+        widget = GTK_WIDGET(form);
 
 	attributes.window_type = GDK_WINDOW_CHILD;
-	attributes.x = x;
-	attributes.y = y;
+	attributes.x = child->x;
+	attributes.y = child->y;
 	attributes.width = child->widget->requisition.width;
 	attributes.height = child->widget->requisition.height;
 	attributes.wclass = GDK_INPUT_OUTPUT;
@@ -615,17 +684,36 @@ gtk_form_realize_child(GtkForm * form,
 				       &attributes, attributes_mask);
 	gdk_window_set_user_data(child->window, widget);
 
-	if (child->window)
-	    gtk_style_set_background(widget->style,
-				     child->window,
-				     GTK_STATE_NORMAL);
+        gtk_style_set_background(widget->style,
+                                 child->window,
+                                 GTK_STATE_NORMAL);
+
+        gtk_widget_set_parent_window(child->widget, child->window);
+        gtk_form_set_static_gravity(child->window, TRUE);
+
+        /* Install signal handlers to map/unmap child->window
+         * alongside with the actual widget.
+         */
+        gtk_signal_connect(GTK_OBJECT(child->widget), "map",
+                           GTK_SIGNAL_FUNC(&gtk_form_child_map), child);
+        gtk_signal_connect(GTK_OBJECT(child->widget), "unmap",
+                           GTK_SIGNAL_FUNC(&gtk_form_child_unmap), child);
     }
-    gtk_widget_set_parent_window(child->widget,
-		       child->window ? child->window : form->bin_window);
+    else if (!GTK_WIDGET_REALIZED(child->widget))
+    {
+        gtk_widget_set_parent_window(child->widget, form->bin_window);
+    }
+}
 
+    static void
+gtk_form_realize_child(GtkForm * form,
+		       GtkFormChild * child)
+{
+    gtk_form_attach_child_window(form, child);
     gtk_widget_realize(child->widget);
 
-    gtk_form_set_static_gravity(child->window ? child->window : child->widget->window, TRUE);
+    if (!child->window) /* already set, see above */
+        gtk_form_set_static_gravity(child->widget->window, TRUE);
 }
 
     static void
@@ -638,17 +726,14 @@ gtk_form_position_child(GtkForm * form,
 
     x = child->x;
     y = child->y;
+
     if ((x >= G_MINSHORT) && (x <= G_MAXSHORT) &&
-	    (y >= G_MINSHORT) && (y <= G_MAXSHORT))
+	(y >= G_MINSHORT) && (y <= G_MAXSHORT))
     {
 	if (!child->mapped)
 	{
-	    child->mapped = TRUE;
-
 	    if (GTK_WIDGET_MAPPED(form) && GTK_WIDGET_VISIBLE(child->widget))
 	    {
-		if (child->window)
-		    gdk_window_show(child->window);
 		if (!GTK_WIDGET_MAPPED(child->widget))
 		    gtk_widget_map(child->widget);
 
@@ -691,9 +776,8 @@ gtk_form_position_child(GtkForm * form,
 	if (child->mapped)
 	{
 	    child->mapped = FALSE;
-	    if (child->window)
-		gdk_window_hide(child->window);
-	    else if (GTK_WIDGET_MAPPED (child->widget))
+
+            if (GTK_WIDGET_MAPPED(child->widget))
 		gtk_widget_unmap(child->widget);
 	}
     }
@@ -797,6 +881,13 @@ gtk_form_main_filter(GdkXEvent * gdk_xev
     static void
 gtk_form_set_static_gravity(GdkWindow * win, gboolean on)
 {
+#ifdef HAVE_GTK2
+    gboolean static_gravity_supported;
+
+    static_gravity_supported = gdk_window_set_static_gravities(win, on);
+
+    g_return_if_fail(static_gravity_supported);
+#else
     XSetWindowAttributes xattributes;
 
     xattributes.win_gravity = on ? StaticGravity : NorthWestGravity;
@@ -806,6 +897,7 @@ gtk_form_set_static_gravity(GdkWindow * 
 			    GDK_WINDOW_XWINDOW(win),
 			    CWBitGravity | CWWinGravity,
 			    &xattributes);
+#endif
 }
 
     void
@@ -813,8 +905,9 @@ gtk_form_move_resize(GtkForm * form, Gtk
 		     gint x, gint y,
 		     gint w, gint h)
 {
-    widget->requisition.width = w;
+    widget->requisition.width  = w;
     widget->requisition.height = h;
+
     gtk_form_move(form, widget, x, y);
 }
 
@@ -833,5 +926,32 @@ gtk_form_send_configure(GtkForm *form)
     event.width = widget->allocation.width;
     event.height = widget->allocation.height;
 
-    gtk_widget_event (widget, (GdkEvent*) &event);
+#ifdef HAVE_GTK2
+    gtk_main_do_event((GdkEvent*)&event);
+#else
+    gtk_widget_event(widget, (GdkEvent*) &event);
+#endif
+}
+
+    static void
+gtk_form_child_map(GtkWidget *widget, gpointer user_data)
+{
+    GtkFormChild *child;
+
+    child = (GtkFormChild *)user_data;
+
+    child->mapped = TRUE;
+    gdk_window_show(child->window);
 }
+
+    static void
+gtk_form_child_unmap(GtkWidget *widget, gpointer user_data)
+{
+    GtkFormChild *child;
+
+    child = (GtkFormChild *)user_data;
+
+    child->mapped = FALSE;
+    gdk_window_hide(child->window);
+}
+
Index: src/gui_gtk_x11.c
===================================================================
RCS file: /cvsroot/vim/vim/src/gui_gtk_x11.c,v
retrieving revision 1.63
diff -u -3 -p -r1.63 gui_gtk_x11.c
--- src/gui_gtk_x11.c	3 Aug 2002 17:15:15 -0000	1.63
+++ src/gui_gtk_x11.c	6 Feb 2003 17:52:32 -0000
@@ -14,6 +14,11 @@
  *
  * With GREAT support and continuous encouragements by Andy Kahn and of
  * course Bram Moolenaar!
+ *
+ * Support for GTK+ 2 was added by:
+ *
+ * Â© 2002,2003  Jason Hildebrand  <jason@peaceworks.ca>
+ *              Daniel Elstner  <daniel.elstner@gmx.net>
  */
 
 #include "vim.h"
@@ -73,8 +78,22 @@
 # include <X11/Sunkeysym.h>
 #endif
 
-#define VIM_NAME	"vim"
-#define VIM_CLASS	"Vim"
+/* Easy-to-use macros for multihead support.
+ */
+#ifdef GTK2_MULTIHEAD
+
+# define GET_X_DISPLAY()        GDK_WINDOW_XDISPLAY(gui.mainwin->window)
+# define GET_X_ATOM(atom)       gdk_x11_atom_to_xatom_for_display( \
+                                    gtk_widget_get_display(gui.mainwin), (atom))
+# define GET_GDK_ATOM(xatom)    gdk_x11_xatom_to_atom_for_display( \
+                                    gtk_widget_get_display(gui.mainwin), (xatom))
+#else
+
+# define GET_X_DISPLAY()        GDK_DISPLAY()
+# define GET_X_ATOM(atom)       ((Atom) (atom))
+# define GET_GDK_ATOM(xatom)    ((GdkAtom) (xatom))
+
+#endif
 
 /* slection distinguishers */
 enum
@@ -100,32 +119,50 @@ enum
   TARGET_STRING
 };
 
-static GtkTargetEntry target_table[] =
+/* GTK2_FIXME: Handle target "UTF8_STRING"?
+ * (Actually this could be done for the old GTK+ too, I think.)
+ */
+static const GtkTargetEntry target_table[] =
 {
     {"text/uri-list",	0, TARGET_STRING},
     {"STRING",		0, TARGET_STRING},
     {"text/plain",	0, TARGET_STRING}
 };
-static guint n_targets = sizeof(target_table) / sizeof(target_table[0]);
+enum { DND_N_TARGETS = sizeof(target_table) / sizeof(target_table[0]) };
 #endif
 
+#ifdef HAVE_GTK2
+
+/* "Monospace" is a standard font alias that should be present
+ * on all proper Pango/fontconfig installations.
+ */
+# define DEFAULT_FONT	"Monospace 10"
+
+#else /* !HAVE_GTK2 */
+
 /* This is the single only fixed width font in X11, which seems to be present
  * on all servers and available in all the variants we need.
  */
-#define DFLT_FONT	"-adobe-courier-medium-r-normal-*-14-*-*-*-m-*-*-*"
+# define DEFAULT_FONT	"-adobe-courier-medium-r-normal-*-14-*-*-*-m-*-*-*"
+
+#endif /* !HAVE_GTK2 */
 
+#ifndef USE_GNOME_SESSION
 /*
  * Atoms used to communicate save-yourself from the X11 session manager. There
  * is no need to move them into the GUI struct, since they should be constant.
  */
 static GdkAtom wm_protocols_atom = GDK_NONE;
 static GdkAtom save_yourself_atom = GDK_NONE;
+#endif
 
+#ifndef HAVE_GTK2
 /*
  * Atom used to recognize requests for on the fly GTK+ style configuration
  * changes.
  */
 static GdkAtom reread_rcfiles_atom = GDK_NONE;
+#endif
 
 /*
  * Atoms used to control/reference X11 selections.
@@ -142,7 +179,7 @@ static struct special_key
     guint key_sym;
     char_u code0;
     char_u code1;
-} special_keys[] =
+} const special_keys[] =
 {
     {GDK_Up,		'k', 'u'},
     {GDK_Down,		'k', 'd'},
@@ -238,74 +275,94 @@ static struct special_key
  *
  * When changing this, also update doc/gui_x11.txt and the usage message!!!
  */
-static struct cmdline_option
+enum option_flags
 {
-    char    *name;
-    int	    has_value;
-} cmdline_options[] =
+    HAS_VALUE       = 1 << 0,   /* a value is expected after the argument */
+    NEEDS_GUI       = 1 << 1,   /* need to initialize the GUI for this    */
+    IS_GTK_ARG      = 1 << 2,   /* argument is handled by GTK+ or GNOME   */
+    COMPAT_LONGOPT  = 1 << 3    /* accept -foo but substitute with --foo  */
+};
+
+struct cmdline_option
 {
-    /* We handle these options ourselfs */
-    {"-fn",		TRUE},
-    {"-font",		TRUE},
-    {"-geom",		TRUE},
-    {"-geometry",	TRUE},
-    {"-reverse",	FALSE},
-    {"-rv",		FALSE},
-#if 0	/* TBD */
-    {"-bg",		TRUE},
-    {"-background",	TRUE},
-    {"-fg",		TRUE},
-    {"-foreground",	TRUE},
-    {"-boldfont",	TRUE},
-    {"-italicfont",	TRUE},
-    {"+reverse",	FALSE},
-    {"+rv",		FALSE},
-    {"-iconic",		FALSE},
-    {"-name",		TRUE},
-    {"-bw",		TRUE},
-    {"-borderwidth",	TRUE},
-    {"-sw",		TRUE},
-    {"-scrollbarwidth", TRUE},
-    {"-xrm",		TRUE},
-#endif
+    const char          *name;
+    enum option_flags   flags;
 };
 
-/*
- * Arguments handled by GTK (and GNOME) internally.
- */
-static char *gtk_cmdline_options[] =
+static struct cmdline_option const cmdline_options[] =
 {
-    "--sync",
-    "--gdk-debug=",
-    "--gdk-no-debug=",
-    "--no-xshm",
-    "--xim-preedit",
-    "--xim-status",
-    "--gtk-debug=",
-    "--gtk-no-debug=",
-    "--g-fatal-warnings",
-    "--gtk-module=",
-    "-display",
-    "--display",
+    /* We handle these options ourselfs */
+    { "-fn",		    HAS_VALUE },
+    { "-font",		    HAS_VALUE },
+    { "-geom",		    HAS_VALUE },
+    { "-geometry",	    HAS_VALUE },
+    { "-reverse",	    0 },
+    { "-rv",		    0 },
+#if 0	/* TBD */
+    { "-bg",		    HAS_VALUE },
+    { "-background",	    HAS_VALUE },
+    { "-fg",		    HAS_VALUE },
+    { "-foreground",	    HAS_VALUE },
+    { "-boldfont",	    HAS_VALUE },
+    { "-italicfont",	    HAS_VALUE },
+    { "+reverse",	    0 },
+    { "+rv",		    0 },
+    { "-iconic",	    0 },
+    { "-bw",		    HAS_VALUE },
+    { "-borderwidth",	    HAS_VALUE },
+    { "-sw",		    HAS_VALUE },
+    { "-scrollbarwidth",    HAS_VALUE },
+    { "-xrm",		    HAS_VALUE },
+#endif
+    /* Arguments handled by GTK (and GNOME) internally. */
+    { "--g-fatal-warnings",     IS_GTK_ARG              },
+    { "--gdk-debug",            IS_GTK_ARG | HAS_VALUE  },
+    { "--gdk-no-debug",         IS_GTK_ARG | HAS_VALUE  },
+    { "--gtk-debug",            IS_GTK_ARG | HAS_VALUE  },
+    { "--gtk-no-debug",         IS_GTK_ARG | HAS_VALUE  },
+    { "--gtk-module",           IS_GTK_ARG | HAS_VALUE  },
+    { "--sync",                 IS_GTK_ARG              },
+    { "--display",              IS_GTK_ARG | HAS_VALUE | COMPAT_LONGOPT },
+    { "--name",                 IS_GTK_ARG | HAS_VALUE | COMPAT_LONGOPT },
+    { "--class",                IS_GTK_ARG | HAS_VALUE | COMPAT_LONGOPT },
+#ifdef HAVE_GTK2
+    { "--screen",               IS_GTK_ARG | HAS_VALUE  },
+    { "--gxid-host",            IS_GTK_ARG | HAS_VALUE  },
+    { "--gxid-port",            IS_GTK_ARG | HAS_VALUE  },
+#else /* these don't seem to exist anymore */
+    { "--no-xshm",              IS_GTK_ARG              },
+    { "--xim-preedit",          IS_GTK_ARG | HAS_VALUE  },
+    { "--xim-status",           IS_GTK_ARG | HAS_VALUE  },
+    { "--gxid_host",            IS_GTK_ARG | HAS_VALUE  },
+    { "--gxid_port",            IS_GTK_ARG | HAS_VALUE  },
+#endif
 #ifdef FEAT_GUI_GNOME
-    "--disable-sound",
-    "--enable-sound",
-    "--espeaker=",
-    "--version",
-    "-?",
-    "--help",
-    "--usage",
-    "--disable-crash-dialog",
-    "--sm-client-id=",
-    "--sm-config-prefix=",
-    "--sm-disable",
+    { "--load-modules",         IS_GTK_ARG | HAS_VALUE  },
+    { "--sm-client-id",         IS_GTK_ARG | HAS_VALUE  },
+    { "--sm-config-prefix",     IS_GTK_ARG | HAS_VALUE  },
+    { "--sm-disable",           IS_GTK_ARG              },
+    { "--oaf-ior-fd",           IS_GTK_ARG | HAS_VALUE  },
+    { "--oaf-activate-iid",     IS_GTK_ARG | HAS_VALUE  },
+    { "--oaf-private",          IS_GTK_ARG              },
+    { "--enable-sound",         IS_GTK_ARG              },
+    { "--disable-sound",        IS_GTK_ARG              },
+    { "--espeaker",             IS_GTK_ARG | HAS_VALUE  },
+    { "-?",                     IS_GTK_ARG | NEEDS_GUI  },
+    { "--help",                 IS_GTK_ARG | NEEDS_GUI  },
+    { "--usage",                IS_GTK_ARG | NEEDS_GUI  },
+    { "--version",              IS_GTK_ARG | NEEDS_GUI  },
+    { "--disable-crash-dialog", IS_GTK_ARG              },
 #endif
-    NULL
+    { NULL, 0 }
 };
 
 static int gui_argc = 0;
 static char **gui_argv = NULL;
 
+#ifdef USE_GNOME_SESSION
+static char *restart_command = NULL;
+#endif
+
 #ifdef FEAT_GUI_GNOME
 /*
  * Can't use Gnome if --socketid given
@@ -323,117 +380,136 @@ static int using_gnome = 0;
     void
 gui_mch_prepare(int *argc, char **argv)
 {
-    int arg;
-    int i;
-    char **gtk_option;
+    struct cmdline_option const *option;
+    int     i   = 0;
+    int     len = 0;
 
+#ifdef USE_GNOME_SESSION
     /*
-     * Move all the entries in argv which are relevant to X into gui_argv.
+     * Determine the command used to invoke vim, to be passed as restart
+     * command to GnomeClient when saving the session.  If argv[0] contains
+     * any directory components try to build an absolute path.  Otherwise,
+     * just leave it as is.
      */
-    gui_argc = 0;
-    gui_argv = (char **)lalloc((long_u)(*argc * sizeof(char *)), FALSE);
-    if (gui_argv == NULL)
-	return;
-
-    gui_argv[gui_argc++] = argv[0];
-    arg = 1;
-    while (arg < *argc)
-    {
-	/* Look for argv[arg] in cmdline_options[] table */
-	for (i = 0; i < XtNumber(cmdline_options); i++)
-	    if (strcmp(argv[arg], cmdline_options[i].name) == 0)
-		break;
-
-	if (i < XtNumber(cmdline_options))
-	{
-	    /* Remember finding "-rv" or "-reverse" */
-	    if (strcmp("-rv", argv[arg]) == 0
-		    || strcmp("-reverse", argv[arg]) == 0)
-	    {
-		found_reverse_arg = TRUE;
-	    }
-	    else if ((strcmp("-fn", argv[arg]) == 0
-			|| strcmp("-font", argv[arg]) == 0) && arg + 1 < *argc)
-	    {
-		font_argument = argv[arg + 1];
-	    }
-	    else if ((strcmp("-geometry", argv[arg]) == 0
-			|| strcmp("-geom", argv[arg]) == 0) && arg + 1 < *argc)
-	    {
-		gui.geom = (char_u *)g_strdup((const char *)argv[arg + 1]);
-	    }
+    if (g_path_is_absolute(argv[0]) || strchr(argv[0], G_DIR_SEPARATOR) == NULL)
+    {
+        restart_command = argv[0];
+    }
+    else
+    {
+        char *current_dir;
 
-#ifndef FEAT_GUI_GNOME
-	    /* Found match in table, so move it into gui_argv */
-	    gui_argv[gui_argc++] = argv[arg];
-#endif
-	    if (--*argc > arg)
-	    {
-		mch_memmove(&argv[arg], &argv[arg + 1],
-			    (*argc - arg) * sizeof(char *));
-		if (cmdline_options[i].has_value)
-		{
-#ifndef FEAT_GUI_GNOME
-		    /* Move the option argument as well. */
-		    gui_argv[gui_argc++] = argv[arg];
-#endif
-		    if (--*argc > arg)
-			mch_memmove(&argv[arg], &argv[arg + 1],
-				    (*argc - arg) * sizeof(char *));
-		}
-	    }
-	}
-	else
-	    ++arg;
+        current_dir = g_get_current_dir();
+        restart_command = g_build_filename(current_dir, argv[0], NULL); /* tiny leak */
+        g_free(current_dir);
     }
+#endif
 
-    /* extract the gtk internal options */
-    gtk_option = gtk_cmdline_options;
-    while (*gtk_option)
-    {
-	arg = 1;
-	while (arg < *argc)
-	{
-	    if (strncmp(argv[arg], *gtk_option, strlen(*gtk_option)) == 0)
-	    {
-		/* Replace the standard X argument "-display" with the GTK
-		 * argument "--display". */
-		if (strncmp(*gtk_option, "-display", 8) == 0)
-		    gui_argv[gui_argc++] =
-				   (char *)vim_strsave((char_u *)"--display");
-		else
-		    gui_argv[gui_argc++] = argv[arg];
+    /*
+     * Move all the entries in argv which are relevant to GTK+ and GNOME
+     * into gui_argv.
+     */
+    gui_argc = 0;
+    gui_argv = (char **)alloc(*argc * sizeof(char *));
 
-		/* These arguments make gnome_init() print a message and exit.
-		 * Must start the GUI for this, otherwise ":gui" will exit
-		 * later! */
-		if (strcmp("-?", argv[arg]) == 0
-			|| strcmp("--help", argv[arg]) == 0
-			|| strcmp("--version", argv[arg]) == 0
-			|| strcmp("--usage", argv[arg]) == 0)
-		    gui.starting = TRUE;
+    g_return_if_fail(gui_argv != NULL);
 
-		if (--*argc > arg)
-		{
-		    mch_memmove(&argv[arg], &argv[arg + 1],
-					      (*argc - arg) * sizeof(char *));
-		    /* Move the option argument as well, if there is one. */
-		    if (strncmp(*gtk_option, "--xim", 5) == 0
-			    || strncmp(*gtk_option, "-display", 8) == 0
-			    || strncmp(*gtk_option, "--display", 9) == 0)
-		    {
-			gui_argv[gui_argc++] = argv[arg];
-			if (--*argc > arg)
-			    mch_memmove(&argv[arg], &argv[arg + 1],
-				    (*argc - arg) * sizeof(char *));
-		    }
-		}
-		break;
-	    }
-	    else
-		arg++;
-	}
-	gtk_option++;
+    gui_argv[gui_argc++] = argv[i++];
+
+    while (i < *argc)
+    {
+        /* Don't waste CPU cycles on non-option arguments. */
+        if (argv[i][0] != '-')
+        {
+            ++i;
+            continue;
+        }
+
+        /* Look for argv[i] in cmdline_options[] table. */
+        for (option = &cmdline_options[0]; option->name != NULL; ++option)
+        {
+            len = strlen(option->name);
+
+            if (strncmp(argv[i], option->name, len) == 0)
+            {
+                if (argv[i][len] == '\0')
+                    break;
+
+                /* allow --foo=bar style for GTK+ options */
+                if (argv[i][len] == '=' && (option->flags & (HAS_VALUE | IS_GTK_ARG))
+                                                         == (HAS_VALUE | IS_GTK_ARG))
+                    break;
+            }
+            else if ((option->flags & COMPAT_LONGOPT)
+                     && strcmp(argv[i], option->name + 1) == 0)
+            {
+                /* Replace the standard X arguments "-name" and "-display"
+                 * with their GNU-style counterparts.
+                 */
+                argv[i] = (char *)option->name;
+                break;
+            }
+        }
+
+        if (option->name == NULL)
+        {
+            ++i;
+            continue;
+        }
+
+        if (option->flags & IS_GTK_ARG)
+        {
+            /* Found match in table, so move it into gui_argv */
+            gui_argv[gui_argc++] = argv[i];
+        }
+        else
+        {
+            /* Remember finding "-rv" or "-reverse" */
+            if ((len == 3 && strcmp(argv[i], "-rv")      == 0) ||
+                (len == 8 && strcmp(argv[i], "-reverse") == 0))
+            {
+                found_reverse_arg = TRUE;
+            }
+            else if ((len == 3 && strcmp(argv[i], "-fn")   == 0) ||
+                     (len == 5 && strcmp(argv[i], "-font") == 0))
+            {
+                if (i + 1 < *argc)
+                    font_argument = argv[i + 1];
+            }
+            else if ((len == 5 && strcmp(argv[i], "-geom")     == 0) ||
+                     (len == 9 && strcmp(argv[i], "-geometry") == 0))
+            {
+                if (i + 1 < *argc)
+                    gui.geom = vim_strsave((char_u *)argv[i + 1]);
+            }
+        }
+
+        /* These arguments make gnome_init() print a message and exit.
+         * Must start the GUI for this, otherwise ":gui" will exit
+         * later!
+         */
+        if (option->flags & NEEDS_GUI)
+            gui.starting = TRUE;
+
+        if (--*argc > i)
+        {
+            int n_strip = 1;
+
+            /* Move the option argument as well, if there is one. */
+            if ((option->flags & HAS_VALUE)
+                && argv[i][len] != '='
+                && strcmp(argv[i + 1], "--") != 0)
+            {
+                ++n_strip;
+                --*argc;
+                if (option->flags & IS_GTK_ARG)
+                    gui_argv[gui_argc++] = argv[i + 1];
+            }
+
+            if (*argc > i)
+                mch_memmove(&argv[i], &argv[i + n_strip],
+                            (*argc - i) * sizeof(char *));
+        }
     }
 }
 
@@ -491,7 +567,7 @@ property_event(GtkWidget * widget, GdkEv
 {
     if (e->type == GDK_PROPERTY_NOTIFY
 	    && GDK_WINDOW_XWINDOW(e->window) == commWindow
-	    && e->atom == commProperty
+	    && e->atom == GET_GDK_ATOM(commProperty)
 	    && e->state == (guint)GDK_PROPERTY_NEW_VALUE)
     {
 	XEvent	    xev;
@@ -544,7 +620,7 @@ gui_mch_set_blinking(long waittime, long
  * Stop the cursor blinking.  Show the cursor if it wasn't shown.
  */
     void
-gui_mch_stop_blink()
+gui_mch_stop_blink(void)
 {
     if (blink_timer)
     {
@@ -583,7 +659,7 @@ blink_cb(gpointer data)
  * waiting time and shows the cursor.
  */
     void
-gui_mch_start_blink()
+gui_mch_start_blink(void)
 {
     if (blink_timer)
 	gtk_timeout_remove(blink_timer);
@@ -754,7 +830,13 @@ key_press_event(GtkWidget * widget, GdkE
 		|| (*p_wak == 'm'
 		    && len == 1
 		    && gui_is_menu_shortcut(string[0]))))
-	return TRUE;
+# ifdef HAVE_GTK2
+        /* For GTK2 we return false to signify that we haven't handled the
+         * keypress, so that gtk will handle the mnemonic or accelerator. */
+	return FALSE;
+# else
+        return TRUE;
+# endif
 #endif
 
     /* Check for Alt/Meta key (Mod1Mask), but not for a BS, DEL or character
@@ -1049,7 +1131,6 @@ selection_get_event(GtkWidget *widget,
     vim_free(result);
 }
 
-
 /*
  * Check if the GUI can be started.  Called before gvimrc is sourced.
  * Return OK or FAIL.
@@ -1057,34 +1138,38 @@ selection_get_event(GtkWidget *widget,
     int
 gui_mch_init_check(void)
 {
+    int init_failed;
+
+#ifndef HAVE_GTK2
     /* This is needed to make the locale handling consistant between the GUI
      * and the rest of VIM. */
     gtk_set_locale();
+#endif
 
 #ifdef FEAT_GUI_GNOME
     if (gtk_socket_id == 0)
-	using_gnome = 1;
+        using_gnome = 1;
 #endif
 
-    if ((
-#ifdef FEAT_GUI_GNOME
-	    using_gnome
-		&& gnome_init("vim", VIM_VERSION_SHORT, gui_argc, gui_argv))
-	    || (!using_gnome &&
+    /* For GNOME 2, always use gtk_init_check() since gnome_program_init()
+     * exits on failure.  So let's call it later in gui_mch_init().
+     */
+#if defined(FEAT_GUI_GNOME) && !defined(HAVE_GTK2)
+    if (using_gnome)
+        init_failed = gnome_init("vim", VIM_VERSION_SHORT, gui_argc, gui_argv);
+    else
+#else
+        /* Don't use gtk_init(), it exits on failure. */
+        init_failed = !gtk_init_check(&gui_argc, &gui_argv);
 #endif
-		!gtk_init_check(&gui_argc, &gui_argv)))
-	/* Don't use gtk_init(), it exits on failure. */
+
+    if (init_failed)
     {
-	gui.dying = TRUE;
-	EMSG(_("E233: cannot open display"));
-	return FAIL;
+        gui.dying = TRUE;
+        EMSG(_("E233: cannot open display"));
+        return FAIL;
     }
-    vim_free(gui_argv);
 
-    /* This is needed for the X clipboard support.
-     * Not very nice, but it works...
-     */
-    gui.dpy = GDK_DISPLAY();
     return OK;
 }
 
@@ -1288,6 +1373,7 @@ button_press_event(GtkWidget * widget, G
      * Don't let additional events about multiple clicks send by GTK to us
      * after the initial button press event confuse us.
      */
+    
     if (event->type != GDK_BUTTON_PRESS)
 	return FALSE;
 
@@ -1346,6 +1432,50 @@ button_press_event(GtkWidget * widget, G
     return TRUE;
 }
 
+#ifdef HAVE_GTK2
+
+/* GTK2 doesn't handle mouse buttons 4, 5, 6 and 7 the same way as GTK1.
+   It uses the new GdkEventScroll. */
+    static gint
+scroll_event(GtkWidget *widget, GdkEventScroll *event)
+{
+    int button;
+    int_u vim_modifiers;
+
+    /* Copy this from previous function even if I don't know what it's use is. */
+    if (gtk_socket_id != 0 && !GTK_WIDGET_HAS_FOCUS(gui.drawarea))
+	gtk_widget_grab_focus(gui.drawarea);
+
+    switch(event->direction)
+    {
+	case GDK_SCROLL_UP:
+	    button = MOUSE_4;
+	    break;
+	case GDK_SCROLL_DOWN:
+	    button = MOUSE_5;
+	    break;
+	default: /* We don't care about left and right...  Yet. */
+	    return FALSE;
+    }
+    
+    vim_modifiers = 0x0;
+    if (event->state & GDK_SHIFT_MASK)
+	vim_modifiers |= MOUSE_SHIFT;
+    if (event->state & GDK_CONTROL_MASK)
+	vim_modifiers |= MOUSE_CTRL;
+    if (event->state & GDK_MOD1_MASK)
+	vim_modifiers |= MOUSE_ALT;
+
+    gui_send_mouse_event(button, event->x, event->y, FALSE, vim_modifiers);
+    if (gtk_main_level() > 0)
+	gtk_main_quit();	/* make sure the above will be handled immediately */
+
+    return TRUE;
+}
+
+#endif /* HAVE_GTK2 */
+
+
 /*ARGSUSED*/
     static gint
 button_release_event(GtkWidget * widget, GdkEventButton * event)
@@ -1353,7 +1483,7 @@ button_release_event(GtkWidget * widget,
     int x, y;
     int_u vim_modifiers;
 
-    /* Remove any motion "mashine gun" timers used for automatic further
+    /* Remove any motion "machine gun" timers used for automatic further
        extension of allocation areas if outside of the applications window
        area .*/
     if (motion_repeat_timer)
@@ -1553,6 +1683,161 @@ drag_data_received(GtkWidget *widget, Gd
 }
 #endif /* GTK_DND */
 
+
+#ifdef USE_GNOME_SESSION
+
+    static void
+sm_client_check_changed_any(GnomeClient     *client,
+                            gint            key,
+                            GnomeDialogType type,
+                            gpointer        data)
+{
+    cmdmod_T    save_cmdmod;
+    gboolean    shutdown_cancelled;
+
+    save_cmdmod = cmdmod;
+
+# ifdef FEAT_BROWSE
+    cmdmod.browse = TRUE;
+# endif
+# if defined(FEAT_GUI_DIALOG) || defined(FEAT_CON_DIALOG)
+    cmdmod.confirm = TRUE;
+# endif
+
+    /* If there are changed buffers, present the user with
+     * a dialog if possible, otherwise give an error message.
+     */
+    shutdown_cancelled = check_changed_any(FALSE);
+
+    exiting = FALSE;
+    cmdmod = save_cmdmod;
+    setcursor(); /* position the cursor */
+    out_flush();
+
+    /* If the user hit the [Cancel] button the whole shutdown
+     * will be cancelled.  Wow, quite powerful feature (:
+     */
+    gnome_interaction_key_return(key, shutdown_cancelled);
+}
+
+    static gboolean
+sm_client_save_yourself(GnomeClient        *client,
+                        gint               phase,
+                        GnomeSaveStyle     save_style,
+                        gboolean           shutdown,
+                        GnomeInteractStyle interact_style,
+                        gboolean           fast)
+{
+    char        *session_path;
+    char        *session_file;
+    char_u      *escaped_filename;
+    char        *mksession_cmdline;
+    gboolean    success = FALSE;
+
+    /* Always request an interaction if possible.  check_changed_any()
+     * won't actually show a dialog unless any buffers have been modified.
+     * There doesn't seem to be an obvious way to check that without
+     * automatically firing the dialog.  Anyway, it works just fine.
+     */
+    if (interact_style == GNOME_INTERACT_ANY)
+    {
+        gnome_client_request_interaction(client, GNOME_DIALOG_NORMAL,
+                                         &sm_client_check_changed_any, NULL);
+    }
+
+    out_flush();
+    ml_sync_all(FALSE, FALSE); /* preserve all swap files */
+
+    /* The path is unique for each session save.  We do neither know nor care
+     * which Session.vim will actually be used later.  This decision is in the
+     * domain of the session manager.
+     */
+    session_path = gnome_config_get_real_path(gnome_client_get_config_prefix(client));
+    session_file = g_build_filename(session_path, "Session.vim", NULL);
+
+    /* Build an ex command line to create a script that can be used to restore
+     * the current session.  Escape the filename to avoid nasty surprises.
+     */
+    escaped_filename  = vim_strsave_escaped((char_u *)session_file, escape_chars);
+    mksession_cmdline = g_strconcat("mksession ", (const char *)escaped_filename, NULL);
+
+    /* Ignore errors here and let :mksession report the failure. */
+    vim_mkdir((char_u *)session_path, 0700);
+
+    if (do_cmdline_cmd((char_u *)mksession_cmdline) == FAIL)
+    {
+        mch_rmdir((char_u *)session_path);
+    }
+    else
+    {
+        const char  *argv[6];
+        int         i;
+
+        /* Tell the session manager how to wipe out the stored session data.
+         * This isn't as dangerous as it looks, don't worry :)  session_path
+         * is unique (it'll be something like /home/user/.gnome2/vim-XXXXXX/)
+         * and contains only a single file, Session.vim.
+         */
+        i = 0;
+        argv[i++] = "rm";
+        argv[i++] = "-r";
+        argv[i++] = session_path;
+        argv[i] = NULL;
+
+        gnome_client_set_discard_command(client, i, (char **)argv);
+
+        /* Tell the session manager how to restore the just saved session.
+         * This is easily done thanks to Vim's -S option.  Pass the -f flag
+         * since there's no need to fork -- it might even cause confusion.
+         */
+        i = 0;
+        argv[i++] = restart_command;
+        argv[i++] = "-f";
+        argv[i++] = "-g";
+        argv[i++] = "-S";
+        argv[i++] = session_file;
+        argv[i] = NULL;
+
+        gnome_client_set_clone_command  (client, i, (char **)argv);
+        gnome_client_set_restart_command(client, i, (char **)argv);
+
+        success = TRUE;
+    }
+
+    g_free(mksession_cmdline);
+    vim_free(escaped_filename);
+    g_free(session_file);
+    g_free(session_path);
+
+    return success;
+}
+
+    static void
+sm_client_die(void)
+{
+    STRNCPY(IObuff, _("Vim: Received \"die\" request from session manager\n"), IOSIZE);
+    IObuff[IOSIZE - 1] = NUL;
+    preserve_exit();
+}
+
+    static void
+setup_save_yourself(void)
+{
+    GnomeClient *client;
+
+    client = gnome_master_client();
+
+    if (client != NULL)
+    {
+        g_signal_connect(G_OBJECT(client), "save_yourself",
+                         G_CALLBACK(&sm_client_save_yourself), NULL);
+        g_signal_connect(G_OBJECT(client), "die",
+                         G_CALLBACK(&sm_client_die), NULL);
+    }
+}
+
+#else /* !USE_GNOME_SESSION */
+
 /*
  * Setup the WM_PROTOCOLS to indicate we want the WM_SAVE_YOURSELF event.
  * This is an ugly use of X functions.  GTK doesn't offer an alternative.
@@ -1562,17 +1847,22 @@ setup_save_yourself(void)
 {
     Atom	*existing;
     Atom	*new;
+    Atom        save_yourself_xatom;
     int		count;
     int		i;
 
+    save_yourself_xatom = GET_X_ATOM(save_yourself_atom);
+
     /* first get the existing value */
-    if (XGetWMProtocols(GDK_DISPLAY(),
-		  GDK_WINDOW_XWINDOW(gui.mainwin->window), &existing, &count))
+    if (XGetWMProtocols(GET_X_DISPLAY(), GDK_WINDOW_XWINDOW(gui.mainwin->window),
+                        &existing, &count))
     {
 	/* check if WM_SAVE_YOURSELF isn't there yet */
 	for (i = 0; i < count; ++i)
-	    if (existing[i] == save_yourself_atom)
+        {
+	    if (existing[i] == save_yourself_xatom)
 		break;
+        }
 	if (i == count)
 	{
 	    /* allocate an Atoms array which is one item longer */
@@ -1581,9 +1871,9 @@ setup_save_yourself(void)
 	    {
 		for (i = 0; i < count; ++i)
 		    new[i] = existing[i];
-		new[count] = save_yourself_atom;
-		XSetWMProtocols(GDK_DISPLAY(),
-		     GDK_WINDOW_XWINDOW(gui.mainwin->window), new, count + 1);
+		new[count] = save_yourself_xatom;
+		XSetWMProtocols(GET_X_DISPLAY(), GDK_WINDOW_XWINDOW(gui.mainwin->window),
+                                new, count + 1);
 		vim_free(new);
 	    }
 	}
@@ -1591,6 +1881,49 @@ setup_save_yourself(void)
     }
 }
 
+# ifdef HAVE_GTK2
+/*
+ * Installing a global event filter seems to be the only way to catch
+ * client messages of type WM_PROTOCOLS without overriding GDK's own
+ * client message event filter.  Well, that's still better than trying
+ * to guess what the GDK filter had done if it had been invoked instead
+ * (This is what we did for GTK+ 1.2, see below).
+ *
+ * GTK2_FIXME:  This doesn't seem to work.  For some reason we never
+ * receive WM_SAVE_YOURSELF even though everything is set up correctly.
+ * I have the nasty feeling modern session managers just don't send this
+ * deprecated message anymore.
+ *
+ * The GNOME session support is much cooler anyway.  Unlike this ugly
+ * WM_SAVE_YOURSELF hack it actually stores the session...
+ */
+    static GdkFilterReturn
+global_event_filter(GdkXEvent *xev, GdkEvent *event, gpointer data)
+{
+    XEvent *xevent = (XEvent *)xev;
+
+    if (xevent != NULL &&
+        xevent->type == ClientMessage &&
+        xevent->xclient.message_type == GET_X_ATOM(wm_protocols_atom) &&
+        xevent->xclient.data.l[0] == GET_X_ATOM(save_yourself_atom))
+    {
+        out_flush();
+        ml_sync_all(FALSE, FALSE); /* preserve all swap files */
+
+        /* Set the window's WM_COMMAND property, to let the window manager
+         * know we are done saving ourselves.  We don't want to be
+         * restarted, thus set argv to NULL.
+         */
+        XSetCommand(GET_X_DISPLAY(), GDK_WINDOW_XWINDOW(gui.mainwin->window), NULL, 0);
+
+        return GDK_FILTER_REMOVE;
+    }
+
+    return GDK_FILTER_CONTINUE;
+}
+
+# else /* !HAVE_GTK2 */
+
 /*
  * GDK handler for X ClientMessage events.
  */
@@ -1603,7 +1936,7 @@ gdk_wm_protocols_filter(GdkXEvent *xev, 
 
     if (xevent != NULL)
     {
-	if ((Atom)(xevent->xclient.data.l[0]) == save_yourself_atom)
+	if (xevent->xclient.data.l[0] == GET_X_ATOM(save_yourself_atom))
 	{
 	    out_flush();
 	    ml_sync_all(FALSE, FALSE);      /* preserve all swap files */
@@ -1611,7 +1944,7 @@ gdk_wm_protocols_filter(GdkXEvent *xev, 
 	    /* Set the window's WM_COMMAND property, to let the window manager
 	     * know we are done saving ourselves.  We don't want to be
 	     * restarted, thus set argv to NULL. */
-	    XSetCommand(gui.dpy, GDK_WINDOW_XWINDOW(gui.mainwin->window),
+	    XSetCommand(GET_X_DISPLAY(), GDK_WINDOW_XWINDOW(gui.mainwin->window),
 								     NULL, 0);
 	}
 
@@ -1622,7 +1955,7 @@ gdk_wm_protocols_filter(GdkXEvent *xev, 
 	 * register for WM_PROTOCOLS, and only process the WM_SAVE_YOURSELF
 	 * bit;  it's all or nothing.
 	 */
-	else if ((Atom)(xevent->xclient.data.l[0]) == gdk_wm_delete_window)
+	else if (xevent->xclient.data.l[0] == GET_X_ATOM(gdk_wm_delete_window))
 	{
 	    event->any.type = GDK_DELETE;
 	    return GDK_FILTER_TRANSLATE;
@@ -1631,6 +1964,9 @@ gdk_wm_protocols_filter(GdkXEvent *xev, 
 
     return GDK_FILTER_REMOVE;
 }
+# endif /* !HAVE_GTK2 */
+
+#endif /* !USE_GNOME_SESSION */
 
 
 /*
@@ -1655,13 +1991,6 @@ mainwin_realize(GtkWidget *widget)
 #include "../runtime/vim48x48.xpm"
 #undef magick
 
-    static GdkPixmap	*icon = NULL;
-    static GdkBitmap	*icon_mask = NULL;
-    static char		**magick = vim32x32;
-    Window		root_window;
-    XIconSize		*size;
-    int			number_sizes;
-
     /* When started with "--echo-wid" argument, write window ID on stdout. */
     if (echo_wid_arg)
     {
@@ -1671,11 +2000,30 @@ mainwin_realize(GtkWidget *widget)
 
     if (vim_strchr(p_go, GO_ICON) != NULL)
     {
-	/*
-	 * Add an icon to the main window. For fun and convenience of the
-	 * user.
-	 * Adjust the icon to the preferences of the actual window manager.
-	 * This is once again a workaround for a defficiency in GTK+.
+        /* Add an icon to the main window. For fun and convenience of the user.
+         */
+#ifdef HAVE_GTK2
+        GList *icons = NULL;
+
+        icons = g_list_prepend(icons, gdk_pixbuf_new_from_xpm_data((const char **)vim16x16));
+        icons = g_list_prepend(icons, gdk_pixbuf_new_from_xpm_data((const char **)vim32x32));
+        icons = g_list_prepend(icons, gdk_pixbuf_new_from_xpm_data((const char **)vim48x48));
+
+        gtk_window_set_icon_list(GTK_WINDOW(gui.mainwin), icons);
+
+        g_list_foreach(icons, (GFunc)&g_object_unref, NULL);
+        g_list_free(icons);
+
+#else /* !HAVE_GTK2 */
+        static GdkPixmap	*icon = NULL;
+        static GdkBitmap	*icon_mask = NULL;
+        static char		**magick = vim32x32;
+        Window                  root_window;
+        XIconSize		*size;
+        int			number_sizes;
+
+        /* Adjust the icon to the preferences of the actual window manager.
+	 * This is once again a workaround for a defficiency in GTK+ 1.2.
 	 */
 	root_window = XRootWindow(GDK_DISPLAY(), DefaultScreen(GDK_DISPLAY()));
 	if (XGetIconSizes(GDK_DISPLAY(), root_window,
@@ -1696,14 +2044,21 @@ mainwin_realize(GtkWidget *widget)
 	    icon = gdk_pixmap_create_from_xpm_d(gui.mainwin->window,
 		    &icon_mask, NULL, magick);
 	gdk_window_set_icon(gui.mainwin->window, NULL, icon, icon_mask);
+#endif /* !HAVE_GTK2 */
     }
 
+#ifndef USE_GNOME_SESSION
     /* Register a handler for WM_SAVE_YOURSELF with GDK's low-level X I/F */
-    gdk_add_client_message_filter(wm_protocols_atom,
-					       gdk_wm_protocols_filter, NULL);
-
+# ifdef HAVE_GTK2
+    gdk_window_add_filter(NULL, &global_event_filter, NULL);
+# else
+    gdk_add_client_message_filter(wm_protocols_atom, &gdk_wm_protocols_filter, NULL);
+# endif
+#endif
     /* Setup to indicate to the window manager that we want to catch the
-     * WM_SAVE_YOURSELF event. */
+     * WM_SAVE_YOURSELF event.  For GNOME2, this connects to the session
+     * manager instead.
+     */
     setup_save_yourself();
 
 #ifdef FEAT_CLIENTSERVER
@@ -1711,7 +2066,8 @@ mainwin_realize(GtkWidget *widget)
     {
 	/* This is a :gui command in a plain vim with no previous server */
 	commWindow = GDK_WINDOW_XWINDOW(gui.mainwin->window);
-	(void)serverRegisterName(gui.dpy, serverDelayedStartName);
+
+	(void)serverRegisterName(GET_X_DISPLAY(), serverDelayedStartName);
     }
     else
     {
@@ -1720,8 +2076,8 @@ mainwin_realize(GtkWidget *widget)
 	 * have to change the "server" registration to that of the main window
 	 * If we have not registered a name yet, remember the window
 	 */
-	serverChangeRegisteredWindow(GDK_DISPLAY(),
-			       GDK_WINDOW_XWINDOW(gui.mainwin->window));
+        serverChangeRegisteredWindow(GET_X_DISPLAY(),
+                                     GDK_WINDOW_XWINDOW(gui.mainwin->window));
     }
     gtk_widget_add_events (gui.mainwin, GDK_PROPERTY_CHANGE_MASK);
     gtk_signal_connect(GTK_OBJECT(gui.mainwin), "property_notify_event",
@@ -1729,6 +2085,36 @@ mainwin_realize(GtkWidget *widget)
 #endif
 }
 
+#ifdef GTK2_MULTIHEAD
+    static void
+drawarea_screen_changed(GtkWidget *widget, GdkScreen *previous_screen)
+{
+    GdkDisplay *display;
+
+    if (!gtk_widget_has_screen(widget))
+        return;
+
+    /* Update the global pointer to the X display to support multihead.
+     * This is needed for the X clipboard support.
+     * Not very nice, but it works...
+     */
+    display = gtk_widget_get_display(widget);
+    gui.dpy = (display != NULL) ? GDK_DISPLAY_XDISPLAY(display) : NULL;
+
+    if (gui.text_context != NULL)
+        g_object_unref(gui.text_context);
+
+    /* Create a new PangoContext for this screen,
+     * and initialize it with the current font if necessary.
+     */
+    gui.text_context = gtk_widget_create_pango_context(widget);
+    pango_context_set_base_dir(gui.text_context, PANGO_DIRECTION_LTR);
+
+    if (gui.norm_font != NULL)
+        gui_mch_init_font(p_guifont, 0);
+}
+#endif /* GTK2_MULTIHEAD */
+
 /*
  * After the drawing area comes up, we calculate all colors and create the
  * dummy blank cursor.
@@ -1744,6 +2130,11 @@ drawarea_realize_cb(GtkWidget *widget)
     GdkColor color;
     GtkWidget *sbar;
 
+#ifndef GTK2_MULTIHEAD
+    /* for multihead the "screen_changed" signal is used instead */
+    gui.dpy = GET_X_DISPLAY();
+#endif
+
 #ifdef FEAT_XIM
     xim_init();
 #endif
@@ -1774,6 +2165,43 @@ drawarea_realize_cb(GtkWidget *widget)
 }
 
 /*
+ * Properly clean up on shutdown.
+ */
+    static void
+drawarea_unrealize_cb(GtkWidget *widget)
+{
+#ifdef HAVE_GTK2
+    if (gui.ascii_glyphs != NULL)
+    {
+        pango_glyph_string_free(gui.ascii_glyphs);
+        gui.ascii_glyphs = NULL;
+    }
+    if (gui.ascii_font != NULL)
+    {
+        g_object_unref(gui.ascii_font);
+        gui.ascii_font = NULL;
+    }
+
+    g_object_unref(gui.text_context);
+    gui.text_context = NULL;
+
+    g_object_unref(gui.text_gc);
+    gui.text_gc = NULL;
+#else
+    gdk_gc_unref(gui.text_gc);
+    gui.text_gc = NULL;
+#endif
+}
+
+#ifdef HAVE_GTK2
+    static void
+drawarea_style_set_cb(GtkWidget *widget, GtkStyle *previous_style)
+{
+    gui_mch_new_colors();
+}
+#endif /* HAVE_GTK2 */
+
+/*
  * Callback routine for the "delete_event" signal on the toplevel window.
  * Tries to vim gracefully, or refuses to exit with changed buffers.
  */
@@ -1785,6 +2213,9 @@ delete_event_cb(GtkWidget *wgt, gpointer
     return TRUE;
 }
 
+/* GTK2_FIXME: Handle target "UTF8_STRING"?
+ * (Actually this could be done for the old GTK+ too, I think.)
+ */
 static const GtkTargetEntry primary_targets[] = {
     {VIM_ATOM_NAME,   0, SELECTION_VIM},
     {"COMPOUND_TEXT", 0, SELECTION_COMPOUND_TEXT},
@@ -1792,39 +2223,153 @@ static const GtkTargetEntry primary_targ
     {"STRING",	      0, SELECTION_STRING}
 };
 
+#ifdef FEAT_TOOLBAR
+
+# ifdef HAVE_GTK2
 /*
- * Initialize the X GUI.  Create all the windows, set up all the call-backs
- * etc.
- * Returns OK for success, FAIL when the GUI can't be started.
+ * This hack wouldn't be necessary if we only used stock icons in the
+ * toolbar, which is the default.  It's implemented anyway just to be
+ * complete.
  */
-    int
-gui_mch_init()
+    static void
+icon_size_changed_foreach(GtkWidget *widget, gpointer user_data)
 {
-    GtkWidget *vbox;
-
-    /* Initialize values */
-    gui.border_width = 2;
-    gui.scrollbar_width = SB_DEFAULT_WIDTH;
-    gui.scrollbar_height = SB_DEFAULT_WIDTH;
-    gui.fgcolor = g_new0(GdkColor, 1);
-    gui.bgcolor = g_new0(GdkColor, 1);
+    if (GTK_IS_IMAGE(widget))
+    {
+        if (gtk_image_get_storage_type(GTK_IMAGE(widget)) == GTK_IMAGE_ICON_SET)
+        {
+            GtkIconSet  *icon_set;
+            GtkIconSize icon_size;
 
-    /* Initialise atoms */
-    compound_text_atom = gdk_atom_intern("COMPOUND_TEXT", FALSE);
-    text_atom = gdk_atom_intern("TEXT", FALSE);
+            gtk_image_get_icon_set(GTK_IMAGE(widget), &icon_set, &icon_size);
 
-    /* Set default foreground and background colors. */
-    gui.norm_pixel = gui.def_norm_pixel;
-    gui.back_pixel = gui.def_back_pixel;
+            gtk_icon_set_ref(icon_set);
+            icon_size = GPOINTER_TO_INT(user_data);
 
-    if (gtk_socket_id != 0)
+            gtk_image_set_from_icon_set(GTK_IMAGE(widget), icon_set, icon_size);
+            gtk_icon_set_unref(icon_set);
+        }
+    }
+    else if (GTK_IS_CONTAINER(widget))
     {
-	GtkPlug *plug;
+        gtk_container_foreach(GTK_CONTAINER(widget),
+                              &icon_size_changed_foreach,
+                              user_data);
+    }
+}
+# endif /* HAVE_GTK2 */
 
-	/* Use GtkSocket from another app. */
-	plug = GTK_PLUG(gui.mainwin = gtk_plug_new(gtk_socket_id));
+    static void
+set_toolbar_style(GtkToolbar *toolbar, const char *style_string)
+{
+    char            **style_values;
+    char            **value;
+    gboolean        text  = FALSE;
+    gboolean        icons = FALSE;
+    gboolean        tooltips = FALSE;
+    GtkToolbarStyle style = GTK_TOOLBAR_ICONS;
+# ifdef HAVE_GTK2
+    gboolean        horiz = FALSE;
+    GtkIconSize     size  = GTK_ICON_SIZE_SMALL_TOOLBAR;
+# endif
 
-	/* Pretend we never wanted it if it failed (get own window) */
+    style_values = g_strsplit(style_string, ",", -1);
+
+    for (value = &style_values[0]; *value != NULL; ++value)
+    {
+        if      (strcmp(*value, "text")     == 0) text  = TRUE;
+        else if (strcmp(*value, "icons")    == 0) icons = TRUE;
+        else if (strcmp(*value, "tooltips") == 0) tooltips = TRUE;
+# ifdef HAVE_GTK2
+        else if (strcmp(*value, "horiz")    == 0) horiz = TRUE;
+        else if (strcmp(*value, "large")    == 0) size  = GTK_ICON_SIZE_LARGE_TOOLBAR;
+        else if (strcmp(*value, "medium")   == 0) size  = GTK_ICON_SIZE_BUTTON;
+        else if (strcmp(*value, "small")    == 0) size  = GTK_ICON_SIZE_SMALL_TOOLBAR;
+        else if (strcmp(*value, "tiny")     == 0) size  = GTK_ICON_SIZE_MENU;
+# endif
+    }
+
+    g_strfreev(style_values);
+
+    if (text)                   style = GTK_TOOLBAR_TEXT;
+    if (text && icons)          style = GTK_TOOLBAR_BOTH;
+# ifdef HAVE_GTK2
+    if (text && icons && horiz) style = GTK_TOOLBAR_BOTH_HORIZ;
+# endif
+    gtk_toolbar_set_style(toolbar, style);
+
+    gtk_toolbar_set_tooltips(toolbar, tooltips);
+
+# ifdef HAVE_GTK2
+    if (size != gtk_toolbar_get_icon_size(toolbar))
+        gtk_container_foreach(GTK_CONTAINER(toolbar),
+                              &icon_size_changed_foreach,
+                              GINT_TO_POINTER(size));
+    gtk_toolbar_set_icon_size(toolbar, size);
+# endif
+}
+
+#endif /* FEAT_TOOLBAR */
+
+/*
+ * Initialize the X GUI.  Create all the windows, set up all the call-backs
+ * etc.
+ * Returns OK for success, FAIL when the GUI can't be started.
+ */
+    int
+gui_mch_init(void)
+{
+    GtkWidget *vbox;
+
+#if defined(FEAT_GUI_GNOME) && defined(HAVE_GTK2)
+    if (using_gnome)
+        gnome_program_init("vim", VIM_VERSION_SHORT,
+                           LIBGNOMEUI_MODULE, gui_argc, gui_argv,
+                           NULL);
+#endif
+    vim_free(gui_argv);
+    gui_argv = NULL;
+
+#ifdef HAVE_GTK2
+    /*
+     * Force UTF-8 output no matter what the value of 'encoding' is.
+     * did_set_string_option() in option.c prohibits changing 'termencoding'
+     * to something else than UTF-8 if the GUI is in use.
+     */
+    set_option_value((char_u *)"termencoding", 0L, (char_u *)"utf-8", 0);
+
+# ifdef FEAT_TOOLBAR
+    gui_gtk_register_stock_icons();
+# endif
+# if 0
+    /* FIXME: Need to install the classic icons and a gtkrc.classic file. */
+    gtk_rc_parse("gtkrc");
+# endif
+#endif
+
+    /* Initialize values */
+    gui.border_width = 2;
+    gui.scrollbar_width = SB_DEFAULT_WIDTH;
+    gui.scrollbar_height = SB_DEFAULT_WIDTH;
+    gui.fgcolor = g_new0(GdkColor, 1);
+    gui.bgcolor = g_new0(GdkColor, 1);
+
+    /* Initialise atoms */
+    compound_text_atom = gdk_atom_intern("COMPOUND_TEXT", FALSE);
+    text_atom = gdk_atom_intern("TEXT", FALSE);
+
+    /* Set default foreground and background colors. */
+    gui.norm_pixel = gui.def_norm_pixel;
+    gui.back_pixel = gui.def_back_pixel;
+
+    if (gtk_socket_id != 0)
+    {
+	GtkPlug *plug;
+
+	/* Use GtkSocket from another app. */
+	plug = GTK_PLUG(gui.mainwin = gtk_plug_new(gtk_socket_id));
+
+	/* Pretend we never wanted it if it failed (get own window) */
 	if (!plug->socket_window)
 	{
 	    /* Failed - using straightforward window */
@@ -1840,22 +2385,45 @@ gui_mch_init()
 #endif
 	    gui.mainwin = gtk_window_new(GTK_WINDOW_TOPLEVEL);
     }
+
+    gtk_widget_set_name(gui.mainwin, "vim-main-window");
+
+#ifdef HAVE_GTK2
+    /* the PangoContext used for drawing all text */
+    gui.text_context = gtk_widget_create_pango_context(gui.mainwin);
+    pango_context_set_base_dir(gui.text_context, PANGO_DIRECTION_LTR);
+#endif
+
+#ifndef HAVE_GTK2
     gtk_window_set_policy(GTK_WINDOW(gui.mainwin), TRUE, TRUE, TRUE);
+#endif
     gtk_container_border_width(GTK_CONTAINER(gui.mainwin), 0);
     gtk_widget_set_events(gui.mainwin, GDK_VISIBILITY_NOTIFY_MASK);
-    (void)gtk_signal_connect(GTK_OBJECT(gui.mainwin), "delete_event",
-			     GTK_SIGNAL_FUNC(delete_event_cb), NULL);
+
+    gtk_signal_connect(GTK_OBJECT(gui.mainwin), "delete_event",
+                       GTK_SIGNAL_FUNC(&delete_event_cb), NULL);
 
     gtk_signal_connect(GTK_OBJECT(gui.mainwin), "realize",
-				      GTK_SIGNAL_FUNC(mainwin_realize), NULL);
+                       GTK_SIGNAL_FUNC(&mainwin_realize), NULL);
 
-    /* FIXME: this should eventually get the accelgroup of the gui.mainwin */
+#ifdef HAVE_GTK2
+    gui.accel_group = gtk_accel_group_new();
+    gtk_window_add_accel_group(GTK_WINDOW(gui.mainwin), gui.accel_group);
+#else
     gui.accel_group = gtk_accel_group_get_default();
+#endif
 
     vbox = gtk_vbox_new(FALSE, 0);
+
 #ifdef FEAT_GUI_GNOME
     if (using_gnome)
-	gnome_app_set_contents(GNOME_APP(gui.mainwin), vbox);
+    {
+# if defined(HAVE_GTK2) && defined(FEAT_MENU)
+        /* automagically restore menubar/toolbar placement */
+        gnome_app_enable_layout_config(GNOME_APP(gui.mainwin), TRUE);
+# endif
+        gnome_app_set_contents(GNOME_APP(gui.mainwin), vbox);
+    }
     else
 #endif
     {
@@ -1866,15 +2434,23 @@ gui_mch_init()
 #ifdef FEAT_MENU
     /* create the menubar and handle */
     gui.menubar = gtk_menu_bar_new();
-    gtk_widget_show(gui.menubar);
+
 # ifdef FEAT_GUI_GNOME
     if (using_gnome)
     {
+#  ifdef HAVE_GTK2
+        BonoboDockItem *dockitem;
+
+        gnome_app_set_menus(GNOME_APP(gui.mainwin), GTK_MENU_BAR(gui.menubar));
+        dockitem = gnome_app_get_dock_item_by_name(GNOME_APP(gui.mainwin),
+                                                   GNOME_APP_MENUBAR_NAME);
+        gui.menubar_h = GTK_WIDGET(dockitem);
+#  else
 	gui.menubar_h = gnome_dock_item_new("VimMainMenu",
 					    GNOME_DOCK_ITEM_BEH_EXCLUSIVE |
 					    GNOME_DOCK_ITEM_BEH_NEVER_VERTICAL);
-	gtk_widget_show(gui.menubar_h);
 	gtk_container_add(GTK_CONTAINER(gui.menubar_h), gui.menubar);
+
 	gnome_dock_add_item(GNOME_DOCK(GNOME_APP(gui.mainwin)->dock),
 			    GNOME_DOCK_ITEM(gui.menubar_h),
 			    GNOME_DOCK_TOP, /* placement */
@@ -1882,38 +2458,55 @@ gui_mch_init()
 			    0,	/* band_position */
 			    0,	/* offset */
 			    TRUE);
+        gtk_widget_show(gui.menubar);
+#  endif
     }
     else
 # endif	/* FEAT_GUI_GNOME */
-	gtk_box_pack_start(GTK_BOX(vbox), gui.menubar, FALSE, TRUE, 0);
+    {
+        if (vim_strchr(p_go, GO_MENUS) != NULL)
+            gtk_widget_show(gui.menubar);
+        gtk_box_pack_start(GTK_BOX(vbox), gui.menubar, FALSE, FALSE, 0);
+    }
 #endif	/* FEAT_MENU */
 
 #ifdef FEAT_TOOLBAR
-    /* create the toolbar */
-    if (strstr((const char *)p_toolbar, "text")
-	    && strstr((const char *)p_toolbar, "icons"))
-	gui.toolbar =
-	    gtk_toolbar_new(GTK_ORIENTATION_HORIZONTAL, GTK_TOOLBAR_BOTH);
-    else if (strstr((const char *)p_toolbar, "text"))
-	gui.toolbar =
-	    gtk_toolbar_new(GTK_ORIENTATION_HORIZONTAL, GTK_TOOLBAR_TEXT);
-    else
-	gui.toolbar =
-	    gtk_toolbar_new(GTK_ORIENTATION_HORIZONTAL, GTK_TOOLBAR_ICONS);
 
-    gtk_widget_show(gui.toolbar);
+    /* create the toolbar */
+# ifdef HAVE_GTK2
     /* some aesthetics on the toolbar */
+    gtk_rc_parse_string("style \"vim-toolbar-style\" {"
+                        "  GtkToolbar::button_relief = GTK_RELIEF_NONE\n"
+                        "}\n"
+                        "widget \"*.vim-toolbar\" style \"vim-toolbar-style\"\n");
+    gui.toolbar = gtk_toolbar_new();
+    gtk_widget_set_name(gui.toolbar, "vim-toolbar");
+# else
+    gui.toolbar = gtk_toolbar_new(GTK_ORIENTATION_HORIZONTAL, GTK_TOOLBAR_ICONS);
     gtk_toolbar_set_button_relief(GTK_TOOLBAR(gui.toolbar), GTK_RELIEF_NONE);
+# endif
+
+    set_toolbar_style(GTK_TOOLBAR(gui.toolbar), (const char *)p_toolbar);
 
 # ifdef FEAT_GUI_GNOME
-    if (using_gnome && gui.toolbar)
+    if (using_gnome)
     {
+#  ifdef HAVE_GTK2
+        BonoboDockItem *dockitem;
+
+        gnome_app_set_toolbar(GNOME_APP(gui.mainwin), GTK_TOOLBAR(gui.toolbar));
+        dockitem = gnome_app_get_dock_item_by_name(GNOME_APP(gui.mainwin),
+                                                   GNOME_APP_TOOLBAR_NAME);
+        gui.toolbar_h = GTK_WIDGET(dockitem);
+        gtk_container_set_border_width(GTK_CONTAINER(gui.toolbar), 0);
+#  else
 	GtkWidget *dockitem;
+
 	dockitem = gnome_dock_item_new("VimToolBar",
 				       GNOME_DOCK_ITEM_BEH_EXCLUSIVE);
 	gtk_container_add(GTK_CONTAINER(dockitem), GTK_WIDGET(gui.toolbar));
 	gui.toolbar_h = dockitem;
-	gtk_widget_show(gui.toolbar_h);
+
 	gnome_dock_add_item(GNOME_DOCK(GNOME_APP(gui.mainwin)->dock),
 			    GNOME_DOCK_ITEM(dockitem),
 			    GNOME_DOCK_TOP,	/* placement */
@@ -1922,12 +2515,18 @@ gui_mch_init()
 			    0,  /* offset */
 			    TRUE);
 	gtk_container_border_width(GTK_CONTAINER(gui.toolbar), 2);
+        gtk_widget_show(gui.toolbar);
+#  endif
     }
-    else if (!using_gnome)
+    else
 # endif	/* FEAT_GUI_GNOME */
     {
+# ifndef HAVE_GTK2
 	gtk_container_border_width(GTK_CONTAINER(gui.toolbar), 1);
-	gtk_box_pack_start(GTK_BOX(vbox), gui.toolbar, FALSE, TRUE, 0);
+# endif
+        if (vim_strchr(p_go, GO_TOOLBAR) != NULL)
+            gtk_widget_show(gui.toolbar);
+        gtk_box_pack_start(GTK_BOX(vbox), gui.toolbar, FALSE, FALSE, 0);
     }
 #endif	/* USE_TOOLBARS */
 
@@ -1937,6 +2536,11 @@ gui_mch_init()
 
     gui.drawarea = gtk_drawing_area_new();
 
+#ifdef GTK2_MULTIHEAD
+    g_signal_connect(G_OBJECT(gui.drawarea), "screen_changed",
+                     G_CALLBACK(&drawarea_screen_changed), NULL);
+#endif
+
     /* Determine which events we will filter. */
     gtk_widget_set_events(gui.drawarea,
 			  GDK_EXPOSURE_MASK |
@@ -1952,22 +2556,32 @@ gui_mch_init()
     gtk_widget_show(gui.formwin);
     gtk_box_pack_start(GTK_BOX(vbox), gui.formwin, TRUE, TRUE, 0);
 
-    if (gtk_socket_id != 0)
-	/* For GtkSockets, key-presses must go to the focus widget (drawarea)
-	 * and not the window. */
-	gtk_signal_connect(GTK_OBJECT(gui.drawarea), "key_press_event",
-			   (GtkSignalFunc)key_press_event, NULL);
-    else
-	gtk_signal_connect(GTK_OBJECT(gui.mainwin), "key_press_event",
-			   (GtkSignalFunc)key_press_event, NULL);
+    /* For GtkSockets, key-presses must go to the focus widget (drawarea)
+     * and not the window.
+     */
+    gtk_signal_connect((gtk_socket_id == 0) ? GTK_OBJECT(gui.mainwin)
+                                            : GTK_OBJECT(gui.drawarea),
+                       "key_press_event",
+                       GTK_SIGNAL_FUNC(key_press_event), NULL);
 
     gtk_signal_connect(GTK_OBJECT(gui.drawarea), "realize",
-		       GTK_SIGNAL_FUNC(drawarea_realize_cb), NULL);
+                       GTK_SIGNAL_FUNC(drawarea_realize_cb), NULL);
+    gtk_signal_connect(GTK_OBJECT(gui.drawarea), "unrealize",
+                       GTK_SIGNAL_FUNC(drawarea_unrealize_cb), NULL);
 
     gui.visibility = GDK_VISIBILITY_UNOBSCURED;
+
+#ifndef USE_GNOME_SESSION
     wm_protocols_atom = gdk_atom_intern("WM_PROTOCOLS", FALSE);
     save_yourself_atom = gdk_atom_intern("WM_SAVE_YOURSELF", FALSE);
+#endif
+
+#ifdef HAVE_GTK2
+    g_signal_connect_after(G_OBJECT(gui.drawarea), "style_set",
+                           G_CALLBACK(&drawarea_style_set_cb), NULL);
+#else
     reread_rcfiles_atom = gdk_atom_intern("_GTK_READ_RCFILES", FALSE);
+#endif
 
     if (gtk_socket_id != 0)
 	/* make sure keybord input can go to the drawarea */
@@ -2011,6 +2625,10 @@ gui_mch_init()
 		       GTK_SIGNAL_FUNC(motion_notify_event), NULL);
     gtk_signal_connect(GTK_OBJECT(gui.drawarea), "button_press_event",
 		       GTK_SIGNAL_FUNC(button_press_event), NULL);
+#ifdef HAVE_GTK2
+    g_signal_connect(G_OBJECT(gui.drawarea), "scroll_event",
+                     G_CALLBACK(scroll_event), NULL);
+#endif
     gtk_signal_connect(GTK_OBJECT(gui.drawarea), "button_release_event",
 		       GTK_SIGNAL_FUNC(button_release_event), NULL);
 
@@ -2025,10 +2643,10 @@ gui_mch_init()
     /*
      * Add selection targets for PRIMARY and CLIPBOARD selections.
      */
-    gtk_selection_add_targets(gui.drawarea, (long)GDK_SELECTION_PRIMARY,
+    gtk_selection_add_targets(gui.drawarea, (GdkAtom)GDK_SELECTION_PRIMARY,
 	    primary_targets,
 	    sizeof(primary_targets)/sizeof(primary_targets[0]));
-    gtk_selection_add_targets(gui.drawarea, (long)clip_plus.gtk_sel_atom,
+    gtk_selection_add_targets(gui.drawarea, (GdkAtom)clip_plus.gtk_sel_atom,
 	    primary_targets,
 	    sizeof(primary_targets)/sizeof(primary_targets[0]));
     gtk_signal_connect(GTK_OBJECT(gui.drawarea), "selection_get",
@@ -2040,24 +2658,117 @@ gui_mch_init()
     return OK;
 }
 
+#if (defined(UNIX) && defined(USE_GNOME_SESSION)) || defined(PROTO)
+/*
+ * This is called from gui_start() after a fork() has been done.
+ * We have to tell the session manager our new PID.
+ */
+    void
+gui_mch_forked(void)
+{
+    GnomeClient *client;
+
+    client = gnome_master_client();
+
+    if (client != NULL)
+        gnome_client_set_process_id(client, getpid());
+}
+#endif
 
 /*
  * Called when the foreground or background color has been changed.
  */
     void
-gui_mch_new_colors()
+gui_mch_new_colors(void)
 {
     /* This used to change the graphics contexts directly but we are currently
      * manipulating them where desired.
      */
     if (gui.drawarea && gui.drawarea->window)
     {
-	GdkColor color;
+	GdkColor color = { 0, };
+
 	color.pixel = gui.back_pixel;
 	gdk_window_set_background(gui.drawarea->window, &color);
     }
 }
 
+
+#ifdef HAVE_GTK2
+
+    static int
+get_menu_tool_width(void)
+{
+    int width = 0;
+
+# if defined(FEAT_GUI_GNOME) && defined(FEAT_TOOLBAR)
+    if (using_gnome && gui.toolbar_h
+        && GTK_WIDGET_REALIZED(gui.toolbar_h)
+        && GTK_WIDGET_VISIBLE(gui.toolbar_h)
+        && !BONOBO_DOCK_ITEM(gui.toolbar_h)->is_floating
+        && bonobo_dock_item_get_orientation(BONOBO_DOCK_ITEM(gui.toolbar_h))
+               == GTK_ORIENTATION_VERTICAL)
+    {
+        width += gui.toolbar_h->allocation.width;
+    }
+# endif
+
+    return width;
+}
+
+    static int
+get_menu_tool_height(void)
+{
+    int height = 0;
+
+# ifdef FEAT_MENU
+#  ifdef FEAT_GUI_GNOME
+    if (using_gnome && gui.menubar_h
+        && GTK_WIDGET_REALIZED(gui.menubar_h)
+        && GTK_WIDGET_VISIBLE(gui.menubar_h)
+        && !BONOBO_DOCK_ITEM(gui.menubar_h)->is_floating)
+    {
+        height += gui.menubar_h->allocation.height;
+    }
+#  endif
+    if (!using_gnome && gui.menubar
+        && GTK_WIDGET_REALIZED(gui.menubar)
+        && GTK_WIDGET_VISIBLE(gui.menubar))
+    {
+        height += gui.menubar->allocation.height;
+    }
+# endif
+
+# ifdef FEAT_TOOLBAR
+#  ifdef FEAT_GUI_GNOME
+    if (using_gnome && gui.toolbar_h
+        && GTK_WIDGET_REALIZED(gui.toolbar_h)
+        && GTK_WIDGET_VISIBLE(gui.toolbar_h)
+        && !BONOBO_DOCK_ITEM(gui.toolbar_h)->is_floating
+        && bonobo_dock_item_get_orientation(BONOBO_DOCK_ITEM(gui.toolbar_h))
+               == GTK_ORIENTATION_HORIZONTAL)
+    {
+        height += gui.toolbar_h->allocation.height;
+    }
+#  endif
+    if (!using_gnome && gui.toolbar
+        && GTK_WIDGET_REALIZED(gui.toolbar)
+        && GTK_WIDGET_VISIBLE(gui.toolbar))
+    {
+        height += gui.toolbar->allocation.height;
+    }
+# endif
+# ifdef FEAT_XIM
+    if (xim_get_status_area_height())
+        height += gui.char_height + 2;
+# endif
+
+    return height;
+}
+
+#endif /* HAVE_GTK2 */
+
+
     static void
 update_window_manager_hints(void)
 {
@@ -2072,25 +2783,38 @@ update_window_manager_hints(void)
 
     /* This also needs to be done when the main window isn't there yet,
      * otherwise the hints don't work. */
-    width = gui_get_base_width();
+    width  = gui_get_base_width();
     height = gui_get_base_height();
 
+# ifdef HAVE_GTK2
+    width  += get_menu_tool_width();
+    height += get_menu_tool_height();
+# endif
+
     /* Avoid an expose event when the size didn't change. */
     if (width != old_width
 	    || height != old_height
 	    || gui.char_width != old_char_width
 	    || gui.char_height != old_char_height)
     {
-	geometry_mask =
-		     GDK_HINT_BASE_SIZE|GDK_HINT_RESIZE_INC|GDK_HINT_MIN_SIZE;
+	geometry_mask = GDK_HINT_BASE_SIZE|GDK_HINT_RESIZE_INC|GDK_HINT_MIN_SIZE;
 	geometry.width_inc = gui.char_width;
 	geometry.height_inc = gui.char_height;
 	geometry.base_width = width;
 	geometry.base_height = height;
 	geometry.min_width = width + MIN_COLUMNS * gui.char_width;
 	geometry.min_height = height + MIN_LINES * gui.char_height;
+# ifdef HAVE_GTK2
+        /* Using gui.formwin as geometry widget doesn't work as expected
+         * with GTK+ 2 -- dunno why.  Presumably all the resizing hacks
+         * in Vim confuse GTK+.
+         */
+	gtk_window_set_geometry_hints(GTK_WINDOW(gui.mainwin), gui.mainwin,
+				      &geometry, geometry_mask);
+# else
 	gtk_window_set_geometry_hints(GTK_WINDOW(gui.mainwin), gui.formwin,
 				      &geometry, geometry_mask);
+# endif
 	old_width = width;
 	old_height = height;
 	old_char_width = gui.char_width;
@@ -2112,6 +2836,7 @@ form_configure_event(GtkWidget * widget,
     return TRUE;
 }
 
+#ifndef HAVE_GTK2
 /*
  * X11 based inter client communication handler.
  */
@@ -2133,6 +2858,7 @@ client_event_cb(GtkWidget *widget, GdkEv
     }
     return FALSE;
 }
+#endif /* !HAVE_GTK2 */
 
 /*
  * Function called when window already closed.
@@ -2142,23 +2868,30 @@ client_event_cb(GtkWidget *widget, GdkEv
     static void
 destroy_callback(void)
 {
-    /* preserve files and exit */
-    preserve_exit();
-    if (gtk_main_level() > 0)
-	gtk_main_quit();
-}
+    gui.mainwin = NULL;
 
+    if (!exiting) /* only do anything if the destroy was unexpected */
+    {
+        STRNCPY(IObuff, _("Vim: Main window unexpectedly destroyed\n"), IOSIZE);
+        IObuff[IOSIZE - 1] = NUL;
+        preserve_exit();
+    }
+}
 
 /*
  * Open the GUI window which was created by a call to gui_mch_init().
  */
     int
-gui_mch_open()
+gui_mch_open(void)
 {
     int x = -1, y = -1;
 
     if (gui_win_x != -1 && gui_win_y != -1)
+#ifdef HAVE_GTK2
+        gtk_window_move(GTK_WINDOW(gui.mainwin), gui_win_x, gui_win_y);
+#else
 	gtk_widget_set_uposition(gui.mainwin, gui_win_x, gui_win_y);
+#endif
 
     /* Determine user specified geometry, if present. */
     if (gui.geom != NULL)
@@ -2172,8 +2905,12 @@ gui_mch_open()
 	if (mask & HeightValue)
 	    Rows = h;
 	if (mask & (XValue | YValue))
+#ifdef HAVE_GTK2
+            gtk_window_move(GTK_WINDOW(gui.mainwin), x, y);
+#else
 	    gtk_widget_set_uposition(gui.mainwin, x, y);
-	g_free(gui.geom);
+#endif
+	vim_free(gui.geom);
 	gui.geom = NULL;
     }
 
@@ -2209,12 +2946,14 @@ gui_mch_open()
     gtk_signal_connect(GTK_OBJECT(gui.mainwin), "destroy",
 		       GTK_SIGNAL_FUNC(destroy_callback), NULL);
 
+#ifndef HAVE_GTK2
     /* Make this run after any internal handling of the client event happened
      * to make sure that all changes implicated by it are already in place and
      * we thus can make our own adjustments.
      */
     gtk_signal_connect_after(GTK_OBJECT(gui.mainwin), "client_event",
-		    GTK_SIGNAL_FUNC(client_event_cb), NULL);
+                             GTK_SIGNAL_FUNC(client_event_cb), NULL);
+#endif
 
 #ifdef FEAT_HANGULIN
     hangul_keyboard_set();
@@ -2239,14 +2978,48 @@ gui_mch_open()
      */
     gtk_drag_dest_set(gui.drawarea,
 	    GTK_DEST_DEFAULT_ALL,
-	    target_table, n_targets,
+	    target_table, DND_N_TARGETS,
 	    GDK_ACTION_COPY | GDK_ACTION_MOVE);
 
     gtk_signal_connect(GTK_OBJECT(gui.drawarea), "drag_data_received",
 	    GTK_SIGNAL_FUNC(drag_data_received), NULL);
 #endif
 
-    gtk_widget_show(gui.mainwin);
+#if defined(FEAT_GUI_GNOME) && defined(HAVE_GTK2) && defined(FEAT_MENU)
+    {
+        unsigned long menubar_handler = 0;
+# ifdef FEAT_TOOLBAR
+        unsigned long toolbar_handler = 0;
+# endif
+        /* Urgh hackish :/  For some reason BonoboDockLayout always forces a
+         * show when restoring the saved layout configuration.  We can't just
+         * hide the widgets again after gtk_widget_show(gui.mainwin) since it's
+         * a toplevel window and thus will be realized immediately.  Instead,
+         * connect signal handlers to hide the widgets just after they've been
+         * marked visible, but before the main window is realized.
+         */
+        if (vim_strchr(p_go, GO_MENUS) == NULL)
+            menubar_handler = g_signal_connect_after(gui.menubar_h, "show",
+                                                     G_CALLBACK(&gtk_widget_hide),
+                                                     NULL);
+# ifdef FEAT_TOOLBAR
+        if (vim_strchr(p_go, GO_TOOLBAR) == NULL)
+            toolbar_handler = g_signal_connect_after(gui.toolbar_h, "show",
+                                                     G_CALLBACK(&gtk_widget_hide),
+                                                     NULL);
+# endif
+#endif
+        gtk_widget_show(gui.mainwin);
+
+#if defined(FEAT_GUI_GNOME) && defined(HAVE_GTK2) && defined(FEAT_MENU)
+        if (menubar_handler != 0)
+            g_signal_handler_disconnect(gui.menubar_h, menubar_handler);
+# ifdef FEAT_TOOLBAR
+        if (toolbar_handler != 0)
+            g_signal_handler_disconnect(gui.toolbar_h, toolbar_handler);
+# endif
+    }
+#endif
 
     return OK;
 }
@@ -2256,7 +3029,8 @@ gui_mch_open()
     void
 gui_mch_exit(int rc)
 {
-    gtk_exit(0);
+    if (gui.mainwin != NULL)
+        gtk_object_destroy(GTK_OBJECT(gui.mainwin));
 }
 
 /*
@@ -2265,9 +3039,13 @@ gui_mch_exit(int rc)
     int
 gui_mch_get_winpos(int *x, int *y)
 {
+#ifdef HAVE_GTK2
+    gtk_window_get_position(GTK_WINDOW(gui.mainwin), x, y);
+#else
     /* For some people this must be gdk_window_get_origin() for a correct
      * result.  Where is the documentation! */
     gdk_window_get_root_origin(gui.mainwin->window, x, y);
+#endif
     return OK;
 }
 
@@ -2278,8 +3056,40 @@ gui_mch_get_winpos(int *x, int *y)
     void
 gui_mch_set_winpos(int x, int y)
 {
+#ifdef HAVE_GTK2
+    gtk_window_move(GTK_WINDOW(gui.mainwin), x, y);
+#else
     gdk_window_move(gui.mainwin->window, x, y);
+#endif
+}
+
+#ifdef HAVE_GTK2
+static gboolean resize_idle_installed = FALSE;
+/*
+ * Idle handler to force resize.  Used by gui_mch_set_shellsize() to ensure
+ * the shell size doesn't exceed the window size, i.e. if the window manager
+ * ignored our size request.  Usually this happens if the window is maximized.
+ */
+    static gboolean
+force_shell_resize_idle(gpointer data)
+{
+    if (gui.mainwin != NULL && GTK_WIDGET_MAPPED(gui.mainwin))
+    {
+        int width;
+        int height;
+
+        gtk_window_get_size(GTK_WINDOW(gui.mainwin), &width, &height);
+
+        width  -= get_menu_tool_width();
+        height -= get_menu_tool_height();
+
+        gui_resize_shell(width, height);
+    }
+
+    resize_idle_installed = FALSE;
+    return FALSE; /* don't call me again */
 }
+#endif /* HAVE_GTK2 */
 
 /*
  * Set the windows size.
@@ -2289,6 +3099,7 @@ gui_mch_set_winpos(int x, int y)
 gui_mch_set_shellsize(int width, int height,
 	int min_width, int min_height, int base_width, int base_height)
 {
+#ifndef HAVE_GTK2
     /* Hack: When the form already is at the desired size, the window might
      * have been resized with the mouse.  Force a resize by setting a
      * different size first. */
@@ -2300,12 +3111,30 @@ gui_mch_set_shellsize(int width, int hei
     }
 
     gtk_form_set_size(GTK_FORM(gui.formwin), width, height);
-
+#endif
     /* give GTK+ a chance to put all widget's into place */
     gui_mch_update();
 
     /* this will cause the proper resizement to happen too */
     update_window_manager_hints();
+
+#ifdef HAVE_GTK2
+    /* With GTK+ 2, changing the size of the form widget doesn't resize
+     * the window.  So lets do it the other way around and resize the
+     * main window instead.
+     */
+    width  += get_menu_tool_width();
+    height += get_menu_tool_height();
+
+    gtk_window_resize(GTK_WINDOW(gui.mainwin), width, height);
+
+    if (!resize_idle_installed)
+    {
+        resize_idle_installed = TRUE;
+        g_idle_add_full(GDK_PRIORITY_EVENTS + 10,
+                        &force_shell_resize_idle, NULL, NULL);
+    }
+#endif
 }
 
 
@@ -2317,10 +3146,24 @@ gui_mch_set_shellsize(int width, int hei
     void
 gui_mch_get_screen_dimensions(int *screen_w, int *screen_h)
 {
-    *screen_w = gdk_screen_width();
-    /* Subtract 'guihearroom' from the height to allow some room for the
-     * window manager (task list and window title bar). */
-    *screen_h = gdk_screen_height() - p_ghr;
+#ifdef GTK2_MULTIHEAD
+    if (gui.mainwin && gtk_widget_has_screen(gui.mainwin))
+    {
+        GdkScreen* screen;
+
+        screen = gtk_widget_get_screen(gui.mainwin);
+
+        *screen_w = gdk_screen_get_width(screen);
+        *screen_h = gdk_screen_get_height(screen) - p_ghr;
+    }
+    else
+#endif
+    {
+        *screen_w = gdk_screen_width();
+        /* Subtract 'guiheadroom' from the height to allow some room for the
+         * window manager (task list and window title bar). */
+        *screen_h = gdk_screen_height() - p_ghr;
+    }
 
     /*
      * FIXME: dirty trick: Because the gui_get_base_height() doesn't include
@@ -2328,28 +3171,63 @@ gui_mch_get_screen_dimensions(int *scree
      * hight, so that the window size can be made to fit on the screen.
      * This should be completely changed later.
      */
-#ifdef FEAT_TOOLBAR
+#ifdef HAVE_GTK2
+    *screen_w -= get_menu_tool_width();
+    *screen_h -= get_menu_tool_height();
+#else
+# ifdef FEAT_TOOLBAR
     if (gui.toolbar && GTK_WIDGET_REALIZED(gui.toolbar)
 	    && GTK_WIDGET_VISIBLE(gui.toolbar))
 	*screen_h -= gui.toolbar->allocation.height;
-#endif
-#ifdef FEAT_MENU
+# endif
+# ifdef FEAT_MENU
     if (gui.menubar && GTK_WIDGET_REALIZED(gui.menubar)
 	    && GTK_WIDGET_VISIBLE(gui.menubar))
 	*screen_h -= gui.menubar->allocation.height;
+# endif
 #endif
 }
 
+#if defined(FEAT_TITLE) || defined(PROTO)
+    void
+gui_mch_settitle(char_u *title, char_u *icon)
+{
+# ifdef HAVE_GTK2
+    if (output_conv.vc_type != CONV_NONE)
+        title = string_convert(&output_conv, title, NULL);
+# endif
+
+    gtk_window_set_title(GTK_WINDOW(gui.mainwin), (const char *)title);
+
+# ifdef HAVE_GTK2
+    if (output_conv.vc_type != CONV_NONE)
+        vim_free(title);
+# endif
+}
+#endif
+
 #if defined(FEAT_MENU) || defined(PROTO)
     void
-gui_mch_enable_menu(int flag)
+gui_mch_enable_menu(int showit)
 {
-    if (flag)
-	gtk_widget_show(gui.menubar);
+    GtkWidget *widget;
+
+# ifdef FEAT_GUI_GNOME
+    if (using_gnome)
+        widget = gui.menubar_h;
     else
-	gtk_widget_hide(gui.menubar);
+# endif
+        widget = gui.menubar;
 
-    update_window_manager_hints();
+    if (!showit != !GTK_WIDGET_VISIBLE(widget))
+    {
+        if (showit)
+            gtk_widget_show(widget);
+        else
+            gtk_widget_hide(widget);
+
+        update_window_manager_hints();
+    }
 }
 #endif
 
@@ -2359,59 +3237,34 @@ gui_mch_enable_menu(int flag)
     void
 gui_mch_show_toolbar(int showit)
 {
+    GtkWidget *widget;
+
     if (gui.toolbar == NULL)
 	return;
 
-    if (!showit)
-    {
 # ifdef FEAT_GUI_GNOME
-	if (using_gnome && GTK_WIDGET_VISIBLE(gui.toolbar_h))
-	{
-	    gtk_widget_hide(gui.toolbar_h);
-	    /* wait util this gets done on the server side. */
-	    update_window_manager_hints();
-	}
-# endif
-	if (!using_gnome && GTK_WIDGET_VISIBLE(gui.toolbar))
-	{
-	    gtk_widget_hide(gui.toolbar);
-	    /* wait util this gets done on the server side. */
-	    update_window_manager_hints();
-	}
-    }
+    if (using_gnome)
+        widget = gui.toolbar_h;
     else
-    {
-	if (strstr((const char *)p_toolbar, "text")
-		&& strstr((const char *)p_toolbar, "icons"))
-	    gtk_toolbar_set_style(GTK_TOOLBAR(gui.toolbar), GTK_TOOLBAR_BOTH);
-	else if (strstr((const char *)p_toolbar, "text"))
-	    gtk_toolbar_set_style(GTK_TOOLBAR(gui.toolbar), GTK_TOOLBAR_TEXT);
-	else if (strstr((const char *)p_toolbar, "icons"))
-	    gtk_toolbar_set_style(GTK_TOOLBAR(gui.toolbar), GTK_TOOLBAR_ICONS);
-
-# ifdef FEAT_GUI_GNOME
-	if (using_gnome && !GTK_WIDGET_VISIBLE(gui.toolbar_h))
-	{
-	    gtk_widget_show(gui.toolbar_h);
-	    update_window_manager_hints();
-	}
-	else
 # endif
-	if (!using_gnome && !GTK_WIDGET_VISIBLE(gui.toolbar))
-	{
-	    gtk_widget_show(gui.toolbar);
-	    update_window_manager_hints();
-	}
+        widget = gui.toolbar;
 
-	if (strstr((const char *)p_toolbar, "tooltips"))
-	    gtk_toolbar_set_tooltips(GTK_TOOLBAR(gui.toolbar), TRUE);
-	else
-	    gtk_toolbar_set_tooltips(GTK_TOOLBAR(gui.toolbar), FALSE);
+    if (showit)
+        set_toolbar_style(GTK_TOOLBAR(gui.toolbar), (const char *)p_toolbar);
+
+    if (!showit != !GTK_WIDGET_VISIBLE(widget))
+    {
+        if (showit)
+            gtk_widget_show(widget);
+        else
+            gtk_widget_hide(widget);
+
+        update_window_manager_hints();
     }
 }
-#endif
-
+#endif /* FEAT_TOOLBAR */
 
+#ifndef HAVE_GTK2
 /*
  * Get a font structure for highlighting.
  * "cbdata" is a pointer to the global gui structure.
@@ -2421,14 +3274,16 @@ gui_mch_show_toolbar(int showit)
 font_sel_ok(GtkWidget *wgt, gpointer cbdata)
 {
     gui_T *vw = (gui_T *)cbdata;
-    GtkFontSelectionDialog *fs = (GtkFontSelectionDialog *)vw->fontdlg;
+    GtkFontSelectionDialog *fs;
+
+    fs = GTK_FONT_SELECTION_DIALOG(vw->fontdlg);
 
-    if (vw->fontname)
-	g_free(vw->fontname);
+    if (vw->fontname != NULL)
+        vim_free(vw->fontname);
 
-    vw->fontname = (char_u *)g_strdup(
-				gtk_font_selection_dialog_get_font_name(fs));
+    vw->fontname = vim_strsave((char_u *)gtk_font_selection_dialog_get_font_name(fs));
     gtk_widget_hide(vw->fontdlg);
+
     if (gtk_main_level() > 0)
 	gtk_main_quit();
 }
@@ -2454,13 +3309,35 @@ font_sel_destroy(GtkWidget *wgt, gpointe
     if (gtk_main_level() > 0)
 	gtk_main_quit();
 }
+#endif /* !HAVE_GTK2 */
 
     int
 gui_mch_adjust_charsize(void)
 {
+#ifdef HAVE_GTK2
+    PangoFontMetrics    *metrics;
+    int                 ascent;
+    int                 descent;
+
+    metrics = pango_context_get_metrics(gui.text_context, gui.norm_font,
+                                        pango_context_get_language(gui.text_context));
+
+    ascent  = pango_font_metrics_get_ascent(metrics);
+    descent = pango_font_metrics_get_descent(metrics);
+
+    pango_font_metrics_unref(metrics);
+
+    gui.char_height = PANGO_PIXELS(ascent + descent) + p_linespace;
+    gui.char_ascent = PANGO_PIXELS(ascent) + p_linespace / 2;
+
+#else /* !HAVE_GTK2 */
+
     gui.char_height = gui.current_font->ascent + gui.current_font->descent
 		      + p_linespace;
     gui.char_ascent = gui.current_font->ascent + p_linespace / 2;
+
+#endif /* !HAVE_GTK2 */
+
     return OK;
 }
 
@@ -2492,8 +3369,9 @@ gui_mch_get_fontset(char_u *name, int re
 
     return (GuiFontset)font;
 }
-#endif
+#endif /* FEAT_XFONTSET */
 
+#ifndef HAVE_GTK2
 /*
  * Put up a font dialog and return the selected font name in allocated memory.
  * "oldval" is the previous value.
@@ -2506,11 +3384,10 @@ gui_mch_font_dialog(char_u *oldval)
     {
 	GtkFontSelectionDialog	*fsd = NULL;
 
-	gui.fontdlg = gtk_font_selection_dialog_new(_("Font Selection"));
+	gui.fontdlg = gtk_font_selection_dialog_new((const char *)_("Font Selection"));
 	fsd = GTK_FONT_SELECTION_DIALOG(gui.fontdlg);
 	gtk_window_set_modal(GTK_WINDOW(gui.fontdlg), TRUE);
-	gtk_window_set_transient_for(GTK_WINDOW(gui.fontdlg),
-		GTK_WINDOW(gui.mainwin));
+        gtk_window_set_transient_for(GTK_WINDOW(gui.fontdlg), GTK_WINDOW(gui.mainwin));
 	gtk_signal_connect(GTK_OBJECT(gui.fontdlg), "destroy",
 		GTK_SIGNAL_FUNC(font_sel_destroy), &gui);
 	gtk_signal_connect(GTK_OBJECT(fsd->ok_button), "clicked",
@@ -2525,11 +3402,12 @@ gui_mch_font_dialog(char_u *oldval)
 
     if (gui.fontname)
     {
-	g_free(gui.fontname);
+	vim_free(gui.fontname);
 	gui.fontname = NULL;
     }
     gtk_window_position(GTK_WINDOW(gui.fontdlg), GTK_WIN_POS_MOUSE);
     gtk_widget_show(gui.fontdlg);
+
     {
 	static gchar	*spacings[] = {"c", "m", NULL};
 
@@ -2550,6 +3428,109 @@ gui_mch_font_dialog(char_u *oldval)
 	return NULL;
     return vim_strsave(gui.fontname);
 }
+#endif /* !HAVE_GTK2 */
+
+#ifdef HAVE_GTK2
+/*
+ * Put up a font dialog and return the selected font name in allocated memory.
+ * "oldval" is the previous value.  Return NULL when cancelled.
+ * This should probably go into gui_gtk.c.  Hmm.
+ * FIXME:
+ * The GTK2 font selection dialog has no filtering API.  So we could either
+ * a) implement our own (possibly copying the code from gnome-terminal) or
+ * b) just live with it.
+ */
+    char_u *
+gui_mch_font_dialog(char_u *oldval)
+{
+    GtkWidget   *dialog;
+    int         response;
+    char_u      *fontname = NULL;
+
+    dialog = gtk_font_selection_dialog_new(NULL);
+
+    gtk_window_set_transient_for(GTK_WINDOW(dialog), GTK_WINDOW(gui.mainwin));
+    gtk_window_set_destroy_with_parent(GTK_WINDOW(dialog), TRUE);
+
+    if (oldval != NULL && oldval[0] != NUL)
+    {
+        if (output_conv.vc_type != CONV_NONE)
+            oldval = string_convert(&output_conv, oldval, NULL);
+
+        gtk_font_selection_dialog_set_font_name(GTK_FONT_SELECTION_DIALOG(dialog),
+                                                (const char *)oldval);
+        if (output_conv.vc_type != CONV_NONE)
+            vim_free(oldval);
+    }
+
+    response = gtk_dialog_run(GTK_DIALOG(dialog));
+
+    if (response == GTK_RESPONSE_OK)
+    {
+        char *name;
+
+        name = gtk_font_selection_dialog_get_font_name(GTK_FONT_SELECTION_DIALOG(dialog));
+
+        if (name != NULL)
+        {
+            if (input_conv.vc_type == CONV_NONE)
+                fontname = vim_strsave((char_u *)name);
+            else
+                fontname = string_convert(&input_conv, (char_u *)name, NULL);
+            g_free(name);
+        }
+    }
+
+    if (response != GTK_RESPONSE_NONE)
+        gtk_widget_destroy(dialog);
+
+    return fontname;
+}
+
+/* Some monospace fonts don't support a bold weight, and fall back
+ * silently to the regular weight.  But this is no good since our text
+ * drawing function can emulate bold by overstriking.  So let's try
+ * to detect whether bold weight is actually available and emulate it
+ * otherwise.
+ *
+ * Note that we don't need to check for italic style since Xft can
+ * emulate italic on its own, provided you have a proper fontconfig
+ * setup.  We wouldn't be able to emulate it in Vim anyway.
+ */
+    static void
+get_styled_font_variants(void)
+{
+    PangoFontDescription    *bold_font_desc;
+    PangoFont               *plain_font;
+    PangoFont               *bold_font;
+
+    gui.font_can_bold = 0;
+
+    plain_font = pango_context_load_font(gui.text_context, gui.norm_font);
+
+    if (plain_font == NULL)
+        return;
+
+    bold_font_desc = pango_font_description_copy(gui.norm_font);
+    pango_font_description_set_weight(bold_font_desc, PANGO_WEIGHT_BOLD);
+
+    bold_font = pango_context_load_font(gui.text_context, bold_font_desc);
+
+    /* The comparison relies on the unique handle nature of a PangoFont*,
+     * i.e.  it's assumed that a different PangoFont* won't refer to the
+     * same font.  Seems to work, and failing here isn't critical anyway.
+     */
+    if (bold_font != NULL)
+    {
+        gui.font_can_bold = (bold_font != plain_font);
+        g_object_unref(bold_font);
+    }
+
+    pango_font_description_free(bold_font_desc);
+    g_object_unref(plain_font);
+}
+
+#else /* !HAVE_GTK2 */
 
 /*
  * There is only one excuse I can give for the following attempt to manage font
@@ -2641,6 +3622,70 @@ get_styled_font_variants(char_u * font_n
 
     g_free(sdup);
 }
+#endif /* !HAVE_GTK2 */
+
+#ifdef HAVE_GTK2
+/*
+ * Create a map from ASCII characters in the range [32,126] to glyphs
+ * of the current font.  This is used by gui_mch_draw_string() to skip
+ * the itemize and shaping process for the most common case.
+ */
+    static void
+ascii_glyph_table_init(void)
+{
+    char_u          ascii_chars[128];
+    PangoAttrList   *attr_list;
+    GList           *item_list;
+    int             i;
+
+    if (gui.ascii_glyphs != NULL)
+        pango_glyph_string_free(gui.ascii_glyphs);
+
+    if (gui.ascii_font != NULL)
+        g_object_unref(gui.ascii_font);
+
+    gui.ascii_glyphs = NULL;
+    gui.ascii_font   = NULL;
+
+    /* For safety, fill in question marks for the control characters. */
+    for (i = 0; i < 32; ++i)
+        ascii_chars[i] = '?';
+
+    for (; i < 127; ++i)
+        ascii_chars[i] = i;
+
+    ascii_chars[i] = '?';
+
+    attr_list = pango_attr_list_new();
+    item_list = pango_itemize(gui.text_context, (const char *)ascii_chars,
+                              0, sizeof(ascii_chars), attr_list, NULL);
+
+    if (item_list != NULL && item_list->next == NULL) /* play safe */
+    {
+        PangoItem *item;
+
+        item = (PangoItem *)item_list->data;
+
+        gui.ascii_font = item->analysis.font;
+        g_object_ref(gui.ascii_font);
+
+        gui.ascii_glyphs = pango_glyph_string_new();
+
+        pango_shape((const char *)ascii_chars, sizeof(ascii_chars),
+                    &item->analysis, gui.ascii_glyphs);
+
+        g_return_if_fail(gui.ascii_glyphs->num_glyphs == sizeof(ascii_chars));
+
+        for (i = 0; i < gui.ascii_glyphs->num_glyphs; ++i)
+            gui.ascii_glyphs->glyphs[i].geometry.width = gui.char_width * PANGO_SCALE;
+
+        pango_item_free(item);
+    }
+
+    g_list_free(item_list);
+    pango_attr_list_unref(attr_list);
+}
+#endif /* HAVE_GTK2 */
 
 /*
  * Initialize Vim to use the font or fontset with the given name.
@@ -2650,20 +3695,68 @@ get_styled_font_variants(char_u * font_n
     int
 gui_mch_init_font(char_u *font_name, int fontset)
 {
+#ifdef HAVE_GTK2
+    PangoFontDescription    *font_desc;
+    PangoFontMetrics        *metrics;
+    int                     width;
+    int                     ascent;
+    int                     descent;
+
+    /* If font_name is NULL, this means to use the default, which should
+     * be present on all proper Pango/fontconfig installations.
+     */
+    if (font_name == NULL)
+        font_name = (char_u *)DEFAULT_FONT;
+
+    font_desc = gui_mch_get_font(font_name, FALSE);
+
+    if (font_desc == NULL)
+        return FAIL;
+
+    gui_mch_free_font(gui.norm_font);
+    gui.norm_font = font_desc;
+
+    pango_context_set_font_description(gui.text_context, font_desc);
+
+    metrics = pango_context_get_metrics(gui.text_context, font_desc,
+                                        pango_context_get_language(gui.text_context));
+
+    width   = pango_font_metrics_get_approximate_char_width(metrics);
+    ascent  = pango_font_metrics_get_ascent(metrics);
+    descent = pango_font_metrics_get_descent(metrics);
+
+    pango_font_metrics_unref(metrics);
+
+    gui.char_width  = PANGO_PIXELS(width);
+    gui.char_height = PANGO_PIXELS(ascent + descent) + p_linespace;
+    gui.char_ascent = PANGO_PIXELS(ascent) + p_linespace / 2;
+
+    /* A zero width may cause a crash.  Happens for semi-invalid fontsets. */
+    if (gui.char_width <= 0)
+        gui.char_width = 8;
+
+    /* Set the fontname, which will be used for information purposes */
+    hl_set_font_name(font_name);
+
+    get_styled_font_variants();
+    ascii_glyph_table_init();
+
+#else /* !HAVE_GTK2 */
+
     GdkFont	*font = NULL;
 
-#ifdef FEAT_XFONTSET
+# ifdef FEAT_XFONTSET
     /* Try loading a fontset.  If this fails we try loading a normal font. */
     if (fontset && font_name != NULL)
 	font = gui_mch_get_fontset(font_name, TRUE, TRUE);
 
     if (font == NULL)
-#endif
+# endif
     {
 	/* If font_name is NULL, this means to use the default, which should
 	 * be present on all X11 servers. */
 	if (font_name == NULL)
-	    font_name = (char_u *)DFLT_FONT;
+	    font_name = (char_u *)DEFAULT_FONT;
 	font = gui_mch_get_font(font_name, FALSE);
     }
 
@@ -2671,7 +3764,7 @@ gui_mch_init_font(char_u *font_name, int
 	return FAIL;
 
     gui_mch_free_font(gui.norm_font);
-#ifdef FEAT_XFONTSET
+# ifdef FEAT_XFONTSET
     gui_mch_free_fontset(gui.fontset);
     if (font->type == GDK_FONT_FONTSET)
     {
@@ -2682,12 +3775,12 @@ gui_mch_init_font(char_u *font_name, int
 	gui.char_width = gdk_string_width(font, "xW") / 2;
     }
     else
-#endif
+# endif
     {
 	gui.norm_font = font;
-#ifdef FEAT_XFONTSET
+# ifdef FEAT_XFONTSET
 	gui.fontset = NOFONTSET;
-#endif
+# endif
 	gui.char_width = ((XFontStruct *)
 				      GDK_FONT_XFONT(font))->max_bounds.width;
     }
@@ -2710,6 +3803,7 @@ gui_mch_init_font(char_u *font_name, int
      * usage.
      */
     gui_gtk_synch_fonts();
+#endif /* !HAVE_GTK2 */
 
 #ifdef FEAT_XIM
     /* Adjust input management behaviour to the capabilities of the new
@@ -2717,14 +3811,14 @@ gui_mch_init_font(char_u *font_name, int
     xim_decide_input_style();
     if (xim_get_status_area_height())
     {
-	/* Status area is required.  Just create the empty label so that
-	 * mainwin will allocate the extra space for status area. */
-	GtkWidget *label = gtk_label_new("       ");
-
-	gtk_widget_set_usize(label, 20, gui.char_height + 2);
-	gtk_box_pack_end(GTK_BOX(GTK_BIN(gui.mainwin)->child), label,
-							     FALSE, FALSE, 0);
-	gtk_widget_show(label);
+        /* Status area is required.  Just create the empty container so that
+         * mainwin will allocate the extra space for status area. */
+        GtkWidget *alignment = gtk_alignment_new(0.5, 0.5, 1.0, 1.0);
+
+        gtk_widget_set_usize(alignment, 20, gui.char_height + 2);
+        gtk_box_pack_end(GTK_BOX(GTK_BIN(gui.mainwin)->child),
+                         alignment, FALSE, FALSE, 0);
+        gtk_widget_show(alignment);
     }
 #endif
 
@@ -2741,37 +3835,116 @@ gui_mch_init_font(char_u *font_name, int
     GuiFont
 gui_mch_get_font(char_u *name, int report_error)
 {
-    GdkFont *font;
+#ifdef HAVE_GTK2
+    PangoFontDescription    *font;
+#else
+    GdkFont                 *font;
+#endif
 
     /* can't do this when GUI is not running */
     if (!gui.in_use || name == NULL)
-	return NOFONT;
+	return NULL;
+
+#ifdef HAVE_GTK2
+    if (output_conv.vc_type != CONV_NONE)
+    {
+        char_u *buf;
+
+        buf = string_convert(&output_conv, name, NULL);
+        font = pango_font_description_from_string((const char *)buf);
+        vim_free(buf);
+    }
+    else
+        font = pango_font_description_from_string((const char *)name);
+
+    if (font != NULL)
+    {
+        PangoFont *real_font;
 
-    font = gdk_font_load((const gchar *)name);
+        /* pango_context_load_font() bails out if no font size is set */
+        if (pango_font_description_get_size(font) <= 0)
+            pango_font_description_set_size(font, 10 * PANGO_SCALE);
+
+        real_font = pango_context_load_font(gui.text_context, font);
+
+        if (real_font == NULL)
+        {
+            pango_font_description_free(font);
+            font = NULL;
+        }
+        else
+            g_object_unref(real_font);
+    }
+#else
+    font = gdk_font_load((const char *)name);
+#endif /* !HAVE_GTK2 */
 
     if (font == NULL)
     {
 	if (report_error)
 	    EMSG2(_("E235: Unknown font: %s"), name);
-	return NOFONT;
+
+	return NULL;
     }
 
-    /* reference this font as being in use */
-    gdk_font_ref(font);
+#ifdef HAVE_GTK2
+    {
+        /* Check that this is a mono-spaced font.  Naturally, this is a bit
+         * hackish -- fixed-width isn't really suitable for i18n text :/
+         */
+        PangoLayout     *layout;
+        unsigned int    i;
+        int             last_width   = -1;
+        const char      test_chars[] = { 'W', 'i', ',', 'x' }; /* arbitrary */
+
+        layout = pango_layout_new(gui.text_context);
+        pango_layout_set_font_description(layout, font);
+
+        for (i = 0; i < G_N_ELEMENTS(test_chars); ++i)
+        {
+            int width;
+
+            pango_layout_set_text(layout, &test_chars[i], 1);
+            pango_layout_get_size(layout, &width, NULL);
+
+            if (last_width >= 0 && width != last_width)
+            {
+                pango_font_description_free(font);
+                font = NULL;
+                break;
+            }
+
+            last_width = width;
+        }
 
-    /* Check that this is a mono-spaced font. */
-    if (((XFontStruct *)GDK_FONT_XFONT(font))->max_bounds.width
-	    != ((XFontStruct *)GDK_FONT_XFONT(font))->min_bounds.width)
+        g_object_unref(layout);
+    }
+#else /* !HAVE_GTK2 */
     {
-	EMSG2(_("E236: Font \"%s\" is not fixed-width"), name);
-	gdk_font_unref(font);
+        XFontStruct *xfont;
 
-	return NOFONT;
+        /* reference this font as being in use */
+        gdk_font_ref(font);
+
+        /* Check that this is a mono-spaced font.
+         */
+        xfont = (XFontStruct *) GDK_FONT_XFONT(font);
+
+        if (xfont->max_bounds.width != xfont->min_bounds.width)
+        {
+            gdk_font_unref(font);
+            font = NULL;
+        }
     }
+#endif /* !HAVE_GTK2 */
+
+    if (font == NULL)
+        EMSG2(_("E236: Font \"%s\" is not fixed-width"), name);
 
-    return (GuiFont)font;
+    return font;
 }
 
+#ifndef HAVE_GTK2
 /*
  * Set the current text font.
  * Since we create all GC on demand, we use just gui.current_font to
@@ -2782,6 +3955,7 @@ gui_mch_set_font(GuiFont font)
 {
     gui.current_font = font;
 }
+#endif
 
 #if defined(FEAT_XFONTSET) || defined(PROTO)
 /*
@@ -2801,7 +3975,11 @@ gui_mch_set_fontset(GuiFontset fontset)
 gui_mch_free_font(GuiFont font)
 {
     if (font != NOFONT)
-	gdk_font_unref((GdkFont *)font);
+#ifdef HAVE_GTK2
+        pango_font_description_free(font);
+#else
+	gdk_font_unref(font);
+#endif
 }
 
 #if defined(FEAT_XFONTSET) || defined(PROTO)
@@ -2812,7 +3990,7 @@ gui_mch_free_font(GuiFont font)
 gui_mch_free_fontset(GuiFontset fontset)
 {
     if (fontset != NOFONTSET)
-	gdk_font_unref((GdkFont *)fontset);
+	gdk_font_unref(fontset);
 }
 #endif
 
@@ -2826,8 +4004,7 @@ gui_mch_free_fontset(GuiFontset fontset)
     guicolor_T
 gui_mch_get_color(char_u * name)
 {
-    int i;
-    static char *(vimnames[][2]) =
+    static const char *const (vimnames[][2]) =
     {
     /* A number of colors that some X11 systems don't have */
 	{"LightRed",	 "#FFBBBB"},
@@ -2847,8 +4024,13 @@ gui_mch_get_color(char_u * name)
 
     while (name != NULL)
     {
-	GdkColor	color;
-	int		parsed;
+        GdkColor    color;
+        int         parsed;
+        int         i;
+
+        parsed = gdk_color_parse((const char *)name, &color);
+
+#ifndef HAVE_GTK2 /* ohh, lovely GTK+ 2, eases our pain :) */
 
 	/* Since we have already called gtk_set_locale here the bugger
 	 * XParseColor will accept only explicit color names in the language
@@ -2859,9 +4041,6 @@ gui_mch_get_color(char_u * name)
 	 * Therefore we first try to parse the color in the current locale and
 	 * if it fails, we fall back to the portable "C" one.
 	 */
-
-	parsed = gdk_color_parse((const gchar *)name, &color);
-
 	if (!parsed)
 	{
 	    char *current;
@@ -2871,14 +4050,18 @@ gui_mch_get_color(char_u * name)
 	    {
 		char *saved;
 
-		saved = strdup(current);
+		saved = g_strdup(current);
 		setlocale(LC_ALL, "C");
+
 		parsed = gdk_color_parse((const gchar *)name, &color);
+
 		setlocale(LC_ALL, saved);
 		gtk_set_locale();
-		free(saved);
+
+		g_free(saved);
 	    }
 	}
+#endif /* !HAVE_GTK2 */
 
 	if (parsed)
 	{
@@ -2925,9 +4108,190 @@ gui_mch_set_bg_color(guicolor_T color)
     gui.bgcolor->pixel = (Pixel) color;
 }
 
+#ifdef HAVE_GTK2
+    static void
+draw_glyph_string(int row, int col, int num_cells, int flags,
+                  PangoFont *font, PangoGlyphString *glyphs)
+{
+    if (!(flags & DRAW_TRANSP))
+    {
+        gdk_gc_set_foreground(gui.text_gc, gui.bgcolor);
+
+        gdk_draw_rectangle(gui.drawarea->window,
+                           gui.text_gc,
+                           TRUE,
+                           FILL_X(col),
+                           FILL_Y(row),
+                           num_cells * gui.char_width,
+                           gui.char_height);
+    }
+
+    gdk_gc_set_foreground(gui.text_gc, gui.fgcolor);
+
+    gdk_draw_glyphs(gui.drawarea->window,
+                    gui.text_gc,
+                    font,
+                    TEXT_X(col),
+                    TEXT_Y(row),
+                    glyphs);
+
+    /* redraw the contents with an offset of 1 to emulate bold */
+    if ((flags & DRAW_BOLD) && !gui.font_can_bold)
+        gdk_draw_glyphs(gui.drawarea->window,
+                        gui.text_gc,
+                        font,
+                        TEXT_X(col) + 1,
+                        TEXT_Y(row),
+                        glyphs);
+
+}
+#endif /* HAVE_GTK2 */
+
     void
 gui_mch_draw_string(int row, int col, char_u *s, int len, int flags)
 {
+#ifdef HAVE_GTK2
+    char_u              *conv_buf = NULL;
+    PangoAttrList       *attr_list;
+    GList               *item_list;
+    PangoGlyphString    *glyphs;
+    int                 item_offset = 0; /* column offset in cells */
+    int                 i;
+
+    if (gui.text_context == NULL || gui.drawarea->window == NULL)
+        return;
+
+    if (!enc_utf8 && output_conv.vc_type != CONV_NONE)
+    {
+        /* Convert characters from 'encoding' to 'termencoding', which is set
+         * to UTF-8 by gui_mch_init().  did_set_string_option() in option.c
+         * prohibits changing this to something else than UTF-8 if the GUI is
+         * in use.
+         */
+        conv_buf = string_convert(&output_conv, s, &len);
+        s = conv_buf;
+    }
+
+    gdk_gc_set_exposures(gui.text_gc, gui.visibility != GDK_VISIBILITY_UNOBSCURED);
+
+    glyphs = pango_glyph_string_new();
+
+    /* Optimization hack:  If possible, skip the itemize and shaping process
+     * for pure ASCII strings.  This optimization is particularly useful
+     * because Vim draws space characters to clear parts of the screen.
+     */
+    if (!(flags & DRAW_ITALIC) && !((flags & DRAW_BOLD) && gui.font_can_bold)
+        && gui.ascii_glyphs != NULL)
+    {
+        for (i = 0; i < len; ++i)
+            if (s[i] & 0x80) goto not_ascii;
+
+        pango_glyph_string_set_size(glyphs, len);
+
+        for (i = 0; i < len; ++i)
+        {
+            glyphs->glyphs[i] = gui.ascii_glyphs->glyphs[s[i]];
+            glyphs->log_clusters[i] = i;
+        }
+
+        draw_glyph_string(row, col, len, flags, gui.ascii_font, glyphs);
+
+        item_offset = len;
+    }
+    else
+    {
+not_ascii:
+        attr_list = pango_attr_list_new();
+
+        if ((flags & DRAW_BOLD) && gui.font_can_bold)
+        {
+            PangoAttribute *attribute;
+
+            attribute = pango_attr_weight_new(PANGO_WEIGHT_BOLD);
+            attribute->start_index = 0;
+            attribute->end_index = len;
+
+            pango_attr_list_insert(attr_list, attribute);
+        }
+
+        if (flags & DRAW_ITALIC)
+        {
+            PangoAttribute *attribute;
+
+            attribute = pango_attr_style_new(PANGO_STYLE_ITALIC);
+            attribute->start_index = 0;
+            attribute->end_index = len;
+
+            pango_attr_list_insert(attr_list, attribute);
+        }
+
+        /* Break the text into segments with consistent directional level
+         * and shaping engine.  Pure Latin text needs only a single segment,
+         * so there's no need to worry about the loop's efficiency.  Better
+         * try to optimize elsewhere, e.g. reducing exposes and stuff :)
+         */
+        item_list = pango_itemize(gui.text_context, (const char *)s, 0, len, attr_list, NULL);
+
+        while (item_list != NULL)
+        {
+            PangoItem   *item;
+            int         item_length = 0; /* item length in cells */
+
+            item = (PangoItem *)item_list->data;
+            item_list = g_list_delete_link(item_list, item_list);
+
+            /* Increment the bidirectional embedding level by 1 if it is not even.
+             * An odd number means the output will be RTL, but we don't want that
+             * since Vim handles right-to-left text on its own.  It would probably
+             * be sufficient to just set level = 0, but you can never know :)
+             *
+             * Unfortunately we can't take advantage of Pango's ability to render
+             * both LTR and RTL at the same time.  In order to support that, Vim's
+             * main screen engine would have to make use of Pango functionality.
+             */
+            item->analysis.level = (item->analysis.level + 1) & (~1U);
+
+            pango_shape((const char *)s + item->offset, item->length, &item->analysis, glyphs);
+
+            /* Fixed-width hack: iterate over the array and assign a fixed
+             * width to each glyph, thus overriding the choice made by the
+             * shaping engine.  We use utf_char2cells() to determine the
+             * number of cells needed.
+             */
+            for (i = 0; i < glyphs->num_glyphs; ++i)
+            {
+                int cells;  /* cells occupied by glyph */
+
+                cells = utf_char2cells(utf_ptr2char(s + item->offset + glyphs->log_clusters[i]));
+                glyphs->glyphs[i].geometry.width = cells * gui.char_width * PANGO_SCALE;
+
+                item_length += cells;
+            }
+
+            draw_glyph_string(row, col + item_offset, item_length,
+                              flags, item->analysis.font, glyphs);
+
+            pango_item_free(item);
+
+            item_offset += item_length;
+        }
+
+        pango_attr_list_unref(attr_list);
+    }
+
+    if (flags & DRAW_UNDERL)
+	gdk_draw_line(gui.drawarea->window,
+		      gui.text_gc,
+                      FILL_X(col),
+                      FILL_Y(row + 1) - 1,
+                      FILL_X(col + item_offset) - 1,
+                      FILL_Y(row + 1) - 1);
+
+    pango_glyph_string_free(glyphs);
+    vim_free(conv_buf);
+
+#else /* !HAVE_GTK2 -- don't look at this too closely.  It hurts. */
+
     static XChar2b	*buf = NULL;
     static int		buflen = 0;
     int			is_wide;
@@ -2935,9 +4299,9 @@ gui_mch_draw_string(int row, int col, ch
     int			textlen;
     XFontStruct		*xfont;
     char_u		*p;
-#ifdef FEAT_MBYTE
+# ifdef FEAT_MBYTE
     unsigned		c;
-#endif
+# endif
     int			width;
 
     if (gui.current_font == NULL || gui.drawarea->window == NULL)
@@ -2947,17 +4311,19 @@ gui_mch_draw_string(int row, int col, ch
 				 gui.visibility != GDK_VISIBILITY_UNOBSCURED);
 
     /*
-     * Yeah yeah apparently the font support in GTK+ only cares for either:
+     * Yeah yeah apparently the font support in GTK+ 1.2 only cares for either:
      * asians or 8-bit fonts. It is broken there, but no wonder the whole font
      * stuff is broken in X11 in first place. And the internationalization API
      * isn't something you would really like to use.
      */
+    
     xfont = (XFontStruct *)((GdkFontPrivate*)gui.current_font)->xfont;
     is_wide = ((xfont->min_byte1 != 0 || xfont->max_byte1 != 0)
-#ifdef FEAT_XFONTSET
+# ifdef FEAT_XFONTSET
 	    && gui.fontset == NOFONTSET
-#endif
+# endif
 	    );
+
     if (is_wide)
     {
 	/* Convert a byte sequence to 16 bit characters for the Gdk functions.
@@ -2975,7 +4341,7 @@ gui_mch_draw_string(int row, int col, ch
 	width = 0;
 	while (p < s + len)
 	{
-#ifdef FEAT_MBYTE
+# ifdef FEAT_MBYTE
 	    if (enc_utf8)
 	    {
 		c = utf_ptr2char(p);
@@ -2987,7 +4353,7 @@ gui_mch_draw_string(int row, int col, ch
 		width += utf_char2cells(c);
 	    }
 	    else
-#endif
+# endif
 	    {
 		buf[textlen].byte1 = '\0';	/* high eight bits */
 		buf[textlen].byte2 = *p;	/* low eight bits */
@@ -3003,7 +4369,7 @@ gui_mch_draw_string(int row, int col, ch
     {
 	text = (XChar2b *)s;
 	textlen = len;
-#ifdef FEAT_MBYTE
+# ifdef FEAT_MBYTE
 	if (has_mbyte)
 	{
 	    width = 0;
@@ -3011,7 +4377,7 @@ gui_mch_draw_string(int row, int col, ch
 		width += (*mb_ptr2cells)(p);
 	}
 	else
-#endif
+# endif
 	    width = len;
     }
 
@@ -3045,6 +4411,7 @@ gui_mch_draw_string(int row, int col, ch
 		      gui.text_gc, FILL_X(col),
 	FILL_Y(row + 1) - 1, FILL_X(col + width) - 1, FILL_Y(row + 1) - 1);
     }
+#endif /* !HAVE_GTK2 */
 }
 
 /*
@@ -3069,21 +4436,28 @@ gui_mch_haskey(char_u * name)
     int
 gui_get_x11_windis(Window * win, Display ** dis)
 {
-    *dis = GDK_DISPLAY();
-    if (gui.mainwin != NULL && gui.mainwin->window)
+    if (gui.mainwin != NULL && gui.mainwin->window != NULL)
     {
-	*win = GDK_WINDOW_XWINDOW(gui.mainwin->window);
-	return OK;
+        *dis = GET_X_DISPLAY();
+        *win = GDK_WINDOW_XWINDOW(gui.mainwin->window);
+        return OK;
     }
+
+    *dis = NULL;
     *win = 0;
     return FAIL;
 }
 #endif
 
     void
-gui_mch_beep()
+gui_mch_beep(void)
 {
-    gdk_beep();
+#ifdef GTK2_MULTIHEAD
+    if (gui.mainwin && GTK_WIDGET_REALIZED(gui.mainwin))
+        gdk_display_beep(gtk_widget_get_display(gui.mainwin));
+    else
+#endif
+        gdk_beep();
 }
 
     void
@@ -3122,8 +4496,9 @@ gui_mch_flash(int msec)
 		       FILL_X((int)Columns) + gui.border_offset,
 		       FILL_Y((int)Rows) + gui.border_offset);
 
-    gdk_flush();
+    XSync(GET_X_DISPLAY(), False);
     ui_delay((long)msec, TRUE);	/* wait so many msec */
+
     gdk_draw_rectangle(gui.drawarea->window, invert_gc,
 		       TRUE,
 		       0, 0,
@@ -3170,11 +4545,15 @@ gui_mch_invert_rectangle(int r, int c, i
  * Iconify the GUI window.
  */
     void
-gui_mch_iconify()
+gui_mch_iconify(void)
 {
+#ifdef HAVE_GTK2
+    gtk_window_iconify(GTK_WINDOW(gui.mainwin));
+#else
     XIconifyWindow(GDK_DISPLAY(),
 		   GDK_WINDOW_XWINDOW(gui.mainwin->window),
 		   DefaultScreen(GDK_DISPLAY()));
+#endif
 }
 
 #if defined(FEAT_EVAL) || defined(PROTO)
@@ -3182,9 +4561,13 @@ gui_mch_iconify()
  * Bring the Vim window to the foreground.
  */
     void
-gui_mch_set_foreground()
+gui_mch_set_foreground(void)
 {
+# ifdef HAVE_GTK2
+    gtk_window_present(GTK_WINDOW(gui.mainwin));
+# else
     gdk_window_raise(gui.mainwin->window);
+# endif
 }
 #endif
 
@@ -3248,7 +4631,7 @@ gui_mch_draw_part_cursor(int w, int h, g
  * immediately.
  */
     void
-gui_mch_update()
+gui_mch_update(void)
 {
     while (gtk_events_pending() && !vim_is_input_buf_full())
 	gtk_main_iteration_do(FALSE);
@@ -3378,9 +4761,13 @@ gui_mch_wait_for_chars(long wtime)
 
 /* Flush any output to the screen */
     void
-gui_mch_flush()
+gui_mch_flush(void)
 {
-    gdk_flush();
+    /* Note:  This used to call gdk_flush(), but gdk_flush() calls XSync()
+     * not XFlush().  A full sync with the X server is absolutely unnecessary
+     * overhead.  I'm not even sure the XFlush() is really necessary.
+     */
+    XFlush(GET_X_DISPLAY());
 }
 
 /*
@@ -3427,26 +4814,30 @@ check_copy_area(void)
 {
     XEvent event;
     XGraphicsExposeEvent *gevent;
+    Display* xdisplay;
 
     if (gui.visibility != GDK_VISIBILITY_PARTIAL)
 	return;
 
-    gdk_flush();
+    xdisplay = GET_X_DISPLAY();
+
+    XFlush(xdisplay);
 
     /* Wait to check whether the scroll worked or not. */
     for (;;)
     {
-	if (XCheckTypedEvent(GDK_DISPLAY(), NoExpose, &event))
+	if (XCheckTypedEvent(xdisplay, NoExpose, &event))
 	    return;		/* The scroll worked. */
 
-	if (XCheckTypedEvent(GDK_DISPLAY(), GraphicsExpose, &event))
+	if (XCheckTypedEvent(xdisplay, GraphicsExpose, &event))
 	{
-	    gevent = (XGraphicsExposeEvent *) & event;
+	    gevent = (XGraphicsExposeEvent *) &event;
 	    gui_redraw(gevent->x, gevent->y, gevent->width, gevent->height);
 	    if (gevent->count == 0)
 		return;		/* This was the last expose event */
 	}
-	gdk_flush();
+
+	XSync(xdisplay, False);
     }
 }
 
@@ -3514,8 +4905,7 @@ gui_mch_insert_lines(int row, int num_li
  * X Selection stuff, for cutting and pasting text to other windows.
  */
     void
-clip_mch_request_selection(cbd)
-    VimClipboard *cbd;
+clip_mch_request_selection(VimClipboard *cbd)
 {
     /* First try to get the content of our own special clipboard. */
     received_selection = RS_NONE;
@@ -3561,7 +4951,7 @@ clip_mch_request_selection(cbd)
 	int     nbytes = 0;
 	char_u *buffer;
 
-	buffer = (char_u *)XFetchBuffer(gui.dpy, &nbytes, 0);
+	buffer = (char_u *)XFetchBuffer(GET_X_DISPLAY(), &nbytes, 0);
 	if (nbytes > 0)
 	{
 	    /* Got something */
@@ -3578,8 +4968,7 @@ clip_mch_request_selection(cbd)
  */
 /*ARGSUSED*/
     void
-clip_mch_lose_selection(cbd)
-    VimClipboard *cbd;
+clip_mch_lose_selection(VimClipboard *cbd)
 {
     /* WEIRD: when using NULL to actually disown the selection, we lose the
      * selection the first time we own it. */
@@ -3593,8 +4982,7 @@ clip_mch_lose_selection(cbd)
  * Own the selection and return OK if it worked.
  */
     int
-clip_mch_own_selection(cbd)
-    VimClipboard *cbd;
+clip_mch_own_selection(VimClipboard *cbd)
 {
     int r;
 
@@ -3612,8 +5000,7 @@ clip_mch_own_selection(cbd)
  */
 /*ARGSUSED*/
     void
-clip_mch_set_selection(cbd)
-    VimClipboard* cbd;
+clip_mch_set_selection(VimClipboard *cbd)
 {
 }
 
@@ -3671,7 +5058,7 @@ gui_mch_menu_hidden(vimmenu_T *menu, int
  * This is called after setting all the menus to grey/hidden or not.
  */
     void
-gui_mch_draw_menubar()
+gui_mch_draw_menubar(void)
 {
     /* just make sure that the visual changes get effect immediately */
     gui_mch_update();
@@ -3684,12 +5071,14 @@ gui_mch_draw_menubar()
     void
 gui_mch_enable_scrollbar(scrollbar_T *sb, int flag)
 {
-    if (sb->id == 0)
+    if (sb->id == NULL)
 	return;
+
     if (flag)
 	gtk_widget_show(sb->id);
     else
 	gtk_widget_hide(sb->id);
+
     update_window_manager_hints();
 }
 
@@ -3700,20 +5089,31 @@ gui_mch_enable_scrollbar(scrollbar_T *sb
     long_u
 gui_mch_get_rgb(guicolor_T pixel)
 {
-    GdkVisual		*visual;
-    GdkColormap		*cmap;
-    GdkColorContext	*cc;
-    GdkColor		c;
+    GdkColormap     *cmap;
+    GdkColor         color = { 0, };
 
-    visual = gtk_widget_get_visual(gui.mainwin);
     cmap = gtk_widget_get_colormap(gui.mainwin);
-    cc = gdk_color_context_new(visual, cmap);
 
-    c.pixel = pixel;
-    gdk_color_context_query_color(cc, &c);
+#ifdef HAVE_GTK2
+    gdk_colormap_query_color(cmap, pixel, &color);
+#else
+    {
+        GdkVisual       *visual;
+        GdkColorContext *cc;
+
+        visual = gtk_widget_get_visual(gui.mainwin);
+        cc = gdk_color_context_new(visual, cmap);
 
-    return ((c.red & 0xff00) << 8) + (c.green & 0xff00)
-						    + ((unsigned)c.blue >> 8);
+        color.pixel = pixel;
+        gdk_color_context_query_color(cc, &color);
+
+        gdk_color_context_free(cc);
+    }
+#endif
+
+    return ((color.red   & 0xff00) << 8) |
+            (color.green & 0xff00)       |
+           ((color.blue  & 0xff00) >> 8);
 }
 
 /*
@@ -3744,10 +5144,11 @@ gui_mch_get_mouse_y(void)
 gui_mch_setmouse(int x, int y)
 {
     /* Sorry for the Xlib call, but we can't avoid it, since there is no
-     * internal GDK mechanism present to accomplish this.
+     * internal GDK mechanism present to accomplish this.  (and for good
+     * reason...)
      */
-    XWarpPointer(GDK_DISPLAY(), (Window) 0,
-		  GDK_WINDOW_XWINDOW(gui.drawarea->window), 0, 0, 0, 0, x, y);
+    XWarpPointer(GET_X_DISPLAY(), (Window) 0,
+                 GDK_WINDOW_XWINDOW(gui.drawarea->window), 0, 0, 0, 0, x, y);
 }
 
 #ifdef FEAT_MOUSESHAPE
@@ -3785,7 +5186,7 @@ gui_mch_mousehide(int hide)
 
 /* Table for shape IDs.  Keep in sync with the mshape_names[] table in
  * misc2.c! */
-static int mshape_ids[] =
+static const int mshape_ids[] =
 {
     GDK_LEFT_PTR,		/* arrow */
     0,				/* blank */
@@ -3807,8 +5208,7 @@ static int mshape_ids[] =
 };
 
     void
-mch_set_mouse_shape(shape)
-    int	shape;
+mch_set_mouse_shape(int shape)
 {
     int		   id;
     GdkCursor	   *c;
@@ -3823,7 +5223,11 @@ mch_set_mouse_shape(shape)
 	if (shape >= MSHAPE_NUMBERED)
 	{
 	    id = shape - MSHAPE_NUMBERED;
+# ifdef HAVE_GTK2
+	    if (id >= GDK_LAST_CURSOR)
+# else
 	    if (id >= GDK_NUM_GLYPHS)
+# endif
 		id = GDK_LEFT_PTR;
 	    else
 		id &= ~1;	/* they are always even (why?) */
@@ -3838,4 +5242,5 @@ mch_set_mouse_shape(shape)
     if (shape != MSHAPE_HIDE)
 	last_shape = shape;
 }
-#endif
+#endif /* FEAT_MOUSESHAPE */
+
Index: src/mbyte.c
===================================================================
RCS file: /cvsroot/vim/vim/src/mbyte.c,v
retrieving revision 1.47
diff -u -3 -p -r1.47 mbyte.c
--- src/mbyte.c	29 Oct 2002 05:15:53 -0000	1.47
+++ src/mbyte.c	6 Feb 2003 17:52:33 -0000
@@ -65,6 +65,8 @@
  *     'encoding'.  If this is not sufficient, system-specific conversion
  *     might be required.
  * (3) For the GUI the correct font must be selected, no conversion done.
+ *     (No longer true for the GTK2 port -- 'termencoding' is used and must
+ *     always be set to UTF-8.  gui_mch_init_check() does this automatically.)
  *     Otherwise, conversion is to be done when 'encoding' differs from
  *     'termencoding'.
  * (4) The encoding of the file is specified with 'fileencoding'.  Conversion
@@ -588,7 +590,7 @@ codepage_invalid:
     /* GNU gettext 0.10.37 supports this feature: set the codeset used for
      * translated messages independently from the current locale. */
     (void)bind_textdomain_codeset(VIMPACKAGE,
-					  enc_utf8 ? "utf-8" : (char *)p_enc);
+					  enc_utf8 ? "UTF-8" : (char *)p_enc);
 #endif
 
 #ifdef FEAT_AUTOCMD
@@ -2723,6 +2725,172 @@ iconv_end()
 
 #if defined(FEAT_XIM) || defined(PROTO)
 
+#ifdef HAVE_GTK2
+
+static int ic_preediting = FALSE;
+static int ic_pos = 0;
+
+    void
+im_set_active(active)
+    int		active;
+{
+    if (xic)
+    {
+	if (active)
+	    gtk_im_context_set_client_window(xic, gui.mainwin->window);
+	else
+	    gtk_im_context_set_client_window(xic, NULL);
+	ic_preediting = active;
+    }
+}
+
+    void
+xim_set_focus(focus)
+    int		focus;
+{
+    if (xic)
+    {
+	if (focus)
+	    gtk_im_context_focus_in(xic);
+	else
+	    gtk_im_context_focus_out(xic);
+    }
+}
+
+    void
+im_set_position(row, col)
+    int		row;
+    int		col;
+{
+    /*
+    gtk_im_context_set_cursor_location (GtkIMContext   *context,
+					GdkRectangle   *area);
+    */
+}
+
+    void
+xim_set_preedit()
+{
+}
+
+    void
+xim_set_status_area()
+{
+}
+
+    static void
+xim_done()
+{
+    gui_update_cursor(TRUE, FALSE);
+    if (showmode() > 0)
+    {
+	setcursor();
+	out_flush();
+    }
+}
+
+    static void
+xim_back_delete(int n)
+{
+    char_u str[3];
+
+    str[0] = CSI;
+    str[1] = 'k';
+    str[2] = 'b';
+    for (; n > 0; n -= 2);
+	add_to_input_buf(str, 3);
+}
+
+
+    static void
+im_commit_cb(GtkIMContext *context, const gchar *str)
+{
+    char *p = NULL;
+
+    if (g_utf8_validate(str, -1, NULL) == TRUE)
+	p = g_locale_from_utf8(str, -1, NULL, NULL, NULL);
+    if (p == NULL)
+	p = (char *) str;
+
+    if (ic_pos > 0)
+    {
+	xim_back_delete(ic_pos);
+	ic_pos = 0;
+    }
+
+    add_to_input_buf((char_u *)p, strlen(p));
+
+    if (p != str)
+	g_free(p);
+
+    xim_done();
+
+    if (gtk_main_level() > 0)
+	gtk_main_quit();
+}
+
+    static void
+im_preedit_changed_cb(GtkIMContext *context)
+{
+    gchar *preedit_string, *p;
+    gint cursor_pos;
+
+    gtk_im_context_get_preedit_string(context, &preedit_string, NULL,
+				      &cursor_pos);
+
+    im_commit_cb(context, preedit_string);
+    ic_pos = cursor_pos;
+}
+
+    void
+xim_init()
+{
+    xic = gtk_im_multicontext_new();
+    if (xic != NULL)
+    {
+	g_signal_connect(G_OBJECT(xic), "commit",
+			 G_CALLBACK(im_commit_cb), NULL);
+	g_signal_connect(G_OBJECT(xic), "preedit_changed",
+			 G_CALLBACK(im_preedit_changed_cb), NULL);
+    }
+}
+
+void
+xim_decide_input_style()
+{
+}
+
+    void
+xim_reset(void)
+{
+    gtk_im_context_reset(xic);
+}
+
+    int
+xim_queue_key_press_event(GdkEvent *ev)
+{
+    return gtk_im_context_filter_keypress(xic, (GdkEventKey *) ev);
+}
+
+    int
+xim_get_status_area_height()
+{
+    return 0;
+}
+
+    int
+im_get_status()
+{
+    return ic_preediting;
+}
+
+    int
+im_xim_isvalid_imactivate()
+{
+    return TRUE;
+}
+
+#else
 static int	xim_is_active = FALSE;  /* XIM should be active in the current
 					   mode */
 static int	xim_has_focus = FALSE;	/* XIM is really being used for Vim */
@@ -4051,6 +4219,7 @@ im_get_status()
     return xim_has_focus;
 }
 
+#endif
 #endif /* FEAT_XIM */
 
 #if defined(FEAT_MBYTE) || defined(PROTO)
Index: src/menu.c
===================================================================
RCS file: /cvsroot/vim/vim/src/menu.c,v
retrieving revision 1.42
diff -u -3 -p -r1.42 menu.c
--- src/menu.c	14 Oct 2002 23:24:25 -0000	1.42
+++ src/menu.c	6 Feb 2003 17:52:34 -0000
@@ -764,7 +764,7 @@ add_menu_path(menu_path, menuarg, pri_ta
 		menu->silent[i] = menuarg->silent[0];
 	    }
 	}
-#if defined(FEAT_TOOLBAR) && defined(FEAT_BEVAL)
+#if defined(FEAT_TOOLBAR) && (defined(FEAT_BEVAL) || defined(HAVE_GTK2))
 	/* Need to update the menu tip. */
 	if (modes & MENU_TIP_MODE)
 	    gui_mch_menu_set_tip(menu);
@@ -942,7 +942,7 @@ remove_menu(menup, name, modes, silent)
 	if (modes & MENU_TIP_MODE)
 	{
 	    free_menu_string(menu, MENU_INDEX_TIP);
-#if defined(FEAT_TOOLBAR) && defined(FEAT_BEVAL)
+#if defined(FEAT_TOOLBAR) && (defined(FEAT_BEVAL) || defined(HAVE_GTK2))
 	    /* Need to update the menu tip. */
 	    if (gui.in_use)
 		gui_mch_menu_set_tip(menu);
Index: src/option.c
===================================================================
RCS file: /cvsroot/vim/vim/src/option.c,v
retrieving revision 1.93
diff -u -3 -p -r1.93 option.c
--- src/option.c	21 Jan 2003 00:00:55 -0000	1.93
+++ src/option.c	6 Feb 2003 17:52:37 -0000
@@ -950,7 +950,7 @@ static struct vimoption
 #endif
 				    },
     {"guifontwide", "gfw",  P_STRING|P_VI_DEF|P_RCLR|P_COMMA|P_NODUP,
-#if defined(FEAT_GUI) && defined(FEAT_MBYTE)
+#if defined(FEAT_GUI) && defined(FEAT_MBYTE) && !defined(HAVE_GTK2)
 			    (char_u *)&p_guifontwide, PV_NONE,
 			    {(char_u *)"", (char_u *)0L}
 #else
@@ -4538,6 +4538,15 @@ did_set_string_option(opt_idx, varp, new
 	    }
 	}
 
+# if defined(FEAT_GUI_GTK) && defined(HAVE_GTK2)
+        if (errmsg == NULL && varp == &p_tenc && gui.in_use)
+        {
+            /* GTK+ 2 uses only a single encoding, and that is UTF-8. */
+            if (STRCMP(p_tenc, "utf-8") != 0)
+	        errmsg = (char_u *)N_("Cannot change 'termencoding' in GTK+ 2 GUI");
+        }
+# endif
+
 	if (errmsg == NULL)
 	{
 # ifdef FEAT_KEYMAP
@@ -4815,25 +4824,25 @@ did_set_string_option(opt_idx, varp, new
     {
 	if (gui.in_use)
 	{
+            p = p_guifont;
 # ifdef FEAT_GUI_GTK
-	    if (STRCMP(p_guifont, "*") == 0)
-	    {
-		/*
-		 * Put up a font dialog and let the user select a new value.
-		 * If this is cancelled go back to the old value but don't
-		 * give an error message.
-		 */
-		p = gui_mch_font_dialog(oldval);
-		if (p != NULL)
-		{
-		    free_string_option(p_guifont);
-		    p_guifont = p;
-		}
-		else
-		    errmsg = (char_u *)"";
-	    }
+            /*
+             * Put up a font dialog and let the user select a new value.
+             * If this is cancelled go back to the old value but don't
+             * give an error message.
+             */
+            if (STRCMP(p, "*") == 0)
+	    {
+                p = gui_mch_font_dialog(oldval);
+
+                if (new_value_alloced)
+                    free_string_option(p_guifont);
+
+                p_guifont = (p != NULL) ? p : vim_strsave(oldval);
+                new_value_alloced = TRUE;
+            }
 # endif
-	    if (errmsg == NULL && gui_init_font(p_guifont, FALSE) != OK)
+	    if (p != NULL && gui_init_font(p_guifont, FALSE) != OK)
 	    {
 # if defined(FEAT_GUI_MSWIN) || defined(FEAT_GUI_PHOTON)
 		if (STRCMP(p_guifont, "*") == 0)
@@ -4860,7 +4869,7 @@ did_set_string_option(opt_idx, varp, new
 	    errmsg = (char_u *)N_("Invalid fontset");
     }
 # endif
-# ifdef FEAT_MBYTE
+# if defined(FEAT_MBYTE) && !defined(HAVE_GTK2)
     else if (varp == &p_guifontwide)
     {
 	if (STRCMP(p_guifontwide, "*") == 0)
Index: src/option.h
===================================================================
RCS file: /cvsroot/vim/vim/src/option.h,v
retrieving revision 1.43
diff -u -3 -p -r1.43 option.h
--- src/option.h	14 Oct 2002 17:31:34 -0000	1.43
+++ src/option.h	6 Feb 2003 17:52:37 -0000
@@ -432,7 +432,7 @@ EXTERN char_u	*p_guifont;	/* 'guifont' *
 # ifdef FEAT_XFONTSET
 EXTERN char_u	*p_guifontset;	/* 'guifontset' */
 # endif
-# ifdef FEAT_MBYTE
+# if defined(FEAT_MBYTE) && !defined(HAVE_GTK2)
 EXTERN char_u	*p_guifontwide;	/* 'guifontwide' */
 # endif
 EXTERN int	p_guipty;	/* 'guipty' */
Index: src/os_unix.c
===================================================================
RCS file: /cvsroot/vim/vim/src/os_unix.c,v
retrieving revision 1.72
diff -u -3 -p -r1.72 os_unix.c
--- src/os_unix.c	3 Feb 2003 18:25:42 -0000	1.72
+++ src/os_unix.c	6 Feb 2003 17:52:39 -0000
@@ -105,7 +105,9 @@ Display	    *x11_display = NULL;
 
 # ifdef FEAT_TITLE
 static int  get_x11_windis __ARGS((void));
+#  ifndef HAVE_GTK2
 static void set_x11_title __ARGS((char_u *));
+#  endif
 static void set_x11_icon __ARGS((char_u *));
 # endif
 #endif
@@ -1245,11 +1247,6 @@ static int get_x11_thing __ARGS((int get
  * try to get x11 window and display
  *
  * return FAIL for failure, OK otherwise
- *
- * FIXME:
- * This code is responsible for setting the window manager name of the
- * editor's window. We should provide a special version of this for usage with
- * the GTK+ widget set, which wouldn't use any direct x11 calls. (--mdcki)
  */
     static int
 get_x11_windis()
@@ -1532,6 +1529,7 @@ get_x11_thing(get_title, test_only)
     return retval;
 }
 
+#ifndef HAVE_GTK2
 /*
  * Set x11 Window Title
  *
@@ -1541,7 +1539,7 @@ get_x11_thing(get_title, test_only)
 set_x11_title(title)
     char_u	*title;
 {
-#if XtSpecificationRelease >= 4
+# if XtSpecificationRelease >= 4
     XTextProperty text_prop;
 
     text_prop.value = title;
@@ -1549,11 +1547,12 @@ set_x11_title(title)
     text_prop.encoding = XA_STRING;
     text_prop.format = 8;
     XSetWMName(x11_display, x11_window, &text_prop);
-#else
+# else
     XStoreName(x11_display, x11_window, (char *)title);
-#endif
+# endif
     XFlush(x11_display);
 }
+#endif
 
 /*
  * Set x11 Window icon
@@ -1672,14 +1671,12 @@ mch_settitle(title, icon)
 
 	if (*T_TS != NUL)		/* it's OK if t_fs is empty */
 	    term_settitle(title);
-#ifdef FEAT_X11
+#if defined(FEAT_X11) && !defined(FEAT_GUI_GTK)
 	else
 	    set_x11_title(title);		/* x11 */
-#else
-# if defined(FEAT_GUI_BEOS) || defined(FEAT_GUI_PHOTON) || defined(FEAT_GUI_MAC)
+#elif defined(FEAT_GUI_BEOS) || defined(FEAT_GUI_PHOTON) || defined(FEAT_GUI_MAC) || defined(FEAT_GUI_GTK)
 	else
 	    gui_mch_settitle(title, icon);
-# endif
 #endif
 	did_set_title = TRUE;
     }
Index: src/screen.c
===================================================================
RCS file: /cvsroot/vim/vim/src/screen.c,v
retrieving revision 1.94
diff -u -3 -p -r1.94 screen.c
--- src/screen.c	29 Jan 2003 16:51:51 -0000	1.94
+++ src/screen.c	6 Feb 2003 17:52:41 -0000
@@ -3545,7 +3545,7 @@ win_line(wp, lnum, startrow, endrow)
 		&& (search_attr == 0 || char_attr != search_attr))
 	    char_attr = extra_attr;
 
-#if defined(FEAT_XIM) && defined(FEAT_GUI_GTK)
+#if defined(FEAT_XIM) && defined(FEAT_GUI_GTK) && !defined(HAVE_GTK2)
 	if (xic != NULL
 		&& lnum == curwin->w_cursor.lnum
 		&& State == INSERT
Index: src/syntax.c
===================================================================
RCS file: /cvsroot/vim/vim/src/syntax.c,v
retrieving revision 1.68
diff -u -3 -p -r1.68 syntax.c
--- src/syntax.c	14 Oct 2002 17:31:35 -0000	1.68
+++ src/syntax.c	6 Feb 2003 17:52:44 -0000
@@ -8371,9 +8371,11 @@ free_highlight_fonts()
 # ifdef FEAT_XFONTSET
     gui_mch_free_fontset(gui.fontset);
 # endif
+# ifndef HAVE_GTK2
     gui_mch_free_font(gui.bold_font);
     gui_mch_free_font(gui.ital_font);
     gui_mch_free_font(gui.boldital_font);
+# endif
 }
 #endif
 
Index: src/auto/configure
===================================================================
RCS file: /cvsroot/vim/vim/src/auto/configure,v
retrieving revision 1.56
diff -u -3 -p -r1.56 configure
--- src/auto/configure	6 Jan 2003 21:11:43 -0000	1.56
+++ src/auto/configure	6 Feb 2003 17:52:46 -0000
@@ -60,6 +60,8 @@ ac_help="$ac_help
 ac_help="$ac_help
   --enable-gnome-check    If GTK GUI, check for GNOME [default=no]"
 ac_help="$ac_help
+  --enable-gtk2-check     If GTK GUI, check for GTK2 (experimental) [default=no]"
+ac_help="$ac_help
   --enable-motif-check    If auto-select GUI, check for Motif [default=yes]"
 ac_help="$ac_help
   --enable-athena-check   If auto-select GUI, check for Athena [default=yes]"
@@ -485,7 +487,7 @@ if test "$silent" = yes; then
 else
   exec 6>&1
 fi
-exec 5>auto/config.log
+exec 5>./config.log
 
 echo "\
 This file contains any messages produced by compilers while
@@ -602,7 +604,7 @@ cat >> confdefs.h <<\EOF
 EOF
 
 echo $ac_n "checking whether ${MAKE-make} sets \${MAKE}""... $ac_c" 1>&6
-echo "configure:604: checking whether ${MAKE-make} sets \${MAKE}" >&5
+echo "configure:608: checking whether ${MAKE-make} sets \${MAKE}" >&5
 set dummy ${MAKE-make}; ac_make=`echo "$2" | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_prog_make_${ac_make}_set'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -632,7 +634,7 @@ fi
 # Extract the first word of "gcc", so it can be a program name with args.
 set dummy gcc; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:634: checking for $ac_word" >&5
+echo "configure:638: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_CC'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -662,7 +664,7 @@ if test -z "$CC"; then
   # Extract the first word of "cc", so it can be a program name with args.
 set dummy cc; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:664: checking for $ac_word" >&5
+echo "configure:668: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_CC'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -713,7 +715,7 @@ fi
       # Extract the first word of "cl", so it can be a program name with args.
 set dummy cl; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:715: checking for $ac_word" >&5
+echo "configure:719: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_CC'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -745,7 +747,7 @@ fi
 fi
 
 echo $ac_n "checking whether the C compiler ($CC $CFLAGS $LDFLAGS) works""... $ac_c" 1>&6
-echo "configure:747: checking whether the C compiler ($CC $CFLAGS $LDFLAGS) works" >&5
+echo "configure:751: checking whether the C compiler ($CC $CFLAGS $LDFLAGS) works" >&5
 
 ac_ext=c
 # CFLAGS is not in ac_cpp because -g, -O, etc. are not valid cpp options.
@@ -756,12 +758,12 @@ cross_compiling=$ac_cv_prog_cc_cross
 
 cat > conftest.$ac_ext << EOF
 
-#line 758 "configure"
+#line 762 "configure"
 #include "confdefs.h"
 
 main(){return(0);}
 EOF
-if { (eval echo configure:763: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:767: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   ac_cv_prog_cc_works=yes
   # If we can't run a trivial program, we are probably using a cross compiler.
   if (./conftest; exit) 2>/dev/null; then
@@ -787,12 +789,12 @@ if test $ac_cv_prog_cc_works = no; then
   { echo "configure: error: installation or configuration problem: C compiler cannot create executables." 1>&2; exit 1; }
 fi
 echo $ac_n "checking whether the C compiler ($CC $CFLAGS $LDFLAGS) is a cross-compiler""... $ac_c" 1>&6
-echo "configure:789: checking whether the C compiler ($CC $CFLAGS $LDFLAGS) is a cross-compiler" >&5
+echo "configure:793: checking whether the C compiler ($CC $CFLAGS $LDFLAGS) is a cross-compiler" >&5
 echo "$ac_t""$ac_cv_prog_cc_cross" 1>&6
 cross_compiling=$ac_cv_prog_cc_cross
 
 echo $ac_n "checking whether we are using GNU C""... $ac_c" 1>&6
-echo "configure:794: checking whether we are using GNU C" >&5
+echo "configure:798: checking whether we are using GNU C" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_gcc'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -801,7 +803,7 @@ else
   yes;
 #endif
 EOF
-if { ac_try='${CC-cc} -E conftest.c'; { (eval echo configure:803: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; } | egrep yes >/dev/null 2>&1; then
+if { ac_try='${CC-cc} -E conftest.c'; { (eval echo configure:807: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; } | egrep yes >/dev/null 2>&1; then
   ac_cv_prog_gcc=yes
 else
   ac_cv_prog_gcc=no
@@ -820,7 +822,7 @@ ac_test_CFLAGS="${CFLAGS+set}"
 ac_save_CFLAGS="$CFLAGS"
 CFLAGS=
 echo $ac_n "checking whether ${CC-cc} accepts -g""... $ac_c" 1>&6
-echo "configure:822: checking whether ${CC-cc} accepts -g" >&5
+echo "configure:826: checking whether ${CC-cc} accepts -g" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_cc_g'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -851,7 +853,7 @@ else
   fi
 fi
 	echo $ac_n "checking how to run the C preprocessor""... $ac_c" 1>&6
-echo "configure:853: checking how to run the C preprocessor" >&5
+echo "configure:857: checking how to run the C preprocessor" >&5
 # On Suns, sometimes $CPP names a directory.
 if test -n "$CPP" && test -d "$CPP"; then
   CPP=
@@ -866,13 +868,13 @@ else
   # On the NeXT, cc -E runs the code through the compiler's parser,
   # not just through cpp.
   cat > conftest.$ac_ext <<EOF
-#line 868 "configure"
+#line 872 "configure"
 #include "confdefs.h"
 #include <assert.h>
 Syntax Error
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:874: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:878: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   :
@@ -883,13 +885,13 @@ else
   rm -rf conftest*
   CPP="${CC-cc} -E -traditional-cpp"
   cat > conftest.$ac_ext <<EOF
-#line 885 "configure"
+#line 889 "configure"
 #include "confdefs.h"
 #include <assert.h>
 Syntax Error
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:891: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:895: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   :
@@ -900,13 +902,13 @@ else
   rm -rf conftest*
   CPP="${CC-cc} -nologo -E"
   cat > conftest.$ac_ext <<EOF
-#line 902 "configure"
+#line 906 "configure"
 #include "confdefs.h"
 #include <assert.h>
 Syntax Error
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:908: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:912: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   :
@@ -930,7 +932,7 @@ else
 fi
 echo "$ac_t""$CPP" 1>&6
 	echo $ac_n "checking for POSIXized ISC""... $ac_c" 1>&6
-echo "configure:932: checking for POSIXized ISC" >&5
+echo "configure:936: checking for POSIXized ISC" >&5
 if test -d /etc/conf/kconfig.d &&
   grep _POSIX_VERSION /usr/include/sys/unistd.h >/dev/null 2>&1
 then
@@ -954,7 +956,7 @@ do
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:956: checking for $ac_word" >&5
+echo "configure:960: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_AWK'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -986,7 +988,7 @@ done
 # Extract the first word of "strip", so it can be a program name with args.
 set dummy strip; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:988: checking for $ac_word" >&5
+echo "configure:992: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_STRIP'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1015,12 +1017,12 @@ fi
 
 
 echo $ac_n "checking for Cygwin environment""... $ac_c" 1>&6
-echo "configure:1017: checking for Cygwin environment" >&5
+echo "configure:1021: checking for Cygwin environment" >&5
 if eval "test \"`echo '$''{'ac_cv_cygwin'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 1022 "configure"
+#line 1026 "configure"
 #include "confdefs.h"
 
 int main() {
@@ -1031,7 +1033,7 @@ int main() {
 return __CYGWIN__;
 ; return 0; }
 EOF
-if { (eval echo configure:1033: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:1037: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   ac_cv_cygwin=yes
 else
@@ -1048,19 +1050,19 @@ echo "$ac_t""$ac_cv_cygwin" 1>&6
 CYGWIN=
 test "$ac_cv_cygwin" = yes && CYGWIN=yes
 echo $ac_n "checking for mingw32 environment""... $ac_c" 1>&6
-echo "configure:1050: checking for mingw32 environment" >&5
+echo "configure:1054: checking for mingw32 environment" >&5
 if eval "test \"`echo '$''{'ac_cv_mingw32'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 1055 "configure"
+#line 1059 "configure"
 #include "confdefs.h"
 
 int main() {
 return __MINGW32__;
 ; return 0; }
 EOF
-if { (eval echo configure:1062: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:1066: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   ac_cv_mingw32=yes
 else
@@ -1079,7 +1081,7 @@ test "$ac_cv_mingw32" = yes && MINGW32=y
 
 
 echo $ac_n "checking for executable suffix""... $ac_c" 1>&6
-echo "configure:1081: checking for executable suffix" >&5
+echo "configure:1085: checking for executable suffix" >&5
 if eval "test \"`echo '$''{'ac_cv_exeext'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1089,7 +1091,7 @@ else
   rm -f conftest*
   echo 'int main () { return 0; }' > conftest.$ac_ext
   ac_cv_exeext=
-  if { (eval echo configure:1091: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; }; then
+  if { (eval echo configure:1095: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; }; then
     for file in conftest.*; do
       case $file in
       *.c | *.o | *.obj) ;;
@@ -1136,14 +1138,14 @@ test "$GCC" = yes && CPP_MM=M; 
 
 if test -f ./toolcheck; then
   echo "checking for buggy tools" 1>&6
-echo "configure:1133: checking for buggy tools" >&5
+echo "configure:1142: checking for buggy tools" >&5
   sh ./toolcheck 1>&6
 fi
 
 OS_EXTRA_SRC=""; OS_EXTRA_OBJ=""
 
 echo $ac_n "checking for BeOS""... $ac_c" 1>&6
-echo "configure:1140: checking for BeOS" >&5
+echo "configure:1149: checking for BeOS" >&5
 case `uname` in
     BeOS)	OS_EXTRA_SRC=os_beos.c; OS_EXTRA_OBJ=objects/os_beos.o
 		BEOS=yes; echo "$ac_t""yes" 1>&6;;
@@ -1151,7 +1153,7 @@ case `uname` in
 esac
 
 echo $ac_n "checking for QNX""... $ac_c" 1>&6
-echo "configure:1148: checking for QNX" >&5
+echo "configure:1157: checking for QNX" >&5
 case `uname` in
     QNX)	OS_EXTRA_SRC=os_qnx.c; OS_EXTRA_OBJ=objects/os_qnx.o
 		test -z "$with_x" && with_x=no
@@ -1184,7 +1186,7 @@ if test -z "$have_local_include" -a -d /
 fi
 
 echo $ac_n "checking --with-vim-name argument""... $ac_c" 1>&6
-echo "configure:1173: checking --with-vim-name argument" >&5
+echo "configure:1190: checking --with-vim-name argument" >&5
 # Check whether --with-vim-name or --without-vim-name was given.
 if test "${with_vim_name+set}" = set; then
   withval="$with_vim_name"
@@ -1195,7 +1197,7 @@ fi
 
 
 echo $ac_n "checking --with-ex-name argument""... $ac_c" 1>&6
-echo "configure:1184: checking --with-ex-name argument" >&5
+echo "configure:1201: checking --with-ex-name argument" >&5
 # Check whether --with-ex-name or --without-ex-name was given.
 if test "${with_ex_name+set}" = set; then
   withval="$with_ex_name"
@@ -1206,7 +1208,7 @@ fi
 
 
 echo $ac_n "checking --with-view-name argument""... $ac_c" 1>&6
-echo "configure:1195: checking --with-view-name argument" >&5
+echo "configure:1212: checking --with-view-name argument" >&5
 # Check whether --with-view-name or --without-view-name was given.
 if test "${with_view_name+set}" = set; then
   withval="$with_view_name"
@@ -1218,7 +1220,7 @@ fi
 
 
 echo $ac_n "checking --with-global-runtime argument""... $ac_c" 1>&6
-echo "configure:1207: checking --with-global-runtime argument" >&5
+echo "configure:1224: checking --with-global-runtime argument" >&5
 # Check whether --with-global-runtime or --without-global-runtime was given.
 if test "${with_global_runtime+set}" = set; then
   withval="$with_global_runtime"
@@ -1232,7 +1234,7 @@ fi
 
 
 echo $ac_n "checking --with-modified-by argument""... $ac_c" 1>&6
-echo "configure:1221: checking --with-modified-by argument" >&5
+echo "configure:1238: checking --with-modified-by argument" >&5
 # Check whether --with-modified-by or --without-modified-by was given.
 if test "${with_modified_by+set}" = set; then
   withval="$with_modified_by"
@@ -1246,9 +1248,9 @@ fi
 
 
 echo $ac_n "checking if character set is EBCDIC""... $ac_c" 1>&6
-echo "configure:1235: checking if character set is EBCDIC" >&5
+echo "configure:1252: checking if character set is EBCDIC" >&5
 cat > conftest.$ac_ext <<EOF
-#line 1237 "configure"
+#line 1254 "configure"
 #include "confdefs.h"
  
 int main() {
@@ -1261,7 +1263,7 @@ make an error "Character set is not EBCD
 #endif 
 ; return 0; }
 EOF
-if { (eval echo configure:1250: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:1267: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
    # TryCompile action if true
 cf_cv_ebcdic=yes 
@@ -1289,7 +1291,7 @@ esac
 
 if test "$cf_cv_ebcdic" = "yes"; then
 echo $ac_n "checking for OS/390 Unix""... $ac_c" 1>&6
-echo "configure:1278: checking for OS/390 Unix" >&5
+echo "configure:1295: checking for OS/390 Unix" >&5
 case `uname` in
     OS/390)	OS390Unix="yes";
 										if test "$CC" = "cc"; then
@@ -1326,7 +1328,7 @@ fi
 
 
 echo $ac_n "checking --with-features argument""... $ac_c" 1>&6
-echo "configure:1315: checking --with-features argument" >&5
+echo "configure:1332: checking --with-features argument" >&5
 # Check whether --with-features or --without-features was given.
 if test "${with_features+set}" = set; then
   withval="$with_features"
@@ -1369,7 +1371,7 @@ esac
 
 
 echo $ac_n "checking --with-compiledby argument""... $ac_c" 1>&6
-echo "configure:1358: checking --with-compiledby argument" >&5
+echo "configure:1375: checking --with-compiledby argument" >&5
 # Check whether --with-compiledby or --without-compiledby was given.
 if test "${with_compiledby+set}" = set; then
   withval="$with_compiledby"
@@ -1381,7 +1383,7 @@ fi
 
 
 echo $ac_n "checking --enable-perlinterp argument""... $ac_c" 1>&6
-echo "configure:1370: checking --enable-perlinterp argument" >&5
+echo "configure:1387: checking --enable-perlinterp argument" >&5
 # Check whether --enable-perlinterp or --disable-perlinterp was given.
 if test "${enable_perlinterp+set}" = set; then
   enableval="$enable_perlinterp"
@@ -1396,7 +1398,7 @@ if test "$enable_perlinterp" = "yes"; th
   # Extract the first word of "perl", so it can be a program name with args.
 set dummy perl; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:1385: checking for $ac_word" >&5
+echo "configure:1402: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_vi_cv_path_perl'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1430,7 +1432,7 @@ fi
 
   if test "X$vi_cv_path_perl" != "X"; then
     echo $ac_n "checking Perl version""... $ac_c" 1>&6
-echo "configure:1419: checking Perl version" >&5
+echo "configure:1436: checking Perl version" >&5
     if $vi_cv_path_perl -e 'require 5.003_01' >/dev/null 2>/dev/null; then
       echo "$ac_t""OK" 1>&6
       eval `$vi_cv_path_perl -V:shrpenv`
@@ -1472,7 +1474,7 @@ fi
 
 
 echo $ac_n "checking --enable-pythoninterp argument""... $ac_c" 1>&6
-echo "configure:1461: checking --enable-pythoninterp argument" >&5
+echo "configure:1478: checking --enable-pythoninterp argument" >&5
 # Check whether --enable-pythoninterp or --disable-pythoninterp was given.
 if test "${enable_pythoninterp+set}" = set; then
   enableval="$enable_pythoninterp"
@@ -1486,7 +1488,7 @@ if test "$enable_pythoninterp" = "yes"; 
     # Extract the first word of "python", so it can be a program name with args.
 set dummy python; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:1475: checking for $ac_word" >&5
+echo "configure:1492: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_vi_cv_path_python'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1521,7 +1523,7 @@ fi
   if test "X$vi_cv_path_python" != "X"; then
 
         echo $ac_n "checking Python version""... $ac_c" 1>&6
-echo "configure:1510: checking Python version" >&5
+echo "configure:1527: checking Python version" >&5
 if eval "test \"`echo '$''{'vi_cv_var_python_version'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1533,14 +1535,14 @@ fi
 echo "$ac_t""$vi_cv_var_python_version" 1>&6
 
         echo $ac_n "checking Python is 1.4 or better""... $ac_c" 1>&6
-echo "configure:1522: checking Python is 1.4 or better" >&5
+echo "configure:1539: checking Python is 1.4 or better" >&5
     if ${vi_cv_path_python} -c \
 	"import sys; sys.exit(${vi_cv_var_python_version} < 1.4)"
     then
       echo "$ac_t""yep" 1>&6
 
             echo $ac_n "checking Python's install prefix""... $ac_c" 1>&6
-echo "configure:1529: checking Python's install prefix" >&5
+echo "configure:1546: checking Python's install prefix" >&5
 if eval "test \"`echo '$''{'vi_cv_path_python_pfx'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1552,7 +1554,7 @@ fi
 echo "$ac_t""$vi_cv_path_python_pfx" 1>&6
 
             echo $ac_n "checking Python's execution prefix""... $ac_c" 1>&6
-echo "configure:1541: checking Python's execution prefix" >&5
+echo "configure:1558: checking Python's execution prefix" >&5
 if eval "test \"`echo '$''{'vi_cv_path_python_epfx'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1583,7 +1585,7 @@ fi
 
 
       echo $ac_n "checking Python's configuration directory""... $ac_c" 1>&6
-echo "configure:1572: checking Python's configuration directory" >&5
+echo "configure:1589: checking Python's configuration directory" >&5
 if eval "test \"`echo '$''{'vi_cv_path_python_conf'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1647,21 +1649,21 @@ fi
 	PYTHON_GETPATH_CFLAGS="-DPYTHONPATH='\"${vi_cv_path_pythonpath}\"' -DPREFIX='\"${vi_cv_path_python_pfx}\"' -DEXEC_PREFIX='\"${vi_cv_path_python_epfx}\"'"
 
 					echo $ac_n "checking if -pthread should be used""... $ac_c" 1>&6
-echo "configure:1636: checking if -pthread should be used" >&5
+echo "configure:1653: checking if -pthread should be used" >&5
 	if test "`(uname) 2>/dev/null`" = FreeBSD; then
 	  cflags_save=$CFLAGS
 	  libs_save=$LIBS
 	  CFLAGS="$CFLAGS -D_THREAD_SAFE"
 	  LIBS="$LIBS -pthread"
 	  cat > conftest.$ac_ext <<EOF
-#line 1643 "configure"
+#line 1660 "configure"
 #include "confdefs.h"
 
 int main() {
  
 ; return 0; }
 EOF
-if { (eval echo configure:1650: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:1667: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   echo "$ac_t""yes" 1>&6; PYTHON_CFLAGS="$PYTHON_CFLAGS -D_THREAD_SAFE"
 else
@@ -1696,7 +1698,7 @@ fi
 
 
 echo $ac_n "checking --enable-tclinterp argument""... $ac_c" 1>&6
-echo "configure:1685: checking --enable-tclinterp argument" >&5
+echo "configure:1702: checking --enable-tclinterp argument" >&5
 # Check whether --enable-tclinterp or --disable-tclinterp was given.
 if test "${enable_tclinterp+set}" = set; then
   enableval="$enable_tclinterp"
@@ -1710,7 +1712,7 @@ echo "$ac_t""$enable_tclinterp" 1>&6
 if test "$enable_tclinterp" = "yes"; then
 
     echo $ac_n "checking --with-tclsh argument""... $ac_c" 1>&6
-echo "configure:1699: checking --with-tclsh argument" >&5
+echo "configure:1716: checking --with-tclsh argument" >&5
   # Check whether --with-tclsh or --without-tclsh was given.
 if test "${with_tclsh+set}" = set; then
   withval="$with_tclsh"
@@ -1722,7 +1724,7 @@ fi
   # Extract the first word of "$tclsh_name", so it can be a program name with args.
 set dummy $tclsh_name; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:1711: checking for $ac_word" >&5
+echo "configure:1728: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_vi_cv_path_tcl'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1761,7 +1763,7 @@ fi
     # Extract the first word of "$tclsh_name", so it can be a program name with args.
 set dummy $tclsh_name; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:1750: checking for $ac_word" >&5
+echo "configure:1767: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_vi_cv_path_tcl'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1799,7 +1801,7 @@ fi
     # Extract the first word of "$tclsh_name", so it can be a program name with args.
 set dummy $tclsh_name; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:1788: checking for $ac_word" >&5
+echo "configure:1805: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_vi_cv_path_tcl'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1834,14 +1836,14 @@ fi
   fi
   if test "X$vi_cv_path_tcl" != "X"; then
     echo $ac_n "checking Tcl version""... $ac_c" 1>&6
-echo "configure:1823: checking Tcl version" >&5
+echo "configure:1840: checking Tcl version" >&5
     if echo 'exit [expr [info tclversion] < 8.0]' | $vi_cv_path_tcl - ; then
       tclver=`echo 'puts [info tclversion]' | $vi_cv_path_tcl -`
       echo "$ac_t""$tclver - OK" 1>&6;
       tclloc=`echo 'set l [info library];set i [string last lib $l];incr i -2;puts [string range $l 0 $i]' | $vi_cv_path_tcl -`
 
       echo $ac_n "checking for location of Tcl include""... $ac_c" 1>&6
-echo "configure:1830: checking for location of Tcl include" >&5
+echo "configure:1847: checking for location of Tcl include" >&5
       tclinc="$tclloc/include $tclloc/include/tcl $tclloc/include/tcl$tclver /usr/local/include"
       for try in $tclinc; do
 	if test -f "$try/tcl.h"; then
@@ -1856,7 +1858,7 @@ echo "configure:1830: checking for locat
       fi
       if test -z "$SKIP_TCL"; then
 	echo $ac_n "checking for location of tclConfig.sh script""... $ac_c" 1>&6
-echo "configure:1845: checking for location of tclConfig.sh script" >&5
+echo "configure:1862: checking for location of tclConfig.sh script" >&5
 	tclcnf=`echo $tclinc | sed s/include/lib/g`
 	for try in $tclcnf; do
 	  if test -f $try/tclConfig.sh; then
@@ -1869,7 +1871,7 @@ echo "configure:1845: checking for locat
 	if test -z "$TCL_LIBS"; then
 	  echo "$ac_t""<not found>" 1>&6
 	  echo $ac_n "checking for Tcl library by myself""... $ac_c" 1>&6
-echo "configure:1858: checking for Tcl library by myself" >&5
+echo "configure:1875: checking for Tcl library by myself" >&5
 	  tcllib=`echo $tclinc | sed s/include/lib/g`
 	  for ext in .so .a ; do
 	    for ver in "" $tclver ; do
@@ -1915,7 +1917,7 @@ fi
 
 
 echo $ac_n "checking --enable-rubyinterp argument""... $ac_c" 1>&6
-echo "configure:1904: checking --enable-rubyinterp argument" >&5
+echo "configure:1921: checking --enable-rubyinterp argument" >&5
 # Check whether --enable-rubyinterp or --disable-rubyinterp was given.
 if test "${enable_rubyinterp+set}" = set; then
   enableval="$enable_rubyinterp"
@@ -1930,7 +1932,7 @@ if test "$enable_rubyinterp" = "yes"; th
   # Extract the first word of "ruby", so it can be a program name with args.
 set dummy ruby; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:1919: checking for $ac_word" >&5
+echo "configure:1936: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_vi_cv_path_ruby'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1964,7 +1966,7 @@ fi
 
   if test "X$vi_cv_path_ruby" != "X"; then
     echo $ac_n "checking Ruby version""... $ac_c" 1>&6
-echo "configure:1953: checking Ruby version" >&5
+echo "configure:1970: checking Ruby version" >&5
     if $vi_cv_path_ruby -e 'VERSION >= "1.6.0" or exit 1' >/dev/null 2>/dev/null; then
       echo "$ac_t""OK" 1>&6
       rubyhdrdir=`$vi_cv_path_ruby -r mkmf -e 'print Config::CONFIG["archdir"] || $hdrdir'`
@@ -2006,7 +2008,7 @@ fi
 
 
 echo $ac_n "checking --enable-cscope argument""... $ac_c" 1>&6
-echo "configure:1995: checking --enable-cscope argument" >&5
+echo "configure:2012: checking --enable-cscope argument" >&5
 # Check whether --enable-cscope or --disable-cscope was given.
 if test "${enable_cscope+set}" = set; then
   enableval="$enable_cscope"
@@ -2024,7 +2026,7 @@ EOF
 fi
 
 echo $ac_n "checking --enable-workshop argument""... $ac_c" 1>&6
-echo "configure:2013: checking --enable-workshop argument" >&5
+echo "configure:2030: checking --enable-workshop argument" >&5
 # Check whether --enable-workshop or --disable-workshop was given.
 if test "${enable_workshop+set}" = set; then
   enableval="$enable_workshop"
@@ -2049,7 +2051,7 @@ EOF
 fi
 
 echo $ac_n "checking --enable-sniff argument""... $ac_c" 1>&6
-echo "configure:2038: checking --enable-sniff argument" >&5
+echo "configure:2055: checking --enable-sniff argument" >&5
 # Check whether --enable-sniff or --disable-sniff was given.
 if test "${enable_sniff+set}" = set; then
   enableval="$enable_sniff"
@@ -2071,7 +2073,7 @@ EOF
 fi
 
 echo $ac_n "checking --enable-multibyte argument""... $ac_c" 1>&6
-echo "configure:2060: checking --enable-multibyte argument" >&5
+echo "configure:2077: checking --enable-multibyte argument" >&5
 # Check whether --enable-multibyte or --disable-multibyte was given.
 if test "${enable_multibyte+set}" = set; then
   enableval="$enable_multibyte"
@@ -2089,7 +2091,7 @@ EOF
 fi
 
 echo $ac_n "checking --enable-hangulinput argument""... $ac_c" 1>&6
-echo "configure:2078: checking --enable-hangulinput argument" >&5
+echo "configure:2095: checking --enable-hangulinput argument" >&5
 # Check whether --enable-hangulinput or --disable-hangulinput was given.
 if test "${enable_hangulinput+set}" = set; then
   enableval="$enable_hangulinput"
@@ -2101,7 +2103,7 @@ fi
 echo "$ac_t""$enable_hangulinput" 1>&6
 
 echo $ac_n "checking --enable-xim argument""... $ac_c" 1>&6
-echo "configure:2090: checking --enable-xim argument" >&5
+echo "configure:2107: checking --enable-xim argument" >&5
 # Check whether --enable-xim or --disable-xim was given.
 if test "${enable_xim+set}" = set; then
   enableval="$enable_xim"
@@ -2112,7 +2114,7 @@ fi
 
 
 echo $ac_n "checking --enable-fontset argument""... $ac_c" 1>&6
-echo "configure:2101: checking --enable-fontset argument" >&5
+echo "configure:2118: checking --enable-fontset argument" >&5
 # Check whether --enable-fontset or --disable-fontset was given.
 if test "${enable_fontset+set}" = set; then
   enableval="$enable_fontset"
@@ -2132,7 +2134,7 @@ else
   # Extract the first word of "xmkmf", so it can be a program name with args.
 set dummy xmkmf; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:2121: checking for $ac_word" >&5
+echo "configure:2138: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_xmkmfpath'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2170,7 +2172,7 @@ fi
 # Uses ac_ vars as temps to allow command line to override cache and checks.
 # --without-x overrides everything else, but does not touch the cache.
 echo $ac_n "checking for X""... $ac_c" 1>&6
-echo "configure:2159: checking for X" >&5
+echo "configure:2176: checking for X" >&5
 
 # Check whether --with-x or --without-x was given.
 if test "${with_x+set}" = set; then
@@ -2232,12 +2234,12 @@ if test "$ac_x_includes" = NO; then
 
   # First, try using that file with no special directory specified.
 cat > conftest.$ac_ext <<EOF
-#line 2221 "configure"
+#line 2238 "configure"
 #include "confdefs.h"
 #include <$x_direct_test_include>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:2226: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:2243: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -2306,14 +2308,14 @@ if test "$ac_x_libraries" = NO; then
   ac_save_LIBS="$LIBS"
   LIBS="-l$x_direct_test_library $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 2295 "configure"
+#line 2312 "configure"
 #include "confdefs.h"
 
 int main() {
 ${x_direct_test_function}()
 ; return 0; }
 EOF
-if { (eval echo configure:2302: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:2319: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   LIBS="$ac_save_LIBS"
 # We can link X programs with no special library path.
@@ -2419,17 +2421,17 @@ else
     case "`(uname -sr) 2>/dev/null`" in
     "SunOS 5"*)
       echo $ac_n "checking whether -R must be followed by a space""... $ac_c" 1>&6
-echo "configure:2408: checking whether -R must be followed by a space" >&5
+echo "configure:2425: checking whether -R must be followed by a space" >&5
       ac_xsave_LIBS="$LIBS"; LIBS="$LIBS -R$x_libraries"
       cat > conftest.$ac_ext <<EOF
-#line 2411 "configure"
+#line 2428 "configure"
 #include "confdefs.h"
 
 int main() {
 
 ; return 0; }
 EOF
-if { (eval echo configure:2418: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:2435: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   ac_R_nospace=yes
 else
@@ -2445,14 +2447,14 @@ rm -f conftest*
       else
 	LIBS="$ac_xsave_LIBS -R $x_libraries"
 	cat > conftest.$ac_ext <<EOF
-#line 2434 "configure"
+#line 2451 "configure"
 #include "confdefs.h"
 
 int main() {
 
 ; return 0; }
 EOF
-if { (eval echo configure:2441: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:2458: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   ac_R_space=yes
 else
@@ -2484,7 +2486,7 @@ rm -f conftest*
     # libraries were built with DECnet support.  And karl@cs.umb.edu says
     # the Alpha needs dnet_stub (dnet does not exist).
     echo $ac_n "checking for dnet_ntoa in -ldnet""... $ac_c" 1>&6
-echo "configure:2473: checking for dnet_ntoa in -ldnet" >&5
+echo "configure:2490: checking for dnet_ntoa in -ldnet" >&5
 ac_lib_var=`echo dnet'_'dnet_ntoa | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -2492,7 +2494,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-ldnet  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 2481 "configure"
+#line 2498 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -2503,7 +2505,7 @@ int main() {
 dnet_ntoa()
 ; return 0; }
 EOF
-if { (eval echo configure:2492: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:2509: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -2525,7 +2527,7 @@ fi
 
     if test $ac_cv_lib_dnet_dnet_ntoa = no; then
       echo $ac_n "checking for dnet_ntoa in -ldnet_stub""... $ac_c" 1>&6
-echo "configure:2514: checking for dnet_ntoa in -ldnet_stub" >&5
+echo "configure:2531: checking for dnet_ntoa in -ldnet_stub" >&5
 ac_lib_var=`echo dnet_stub'_'dnet_ntoa | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -2533,7 +2535,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-ldnet_stub  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 2522 "configure"
+#line 2539 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -2544,7 +2546,7 @@ int main() {
 dnet_ntoa()
 ; return 0; }
 EOF
-if { (eval echo configure:2533: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:2550: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -2573,12 +2575,12 @@ fi
     # The nsl library prevents programs from opening the X display
     # on Irix 5.2, according to dickey@clark.net.
     echo $ac_n "checking for gethostbyname""... $ac_c" 1>&6
-echo "configure:2562: checking for gethostbyname" >&5
+echo "configure:2579: checking for gethostbyname" >&5
 if eval "test \"`echo '$''{'ac_cv_func_gethostbyname'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 2567 "configure"
+#line 2584 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char gethostbyname(); below.  */
@@ -2601,7 +2603,7 @@ gethostbyname();
 
 ; return 0; }
 EOF
-if { (eval echo configure:2590: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:2607: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_gethostbyname=yes"
 else
@@ -2622,7 +2624,7 @@ fi
 
     if test $ac_cv_func_gethostbyname = no; then
       echo $ac_n "checking for gethostbyname in -lnsl""... $ac_c" 1>&6
-echo "configure:2611: checking for gethostbyname in -lnsl" >&5
+echo "configure:2628: checking for gethostbyname in -lnsl" >&5
 ac_lib_var=`echo nsl'_'gethostbyname | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -2630,7 +2632,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lnsl  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 2619 "configure"
+#line 2636 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -2641,7 +2643,7 @@ int main() {
 gethostbyname()
 ; return 0; }
 EOF
-if { (eval echo configure:2630: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:2647: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -2671,12 +2673,12 @@ fi
     # -lsocket must be given before -lnsl if both are needed.
     # We assume that if connect needs -lnsl, so does gethostbyname.
     echo $ac_n "checking for connect""... $ac_c" 1>&6
-echo "configure:2660: checking for connect" >&5
+echo "configure:2677: checking for connect" >&5
 if eval "test \"`echo '$''{'ac_cv_func_connect'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 2665 "configure"
+#line 2682 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char connect(); below.  */
@@ -2699,7 +2701,7 @@ connect();
 
 ; return 0; }
 EOF
-if { (eval echo configure:2688: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:2705: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_connect=yes"
 else
@@ -2720,7 +2722,7 @@ fi
 
     if test $ac_cv_func_connect = no; then
       echo $ac_n "checking for connect in -lsocket""... $ac_c" 1>&6
-echo "configure:2709: checking for connect in -lsocket" >&5
+echo "configure:2726: checking for connect in -lsocket" >&5
 ac_lib_var=`echo socket'_'connect | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -2728,7 +2730,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lsocket $X_EXTRA_LIBS $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 2717 "configure"
+#line 2734 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -2739,7 +2741,7 @@ int main() {
 connect()
 ; return 0; }
 EOF
-if { (eval echo configure:2728: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:2745: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -2763,12 +2765,12 @@ fi
 
     # gomez@mi.uni-erlangen.de says -lposix is necessary on A/UX.
     echo $ac_n "checking for remove""... $ac_c" 1>&6
-echo "configure:2752: checking for remove" >&5
+echo "configure:2769: checking for remove" >&5
 if eval "test \"`echo '$''{'ac_cv_func_remove'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 2757 "configure"
+#line 2774 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char remove(); below.  */
@@ -2791,7 +2793,7 @@ remove();
 
 ; return 0; }
 EOF
-if { (eval echo configure:2780: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:2797: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_remove=yes"
 else
@@ -2812,7 +2814,7 @@ fi
 
     if test $ac_cv_func_remove = no; then
       echo $ac_n "checking for remove in -lposix""... $ac_c" 1>&6
-echo "configure:2801: checking for remove in -lposix" >&5
+echo "configure:2818: checking for remove in -lposix" >&5
 ac_lib_var=`echo posix'_'remove | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -2820,7 +2822,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lposix  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 2809 "configure"
+#line 2826 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -2831,7 +2833,7 @@ int main() {
 remove()
 ; return 0; }
 EOF
-if { (eval echo configure:2820: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:2837: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -2855,12 +2857,12 @@ fi
 
     # BSDI BSD/OS 2.1 needs -lipc for XOpenDisplay.
     echo $ac_n "checking for shmat""... $ac_c" 1>&6
-echo "configure:2844: checking for shmat" >&5
+echo "configure:2861: checking for shmat" >&5
 if eval "test \"`echo '$''{'ac_cv_func_shmat'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 2849 "configure"
+#line 2866 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char shmat(); below.  */
@@ -2883,7 +2885,7 @@ shmat();
 
 ; return 0; }
 EOF
-if { (eval echo configure:2872: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:2889: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_shmat=yes"
 else
@@ -2904,7 +2906,7 @@ fi
 
     if test $ac_cv_func_shmat = no; then
       echo $ac_n "checking for shmat in -lipc""... $ac_c" 1>&6
-echo "configure:2893: checking for shmat in -lipc" >&5
+echo "configure:2910: checking for shmat in -lipc" >&5
 ac_lib_var=`echo ipc'_'shmat | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -2912,7 +2914,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lipc  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 2901 "configure"
+#line 2918 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -2923,7 +2925,7 @@ int main() {
 shmat()
 ; return 0; }
 EOF
-if { (eval echo configure:2912: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:2929: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -2956,7 +2958,7 @@ fi
   # libraries we check for below, so use a different variable.
   #  --interran@uluru.Stanford.EDU, kb@cs.umb.edu.
   echo $ac_n "checking for IceConnectionNumber in -lICE""... $ac_c" 1>&6
-echo "configure:2945: checking for IceConnectionNumber in -lICE" >&5
+echo "configure:2962: checking for IceConnectionNumber in -lICE" >&5
 ac_lib_var=`echo ICE'_'IceConnectionNumber | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -2964,7 +2966,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lICE $X_EXTRA_LIBS $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 2953 "configure"
+#line 2970 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -2975,7 +2977,7 @@ int main() {
 IceConnectionNumber()
 ; return 0; }
 EOF
-if { (eval echo configure:2964: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:2981: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -3028,18 +3030,18 @@ fi
 
 
       echo $ac_n "checking if X11 header files can be found""... $ac_c" 1>&6
-echo "configure:3017: checking if X11 header files can be found" >&5
+echo "configure:3034: checking if X11 header files can be found" >&5
   cflags_save=$CFLAGS
   CFLAGS="$CFLAGS $X_CFLAGS"
   cat > conftest.$ac_ext <<EOF
-#line 3021 "configure"
+#line 3038 "configure"
 #include "confdefs.h"
 #include <X11/Xlib.h>
 int main() {
 
 ; return 0; }
 EOF
-if { (eval echo configure:3028: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:3045: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   echo "$ac_t""yes" 1>&6
 else
@@ -3065,7 +3067,7 @@ EOF
     LDFLAGS="-L$x_libraries $LDFLAGS"
 
             echo $ac_n "checking for _XdmcpAuthDoIt in -lXdmcp""... $ac_c" 1>&6
-echo "configure:3054: checking for _XdmcpAuthDoIt in -lXdmcp" >&5
+echo "configure:3071: checking for _XdmcpAuthDoIt in -lXdmcp" >&5
 ac_lib_var=`echo Xdmcp'_'_XdmcpAuthDoIt | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -3073,7 +3075,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lXdmcp -lXt $X_PRE_LIBS -lX11 $X_EXTRA_LIBS -lXdmcp $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 3062 "configure"
+#line 3079 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -3084,7 +3086,7 @@ int main() {
 _XdmcpAuthDoIt()
 ; return 0; }
 EOF
-if { (eval echo configure:3073: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:3090: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -3106,7 +3108,7 @@ fi
 
 
                     echo $ac_n "checking for IceOpenConnection in -lICE""... $ac_c" 1>&6
-echo "configure:3095: checking for IceOpenConnection in -lICE" >&5
+echo "configure:3112: checking for IceOpenConnection in -lICE" >&5
 ac_lib_var=`echo ICE'_'IceOpenConnection | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -3114,7 +3116,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lICE $X_EXTRA_LIBS $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 3103 "configure"
+#line 3120 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -3125,7 +3127,7 @@ int main() {
 IceOpenConnection()
 ; return 0; }
 EOF
-if { (eval echo configure:3114: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:3131: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -3148,7 +3150,7 @@ fi
 
         LDFLAGS="$X_LIBS $ac_save_LDFLAGS"
     echo $ac_n "checking for XpmCreatePixmapFromData in -lXpm""... $ac_c" 1>&6
-echo "configure:3137: checking for XpmCreatePixmapFromData in -lXpm" >&5
+echo "configure:3154: checking for XpmCreatePixmapFromData in -lXpm" >&5
 ac_lib_var=`echo Xpm'_'XpmCreatePixmapFromData | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -3156,7 +3158,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lXpm -lXt $X_PRE_LIBS -lXpm -lX11 $X_EXTRA_LIBS $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 3145 "configure"
+#line 3162 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -3167,7 +3169,7 @@ int main() {
 XpmCreatePixmapFromData()
 ; return 0; }
 EOF
-if { (eval echo configure:3156: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:3173: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -3189,18 +3191,18 @@ fi
 
 
         echo $ac_n "checking if X11 header files implicitly declare return values""... $ac_c" 1>&6
-echo "configure:3178: checking if X11 header files implicitly declare return values" >&5
+echo "configure:3195: checking if X11 header files implicitly declare return values" >&5
     cflags_save=$CFLAGS
     CFLAGS="$CFLAGS $X_CFLAGS -Werror"
     cat > conftest.$ac_ext <<EOF
-#line 3182 "configure"
+#line 3199 "configure"
 #include "confdefs.h"
 #include <X11/Xlib.h>
 int main() {
 
 ; return 0; }
 EOF
-if { (eval echo configure:3189: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:3206: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   echo "$ac_t""no" 1>&6
 else
@@ -3209,14 +3211,14 @@ else
   rm -rf conftest*
   CFLAGS="$CFLAGS -Wno-implicit-int"
 	cat > conftest.$ac_ext <<EOF
-#line 3198 "configure"
+#line 3215 "configure"
 #include "confdefs.h"
 #include <X11/Xlib.h>
 int main() {
 
 ; return 0; }
 EOF
-if { (eval echo configure:3205: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:3222: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   echo "$ac_t""yes" 1>&6; cflags_save="$cflags_save -Wno-implicit-int"
 else
@@ -3240,7 +3242,7 @@ fi
 test "x$with_x" = xno -a "x$BEOS" != "xyes" -a "x$QNX" != "xyes" && enable_gui=no
 
 echo $ac_n "checking --enable-gui argument""... $ac_c" 1>&6
-echo "configure:3229: checking --enable-gui argument" >&5
+echo "configure:3246: checking --enable-gui argument" >&5
 # Check whether --enable-gui or --disable-gui was given.
 if test "${enable_gui+set}" = set; then
   enableval="$enable_gui"
@@ -3253,6 +3255,7 @@ fi
 if test "x$BEOS" = "xyes"; then
 
   SKIP_GTK=YES
+  SKIP_GTK2=YES
   SKIP_GNOME=YES
   SKIP_MOTIF=YES
   SKIP_ATHENA=YES
@@ -3271,6 +3274,7 @@ if test "x$BEOS" = "xyes"; then
 
 elif test "x$QNX" = "xyes" -a "x$with_x" = "xno" ; then
   SKIP_GTK=YES
+  SKIP_GTK2=YES
   SKIP_GNOME=YES
   SKIP_MOTIF=YES
   SKIP_ATHENA=YES
@@ -3290,6 +3294,7 @@ elif test "x$QNX" = "xyes" -a "x$with_x"
 else
 
   SKIP_GTK=
+  SKIP_GTK2=
   SKIP_GNOME=
   SKIP_MOTIF=
   SKIP_ATHENA=
@@ -3317,7 +3322,7 @@ fi
 
 if test "x$SKIP_GTK" != "xYES" -a "$enable_gui" != "gtk"; then
   echo $ac_n "checking whether or not to look for GTK""... $ac_c" 1>&6
-echo "configure:3306: checking whether or not to look for GTK" >&5
+echo "configure:3326: checking whether or not to look for GTK" >&5
   # Check whether --enable-gtk-check or --disable-gtk-check was given.
 if test "${enable_gtk_check+set}" = set; then
   enableval="$enable_gtk_check"
@@ -3335,7 +3340,7 @@ fi
 
 if test "x$SKIP_GNOME" != "xYES" -a "$enable_gui" != "gnome"; then
   echo $ac_n "checking whether or not to look for GNOME""... $ac_c" 1>&6
-echo "configure:3324: checking whether or not to look for GNOME" >&5
+echo "configure:3344: checking whether or not to look for GNOME" >&5
   # Check whether --enable-gnome-check or --disable-gnome-check was given.
 if test "${enable_gnome_check+set}" = set; then
   enableval="$enable_gnome_check"
@@ -3350,9 +3355,26 @@ fi
   fi
 fi
 
+if test "x$SKIP_GTK2" != "xYES"; then
+  echo $ac_n "checking whether or not to look for GTK2""... $ac_c" 1>&6
+echo "configure:3361: checking whether or not to look for GTK2" >&5
+  # Check whether --enable-gtk2-check or --disable-gtk2-check was given.
+if test "${enable_gtk2_check+set}" = set; then
+  enableval="$enable_gtk2_check"
+  :
+else
+  enable_gtk2_check="no"
+fi
+
+  echo "$ac_t""$enable_gtk2_check" 1>&6;
+  if test "x$enable_gtk2_check" = "xno"; then
+    SKIP_GTK2=YES
+  fi
+fi
+
 if test "x$SKIP_MOTIF" != "xYES" -a "$enable_gui" != "motif"; then
   echo $ac_n "checking whether or not to look for Motif""... $ac_c" 1>&6
-echo "configure:3341: checking whether or not to look for Motif" >&5
+echo "configure:3378: checking whether or not to look for Motif" >&5
   # Check whether --enable-motif-check or --disable-motif-check was given.
 if test "${enable_motif_check+set}" = set; then
   enableval="$enable_motif_check"
@@ -3369,7 +3391,7 @@ fi
 
 if test "x$SKIP_ATHENA" != "xYES" -a "$enable_gui" != "athena"; then
   echo $ac_n "checking whether or not to look for Athena""... $ac_c" 1>&6
-echo "configure:3358: checking whether or not to look for Athena" >&5
+echo "configure:3395: checking whether or not to look for Athena" >&5
   # Check whether --enable-athena-check or --disable-athena-check was given.
 if test "${enable_athena_check+set}" = set; then
   enableval="$enable_athena_check"
@@ -3396,7 +3418,7 @@ fi
 if test -z "$SKIP_GTK"; then
 
   echo $ac_n "checking --with-gtk-prefix argument""... $ac_c" 1>&6
-echo "configure:3385: checking --with-gtk-prefix argument" >&5
+echo "configure:3422: checking --with-gtk-prefix argument" >&5
   # Check whether --with-gtk-prefix or --without-gtk-prefix was given.
 if test "${with_gtk_prefix+set}" = set; then
   withval="$with_gtk_prefix"
@@ -3407,7 +3429,7 @@ fi
 
 
   echo $ac_n "checking --with-gtk-exec-prefix argument""... $ac_c" 1>&6
-echo "configure:3396: checking --with-gtk-exec-prefix argument" >&5
+echo "configure:3433: checking --with-gtk-exec-prefix argument" >&5
   # Check whether --with-gtk-exec-prefix or --without-gtk-exec-prefix was given.
 if test "${with_gtk_exec_prefix+set}" = set; then
   withval="$with_gtk_exec_prefix"
@@ -3418,7 +3440,7 @@ fi
 
 
   echo $ac_n "checking --disable-gtktest argument""... $ac_c" 1>&6
-echo "configure:3407: checking --disable-gtktest argument" >&5
+echo "configure:3444: checking --disable-gtktest argument" >&5
   # Check whether --enable-gtktest or --disable-gtktest was given.
 if test "${enable_gtktest+set}" = set; then
   enableval="$enable_gtktest"
@@ -3445,7 +3467,7 @@ fi
     # Extract the first word of "gtk-config", so it can be a program name with args.
 set dummy gtk-config; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:3434: checking for $ac_word" >&5
+echo "configure:3471: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_GTK_CONFIG'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -3482,7 +3504,7 @@ fi
             # Extract the first word of "gtk12-config", so it can be a program name with args.
 set dummy gtk12-config; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:3471: checking for $ac_word" >&5
+echo "configure:3508: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_GTK12_CONFIG'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -3520,38 +3542,96 @@ fi
   else
     echo "$ac_t""Using GTK configuration program $GTK_CONFIG" 1>&6
   fi
+  if test "X$PKG_CONFIG" = "X"; then
+    # Extract the first word of "pkg-config", so it can be a program name with args.
+set dummy pkg-config; ac_word=$2
+echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+echo "configure:3550: checking for $ac_word" >&5
+if eval "test \"`echo '$''{'ac_cv_path_PKG_CONFIG'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  case "$PKG_CONFIG" in
+  /*)
+  ac_cv_path_PKG_CONFIG="$PKG_CONFIG" # Let the user override the test with a path.
+  ;;
+  ?:/*)			 
+  ac_cv_path_PKG_CONFIG="$PKG_CONFIG" # Let the user override the test with a dos path.
+  ;;
+  *)
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
+  ac_dummy="$PATH"
+  for ac_dir in $ac_dummy; do 
+    test -z "$ac_dir" && ac_dir=.
+    if test -f $ac_dir/$ac_word; then
+      ac_cv_path_PKG_CONFIG="$ac_dir/$ac_word"
+      break
+    fi
+  done
+  IFS="$ac_save_ifs"
+  test -z "$ac_cv_path_PKG_CONFIG" && ac_cv_path_PKG_CONFIG="no"
+  ;;
+esac
+fi
+PKG_CONFIG="$ac_cv_path_PKG_CONFIG"
+if test -n "$PKG_CONFIG"; then
+  echo "$ac_t""$PKG_CONFIG" 1>&6
+else
+  echo "$ac_t""no" 1>&6
+fi
 
-      if test "X$GTK_CONFIG" != "X"; then
-    
-  if test "X$GTK_CONFIG" != "X"; then
+  fi
 
+      if test "X$GTK_CONFIG" != "Xno" -o "X$PKG_CONFIG" != "Xno"; then
+    
+  if test "X$GTK_CONFIG" != "Xno" -o "X$PKG_CONFIG" != "Xno"; then
+  {
     min_gtk_version=1.1.16
     echo $ac_n "checking for GTK - version >= $min_gtk_version""... $ac_c" 1>&6
-echo "configure:3516: checking for GTK - version >= $min_gtk_version" >&5
+echo "configure:3591: checking for GTK - version >= $min_gtk_version" >&5
     no_gtk=""
-    if test "$GTK_CONFIG" = "no" ; then
-      no_gtk=yes
-    else
+    if test "X$SKIP_GTK2" != "XYES" -a "X$PKG_CONFIG" != "Xno"; then
+    {
+                        if $PKG_CONFIG --exists gtk+-2.0; then
+        GTK_CFLAGS=`$PKG_CONFIG --cflags gtk+-2.0`
+        GTK_LIBS=`$PKG_CONFIG --libs gtk+-2.0`
+        gtk_major_version=`$PKG_CONFIG --modversion gtk+-2.0 | \
+               sed 's/\([0-9]*\)\.\([0-9]*\)\.\([0-9]*\)/\1/'`
+        gtk_minor_version=`$PKG_CONFIG --modversion gtk+-2.0 | \
+               sed 's/\([0-9]*\)\.\([0-9]*\)\.\([0-9]*\)/\2/'`
+        gtk_micro_version=`$PKG_CONFIG --modversion gtk+-2.0 | \
+               sed 's/\([0-9]*\)\.\([0-9]*\)\.\([0-9]*\)/\3/'`
+      else
+        no_gtk=yes
+      fi
+    }
+    elif test "X$GTK_CONFIG" != "Xno"; then
+    {
       GTK_CFLAGS=`$GTK_CONFIG $gtk_config_args --cflags`
       GTK_LIBS=`$GTK_CONFIG $gtk_config_args --libs`
-      gtk_config_major_version=`$GTK_CONFIG $gtk_config_args --version | \
-	     sed 's/\([0-9]*\).\([0-9]*\).\([0-9]*\)/\1/'`
-      gtk_config_minor_version=`$GTK_CONFIG $gtk_config_args --version | \
-	     sed 's/\([0-9]*\).\([0-9]*\).\([0-9]*\)/\2/'`
-      gtk_config_micro_version=`$GTK_CONFIG $gtk_config_args --version | \
-	     sed 's/\([0-9]*\).\([0-9]*\).\([0-9]*\)/\3/'`
-      if test "x$enable_gtktest" = "xyes" ; then
-	ac_save_CFLAGS="$CFLAGS"
-	ac_save_LIBS="$LIBS"
-	CFLAGS="$CFLAGS $GTK_CFLAGS"
-	LIBS="$LIBS $GTK_LIBS"
+      gtk_major_version=`$GTK_CONFIG $gtk_config_args --version | \
+	     sed 's/\([0-9]*\)\.\([0-9]*\)\.\([0-9]*\)/\1/'`
+      gtk_minor_version=`$GTK_CONFIG $gtk_config_args --version | \
+	     sed 's/\([0-9]*\)\.\([0-9]*\)\.\([0-9]*\)/\2/'`
+      gtk_micro_version=`$GTK_CONFIG $gtk_config_args --version | \
+	     sed 's/\([0-9]*\)\.\([0-9]*\)\.\([0-9]*\)/\3/'`
+    }
+    else
+      no_gtk=yes
+    fi
+
+    if test "x$enable_gtktest" = "xyes" -a "x$no_gtk" = "x"; then
+    {
+      ac_save_CFLAGS="$CFLAGS"
+      ac_save_LIBS="$LIBS"
+      CFLAGS="$CFLAGS $GTK_CFLAGS"
+      LIBS="$LIBS $GTK_LIBS"
 
-					rm -f conf.gtktest
-	if test "$cross_compiling" = yes; then
+                              rm -f conf.gtktest
+      if test "$cross_compiling" = yes; then
   echo $ac_n "cross compiling; assumed OK... $ac_c"
 else
   cat > conftest.$ac_ext <<EOF
-#line 3540 "configure"
+#line 3635 "configure"
 #include "confdefs.h"
 
 #include <gtk/gtk.h>
@@ -3560,30 +3640,30 @@ else
 int
 main ()
 {
-  int major, minor, micro;
-  char *tmp_version;
+int major, minor, micro;
+char *tmp_version;
 
-  system ("touch conf.gtktest");
+system ("touch conf.gtktest");
 
-  /* HP/UX 9 (%@#!) writes to sscanf strings */
-  tmp_version = g_strdup("$min_gtk_version");
-  if (sscanf(tmp_version, "%d.%d.%d", &major, &minor, &micro) != 3) {
-     printf("%s, bad version string\n", "$min_gtk_version");
-     exit(1);
-   }
-
-  if ((gtk_major_version > major) ||
-      ((gtk_major_version == major) && (gtk_minor_version > minor)) ||
-      ((gtk_major_version == major) && (gtk_minor_version == minor) &&
-				       (gtk_micro_version >= micro)))
-  {
-      return 0;
-  }
-  return 1;
+/* HP/UX 9 (%@#!) writes to sscanf strings */
+tmp_version = g_strdup("$min_gtk_version");
+if (sscanf(tmp_version, "%d.%d.%d", &major, &minor, &micro) != 3) {
+   printf("%s, bad version string\n", "$min_gtk_version");
+   exit(1);
+ }
+
+if ((gtk_major_version > major) ||
+    ((gtk_major_version == major) && (gtk_minor_version > minor)) ||
+    ((gtk_major_version == major) && (gtk_minor_version == minor) &&
+                                     (gtk_micro_version >= micro)))
+{
+    return 0;
+}
+return 1;
 }
 
 EOF
-if { (eval echo configure:3572: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:3667: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
 then
   :
 else
@@ -3595,17 +3675,18 @@ fi
 rm -fr conftest*
 fi
 
-	CFLAGS="$ac_save_CFLAGS"
-	LIBS="$ac_save_LIBS"
-      fi
+      CFLAGS="$ac_save_CFLAGS"
+      LIBS="$ac_save_LIBS"
+    }
     fi
     if test "x$no_gtk" = x ; then
-      echo "$ac_t""yes" 1>&6
+      echo "$ac_t""yes; found version $gtk_major_version.$gtk_minor_version.$gtk_micro_version" 1>&6
       GTK_LIBNAME="$GTK_LIBS"
 		GUI_INC_LOC="$GTK_CFLAGS"
     else
+    {
       echo "$ac_t""no" 1>&6
-      if test "$GTK_CONFIG" = "no" ; then
+      if test "X$GTK_CONFIG" = "Xno" ; then
 	:
       else
 	if test -f conf.gtktest ; then
@@ -3616,7 +3697,9 @@ fi
       GTK_CFLAGS=""
       GTK_LIBS=""
       :
+    }
     fi
+  }
   else
     GTK_CFLAGS=""
     GTK_LIBS=""
@@ -3634,10 +3717,18 @@ fi
     fi
   fi
     if test "x$GUITYPE" = "xGTK"; then
-    if test $gtk_config_major_version = 1 -a $gtk_config_minor_version -lt 2 -o $gtk_config_major_version = 1 -a $gtk_config_minor_version = 2 -a $gtk_config_micro_version -lt 3; then
+    if test $gtk_major_version = 1 -a $gtk_minor_version -lt 2 -o $gtk_major_version = 1 -a $gtk_minor_version = 2 -a $gtk_micro_version -lt 3; then
       echo "$ac_t""this GTK version is old; version 1.2.3 or later is recommended" 1>&6
     else
+    {
+      if test $gtk_major_version -ge 2; then
+	cat >> confdefs.h <<\EOF
+#define HAVE_GTK2 1
+EOF
+
+      fi
                         if test -z "$SKIP_GNOME"; then
+      {
 	
   
   
@@ -3680,11 +3771,29 @@ else
 fi
 
 
-  if test "x$want_gnome" = xyes; then
+  if test "x$want_gnome" = xyes -a $gtk_major_version -ge 2; then
+  {
+    echo $ac_n "checking for libgnomeui-2.0""... $ac_c" 1>&6
+echo "configure:3778: checking for libgnomeui-2.0" >&5
+    if $PKG_CONFIG --exists libgnomeui-2.0; then
+      echo "$ac_t""yes" 1>&6
+      GNOME_LIBS=`$PKG_CONFIG --libs-only-l libgnomeui-2.0`
+      GNOME_LIBDIR=`$PKG_CONFIG --libs-only-L libgnomeui-2.0`
+      GNOME_INCLUDEDIR=`$PKG_CONFIG --cflags libgnomeui-2.0`
+      have_gnome=yes
+    else
+      echo "$ac_t""not found" 1>&6
+      if test "x" = xfail; then
+	{ echo "configure: error: Could not find libgnomeui-2.0 via pkg-config" 1>&2; exit 1; }
+      fi
+    fi
+  }
+  elif test "x$want_gnome" = xyes; then
+  {
     # Extract the first word of "gnome-config", so it can be a program name with args.
 set dummy gnome-config; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:3673: checking for $ac_word" >&5
+echo "configure:3797: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_GNOME_CONFIG'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -3721,7 +3830,7 @@ fi
       no_gnome_config="yes"
     else
       echo $ac_n "checking if $GNOME_CONFIG works""... $ac_c" 1>&6
-echo "configure:3710: checking if $GNOME_CONFIG works" >&5
+echo "configure:3834: checking if $GNOME_CONFIG works" >&5
       if $GNOME_CONFIG --libs-only-l gnome >/dev/null 2>&1; then
 	echo "$ac_t""yes" 1>&6
 	GNOME_LIBS="`$GNOME_CONFIG --libs-only-l gnome gnomeui`"
@@ -3746,7 +3855,7 @@ echo "configure:3710: checking if $GNOME
 
     if test "$no_gnome_config" = "yes"; then
       echo $ac_n "checking for gnomeConf.sh file in $gnome_prefix""... $ac_c" 1>&6
-echo "configure:3735: checking for gnomeConf.sh file in $gnome_prefix" >&5
+echo "configure:3859: checking for gnomeConf.sh file in $gnome_prefix" >&5
       if test -f $gnome_prefix/gnomeConf.sh; then
 	echo "$ac_t""found" 1>&6
 	echo "loading gnome configuration from" \
@@ -3760,6 +3869,7 @@ echo "configure:3735: checking for gnome
 	fi
       fi
     fi
+  }
   fi
 
 	if test x$have_gnome = xyes ; then
@@ -3770,7 +3880,9 @@ EOF
 	  GUI_INC_LOC="$GUI_INC_LOC $GNOME_INCLUDEDIR"
 	  GTK_LIBNAME="$GTK_LIBNAME $GNOME_LIBDIR $GNOME_LIBS"
 	fi
+      }
       fi
+    }
     fi
   fi
 fi
@@ -3781,7 +3893,7 @@ if test -z "$SKIP_MOTIF"; then
     GUI_INC_LOC="`echo $GUI_INC_LOC|sed 's%-I%%g'`"
 
   echo $ac_n "checking for location of Motif GUI includes""... $ac_c" 1>&6
-echo "configure:3770: checking for location of Motif GUI includes" >&5
+echo "configure:3897: checking for location of Motif GUI includes" >&5
   gui_includes="`echo $x_includes|sed 's%/^/^/*$%%'` `echo "$gui_XXX" | sed s/XXX/include/g` $GUI_INC_LOC"
   GUI_INC_LOC=
   for try in $gui_includes; do
@@ -3805,7 +3917,7 @@ fi
 
 if test -z "$SKIP_MOTIF"; then
   echo $ac_n "checking --with-motif-lib argument""... $ac_c" 1>&6
-echo "configure:3794: checking --with-motif-lib argument" >&5
+echo "configure:3921: checking --with-motif-lib argument" >&5
   # Check whether --with-motif-lib or --without-motif-lib was given.
 if test "${with_motif_lib+set}" = set; then
   withval="$with_motif_lib"
@@ -3822,7 +3934,7 @@ fi
         GUI_LIB_LOC="`echo $GUI_LIB_LOC|sed 's%-L%%g'`"
 
     echo $ac_n "checking for location of Motif GUI libs""... $ac_c" 1>&6
-echo "configure:3811: checking for location of Motif GUI libs" >&5
+echo "configure:3938: checking for location of Motif GUI libs" >&5
     gui_libs="`echo $x_libraries|sed 's%/^/^/*$%%'` `echo "$gui_XXX" | sed s/XXX/lib/g` `echo "$GUI_INC_LOC" | sed s/include/lib/` $GUI_LIB_LOC"
     GUI_LIB_LOC=
     for try in $gui_libs; do
@@ -3864,11 +3976,11 @@ GUI_X_LIBS=
 
 if test -z "$SKIP_ATHENA"; then
   echo $ac_n "checking if Athena header files can be found""... $ac_c" 1>&6
-echo "configure:3853: checking if Athena header files can be found" >&5
+echo "configure:3980: checking if Athena header files can be found" >&5
   cflags_save=$CFLAGS
   CFLAGS="$CFLAGS $X_CFLAGS"
   cat > conftest.$ac_ext <<EOF
-#line 3857 "configure"
+#line 3984 "configure"
 #include "confdefs.h"
 
 #include <X11/Intrinsic.h>
@@ -3877,7 +3989,7 @@ int main() {
 
 ; return 0; }
 EOF
-if { (eval echo configure:3866: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:3993: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   echo "$ac_t""yes" 1>&6
 else
@@ -3905,7 +4017,7 @@ if test -z "$SKIP_ATHENA" -o -z "$SKIP_M
     ldflags_save=$LDFLAGS
   LDFLAGS="$X_LIBS $LDFLAGS"
   echo $ac_n "checking for XShapeQueryExtension in -lXext""... $ac_c" 1>&6
-echo "configure:3894: checking for XShapeQueryExtension in -lXext" >&5
+echo "configure:4021: checking for XShapeQueryExtension in -lXext" >&5
 ac_lib_var=`echo Xext'_'XShapeQueryExtension | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -3913,7 +4025,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lXext -lXt $X_PRE_LIBS -lX11 $X_EXTRA_LIBS $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 3902 "configure"
+#line 4029 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -3924,7 +4036,7 @@ int main() {
 XShapeQueryExtension()
 ; return 0; }
 EOF
-if { (eval echo configure:3913: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:4040: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -3945,7 +4057,7 @@ else
 fi
 
   echo $ac_n "checking for XmuCreateStippledPixmap in -lXmu""... $ac_c" 1>&6
-echo "configure:3934: checking for XmuCreateStippledPixmap in -lXmu" >&5
+echo "configure:4061: checking for XmuCreateStippledPixmap in -lXmu" >&5
 ac_lib_var=`echo Xmu'_'XmuCreateStippledPixmap | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -3953,7 +4065,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lXmu $GUI_X_LIBS -lXt $X_PRE_LIBS -lX11 $X_EXTRA_LIBS $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 3942 "configure"
+#line 4069 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -3964,7 +4076,7 @@ int main() {
 XmuCreateStippledPixmap()
 ; return 0; }
 EOF
-if { (eval echo configure:3953: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:4080: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -3986,7 +4098,7 @@ fi
 
   if test -z "$SKIP_MOTIF"; then
     echo $ac_n "checking for XpEndJob in -lXp""... $ac_c" 1>&6
-echo "configure:3975: checking for XpEndJob in -lXp" >&5
+echo "configure:4102: checking for XpEndJob in -lXp" >&5
 ac_lib_var=`echo Xp'_'XpEndJob | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -3994,7 +4106,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lXp $GUI_X_LIBS -lXm -lXt $X_PRE_LIBS -lX11 $X_EXTRA_LIBS $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 3983 "configure"
+#line 4110 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -4005,7 +4117,7 @@ int main() {
 XpEndJob()
 ; return 0; }
 EOF
-if { (eval echo configure:3994: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:4121: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -4029,7 +4141,7 @@ fi
   LDFLAGS=$ldflags_save
 
     echo $ac_n "checking for extra X11 defines""... $ac_c" 1>&6
-echo "configure:4018: checking for extra X11 defines" >&5
+echo "configure:4145: checking for extra X11 defines" >&5
   NARROW_PROTO=
   rm -fr conftestdir
   if mkdir conftestdir; then
@@ -4059,17 +4171,17 @@ if test -z "$SKIP_ATHENA" -o -z "$SKIP_M
 do
 ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
 echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
-echo "configure:4048: checking for $ac_hdr" >&5
+echo "configure:4175: checking for $ac_hdr" >&5
 if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 4053 "configure"
+#line 4180 "configure"
 #include "confdefs.h"
 #include <$ac_hdr>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:4058: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:4185: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -4098,9 +4210,9 @@ done
 
     if test ! "$enable_xim" = "no"; then
     echo $ac_n "checking for XIMText in X11/Xlib.h""... $ac_c" 1>&6
-echo "configure:4087: checking for XIMText in X11/Xlib.h" >&5
+echo "configure:4214: checking for XIMText in X11/Xlib.h" >&5
     cat > conftest.$ac_ext <<EOF
-#line 4089 "configure"
+#line 4216 "configure"
 #include "confdefs.h"
 #include <X11/Xlib.h>
 EOF
@@ -4117,6 +4229,8 @@ rm -f conftest*
   fi
   CPPFLAGS=$cppflags_save
 
+                
+
     if test "$enable_xim" = "auto" -a ! "$enable_hangulinput" = "yes" \
 		-a ! "x$GUITYPE" = "xNONE" ; then
     echo "$ac_t""X GUI selected; xim has been enabled" 1>&6
@@ -4131,17 +4245,17 @@ if test -z "$SKIP_ATHENA" -o -z "$SKIP_M
 do
 ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
 echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
-echo "configure:4120: checking for $ac_hdr" >&5
+echo "configure:4249: checking for $ac_hdr" >&5
 if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 4125 "configure"
+#line 4254 "configure"
 #include "confdefs.h"
 #include <$ac_hdr>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:4130: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:4259: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -4177,17 +4291,17 @@ if test -z "$SKIP_MOTIF"; then
 do
 ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
 echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
-echo "configure:4166: checking for $ac_hdr" >&5
+echo "configure:4295: checking for $ac_hdr" >&5
 if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 4171 "configure"
+#line 4300 "configure"
 #include "confdefs.h"
 #include <$ac_hdr>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:4176: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:4305: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -4273,17 +4387,17 @@ fi
 
 
 echo $ac_n "checking quality of toupper""... $ac_c" 1>&6
-echo "configure:4262: checking quality of toupper" >&5
+echo "configure:4391: checking quality of toupper" >&5
 if test "$cross_compiling" = yes; then
   { echo "configure: error: failed to compile test program" 1>&2; exit 1; }
 else
   cat > conftest.$ac_ext <<EOF
-#line 4267 "configure"
+#line 4396 "configure"
 #include "confdefs.h"
 #include <ctype.h>
 main() { exit(toupper('A') == 'A' && tolower('z') == 'z'); }
 EOF
-if { (eval echo configure:4272: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:4401: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
 then
   cat >> confdefs.h <<\EOF
 #define BROKEN_TOUPPER 1
@@ -4300,16 +4414,16 @@ fi
 
 
 echo $ac_n "checking whether __DATE__ and __TIME__ work""... $ac_c" 1>&6
-echo "configure:4289: checking whether __DATE__ and __TIME__ work" >&5
+echo "configure:4418: checking whether __DATE__ and __TIME__ work" >&5
 cat > conftest.$ac_ext <<EOF
-#line 4291 "configure"
+#line 4420 "configure"
 #include "confdefs.h"
 
 int main() {
 printf("(" __DATE__ " " __TIME__ ")");
 ; return 0; }
 EOF
-if { (eval echo configure:4298: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:4427: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   echo "$ac_t""yes" 1>&6; cat >> confdefs.h <<\EOF
 #define HAVE_DATE_TIME 1
@@ -4325,17 +4439,17 @@ rm -f conftest*
 
 ac_safe=`echo "elf.h" | sed 'y%./+-%__p_%'`
 echo $ac_n "checking for elf.h""... $ac_c" 1>&6
-echo "configure:4314: checking for elf.h" >&5
+echo "configure:4443: checking for elf.h" >&5
 if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 4319 "configure"
+#line 4448 "configure"
 #include "confdefs.h"
 #include <elf.h>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:4324: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:4453: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -4358,7 +4472,7 @@ fi
 
 if test "$HAS_ELF" = 1; then
   echo $ac_n "checking for main in -lelf""... $ac_c" 1>&6
-echo "configure:4347: checking for main in -lelf" >&5
+echo "configure:4476: checking for main in -lelf" >&5
 ac_lib_var=`echo elf'_'main | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -4366,14 +4480,14 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lelf  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 4355 "configure"
+#line 4484 "configure"
 #include "confdefs.h"
 
 int main() {
 main()
 ; return 0; }
 EOF
-if { (eval echo configure:4362: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:4491: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -4407,12 +4521,12 @@ for ac_hdr in dirent.h sys/ndir.h sys/di
 do
 ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
 echo $ac_n "checking for $ac_hdr that defines DIR""... $ac_c" 1>&6
-echo "configure:4396: checking for $ac_hdr that defines DIR" >&5
+echo "configure:4525: checking for $ac_hdr that defines DIR" >&5
 if eval "test \"`echo '$''{'ac_cv_header_dirent_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 4401 "configure"
+#line 4530 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #include <$ac_hdr>
@@ -4420,7 +4534,7 @@ int main() {
 DIR *dirp = 0;
 ; return 0; }
 EOF
-if { (eval echo configure:4409: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:4538: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   eval "ac_cv_header_dirent_$ac_safe=yes"
 else
@@ -4445,7 +4559,7 @@ done
 # Two versions of opendir et al. are in -ldir and -lx on SCO Xenix.
 if test $ac_header_dirent = dirent.h; then
 echo $ac_n "checking for opendir in -ldir""... $ac_c" 1>&6
-echo "configure:4434: checking for opendir in -ldir" >&5
+echo "configure:4563: checking for opendir in -ldir" >&5
 ac_lib_var=`echo dir'_'opendir | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -4453,7 +4567,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-ldir  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 4442 "configure"
+#line 4571 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -4464,7 +4578,7 @@ int main() {
 opendir()
 ; return 0; }
 EOF
-if { (eval echo configure:4453: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:4582: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -4486,7 +4600,7 @@ fi
 
 else
 echo $ac_n "checking for opendir in -lx""... $ac_c" 1>&6
-echo "configure:4475: checking for opendir in -lx" >&5
+echo "configure:4604: checking for opendir in -lx" >&5
 ac_lib_var=`echo x'_'opendir | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -4494,7 +4608,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lx  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 4483 "configure"
+#line 4612 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -4505,7 +4619,7 @@ int main() {
 opendir()
 ; return 0; }
 EOF
-if { (eval echo configure:4494: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:4623: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -4529,12 +4643,12 @@ fi
 
 
 echo $ac_n "checking for ANSI C header files""... $ac_c" 1>&6
-echo "configure:4518: checking for ANSI C header files" >&5
+echo "configure:4647: checking for ANSI C header files" >&5
 if eval "test \"`echo '$''{'ac_cv_header_stdc'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 4523 "configure"
+#line 4652 "configure"
 #include "confdefs.h"
 #include <stdlib.h>
 #include <stdarg.h>
@@ -4542,7 +4656,7 @@ else
 #include <float.h>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:4531: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:4660: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -4559,7 +4673,7 @@ rm -f conftest*
 if test $ac_cv_header_stdc = yes; then
   # SunOS 4.x string.h does not declare mem*, contrary to ANSI.
 cat > conftest.$ac_ext <<EOF
-#line 4548 "configure"
+#line 4677 "configure"
 #include "confdefs.h"
 #include <string.h>
 EOF
@@ -4577,7 +4691,7 @@ fi
 if test $ac_cv_header_stdc = yes; then
   # ISC 2.0.2 stdlib.h does not declare free, contrary to ANSI.
 cat > conftest.$ac_ext <<EOF
-#line 4566 "configure"
+#line 4695 "configure"
 #include "confdefs.h"
 #include <stdlib.h>
 EOF
@@ -4598,7 +4712,7 @@ if test "$cross_compiling" = yes; then
   :
 else
   cat > conftest.$ac_ext <<EOF
-#line 4587 "configure"
+#line 4716 "configure"
 #include "confdefs.h"
 #include <ctype.h>
 #define ISLOWER(c) ('a' <= (c) && (c) <= 'z')
@@ -4609,7 +4723,7 @@ if (XOR (islower (i), ISLOWER (i)) || to
 exit (0); }
 
 EOF
-if { (eval echo configure:4598: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:4727: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
 then
   :
 else
@@ -4633,12 +4747,12 @@ EOF
 fi
 
 echo $ac_n "checking for sys/wait.h that is POSIX.1 compatible""... $ac_c" 1>&6
-echo "configure:4622: checking for sys/wait.h that is POSIX.1 compatible" >&5
+echo "configure:4751: checking for sys/wait.h that is POSIX.1 compatible" >&5
 if eval "test \"`echo '$''{'ac_cv_header_sys_wait_h'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 4627 "configure"
+#line 4756 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #include <sys/wait.h>
@@ -4654,7 +4768,7 @@ wait (&s);
 s = WIFEXITED (s) ? WEXITSTATUS (s) : 1;
 ; return 0; }
 EOF
-if { (eval echo configure:4643: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:4772: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   ac_cv_header_sys_wait_h=yes
 else
@@ -4677,16 +4791,16 @@ fi
 
 if test $ac_cv_header_sys_wait_h = no; then
   echo $ac_n "checking for sys/wait.h that defines union wait""... $ac_c" 1>&6
-echo "configure:4666: checking for sys/wait.h that defines union wait" >&5
+echo "configure:4795: checking for sys/wait.h that defines union wait" >&5
   cat > conftest.$ac_ext <<EOF
-#line 4668 "configure"
+#line 4797 "configure"
 #include "confdefs.h"
 #include <sys/wait.h>
 int main() {
 union wait xx, yy; xx = yy
 ; return 0; }
 EOF
-if { (eval echo configure:4675: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:4804: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   echo "$ac_t""yes" 1>&6
 			cat >> confdefs.h <<\EOF
@@ -4717,17 +4831,17 @@ for ac_hdr in stdarg.h stdlib.h string.h
 do
 ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
 echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
-echo "configure:4706: checking for $ac_hdr" >&5
+echo "configure:4835: checking for $ac_hdr" >&5
 if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 4711 "configure"
+#line 4840 "configure"
 #include "confdefs.h"
 #include <$ac_hdr>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:4716: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:4845: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -4755,11 +4869,11 @@ done
 
 
 echo $ac_n "checking if strings.h can be included after string.h""... $ac_c" 1>&6
-echo "configure:4744: checking if strings.h can be included after string.h" >&5
+echo "configure:4873: checking if strings.h can be included after string.h" >&5
 cppflags_save=$CPPFLAGS
 CPPFLAGS="$CPPFLAGS $X_CFLAGS"
 cat > conftest.$ac_ext <<EOF
-#line 4748 "configure"
+#line 4877 "configure"
 #include "confdefs.h"
 
 #if defined(_AIX) && !defined(_NO_PROTO)
@@ -4779,7 +4893,7 @@ int main() {
 int i; i = 0;
 ; return 0; }
 EOF
-if { (eval echo configure:4768: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:4897: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   echo "$ac_t""yes" 1>&6
 else
@@ -4797,13 +4911,13 @@ CPPFLAGS=$cppflags_save
 
 if test $ac_cv_prog_gcc = yes; then
     echo $ac_n "checking whether ${CC-cc} needs -traditional""... $ac_c" 1>&6
-echo "configure:4786: checking whether ${CC-cc} needs -traditional" >&5
+echo "configure:4915: checking whether ${CC-cc} needs -traditional" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_gcc_traditional'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
     ac_pattern="Autoconf.*'x'"
   cat > conftest.$ac_ext <<EOF
-#line 4792 "configure"
+#line 4921 "configure"
 #include "confdefs.h"
 #include <sgtty.h>
 Autoconf TIOCGETP
@@ -4821,7 +4935,7 @@ rm -f conftest*
 
   if test $ac_cv_prog_gcc_traditional = no; then
     cat > conftest.$ac_ext <<EOF
-#line 4810 "configure"
+#line 4939 "configure"
 #include "confdefs.h"
 #include <termio.h>
 Autoconf TCGETA
@@ -4843,12 +4957,12 @@ echo "$ac_t""$ac_cv_prog_gcc_traditional
 fi
 
 echo $ac_n "checking for working const""... $ac_c" 1>&6
-echo "configure:4832: checking for working const" >&5
+echo "configure:4961: checking for working const" >&5
 if eval "test \"`echo '$''{'ac_cv_c_const'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 4837 "configure"
+#line 4966 "configure"
 #include "confdefs.h"
 
 int main() {
@@ -4897,7 +5011,7 @@ ccp = (char const *const *) p;
 
 ; return 0; }
 EOF
-if { (eval echo configure:4886: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:5015: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   ac_cv_c_const=yes
 else
@@ -4918,12 +5032,12 @@ EOF
 fi
 
 echo $ac_n "checking for mode_t""... $ac_c" 1>&6
-echo "configure:4907: checking for mode_t" >&5
+echo "configure:5036: checking for mode_t" >&5
 if eval "test \"`echo '$''{'ac_cv_type_mode_t'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 4912 "configure"
+#line 5041 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #if STDC_HEADERS
@@ -4951,12 +5065,12 @@ EOF
 fi
 
 echo $ac_n "checking for off_t""... $ac_c" 1>&6
-echo "configure:4940: checking for off_t" >&5
+echo "configure:5069: checking for off_t" >&5
 if eval "test \"`echo '$''{'ac_cv_type_off_t'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 4945 "configure"
+#line 5074 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #if STDC_HEADERS
@@ -4984,12 +5098,12 @@ EOF
 fi
 
 echo $ac_n "checking for pid_t""... $ac_c" 1>&6
-echo "configure:4973: checking for pid_t" >&5
+echo "configure:5102: checking for pid_t" >&5
 if eval "test \"`echo '$''{'ac_cv_type_pid_t'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 4978 "configure"
+#line 5107 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #if STDC_HEADERS
@@ -5017,12 +5131,12 @@ EOF
 fi
 
 echo $ac_n "checking for size_t""... $ac_c" 1>&6
-echo "configure:5006: checking for size_t" >&5
+echo "configure:5135: checking for size_t" >&5
 if eval "test \"`echo '$''{'ac_cv_type_size_t'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 5011 "configure"
+#line 5140 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #if STDC_HEADERS
@@ -5050,12 +5164,12 @@ EOF
 fi
 
 echo $ac_n "checking for uid_t in sys/types.h""... $ac_c" 1>&6
-echo "configure:5039: checking for uid_t in sys/types.h" >&5
+echo "configure:5168: checking for uid_t in sys/types.h" >&5
 if eval "test \"`echo '$''{'ac_cv_type_uid_t'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 5044 "configure"
+#line 5173 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 EOF
@@ -5084,12 +5198,12 @@ EOF
 fi
 
 echo $ac_n "checking whether time.h and sys/time.h may both be included""... $ac_c" 1>&6
-echo "configure:5073: checking whether time.h and sys/time.h may both be included" >&5
+echo "configure:5202: checking whether time.h and sys/time.h may both be included" >&5
 if eval "test \"`echo '$''{'ac_cv_header_time'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 5078 "configure"
+#line 5207 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #include <sys/time.h>
@@ -5098,7 +5212,7 @@ int main() {
 struct tm *tp;
 ; return 0; }
 EOF
-if { (eval echo configure:5087: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:5216: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   ac_cv_header_time=yes
 else
@@ -5119,12 +5233,12 @@ EOF
 fi
 
 echo $ac_n "checking for ino_t""... $ac_c" 1>&6
-echo "configure:5108: checking for ino_t" >&5
+echo "configure:5237: checking for ino_t" >&5
 if eval "test \"`echo '$''{'ac_cv_type_ino_t'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 5113 "configure"
+#line 5242 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #if STDC_HEADERS
@@ -5152,12 +5266,12 @@ EOF
 fi
 
 echo $ac_n "checking for dev_t""... $ac_c" 1>&6
-echo "configure:5141: checking for dev_t" >&5
+echo "configure:5270: checking for dev_t" >&5
 if eval "test \"`echo '$''{'ac_cv_type_dev_t'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 5146 "configure"
+#line 5275 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #if STDC_HEADERS
@@ -5186,12 +5300,12 @@ fi
 
 
 echo $ac_n "checking for rlim_t""... $ac_c" 1>&6
-echo "configure:5175: checking for rlim_t" >&5
+echo "configure:5304: checking for rlim_t" >&5
 if eval "test \"`echo '$''{'ac_cv_type_rlim_t'+set}'`\" = set"; then
   echo "$ac_t""(cached) $ac_cv_type_rlim_t" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 5180 "configure"
+#line 5309 "configure"
 #include "confdefs.h"
 
 #include <sys/types.h>
@@ -5223,12 +5337,12 @@ EOF
 fi
 
 echo $ac_n "checking for stack_t""... $ac_c" 1>&6
-echo "configure:5212: checking for stack_t" >&5
+echo "configure:5341: checking for stack_t" >&5
 if eval "test \"`echo '$''{'ac_cv_type_stack_t'+set}'`\" = set"; then
   echo "$ac_t""(cached) $ac_cv_type_stack_t" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 5217 "configure"
+#line 5346 "configure"
 #include "confdefs.h"
 
 #include <sys/types.h>
@@ -5258,9 +5372,9 @@ EOF
 fi
 
 echo $ac_n "checking whether stack_t has an ss_base field""... $ac_c" 1>&6
-echo "configure:5255: checking whether stack_t has an ss_base field" >&5
+echo "configure:5376: checking whether stack_t has an ss_base field" >&5
 cat > conftest.$ac_ext <<EOF
-#line 5257 "configure"
+#line 5378 "configure"
 #include "confdefs.h"
 
 #include <sys/types.h>
@@ -5275,7 +5389,7 @@ int main() {
 stack_t sigstk; sigstk.ss_base = 0; 
 ; return 0; }
 EOF
-if { (eval echo configure:5272: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:5393: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   echo "$ac_t""yes" 1>&6; cat >> confdefs.h <<\EOF
 #define HAVE_SS_BASE 1
@@ -5291,7 +5405,7 @@ rm -f conftest*
 
 olibs="$LIBS"
 echo $ac_n "checking --with-tlib argument""... $ac_c" 1>&6
-echo "configure:5288: checking --with-tlib argument" >&5
+echo "configure:5409: checking --with-tlib argument" >&5
 # Check whether --with-tlib or --without-tlib was given.
 if test "${with_tlib+set}" = set; then
   withval="$with_tlib"
@@ -5309,7 +5423,7 @@ else
   esac
   for libname in $tlibs; do
     echo $ac_n "checking for tgetent in -l${libname}""... $ac_c" 1>&6
-echo "configure:5266: checking for tgetent in -l${libname}" >&5
+echo "configure:5427: checking for tgetent in -l${libname}" >&5
 ac_lib_var=`echo ${libname}'_'tgetent | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -5317,7 +5431,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-l${libname}  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 5274 "configure"
+#line 5435 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -5328,7 +5442,7 @@ int main() {
 tgetent()
 ; return 0; }
 EOF
-if { (eval echo configure:5285: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:5446: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -5360,7 +5474,7 @@ fi
   res="FAIL"
 else
   cat > conftest.$ac_ext <<EOF
-#line 5317 "configure"
+#line 5478 "configure"
 #include "confdefs.h"
 
 #ifdef HAVE_TERMCAP_H
@@ -5368,7 +5482,7 @@ else
 #endif
 main() {char *s; s=(char *)tgoto("%p1%d", 0, 1); exit(0); }
 EOF
-if { (eval echo configure:5325: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:5486: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
 then
   res="OK"
 else
@@ -5390,12 +5504,12 @@ fi
 fi
 if test "x$olibs" != "x$LIBS"; then
   echo $ac_n "checking whether we talk terminfo""... $ac_c" 1>&6
-echo "configure:5347: checking whether we talk terminfo" >&5
+echo "configure:5508: checking whether we talk terminfo" >&5
   if test "$cross_compiling" = yes; then
   { echo "configure: error: failed to compile test program." 1>&2; exit 1; }
 else
   cat > conftest.$ac_ext <<EOF
-#line 5352 "configure"
+#line 5513 "configure"
 #include "confdefs.h"
 
 #ifdef HAVE_TERMCAP_H
@@ -5404,7 +5518,7 @@ else
 main()
 {char *s; s=(char *)tgoto("%p1%d", 0, 1); exit(!strcmp(s==0 ? "" : s, "1")); }
 EOF
-if { (eval echo configure:5361: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:5522: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
 then
   echo "$ac_t""no -- we are in termcap land" 1>&6
 else
@@ -5424,9 +5538,9 @@ else
 fi
 
 echo $ac_n "checking whether termcap.h contains ospeed""... $ac_c" 1>&6
-echo "configure:5381: checking whether termcap.h contains ospeed" >&5
+echo "configure:5542: checking whether termcap.h contains ospeed" >&5
 cat > conftest.$ac_ext <<EOF
-#line 5383 "configure"
+#line 5544 "configure"
 #include "confdefs.h"
 
 #ifdef HAVE_TERMCAP_H
@@ -5437,7 +5551,7 @@ int main() {
 ospeed = 20000
 ; return 0; }
 EOF
-if { (eval echo configure:5394: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:5555: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   echo "$ac_t""yes" 1>&6; cat >> confdefs.h <<\EOF
 #define HAVE_OSPEED 1
@@ -5449,9 +5563,9 @@ else
   rm -rf conftest*
   echo "$ac_t""no" 1>&6
 	echo $ac_n "checking whether ospeed can be extern""... $ac_c" 1>&6
-echo "configure:5406: checking whether ospeed can be extern" >&5
+echo "configure:5567: checking whether ospeed can be extern" >&5
 	cat > conftest.$ac_ext <<EOF
-#line 5408 "configure"
+#line 5569 "configure"
 #include "confdefs.h"
 
 #ifdef HAVE_TERMCAP_H
@@ -5463,7 +5577,7 @@ int main() {
 ospeed = 20000
 ; return 0; }
 EOF
-if { (eval echo configure:5420: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:5581: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   echo "$ac_t""yes" 1>&6; cat >> confdefs.h <<\EOF
 #define OSPEED_EXTERN 1
@@ -5481,9 +5595,9 @@ fi
 rm -f conftest*
 
 echo $ac_n "checking whether termcap.h contains UP, BC and PC""... $ac_c" 1>&6
-echo "configure:5438: checking whether termcap.h contains UP, BC and PC" >&5
+echo "configure:5599: checking whether termcap.h contains UP, BC and PC" >&5
 cat > conftest.$ac_ext <<EOF
-#line 5440 "configure"
+#line 5601 "configure"
 #include "confdefs.h"
 
 #ifdef HAVE_TERMCAP_H
@@ -5494,7 +5608,7 @@ int main() {
 if (UP == 0 && BC == 0) PC = 1
 ; return 0; }
 EOF
-if { (eval echo configure:5451: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:5612: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   echo "$ac_t""yes" 1>&6; cat >> confdefs.h <<\EOF
 #define HAVE_UP_BC_PC 1
@@ -5506,9 +5620,9 @@ else
   rm -rf conftest*
   echo "$ac_t""no" 1>&6
 	echo $ac_n "checking whether UP, BC and PC can be extern""... $ac_c" 1>&6
-echo "configure:5463: checking whether UP, BC and PC can be extern" >&5
+echo "configure:5624: checking whether UP, BC and PC can be extern" >&5
 	cat > conftest.$ac_ext <<EOF
-#line 5465 "configure"
+#line 5626 "configure"
 #include "confdefs.h"
 
 #ifdef HAVE_TERMCAP_H
@@ -5520,7 +5634,7 @@ int main() {
 if (UP == 0 && BC == 0) PC = 1
 ; return 0; }
 EOF
-if { (eval echo configure:5477: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:5638: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   echo "$ac_t""yes" 1>&6; cat >> confdefs.h <<\EOF
 #define UP_BC_PC_EXTERN 1
@@ -5538,9 +5652,9 @@ fi
 rm -f conftest*
 
 echo $ac_n "checking whether tputs() uses outfuntype""... $ac_c" 1>&6
-echo "configure:5495: checking whether tputs() uses outfuntype" >&5
+echo "configure:5656: checking whether tputs() uses outfuntype" >&5
 cat > conftest.$ac_ext <<EOF
-#line 5497 "configure"
+#line 5658 "configure"
 #include "confdefs.h"
 
 #ifdef HAVE_TERMCAP_H
@@ -5551,7 +5665,7 @@ int main() {
 extern int xx(); tputs("test", 1, (outfuntype)xx)
 ; return 0; }
 EOF
-if { (eval echo configure:5508: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:5669: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   echo "$ac_t""yes" 1>&6; cat >> confdefs.h <<\EOF
 #define HAVE_OUTFUNTYPE 1
@@ -5566,9 +5680,9 @@ fi
 rm -f conftest*
 
 echo $ac_n "checking whether sys/select.h and sys/time.h may both be included""... $ac_c" 1>&6
-echo "configure:5523: checking whether sys/select.h and sys/time.h may both be included" >&5
+echo "configure:5684: checking whether sys/select.h and sys/time.h may both be included" >&5
 cat > conftest.$ac_ext <<EOF
-#line 5525 "configure"
+#line 5686 "configure"
 #include "confdefs.h"
 
 #include <sys/types.h>
@@ -5578,7 +5692,7 @@ int main() {
 
 ; return 0; }
 EOF
-if { (eval echo configure:5535: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:5696: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   echo "$ac_t""yes" 1>&6
 			cat >> confdefs.h <<\EOF
@@ -5595,7 +5709,7 @@ rm -f conftest*
 
 
 echo $ac_n "checking for /dev/ptc""... $ac_c" 1>&6
-echo "configure:5552: checking for /dev/ptc" >&5
+echo "configure:5713: checking for /dev/ptc" >&5
 if test -r /dev/ptc; then
   cat >> confdefs.h <<\EOF
 #define HAVE_DEV_PTC 1
@@ -5607,17 +5721,17 @@ else
 fi
 
 echo $ac_n "checking for SVR4 ptys""... $ac_c" 1>&6
-echo "configure:5564: checking for SVR4 ptys" >&5
+echo "configure:5725: checking for SVR4 ptys" >&5
 if test -c /dev/ptmx ; then
   cat > conftest.$ac_ext <<EOF
-#line 5567 "configure"
+#line 5728 "configure"
 #include "confdefs.h"
 
 int main() {
 ptsname(0);grantpt(0);unlockpt(0);
 ; return 0; }
 EOF
-if { (eval echo configure:5574: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:5735: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   echo "$ac_t""yes" 1>&6; cat >> confdefs.h <<\EOF
 #define HAVE_SVR4_PTYS 1
@@ -5635,14 +5749,14 @@ else
 fi
 
 echo $ac_n "checking for ptyranges""... $ac_c" 1>&6
-echo "configure:5592: checking for ptyranges" >&5
+echo "configure:5753: checking for ptyranges" >&5
 if test -d /dev/ptym ; then
   pdir='/dev/ptym'
 else
   pdir='/dev'
 fi
 cat > conftest.$ac_ext <<EOF
-#line 5599 "configure"
+#line 5760 "configure"
 #include "confdefs.h"
 #ifdef M_UNIX
    yes;
@@ -5676,13 +5790,13 @@ else
 fi
 
 echo $ac_n "checking default tty permissions/group""... $ac_c" 1>&6
-echo "configure:5633: checking default tty permissions/group" >&5
+echo "configure:5794: checking default tty permissions/group" >&5
 rm -f conftest_grp
 if test "$cross_compiling" = yes; then
   { echo "configure: error: failed to compile test program" 1>&2; exit 1; }
 else
   cat > conftest.$ac_ext <<EOF
-#line 5639 "configure"
+#line 5800 "configure"
 #include "confdefs.h"
 
 #include <sys/types.h>
@@ -5714,7 +5828,7 @@ main()
 }
 
 EOF
-if { (eval echo configure:5671: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:5832: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
 then
   
     if test -f conftest_grp; then
@@ -5745,12 +5859,12 @@ rm -f conftest_grp
 
 
 echo $ac_n "checking return type of signal handlers""... $ac_c" 1>&6
-echo "configure:5702: checking return type of signal handlers" >&5
+echo "configure:5863: checking return type of signal handlers" >&5
 if eval "test \"`echo '$''{'ac_cv_type_signal'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 5707 "configure"
+#line 5868 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #include <signal.h>
@@ -5767,7 +5881,7 @@ int main() {
 int i;
 ; return 0; }
 EOF
-if { (eval echo configure:5724: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:5885: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   ac_cv_type_signal=void
 else
@@ -5799,9 +5913,9 @@ EOF
 fi
 
 echo $ac_n "checking for struct sigcontext""... $ac_c" 1>&6
-echo "configure:5756: checking for struct sigcontext" >&5
+echo "configure:5917: checking for struct sigcontext" >&5
 cat > conftest.$ac_ext <<EOF
-#line 5758 "configure"
+#line 5919 "configure"
 #include "confdefs.h"
 
 #include <signal.h>
@@ -5815,7 +5929,7 @@ int main() {
 
 ; return 0; }
 EOF
-if { (eval echo configure:5772: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:5933: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   echo "$ac_t""yes" 1>&6
 		cat >> confdefs.h <<\EOF
@@ -5831,12 +5945,12 @@ fi
 rm -f conftest*
 
 echo $ac_n "checking getcwd implementation""... $ac_c" 1>&6
-echo "configure:5788: checking getcwd implementation" >&5
+echo "configure:5949: checking getcwd implementation" >&5
 if test "$cross_compiling" = yes; then
   { echo "configure: error: failed to compile test program" 1>&2; exit 1; }
 else
   cat > conftest.$ac_ext <<EOF
-#line 5793 "configure"
+#line 5954 "configure"
 #include "confdefs.h"
 
 char *dagger[] = { "IFS=pwd", 0 };
@@ -5848,7 +5962,7 @@ main()
   return getcwd(buffer, 500) ? 0 : 1;
 }
 EOF
-if { (eval echo configure:5805: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:5966: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
 then
   echo "$ac_t""it is usable" 1>&6
 else
@@ -5873,12 +5987,12 @@ for ac_func in bcmp fchdir fchown fseeko
 	strpbrk strtol tgetent towlower towupper usleep utime utimes
 do
 echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
-echo "configure:5875: checking for $ac_func" >&5
+echo "configure:5991: checking for $ac_func" >&5
 if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 5880 "configure"
+#line 5996 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char $ac_func(); below.  */
@@ -5901,7 +6015,7 @@ $ac_func();
 
 ; return 0; }
 EOF
-if { (eval echo configure:5858: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:6019: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=yes"
 else
@@ -5927,9 +6041,9 @@ done
 
 
 echo $ac_n "checking for st_blksize""... $ac_c" 1>&6
-echo "configure:5884: checking for st_blksize" >&5
+echo "configure:6045: checking for st_blksize" >&5
 cat > conftest.$ac_ext <<EOF
-#line 5886 "configure"
+#line 6047 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #include <sys/stat.h>
@@ -5941,7 +6055,7 @@ int main() {
 	n = (int)st.st_blksize;
 ; return 0; }
 EOF
-if { (eval echo configure:5898: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:6059: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   echo "$ac_t""yes" 1>&6; cat >> confdefs.h <<\EOF
 #define HAVE_ST_BLKSIZE 1
@@ -5956,18 +6070,18 @@ fi
 rm -f conftest*
 
 echo $ac_n "checking whether stat() ignores a trailing slash""... $ac_c" 1>&6
-echo "configure:5958: checking whether stat() ignores a trailing slash" >&5
+echo "configure:6074: checking whether stat() ignores a trailing slash" >&5
 if test "$cross_compiling" = yes; then
   { echo "configure: error: failed to compile test program" 1>&2; exit 1; }
 else
   cat > conftest.$ac_ext <<EOF
-#line 5963 "configure"
+#line 6079 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #include <sys/stat.h>
 main() {struct stat st;  exit(stat("configure/", &st) != 0); }
 EOF
-if { (eval echo configure:5969: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:6085: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
 then
   echo "$ac_t""yes" 1>&6; cat >> confdefs.h <<\EOF
 #define STAT_IGNORES_SLASH 1
@@ -5984,11 +6098,11 @@ fi
 
 
 echo $ac_n "checking for iconv_open()""... $ac_c" 1>&6
-echo "configure:5986: checking for iconv_open()" >&5
+echo "configure:6102: checking for iconv_open()" >&5
 save_LIBS="$LIBS"
 LIBS="$LIBS -liconv"
 cat > conftest.$ac_ext <<EOF
-#line 5990 "configure"
+#line 6106 "configure"
 #include "confdefs.h"
 
 #ifdef HAVE_ICONV_H
@@ -5999,7 +6113,7 @@ int main() {
 iconv_open("fr", "to");
 ; return 0; }
 EOF
-if { (eval echo configure:5928: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:6117: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   echo "$ac_t""yes; with -liconv" 1>&6; cat >> confdefs.h <<\EOF
 #define HAVE_ICONV 1
@@ -6011,7 +6125,7 @@ else
   rm -rf conftest*
   LIBS="$save_LIBS"
     cat > conftest.$ac_ext <<EOF
-#line 5940 "configure"
+#line 6129 "configure"
 #include "confdefs.h"
 
 #ifdef HAVE_ICONV_H
@@ -6022,7 +6136,7 @@ int main() {
 iconv_open("fr", "to");
 ; return 0; }
 EOF
-if { (eval echo configure:5951: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:6140: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   echo "$ac_t""yes" 1>&6; cat >> confdefs.h <<\EOF
 #define HAVE_ICONV 1
@@ -6040,9 +6154,9 @@ rm -f conftest*
 
 
 echo $ac_n "checking for nl_langinfo(CODESET)""... $ac_c" 1>&6
-echo "configure:5969: checking for nl_langinfo(CODESET)" >&5
+echo "configure:6158: checking for nl_langinfo(CODESET)" >&5
 cat > conftest.$ac_ext <<EOF
-#line 5971 "configure"
+#line 6160 "configure"
 #include "confdefs.h"
 
 #ifdef HAVE_LANGINFO_H
@@ -6053,7 +6167,7 @@ int main() {
 char *cs = nl_langinfo(CODESET);
 ; return 0; }
 EOF
-if { (eval echo configure:5982: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:6171: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   echo "$ac_t""yes" 1>&6; cat >> confdefs.h <<\EOF
 #define HAVE_NL_LANGINFO_CODESET 1
@@ -6068,7 +6182,7 @@ fi
 rm -f conftest*
 
 echo $ac_n "checking --disable-acl argument""... $ac_c" 1>&6
-echo "configure:6072: checking --disable-acl argument" >&5
+echo "configure:6186: checking --disable-acl argument" >&5
 # Check whether --enable-acl or --disable-acl was given.
 if test "${enable_acl+set}" = set; then
   enableval="$enable_acl"
@@ -6080,7 +6194,7 @@ fi
 if test "$enable_acl" = "yes"; then
 
 echo $ac_n "checking for acl_get_file in -lposix1e""... $ac_c" 1>&6
-echo "configure:6084: checking for acl_get_file in -lposix1e" >&5
+echo "configure:6198: checking for acl_get_file in -lposix1e" >&5
 ac_lib_var=`echo posix1e'_'acl_get_file | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -6088,7 +6202,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lposix1e  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 6005 "configure"
+#line 6206 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -6099,7 +6213,7 @@ int main() {
 acl_get_file()
 ; return 0; }
 EOF
-if { (eval echo configure:6016: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:6217: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -6118,7 +6232,7 @@ if eval "test \"`echo '$ac_cv_lib_'$ac_l
 else
   echo "$ac_t""no" 1>&6
 echo $ac_n "checking for acl_get_file in -lacl""... $ac_c" 1>&6
-echo "configure:6035: checking for acl_get_file in -lacl" >&5
+echo "configure:6236: checking for acl_get_file in -lacl" >&5
 ac_lib_var=`echo acl'_'acl_get_file | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -6126,7 +6240,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lacl  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 6043 "configure"
+#line 6244 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -6137,7 +6251,7 @@ int main() {
 acl_get_file()
 ; return 0; }
 EOF
-if { (eval echo configure:6054: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:6255: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -6154,7 +6268,7 @@ if eval "test \"`echo '$ac_cv_lib_'$ac_l
   echo "$ac_t""yes" 1>&6
   LIBS="$LIBS -lacl"
 		  echo $ac_n "checking for fgetxattr in -lattr""... $ac_c" 1>&6
-echo "configure:6071: checking for fgetxattr in -lattr" >&5
+echo "configure:6272: checking for fgetxattr in -lattr" >&5
 ac_lib_var=`echo attr'_'fgetxattr | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -6162,7 +6276,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lattr  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 6079 "configure"
+#line 6280 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -6173,7 +6287,7 @@ int main() {
 fgetxattr()
 ; return 0; }
 EOF
-if { (eval echo configure:6090: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:6291: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -6201,9 +6315,9 @@ fi
 
 
 echo $ac_n "checking for POSIX ACL support""... $ac_c" 1>&6
-echo "configure:6078: checking for POSIX ACL support" >&5
+echo "configure:6319: checking for POSIX ACL support" >&5
 cat > conftest.$ac_ext <<EOF
-#line 6080 "configure"
+#line 6321 "configure"
 #include "confdefs.h"
 
 #include <sys/types.h>
@@ -6217,7 +6331,7 @@ acl = acl_get_file("foo", ACL_TYPE_ACCES
 	acl_free(acl);
 ; return 0; }
 EOF
-if { (eval echo configure:6094: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:6335: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   echo "$ac_t""yes" 1>&6; cat >> confdefs.h <<\EOF
 #define HAVE_POSIX_ACL 1
@@ -6232,9 +6346,9 @@ fi
 rm -f conftest*
 
 echo $ac_n "checking for Solaris ACL support""... $ac_c" 1>&6
-echo "configure:6109: checking for Solaris ACL support" >&5
+echo "configure:6350: checking for Solaris ACL support" >&5
 cat > conftest.$ac_ext <<EOF
-#line 6111 "configure"
+#line 6352 "configure"
 #include "confdefs.h"
 
 #ifdef HAVE_SYS_ACL_H
@@ -6245,7 +6359,7 @@ acl("foo", GETACLCNT, 0, NULL);
 	
 ; return 0; }
 EOF
-if { (eval echo configure:6122: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:6363: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   echo "$ac_t""yes" 1>&6; cat >> confdefs.h <<\EOF
 #define HAVE_SOLARIS_ACL 1
@@ -6260,9 +6374,9 @@ fi
 rm -f conftest*
 
 echo $ac_n "checking for AIX ACL support""... $ac_c" 1>&6
-echo "configure:6137: checking for AIX ACL support" >&5
+echo "configure:6378: checking for AIX ACL support" >&5
 cat > conftest.$ac_ext <<EOF
-#line 6139 "configure"
+#line 6380 "configure"
 #include "confdefs.h"
 
 #ifdef HAVE_SYS_ACL_H
@@ -6284,7 +6398,7 @@ aclsize = sizeof(struct acl);
 	
 ; return 0; }
 EOF
-if { (eval echo configure:6161: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:6402: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   echo "$ac_t""yes" 1>&6; cat >> confdefs.h <<\EOF
 #define HAVE_AIX_ACL 1
@@ -6300,7 +6414,7 @@ rm -f conftest*
 fi
 
 echo $ac_n "checking --disable-gpm argument""... $ac_c" 1>&6
-echo "configure:6304: checking --disable-gpm argument" >&5
+echo "configure:6418: checking --disable-gpm argument" >&5
 # Check whether --enable-gpm or --disable-gpm was given.
 if test "${enable_gpm+set}" = set; then
   enableval="$enable_gpm"
@@ -6313,13 +6427,13 @@ fi
 if test "$enable_gpm" = "yes"; then
   echo "$ac_t""no" 1>&6
     echo $ac_n "checking for gpm""... $ac_c" 1>&6
-echo "configure:6189: checking for gpm" >&5
+echo "configure:6431: checking for gpm" >&5
 if eval "test \"`echo '$''{'vi_cv_have_gpm'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   olibs="$LIBS" ; LIBS="-lgpm"
 	cat > conftest.$ac_ext <<EOF
-#line 6195 "configure"
+#line 6437 "configure"
 #include "confdefs.h"
 #include <gpm.h>
 	    #include <linux/keyboard.h>
@@ -6327,7 +6441,7 @@ int main() {
 Gpm_GetLibVersion(NULL);
 ; return 0; }
 EOF
-if { (eval echo configure:6203: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:6445: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   	    	    vi_cv_have_gpm=yes
 else
@@ -6354,16 +6468,16 @@ else
 fi
 
 echo $ac_n "checking for rename""... $ac_c" 1>&6
-echo "configure:6230: checking for rename" >&5
+echo "configure:6472: checking for rename" >&5
 cat > conftest.$ac_ext <<EOF
-#line 6232 "configure"
+#line 6474 "configure"
 #include "confdefs.h"
 #include <stdio.h>
 int main() {
 rename("this", "that")
 ; return 0; }
 EOF
-if { (eval echo configure:6239: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:6481: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   echo "$ac_t""yes" 1>&6; cat >> confdefs.h <<\EOF
 #define HAVE_RENAME 1
@@ -6378,9 +6492,9 @@ fi
 rm -f conftest*
 
 echo $ac_n "checking for sysctl""... $ac_c" 1>&6
-echo "configure:6254: checking for sysctl" >&5
+echo "configure:6496: checking for sysctl" >&5
 cat > conftest.$ac_ext <<EOF
-#line 6256 "configure"
+#line 6498 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #include <sys/sysctl.h>
@@ -6395,7 +6509,7 @@ int main() {
 	
 ; return 0; }
 EOF
-if { (eval echo configure:6271: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:6513: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   echo "$ac_t""yes" 1>&6; cat >> confdefs.h <<\EOF
 #define HAVE_SYSCTL 1
@@ -6410,9 +6524,9 @@ fi
 rm -f conftest*
 
 echo $ac_n "checking for sysinfo""... $ac_c" 1>&6
-echo "configure:6286: checking for sysinfo" >&5
+echo "configure:6528: checking for sysinfo" >&5
 cat > conftest.$ac_ext <<EOF
-#line 6288 "configure"
+#line 6530 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #include <sys/sysinfo.h>
@@ -6425,7 +6539,7 @@ int main() {
 	
 ; return 0; }
 EOF
-if { (eval echo configure:6301: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:6543: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   echo "$ac_t""yes" 1>&6; cat >> confdefs.h <<\EOF
 #define HAVE_SYSINFO 1
@@ -6440,9 +6554,9 @@ fi
 rm -f conftest*
 
 echo $ac_n "checking for sysconf""... $ac_c" 1>&6
-echo "configure:6316: checking for sysconf" >&5
+echo "configure:6558: checking for sysconf" >&5
 cat > conftest.$ac_ext <<EOF
-#line 6318 "configure"
+#line 6560 "configure"
 #include "confdefs.h"
 #include <unistd.h>
 int main() {
@@ -6451,7 +6565,7 @@ int main() {
 	
 ; return 0; }
 EOF
-if { (eval echo configure:6327: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:6569: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   echo "$ac_t""yes" 1>&6; cat >> confdefs.h <<\EOF
 #define HAVE_SYSCONF 1
@@ -6467,7 +6581,7 @@ rm -f conftest*
 
 
 echo $ac_n "checking size of int""... $ac_c" 1>&6
-echo "configure:6343: checking size of int" >&5
+echo "configure:6585: checking size of int" >&5
 if eval "test \"`echo '$''{'ac_cv_sizeof_int'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -6475,7 +6589,7 @@ else
   { echo "configure: error: failed to compile test program" 1>&2; exit 1; }
 else
   cat > conftest.$ac_ext <<EOF
-#line 6351 "configure"
+#line 6593 "configure"
 #include "confdefs.h"
 #include <stdio.h>
 		main()
@@ -6486,7 +6600,7 @@ else
 		  exit(0);
 		}
 EOF
-if { (eval echo configure:6362: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:6604: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
 then
   ac_cv_sizeof_int=`cat conftestval`
 else
@@ -6507,7 +6621,7 @@ EOF
 
 
 echo $ac_n "checking whether memmove/bcopy/memcpy handle overlaps""... $ac_c" 1>&6
-echo "configure:6383: checking whether memmove/bcopy/memcpy handle overlaps" >&5
+echo "configure:6625: checking whether memmove/bcopy/memcpy handle overlaps" >&5
 bcopy_test_prog='
 main() {
   char buf[10];
@@ -6527,11 +6641,11 @@ if test "$cross_compiling" = yes; then
   { echo "configure: error: failed to compile test program" 1>&2; exit 1; }
 else
   cat > conftest.$ac_ext <<EOF
-#line 6403 "configure"
+#line 6645 "configure"
 #include "confdefs.h"
 #define mch_memmove(s,d,l) memmove(d,s,l) $bcopy_test_prog
 EOF
-if { (eval echo configure:6407: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:6649: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
 then
   cat >> confdefs.h <<\EOF
 #define USEMEMMOVE 1
@@ -6545,11 +6659,11 @@ else
   { echo "configure: error: failed to compile test program" 1>&2; exit 1; }
 else
   cat > conftest.$ac_ext <<EOF
-#line 6421 "configure"
+#line 6663 "configure"
 #include "confdefs.h"
 #define mch_memmove(s,d,l) bcopy(d,s,l) $bcopy_test_prog
 EOF
-if { (eval echo configure:6425: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:6667: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
 then
   cat >> confdefs.h <<\EOF
 #define USEBCOPY 1
@@ -6563,11 +6677,11 @@ else
   { echo "configure: error: failed to compile test program" 1>&2; exit 1; }
 else
   cat > conftest.$ac_ext <<EOF
-#line 6439 "configure"
+#line 6681 "configure"
 #include "confdefs.h"
 #define mch_memmove(s,d,l) memcpy(d,s,l) $bcopy_test_prog
 EOF
-if { (eval echo configure:6443: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:6685: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
 then
   cat >> confdefs.h <<\EOF
 #define USEMEMCPY 1
@@ -6599,19 +6713,19 @@ if test "$enable_multibyte" = "yes"; the
     CFLAGS="$CFLAGS -I$x_includes"
     LDFLAGS="$X_LIBS $LDFLAGS -lX11"
     echo $ac_n "checking whether X_LOCALE needed""... $ac_c" 1>&6
-echo "configure:6475: checking whether X_LOCALE needed" >&5
+echo "configure:6717: checking whether X_LOCALE needed" >&5
     cat > conftest.$ac_ext <<EOF
-#line 6477 "configure"
+#line 6719 "configure"
 #include "confdefs.h"
 #include <X11/Xlocale.h>
 int main() {
 
 ; return 0; }
 EOF
-if { (eval echo configure:6484: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:6726: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   cat > conftest.$ac_ext <<EOF
-#line 6487 "configure"
+#line 6729 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -6622,7 +6736,7 @@ int main() {
 _Xsetlocale()
 ; return 0; }
 EOF
-if { (eval echo configure:6498: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:6740: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   echo "$ac_t""yes" 1>&6
 		cat >> confdefs.h <<\EOF
@@ -6649,7 +6763,7 @@ rm -f conftest*
 fi
 
 echo $ac_n "checking for _xpg4_setrunelocale in -lxpg4""... $ac_c" 1>&6
-echo "configure:6525: checking for _xpg4_setrunelocale in -lxpg4" >&5
+echo "configure:6767: checking for _xpg4_setrunelocale in -lxpg4" >&5
 ac_lib_var=`echo xpg4'_'_xpg4_setrunelocale | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -6657,7 +6771,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lxpg4  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 6533 "configure"
+#line 6775 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -6668,7 +6782,7 @@ int main() {
 _xpg4_setrunelocale()
 ; return 0; }
 EOF
-if { (eval echo configure:6544: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:6786: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -6690,7 +6804,7 @@ fi
 
 
 echo $ac_n "checking how to create tags""... $ac_c" 1>&6
-echo "configure:6566: checking how to create tags" >&5
+echo "configure:6808: checking how to create tags" >&5
 test -f tags && mv tags tags.save
 if (eval ctags --version /dev/null | grep Exuberant) < /dev/null 1>&5 2>&1; then
   TAGPRG="ctags"
@@ -6707,7 +6821,7 @@ test -f tags.save && mv tags.save tags
 echo "$ac_t""$TAGPRG" 1>&6 
 
 echo $ac_n "checking how to run man with a section nr""... $ac_c" 1>&6
-echo "configure:6583: checking how to run man with a section nr" >&5
+echo "configure:6825: checking how to run man with a section nr" >&5
 MANDEF="man"
 (eval man -s 2 read) < /dev/null > /dev/null 2>&5 && MANDEF="man -s"
 echo "$ac_t""$MANDEF" 1>&6
@@ -6719,7 +6833,7 @@ EOF
 fi
 
 echo $ac_n "checking --disable-nls argument""... $ac_c" 1>&6
-echo "configure:6595: checking --disable-nls argument" >&5
+echo "configure:6837: checking --disable-nls argument" >&5
 # Check whether --enable-nls or --disable-nls was given.
 if test "${enable_nls+set}" = set; then
   enableval="$enable_nls"
@@ -6734,7 +6848,7 @@ if test "$enable_nls" = "yes"; then
   # Extract the first word of "msgfmt", so it can be a program name with args.
 set dummy msgfmt; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:6610: checking for $ac_word" >&5
+echo "configure:6852: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_MSGFMT'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -6761,19 +6875,19 @@ else
 fi
 
   echo $ac_n "checking for NLS""... $ac_c" 1>&6
-echo "configure:6637: checking for NLS" >&5
+echo "configure:6879: checking for NLS" >&5
   if test -d po; then
     have_gettext="no"
     if test -n "$MSGFMT"; then
       cat > conftest.$ac_ext <<EOF
-#line 6642 "configure"
+#line 6884 "configure"
 #include "confdefs.h"
 #include <libintl.h>
 int main() {
 gettext("Test");
 ; return 0; }
 EOF
-if { (eval echo configure:6649: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:6891: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   echo "$ac_t""gettext() works" 1>&6; have_gettext="yes"
 else
@@ -6783,14 +6897,14 @@ else
   olibs=$LIBS
 	  LIBS="$LIBS -lintl"
 	  cat > conftest.$ac_ext <<EOF
-#line 6659 "configure"
+#line 6901 "configure"
 #include "confdefs.h"
 #include <libintl.h>
 int main() {
 gettext("Test");
 ; return 0; }
 EOF
-if { (eval echo configure:6666: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:6908: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   echo "$ac_t""gettext() works with -lintl" 1>&6; have_gettext="yes"
 else
@@ -6816,12 +6930,12 @@ EOF
             for ac_func in bind_textdomain_codeset
 do
 echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
-echo "configure:6692: checking for $ac_func" >&5
+echo "configure:6934: checking for $ac_func" >&5
 if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 6697 "configure"
+#line 6939 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char $ac_func(); below.  */
@@ -6844,7 +6958,7 @@ $ac_func();
 
 ; return 0; }
 EOF
-if { (eval echo configure:6720: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:6962: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=yes"
 else
@@ -6869,9 +6983,9 @@ fi
 done
 
             echo $ac_n "checking for _nl_msg_cat_cntr""... $ac_c" 1>&6
-echo "configure:6745: checking for _nl_msg_cat_cntr" >&5
+echo "configure:6987: checking for _nl_msg_cat_cntr" >&5
       cat > conftest.$ac_ext <<EOF
-#line 6747 "configure"
+#line 6989 "configure"
 #include "confdefs.h"
 #include <libintl.h>
 		extern int _nl_msg_cat_cntr;
@@ -6879,7 +6993,7 @@ int main() {
 ++_nl_msg_cat_cntr;
 ; return 0; }
 EOF
-if { (eval echo configure:6755: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:6997: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   echo "$ac_t""yes" 1>&6; cat >> confdefs.h <<\EOF
 #define HAVE_NL_MSG_CAT_CNTR 1
@@ -6902,17 +7016,17 @@ fi
 
 ac_safe=`echo "dlfcn.h" | sed 'y%./+-%__p_%'`
 echo $ac_n "checking for dlfcn.h""... $ac_c" 1>&6
-echo "configure:6778: checking for dlfcn.h" >&5
+echo "configure:7020: checking for dlfcn.h" >&5
 if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 6783 "configure"
+#line 7025 "configure"
 #include "confdefs.h"
 #include <dlfcn.h>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:6788: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:7030: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -6933,17 +7047,17 @@ else
   echo "$ac_t""no" 1>&6
 ac_safe=`echo "dl.h" | sed 'y%./+-%__p_%'`
 echo $ac_n "checking for dl.h""... $ac_c" 1>&6
-echo "configure:6809: checking for dl.h" >&5
+echo "configure:7051: checking for dl.h" >&5
 if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 6814 "configure"
+#line 7056 "configure"
 #include "confdefs.h"
 #include <dl.h>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:6819: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:7061: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -6972,9 +7086,9 @@ if test x${DLL} = xdlfcn.h; then
 EOF
 
   echo $ac_n "checking for dlopen()""... $ac_c" 1>&6
-echo "configure:6848: checking for dlopen()" >&5
+echo "configure:7090: checking for dlopen()" >&5
   cat > conftest.$ac_ext <<EOF
-#line 6850 "configure"
+#line 7092 "configure"
 #include "confdefs.h"
 
 int main() {
@@ -6984,7 +7098,7 @@ int main() {
       
 ; return 0; }
 EOF
-if { (eval echo configure:6860: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:7102: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   echo "$ac_t""yes" 1>&6;
 	      cat >> confdefs.h <<\EOF
@@ -6997,11 +7111,11 @@ else
   rm -rf conftest*
   echo "$ac_t""no" 1>&6;
 	      echo $ac_n "checking for dlopen() in -ldl""... $ac_c" 1>&6
-echo "configure:6873: checking for dlopen() in -ldl" >&5
+echo "configure:7115: checking for dlopen() in -ldl" >&5
 	      olibs=$LIBS
 	      LIBS="$LIBS -ldl"
 	      cat > conftest.$ac_ext <<EOF
-#line 6877 "configure"
+#line 7119 "configure"
 #include "confdefs.h"
 
 int main() {
@@ -7011,7 +7125,7 @@ int main() {
 		 
 ; return 0; }
 EOF
-if { (eval echo configure:6887: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:7129: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   echo "$ac_t""yes" 1>&6;
 			  cat >> confdefs.h <<\EOF
@@ -7029,9 +7143,9 @@ rm -f conftest*
 fi
 rm -f conftest*
       echo $ac_n "checking for dlsym()""... $ac_c" 1>&6
-echo "configure:6905: checking for dlsym()" >&5
+echo "configure:7147: checking for dlsym()" >&5
   cat > conftest.$ac_ext <<EOF
-#line 6907 "configure"
+#line 7149 "configure"
 #include "confdefs.h"
 
 int main() {
@@ -7041,7 +7155,7 @@ int main() {
       
 ; return 0; }
 EOF
-if { (eval echo configure:6917: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:7159: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   echo "$ac_t""yes" 1>&6;
 	      cat >> confdefs.h <<\EOF
@@ -7054,11 +7168,11 @@ else
   rm -rf conftest*
   echo "$ac_t""no" 1>&6;
 	      echo $ac_n "checking for dlsym() in -ldl""... $ac_c" 1>&6
-echo "configure:6930: checking for dlsym() in -ldl" >&5
+echo "configure:7172: checking for dlsym() in -ldl" >&5
 	      olibs=$LIBS
 	      LIBS="$LIBS -ldl"
 	      cat > conftest.$ac_ext <<EOF
-#line 6934 "configure"
+#line 7176 "configure"
 #include "confdefs.h"
 
 int main() {
@@ -7068,7 +7182,7 @@ int main() {
 		 
 ; return 0; }
 EOF
-if { (eval echo configure:6944: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:7186: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   echo "$ac_t""yes" 1>&6;
 			  cat >> confdefs.h <<\EOF
@@ -7091,9 +7205,9 @@ elif test x${DLL} = xdl.h; then
 EOF
 
   echo $ac_n "checking for shl_load()""... $ac_c" 1>&6
-echo "configure:6967: checking for shl_load()" >&5
+echo "configure:7209: checking for shl_load()" >&5
   cat > conftest.$ac_ext <<EOF
-#line 6969 "configure"
+#line 7211 "configure"
 #include "confdefs.h"
 
 int main() {
@@ -7103,7 +7217,7 @@ int main() {
      
 ; return 0; }
 EOF
-if { (eval echo configure:6979: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:7221: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   echo "$ac_t""yes" 1>&6;
 	  cat >> confdefs.h <<\EOF
@@ -7116,11 +7230,11 @@ else
   rm -rf conftest*
   echo "$ac_t""no" 1>&6;
 	  echo $ac_n "checking for shl_load() in -ldld""... $ac_c" 1>&6
-echo "configure:6992: checking for shl_load() in -ldld" >&5
+echo "configure:7234: checking for shl_load() in -ldld" >&5
 	  olibs=$LIBS
 	  LIBS="$LIBS -ldld"
 	  cat > conftest.$ac_ext <<EOF
-#line 6996 "configure"
+#line 7238 "configure"
 #include "confdefs.h"
 
 int main() {
@@ -7130,7 +7244,7 @@ int main() {
 	     
 ; return 0; }
 EOF
-if { (eval echo configure:7006: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:7248: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   echo "$ac_t""yes" 1>&6;
 		  cat >> confdefs.h <<\EOF
@@ -7152,17 +7266,17 @@ for ac_hdr in setjmp.h
 do
 ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
 echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
-echo "configure:7028: checking for $ac_hdr" >&5
+echo "configure:7270: checking for $ac_hdr" >&5
 if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 7033 "configure"
+#line 7275 "configure"
 #include "confdefs.h"
 #include <$ac_hdr>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:7038: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:7280: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -7269,7 +7383,7 @@ cat > $CONFIG_STATUS <<EOF
 # $0 $ac_configure_args
 #
 # Compiler output produced by configure, useful for debugging
-# configure, is in auto/config.log if it exists.
+# configure, is in ./config.log if it exists.
 
 ac_cs_usage="Usage: $CONFIG_STATUS [--recheck] [--version] [--help]"
 for ac_option
@@ -7376,6 +7490,7 @@ s%@X_EXTRA_LIBS@%$X_EXTRA_LIBS%g
 s%@X_LIB@%$X_LIB%g
 s%@GTK_CONFIG@%$GTK_CONFIG%g
 s%@GTK12_CONFIG@%$GTK12_CONFIG%g
+s%@PKG_CONFIG@%$PKG_CONFIG%g
 s%@GTK_CFLAGS@%$GTK_CFLAGS%g
 s%@GTK_LIBS@%$GTK_LIBS%g
 s%@GTK_LIBNAME@%$GTK_LIBNAME%g
Index: src/proto/gui_gtk.pro
===================================================================
RCS file: /cvsroot/vim/vim/src/proto/gui_gtk.pro,v
retrieving revision 1.8
diff -u -3 -p -r1.8 gui_gtk.pro
--- src/proto/gui_gtk.pro	30 Apr 2001 08:48:04 -0000	1.8
+++ src/proto/gui_gtk.pro	6 Feb 2003 17:52:46 -0000
@@ -1,9 +1,11 @@
 /* gui_gtk.c */
+void gui_gtk_register_stock_icons __ARGS((void));
 void gui_mch_add_menu __ARGS((vimmenu_T *menu, int idx));
 void gui_mch_add_menu_item __ARGS((vimmenu_T *menu, int idx));
 void gui_mch_set_text_area_pos __ARGS((int x, int y, int w, int h));
 void gui_gtk_set_mnemonics __ARGS((int enable));
 void gui_mch_toggle_tearoffs __ARGS((int enable));
+void gui_mch_menu_set_tip __ARGS((vimmenu_T *menu));
 void gui_mch_destroy_menu __ARGS((vimmenu_T *menu));
 void gui_mch_set_scrollbar_thumb __ARGS((scrollbar_T *sb, long val, long size, long max));
 void gui_mch_set_scrollbar_pos __ARGS((scrollbar_T *sb, int x, int y, int w, int h));
Index: src/proto/gui_gtk_x11.pro
===================================================================
RCS file: /cvsroot/vim/vim/src/proto/gui_gtk_x11.pro,v
retrieving revision 1.12
diff -u -3 -p -r1.12 gui_gtk_x11.pro
--- src/proto/gui_gtk_x11.pro	11 Feb 2002 11:04:47 -0000	1.12
+++ src/proto/gui_gtk_x11.pro	6 Feb 2003 17:52:46 -0000
@@ -5,6 +5,7 @@ void gui_mch_stop_blink __ARGS((void));
 void gui_mch_start_blink __ARGS((void));
 int gui_mch_init_check __ARGS((void));
 int gui_mch_init __ARGS((void));
+void gui_mch_forked __ARGS((void));
 void gui_mch_new_colors __ARGS((void));
 int gui_mch_open __ARGS((void));
 void gui_mch_exit __ARGS((int rc));
@@ -12,6 +13,7 @@ int gui_mch_get_winpos __ARGS((int *x, i
 void gui_mch_set_winpos __ARGS((int x, int y));
 void gui_mch_set_shellsize __ARGS((int width, int height, int min_width, int min_height, int base_width, int base_height));
 void gui_mch_get_screen_dimensions __ARGS((int *screen_w, int *screen_h));
+void gui_mch_settitle __ARGS((char_u *title, char_u *icon));
 void gui_mch_enable_menu __ARGS((int flag));
 void gui_mch_show_toolbar __ARGS((int showit));
 int gui_mch_adjust_charsize __ARGS((void));
--- /dev/null	Wed Aug 14 22:00:49 2002
+++ pixmaps/gen-inline-pixbufs.sh	Wed Jan 29 22:53:50 2003
@@ -0,0 +1,13 @@
+#! /bin/sh
+
+prefix=stock_
+list=
+
+for file in "$@"
+do
+    name=`echo "$file" | sed 's|-|_|g; s|^.*/||; s|\..*$||'`
+    list="$list $prefix$name $file"
+done
+
+gdk-pixbuf-csource --raw --static --build-list $list
+
--- /dev/null	Wed Aug 14 22:00:49 2002
+++ pixmaps/stock_icons.h	Mon Feb  3 00:28:32 2003
@@ -0,0 +1,1700 @@
+/* GdkPixbuf RGBA C-Source image dump */
+
+static const guint8 stock_vim_build_tags[] = 
+{ ""
+  /* Pixbuf magic (0x47646b50) */
+  "GdkP"
+  /* length: header (24) + pixel_data (2304) */
+  "\0\0\11\30"
+  /* pixdata_type (0x1010002) */
+  "\1\1\0\2"
+  /* rowstride (96) */
+  "\0\0\0`"
+  /* width (24) */
+  "\0\0\0\30"
+  /* height (24) */
+  "\0\0\0\30"
+  /* pixel_data: */
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\0"
+  "\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\370\0\0\0\366\0\0\0\363"
+  "\0\0\0\361\0\0\0\357\0\0\0\355\0\0\0\353\0\0\0\351\0\0\0\347\0\0\0\345"
+  "\0\0\0\374\0\0\0\374\0\0\0\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\377\377\377\377\377\377\377\377\377\377\377\377\377"
+  "\377\377\377\377\377\377\377\377\261\261\261\377\377\377\377\377\377"
+  "\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\272\272"
+  "\272\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
+  "\377\344\344\344\377\0\0\0\341\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\377\377\377\377\377\354\354\354\377\354\354\354\377\354\354"
+  "\354\377\354\354\354\377\250\250\250\377\354\354\354\377\354\354\354"
+  "\377\354\354\354\377\354\354\354\377\354\354\354\377\255\255\255\377"
+  "\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377\271"
+  "\271\271\377\0\0\0\341\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\377\377\377\377\377\354\354\354\377\354\354\354\377\354\354\354\377"
+  "\354\354\354\377\253\253\253\377\354\354\354\377\354\354\354\377\354"
+  "\354\354\377\354\354\354\377\354\354\354\377\253\253\253\377\354\354"
+  "\354\377\354\354\354\377\354\354\354\377\354\354\354\377\270\270\270"
+  "\377\0\0\0\341\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\265"
+  "\265\265\377\250\250\250\377\252\252\252\377\252\252\252\377\250\250"
+  "\250\377\205\205\205\377\250\250\250\377\253\253\253\377\253\253\253"
+  "\377\253\253\253\377\253\253\253\377\202\202\202\377\250\250\250\377"
+  "\253\253\253\377\253\253\253\377\253\253\253\377ppp\377\0\0\0\343\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377\377\377\354\354"
+  "\354\377\354\354\354\377\354\354\354\377\354\354\354\377\253\253\253"
+  "\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377"
+  "\354\354\354\377\253\253\253\377\354\354\354\377\354\354\354\377\354"
+  "\354\354\377\354\354\354\377\274\274\274\377\0\0\0\341\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377\377\377\354\354\354\377"
+  "\354\354\354\377\354\354\354\377\354\354\354\377\253\253\253\377\354"
+  "\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354"
+  "\354\377\253\253\253\377\354\354\354\377\354\354\354\377\354\354\354"
+  "\377\354\354\354\377\274\274\274\377\0\0\0\341\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377\377\377\354\354\354\377\354\354"
+  "\354\377\354\354\354\377\354\354\354\377\253\253\253\377\354\354\354"
+  "\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377"
+  "\253\253\253\377\354\354\354\377\354\354\354\377\354\354\354\377\354"
+  "\354\354\377\274\274\274\377\0\0\0\341\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\377\272\272\272\377\247\247\247\377\253\253\253\377"
+  "\253\253\253\377\253\253\253\377\205\205\205\377\253\253\253\377\253"
+  "\253\253\377\253\253\253\377\253\253\253\377\253\253\253\377\215\215"
+  "\215\377\255\255\255\377\253\253\253\377\253\253\253\377\253\253\253"
+  "\377sss\377\0\0\0\335\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377"
+  "\377\377\377\377\354\354\354\377\354\354\354\377\354\354\354\377\354"
+  "\354\354\377\253\253\253\377\354\354\354\377\354\354\354\377\354\354"
+  "\354\377\354\354\354\377\354\354\354\377\253\253\253\377\354\354\354"
+  "\377\354\354\354\377\354\354\354\377\354\354\354\377\274\274\274\377"
+  "\0\0\0\335\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377"
+  "\377\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354"
+  "\377\253\253\253\377\354\354\354\377\354\354\354\377\354\354\354\377"
+  "\354\354\354\377\354\354\354\377\253\253\253\377\354\354\354\377\354"
+  "\354\354\377\354\354\354\377\354\354\354\377\270\270\270\377\0\0\0\373"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377\377\377\354"
+  "\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377\253\253"
+  "\253\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354"
+  "\377\354\354\354\377\253\253\253\377\354\354\354\377\354\354\354\377"
+  "\354\354\354\377\354\354\354\377\274\274\274\377\0\0\0\373\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\270\270\270\377\250\250\250"
+  "\377\253\253\253\377\253\253\253\377\254\254\254\377\207\207\207\377"
+  "\250\250\250\377\247\247\247\377\253\253\253\377\253\253\253\377\250"
+  "\250\250\377\205\205\205\377\250\250\250\377\253\253\253\377\253\253"
+  "\253\377\253\253\253\377ttt\377\0\0\0\373\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\377\377\377\377\377\354\354\354\377\354\354\354\377"
+  "\354\354\354\377\354\354\354\377\253\253\253\377\354\354\354\377\354"
+  "\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377\253\253"
+  "\253\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354"
+  "\377\270\270\270\377\0\0\0\373\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\377\377\377\377\377\354\354\354\377\354\354\354\377\354\354"
+  "\354\377\354\354\354\377\250\250\250\377\354\354\354\377\354\354\354"
+  "\377\354\354\354\377\354\354\354\377\354\354\354\377\251\251\251\377"
+  "\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377\274"
+  "\274\274\377\0\0\0\373\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\377\351\351\351\377\303\303\303\377\303\303\303\377\303\303\303\377"
+  "\277\277\277\377uuu\377\274\274\274\377\274\274\274\377\274\274\274\377"
+  "\274\274\274\377\274\274\274\377~~~\377\270\270\270\377\274\274\274\377"
+  "\274\274\274\377\273\273\273\377\243\243\243\377\0\0\0\373\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377"
+  "\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\376\0\0\0\373\0\0\0\373\0\0\0\373"
+  "\0\0\0\373\0\0\0\373\0\0\0\373\0\0\0\373\0\0\0\377\0\0\0\377\0\0\0\377"
+  "\0\0\0\373\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"};
+
+
+/* GdkPixbuf RGBA C-Source image dump */
+
+static const guint8 stock_vim_find_help[] = 
+{ ""
+  /* Pixbuf magic (0x47646b50) */
+  "GdkP"
+  /* length: header (24) + pixel_data (2304) */
+  "\0\0\11\30"
+  /* pixdata_type (0x1010002) */
+  "\1\1\0\2"
+  /* rowstride (96) */
+  "\0\0\0`"
+  /* width (24) */
+  "\0\0\0\30"
+  /* height (24) */
+  "\0\0\0\30"
+  /* pixel_data: */
+  "\0\0\0\0\0\0\0g\0\0\0\257\0\0\0\247\0\0\0K\0\0\0\0\205\203\177\25mli"
+  "pEDB\266\35\35\34\344\4\4\4\373\4\4\4\373\33\33\33\345=<:\270][Yucb`"
+  "\32\0\0\0\4\0\0\0\15\0\0\0S\0\0\0[\0\0\0\27\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0S\0\0\0\373\0\0\0\223\0\0\0\243\0\0\0\353MLK\227\4\4\4\373//-\377"
+  "\301\277\273\377\354\352\347\377\365\363\360\377\362\360\354\377\341"
+  "\337\334\377\257\255\252\377''&\377\2\2\2\373\77>>\227\0\0\0\335\0\0"
+  "\0\340\0\0\0\357\0\0\0\347\0\0\0\27\0\0\0\0\0\0\0\0\0\0\0\243\0\0\0\213"
+  "\0\0\0\0\207\205\201+60-\317\30\30\30\377\373\370\365\377\376\374\370"
+  "\377\372\370\365\377\365\364\361\377\362\361\355\377\362\360\354\377"
+  "\361\357\353\377\361\356\353\377\352\351\346\377\332\330\324\377\0\0"
+  "\0\377\20\16\16\346CC\77<\0\0\0\22\0\0\0\303\0\0\0\203\0\0\0\0\0\0\0"
+  "\0\0\0\0s\0\0\0\233\206\202~+\37\20\16\344\257:\36\377\373\253\223\377"
+  "\372\351\343\377\360\357\353\377\354\352\347\377\351\350\345\377\352"
+  "\350\346\377\354\352\350\377\355\353\351\377\355\353\351\377\355\353"
+  "\350\377\352\317\306\377\3254\12\377u\31\4\377\20\10\6\347;;7;\0\0\0"
+  "l\0\0\0\317\0\0\0\0\0\0\0\0\0\0\0'\0\0\0\2274\26\15\314\257<\40\377\374"
+  "\314\276\377\367\277\256\377\346uT\377\337\335\333\377\333\331\326\377"
+  "\330\327\323\377\333\332\326\377\343\342\336\377\352\351\346\377\354"
+  "\353\350\377\355\353\350\377\345W-\377\343:\13\377\3244\12\377i\25\4"
+  "\377\20\5\4\324\0\0\0\225\0\0\0\301\0\0\0\1\0\0\0\0\0\0\0\0X,\"\214\17"
+  "\17\17\377\375\324\310\377\367\277\257\377\350uT\377\325Q+\377\306\202"
+  "p\377\276\275\272\377\245\243\240\377\234\232\225\377\271\267\262\377"
+  "\327\326\322\377\347\345\342\377\347\232\205\377\346F\30\377\344<\13"
+  "\377\342:\13\377\3110\11\377\0\0\0\377\1\0\0\352\0\0\0=\0\0\0\4\0\0\0"
+  "\0\216\177z\27\4\1\0\373\372\261\234\377\372\314\276\377GG\77\377\12"
+  "\12\11\377\12\12\11\377KKC\377\0\0\0\377\0\0\0\377\4\4\4\377\0\0\0\377"
+  "\24\24\22\377\205yt\377\3327\13\377\354|[\377\351[2\377\344<\13\377\336"
+  "8\13\377\235#\6\377\0\0\0\374\4\2\2""1\0\0\0\13\0\0\0\2mljpbba\377\355"
+  "\342\337\37744.\377\235\235\215\377\317\317\271\377\304\304\257\377\215"
+  "\215\177\377**&\377\0\0\0b\0\0\0""8\0\0\0""1\0\0\0U\0\0\0\377b\24\4\377"
+  "\342R+\377\362\246\220\377\347N!\377\342;\13\377\311\221\201\377\2\2"
+  "\2\377\0\0\0\210\0\0\0\24\0\0\0\5ECB\267\345\344\342\377FF\77\377\234"
+  "\234\214\377\342\342\320\377\355\355\347\377\300\300\254\377\262\262"
+  "\237\377\202\202t\377LLD\377\0\0\0\35\0\0\0\25\0\0\0\24\"\40\40&\0\0"
+  "\0\377\236-\22\377\357\215q\377\360\233\203\377\352\335\327\377\333\332"
+  "\326\377''$\377\0\0\0\304\0\0\0\36\0\0\0\11\35\35\34\344\360\356\354"
+  "\377\11\11\10\377\325\325\277\377\373\373\372\377\303\303\256\377\265"
+  "\265\242\377\246\246\225\377\234\234\217\377\10\10\7\377\0\0\0\11\0\0"
+  "\0\4\226\225\224\13\0\0\0\11YYVB\77\15\2\377\360\271\251\377\366\365"
+  "\364\377\350\347\344\377\332\330\325\377XVR\377\0\0\0\351\0\0\0%\0\0"
+  "\0\15\4\4\4\373\365\363\360\377\11\11\11\377\312\312\265\377\335\335"
+  "\320\377\267\267\244\377\252\252\230\377\233\233\213\377\256\256\243"
+  "\377\12\12\11\377\0\0\0\2\0\0\0\0\350\347\345\24\0\0\0\2\31\30\30\12"
+  "\12\12\10\377\366\364\362\377\364\363\361\377\344\343\340\377\323\322"
+  "\316\377cb]\377\0\0\0\374\0\0\0+\0\0\0\20\4\4\4\373\362\360\354\377G"
+  "G@\377\222\222\203\377\272\272\247\377\255\255\233\377\237\237\216\377"
+  "\254\254\241\377\317\317\313\377LLE\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0""0/.\5\12\12\12\377\372\370\366\377\357\355\352\377\335\334\330\377"
+  "\306\304\302\377>>9\377\0\0\0\374\0\0\0-\0\0\0\21\33\33\31\345\341\337"
+  "\334\377\331\327\324\37744/\377\207\207y\377\240\240\220\377\256\256"
+  "\242\377\303\303\276\377\1\1\1\377\1\1\1\377\261\260\257\77\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\211\207\2064kjg\377\374\372\370\377\354\352\350\377\326"
+  "\324\322\377\274\272\267\377\0\0\0\377\0\0\0\352\0\0\0-\0\0\0\21<<:\271"
+  "\257\255\252\377\361\356\353\377\351\350\345\377KKC\377\12\12\11\377"
+  "\12\12\11\377AAA\377srq\377\1\1\1\377\1\1\1\377\244\243\241\315\337\336"
+  "\333\10\316\314\312*(((\377\316\233\217\377\372\372\367\377\346\346\342"
+  "\377\315\314\312\377\260\260\254\377\0\0\0\377\0\0\0\306\0\0\0+\0\0\0"
+  "\20][Yu''&\377\352\351\346\377\355\353\351\377\355\343\337\377\347\204"
+  "h\377\337]:\377c\31\11\377\237\237\235\377\1\1\1\377\1\1\1\377\1\1\1"
+  "\377\241\237\235a)))\377\272\177q\377\367\306\267\377\361\246\221\377"
+  "\334\322\314\377\310\306\303\377~|x\377\0\0\0\377\0\0\0\216\0\0\0%\0"
+  "\0\0\15a`^\33\2\2\2\373\332\330\324\377\350\255\234\377\351a9\377\353"
+  "tR\377\357\216r\377\352\200c\377\236.\23\377\77\30\21\377\0\0\0\377\1"
+  "\1\1\377\1\1\1\377\276\236\224\377\371\323\310\377\363\255\231\377\336"
+  "S+\377\3104\11\377\264\202t\377\0\0\0\377\0\0\0\375\0\0\0D\0\0\0\36\0"
+  "\0\0\11\0\0\0\4""854\236\0\0\0\377\3264\12\377\344=\17\377\350X.\377"
+  "\355yW\377\364\266\244\377\364\260\235\377\360\345\340\377\364\363\357"
+  "\377\1\1\1\377\1\1\1\377\1\1\1\377\354\225|\377\343O%\377\3237\12\377"
+  "\277/\11\377&\10\0\377\0\0\0\377\0\0\0\354\0\0\0-\0\0\0\24\0\0\0\5LK"
+  "J\3\0\0\0\220\31\17\13\332u\31\4\377\3255\12\377\342:\13\377\344=\14"
+  "\377\347L\37\377\357\273\253\377\365\364\363\377\357\355\352\377\365"
+  "\363\361\377\1\1\1\377\1\1\1\377\336C\26\377\3237\12\377\3042\14\377"
+  "Y\22\2\377\0\0\0\377\0\0\0\333\0\0\0\377\0\0\0;\0\0\0\13\0\0\0\2\0\0"
+  "\0\7\0\0\0\260JJG7\16\5\4\347i\25\4\377\3100\11\377\3368\13\377\340S"
+  "+\377\347\346\343\377\347\346\342\377\343\342\336\377\335\334\331\377"
+  "\327\326\323\377\317\316\312\377\274[>\377\256)\7\3774\26\15\377\0\0"
+  "\0\377\0\0\0\352\0\0\0b\0\0\0\374\0\0\0A\0\0\0\4\0\0\0\0\0\0\0\13\0\0"
+  "\0\217\0\0\0\12;;7;\17\7\5\325\0\0\0\377\233\"\5\377\301\250\237\377"
+  "\321\320\314\377\320\316\313\377\307\306\303\377\273\272\267\377\265"
+  "\264\261\377\247\246\242\377rd^\377\0\0\0\377\0\0\0\377\0\0\0\331\0\0"
+  "\0Y\0\0\0l\0\0\0\370\0\0\0\22\0\0\0\1\0\0\0\0\0\0\0\0\0\0\0_\0\0\0\230"
+  "\0\0\0\242\0\0\0\253\13\11\10\230\0\0\0\374\1\1\0\377\"\"!\377QPK\377"
+  "]\\W\377;;7\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\375\0\0\0\323\0\0"
+  "\0E\0\0\0H\0\0\0\310\0\0\0\246\0\0\0\2\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\37\0\0\0-\0\0\0\12\0\0\0\21\2\2\2""1\0\0\0\215\0\0\0\305\0\0"
+  "\0\351\0\0\0\374\0\0\0\374\0\0\0\353\0\0\0\307\0\0\0\226\0\0\0K\0\0\0"
+  "\307\0\0\0\377\0\0\0\377\0\0\0\311\0\0\0%\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\1\0\0\0\4\0\0\0\13\0\0\0\24\0\0\0"
+  "\35\0\0\0%\0\0\0+\0\0\0-\0\0\0-\0\0\0+\0\0\0%\0\0\0\36\0\0\0\27\0\0\0"
+  "0\0\0\0\33\0\0\0\4\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\2\0\0\0\4\0\0\0\11\0\0\0\15\0\0"
+  "\0\20\0\0\0\21\0\0\0\21\0\0\0\20\0\0\0\15\0\0\0\11\0\0\0\5\0\0\0\2\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"};
+
+
+/* GdkPixbuf RGBA C-Source image dump */
+
+static const guint8 stock_vim_save_all[] = 
+{ ""
+  /* Pixbuf magic (0x47646b50) */
+  "GdkP"
+  /* length: header (24) + pixel_data (2304) */
+  "\0\0\11\30"
+  /* pixdata_type (0x1010002) */
+  "\1\1\0\2"
+  /* rowstride (96) */
+  "\0\0\0`"
+  /* width (24) */
+  "\0\0\0\30"
+  /* height (24) */
+  "\0\0\0\30"
+  /* pixel_data: */
+  "\0\0\0U\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0"
+  "\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377"
+  "\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0Y\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\303\327\364\377\251\315\345\377uuz\377"
+  "\357\305\273\377\361\310\276\377\360\306\274\377\356\274\262\377\356"
+  "\276\265\377\356\301\270\377\355\277\266\377\351\267\255\377\351\270"
+  "\257\377\351\267\255\377\351\270\257\377\351\271\261\377\345\277\272"
+  "\377srw\377\263\315\343\377\241\276\326\377\0\0\0\377\0\0\0\0\0\0\0\4"
+  "\0\0\0\1\0\0\0\377\273\326\350\377\212\252\305\377`_h\377\340\215~\377"
+  "\340\202n\377\340\200n\377\334zh\377\334\201q\377\332xh\377\324\201s"
+  "\377\324}n\377\316re\377\317rd\377\316ug\377\304g[\377\303eX\377bai\377"
+  "\207\243\267\377Vq\207\377\0\0\0\377\0\0\0\0\0\0\0\15\0\0\0\4\0\0\0\377"
+  "\272\325\351\377\210\247\303\377EDJ\377\0\0\0\377\0\0\0\377\0\0\0\377"
+  "\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377"
+  "\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377"
+  "\0\0\0\377\0\0\0\377\0\0\0_\0\0\0\377\266\323\347\377\207\253\301\377"
+  "\0\0\0\377\303\327\364\377\251\315\345\377uuz\377\357\305\273\377\361"
+  "\310\276\377\360\306\274\377\356\274\262\377\356\276\265\377\356\301"
+  "\270\377\355\277\266\377\351\267\255\377\351\270\257\377\351\267\255"
+  "\377\351\270\257\377\351\271\261\377\345\277\272\377srw\377\263\315\343"
+  "\377\241\276\326\377\0\0\0\377\0\0\0\377\271\323\347\377\205\244\277"
+  "\377\0\0\0\377\273\326\350\377\212\252\305\377`_h\377\340\215~\377\340"
+  "\202n\377\340\200n\377\334zh\377\334\201q\377\332xh\377\324\201s\377"
+  "\324}n\377\316re\377\317rd\377\316ug\377\304g[\377\303eX\377bai\377\207"
+  "\243\267\377Vq\207\377\0\0\0\377\0\0\0\377\271\323\346\377\204\243\277"
+  "\377\0\0\0\377\272\325\351\377\210\247\303\377hfp\377\310\201{\377\313"
+  "|t\377\313zs\377\313{s\377\314|r\377\313}s\377\277kd\377\314zp\377\301"
+  "jb\377\314|s\377\302e[\377\303dY\377\272lj\377hfp\377\201\236\266\377"
+  "Tp\206\377\0\0\0\377\0\0\0\377\267\322\347\377\202\240\273\377\0\0\0"
+  "\377\266\323\347\377\207\253\301\377sss\377\377\377\377\377\377\377\377"
+  "\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
+  "\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
+  "\377\377\377\377\377\377\377\377\377\377\377sss\377\203\240\270\377R"
+  "l\200\377\0\0\0\377\0\0\0\377\265\312\345\377\177\242\271\377\0\0\0\377"
+  "\271\323\347\377\205\244\277\377sss\377\377\377\377\377\377\377\377\377"
+  "\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
+  "\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
+  "\377\377\377\377\377\377\377\377\377\377sss\377\203\240\270\377Oi|\377"
+  "\0\0\0\377\0\0\0\377\256\314\345\377}\240\266\377\0\0\0\377\271\323\346"
+  "\377\204\243\277\377sss\377\316\316\316\377\315\315\315\377\315\315\315"
+  "\377\315\315\315\377\315\315\315\377\315\315\315\377\315\315\315\377"
+  "\315\315\315\377\315\315\315\377\315\315\315\377\315\315\315\377\315"
+  "\315\315\377\277\277\277\377sss\377\210\244\273\377Hbv\377\0\0\0\377"
+  "\0\0\0\377\260\321\344\377\203\241\266\377\0\0\0\377\267\322\347\377"
+  "\202\240\273\377ccc\377\377\377\377\377\377\377\377\377\377\377\377\377"
+  "\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
+  "\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
+  "\377\377\377\377\377\377sss\377\210\244\273\377F^p\377\0\0\0\377\0\0"
+  "\0\377\252\316\343\377{\233\262\377\0\0\0\377\265\312\345\377\177\242"
+  "\271\377sss\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
+  "\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
+  "\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
+  "\377\377\377\377sss\377\207\243\272\377E\\m\377\0\0\0\377\0\0\0\377\251"
+  "\311\342\377t\224\257\377\0\0\0\377\256\314\345\377}\240\266\377sss\377"
+  "\316\316\316\377\315\315\315\377\315\315\315\377\315\315\315\377\315"
+  "\315\315\377\315\315\315\377\315\315\315\377\315\315\315\377\315\315"
+  "\315\377\315\315\315\377\315\315\315\377\315\315\315\377\305\305\305"
+  "\377sss\377\207\243\272\377T`i\377\0\0\0\377\0\0\0\377\253\304\342\377"
+  "r\224\255\377\0\0\0\377\260\321\344\377\203\241\266\377s[[\377\377\377"
+  "\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
+  "\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
+  "\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377sss\377"
+  "\203\240\270\377Q\\d\377\0\0\0\377\0\0\0\377\252\311\342\377p\221\252"
+  "\377\0\0\0\377\252\316\343\377{\233\262\377z\216\232\377zzz\377sss\377"
+  "sss\377sss\377sss\377sss\377kor\377ooo\377sss\377sss\377sss\377sss\377"
+  "iii\377ow~\377\206\242\271\377:Q]\377\0\0\0\377\0\0\0\377\252\311\341"
+  "\377l\216\246\377\0\0\0\377\251\311\342\377t\224\257\377\201\236\266"
+  "\377\203\240\270\377\206\242\271\377\202\237\267\377\177\235\266\377"
+  "~\234\265\377\202\237\267\377y\230\262\377\206\242\271\377\205\241\270"
+  "\377\205\241\270\377\207\243\272\377\202\237\267\377\214\247\275\377"
+  "\203\240\270\377\212\245\273\3776JY\377\0\0\0\377\0\0\0\377\250\310\341"
+  "\377k\215\246\377\0\0\0\377\253\304\342\377r\224\255\377o\220\254\377"
+  "q\222\256\377AJN\377BJQ\377R[c\377boy\377_lv\377\\iq\377Zfo\377Xck\377"
+  "Wcj\377R[c\377;S`\3779BK\377x\227\263\377\244\271\313\3776HS\377\0\0"
+  "\0\377\0\0\0\377\244\304\336\377i\213\243\377\0\0\0\377\252\311\342\377"
+  "p\221\252\377o\217\247\377JSY\377\227\223\214\377\337\335\332\377\343"
+  "\341\336\377\353\352\350\377\353\352\350\377\352\351\347\377\337\335"
+  "\332\377\317\316\311\377\311\306\300\377\233\226\216\377Vah\377Kez\377"
+  "Ts\214\377\252\306\335\3774FN\377\0\0\0\377\0\0\0\377w\211\231\377n\211"
+  "\236\377\0\0\0\377\252\311\341\377l\216\246\377l\214\244\377@GM\377\332"
+  "\330\323\377\347\346\342\377ge^\377ROG\377ROG\377\331\327\324\377\307"
+  "\305\277\377\300\274\265\377\270\263\253\377\317\316\311\377CLT\377M"
+  "i\177\377Oo\204\377\263\312\334\3771>I\377\0\0\0\377\0\0\0""5\14\15\17"
+  "\377N^j\377\0\0\0\377\250\310\341\377k\215\246\377r\217\244\377@GM\377"
+  "\342\341\335\377\360\357\354\377ge^\377ROG\377ROG\377\315\312\306\377"
+  "\302\277\271\377\300\274\265\377\312\306\300\377\334\332\327\377KU]\377"
+  "Ni\177\377Oo\204\377\272\314\334\3771>I\377\0\0\0\377\0\0\0\4\0\0\0""9"
+  "\0\0\0\377\0\0\0\377\244\304\336\377i\213\243\377p\212\241\3778>C\377"
+  "\340\336\332\377\353\352\350\377QNF\377OLD\377OLD\377\307\304\276\377"
+  "\300\274\265\377\313\310\302\377\341\340\334\377\351\350\346\377GQX\377"
+  "Nhy\377Ml\200\377\243\303\333\3778\77C\377\0\0\0\377\0\0\0\1\0\0\0\4"
+  "\0\0\0\16\0\0\0\377w\211\231\377n\211\236\377e\205\234\37738<\377\327"
+  "\324\320\377\326\324\320\377NJC\377MIB\377MIB\377\300\274\265\377\321"
+  "\316\311\377\346\345\342\377\355\354\352\377\346\345\342\377EOU\377H"
+  "as\377Mfx\377\241\301\332\3777<@\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0""5\14\15\17\377N^j\377[n|\377O[b\377\244\240\231\377\300\274"
+  "\265\377\270\263\253\377\314\311\303\377\314\311\303\377\327\325\321"
+  "\377\344\342\340\377\352\351\347\377\335\333\327\377\270\265\260\377"
+  ">GM\377Jav\377J`p\377\233\303\330\3776<A\377\0\0\0\377\0\0\0\0\0\0\0"
+  "\0\0\0\0\1\0\0\0\10\0\0\0\77\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377"
+  "\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377"
+  "\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377(2>\377\0\0\0\377\0"
+  "\0\0^"};
+
+
+/* GdkPixbuf RGBA C-Source image dump */
+
+static const guint8 stock_vim_session_load[] = 
+{ ""
+  /* Pixbuf magic (0x47646b50) */
+  "GdkP"
+  /* length: header (24) + pixel_data (2304) */
+  "\0\0\11\30"
+  /* pixdata_type (0x1010002) */
+  "\1\1\0\2"
+  /* rowstride (96) */
+  "\0\0\0`"
+  /* width (24) */
+  "\0\0\0\30"
+  /* height (24) */
+  "\0\0\0\30"
+  /* pixel_data: */
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\1\0\0\0\37\0\0\0\306"
+  "\0\0\0\342\0\0\0\356\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0.\0"
+  "\0\0\2\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\2\0\0\0\310\265\270"
+  "\245\377\344\347\322\377\344\347\322\377\344\347\322\377\344\347\322"
+  "\377\344\347\322\377\207\212v\37734+\377\22\22\22\6\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0./%O\13\13\13\345\342\345\317\377\317\324\257\377\317"
+  "\324\257\377\317\324\257\377\316\323\256\377\316\323\256\377\262\266"
+  "\226\377--%\377\5\5\4A\0\0\0\1\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\"#\34\241"
+  "\235\237\220\377\342\345\317\377\306\312\246\377\304\311\245\377\306"
+  "\313\247\377\307\314\250\377\311\316\251\377\311\316\251\377UXG\377\31"
+  "\32\25\242**\25\4\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\40\40\32\356\324\326\302"
+  "\377\276\302\240\377\263\270\226\377\260\265\225\377\263\267\227\377"
+  "\266\273\231\377\273\300\236\377\274\301\237\377\201\205l\377>\77""2"
+  "\345\0\0\0\302\0\0\0\324\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0"
+  "\0\377\0\0\0\377\0\0\0Q\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0#$\35\373\332"
+  "\335\310\377\257\264\224\377\252\257\217\377\243\247\211\377\246\252"
+  "\213\377\252\257\217\377\251\255\216\377\247\253\215\377\244\250\212"
+  "\377\241\245\210\377\252\255\226\377\263\265\245\377\270\273\252\377"
+  "\272\274\253\377\301\303\262\377\307\312\267\377\312\315\273\377\272"
+  "\275\250\377\0\0\0\377\34\34\34\3\0\0\0\0\0\0\0\0\0\0\0\0\14\14\11\377"
+  "\335\337\313\377\226\233~\377\235\242\206\377\225\230|\377\226\231~\377"
+  "\232\235\201\377\231\235\200\377\226\231~\377\235\241\204\377\245\252"
+  "\213\377\244\251\212\377\243\250\211\377\242\245\210\377\243\247\211"
+  "\377\242\245\207\377\237\243\206\377\233\236\203\377\211\215t\377\0\0"
+  "\0\377//'\14\0\0\0\1\0\0\0\0\0\0\0\0\0\0\0\377\330\333\311\377\204\206"
+  "n\377}\201i\377\25\26\22\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377"
+  "\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377"
+  "\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\327\0\0\0\301\0\0\0W\0"
+  "\0\0\5\0\0\0\377\327\332\311\377y}g\377=\77""4\377\340\340\331\377\353"
+  "\355\335\377\350\353\331\377\350\353\331\377\350\353\331\377\350\353"
+  "\331\377\350\353\331\377\350\353\331\377\350\353\331\377\350\353\331"
+  "\377\350\353\331\377\350\353\331\377\350\353\331\377\347\352\330\377"
+  "\343\346\324\377\336\341\320\377\332\334\314\377\332\334\321\377+,(\377"
+  ",,#\23\0\0\0\377\327\332\306\377os^\377\15\15\15\377\364\364\354\377"
+  "\317\324\257\377\317\324\257\377\317\324\257\377\317\324\257\377\317"
+  "\324\257\377\317\324\257\377\317\324\257\377\317\324\257\377\317\324"
+  "\257\377\316\323\256\377\1\1\1\377\1\1\1\377\1\1\1\377\306\313\250\377"
+  "\302\306\244\377\273\300\236\377\253\260\221\377#%\36\37722'5\0\0\0\377"
+  "\327\332\306\377IK=\377\334\334\324\377\352\354\335\377\315\322\255\377"
+  "\316\323\256\377\316\323\256\377\315\322\255\377\316\323\256\377\315"
+  "\322\255\377\260\265\225\377\12\12\10\377\12\12\10\377\244\250\212\377"
+  "\5\5\4\377\272\271\266\377\5\5\4\377\233\236\203\377\11\11\10\377\11"
+  "\11\7\377oq]\377\10\10\6\27712(J\0\0\0\377\325\330\304\377\26\26\26\377"
+  "\362\362\352\377\312\317\253\377\312\317\252\377\312\317\253\377\312"
+  "\317\252\377\311\316\252\377\312\317\252\377\311\316\252\377\12\12\10"
+  "\377\207\210\203\377rrp\377\12\12\10\377HFA\377\237\235\226\377HFA\377"
+  "\11\11\7\377\210\207\201\377#$\36\377\4\4\3\377\15\15\12\24123)>\0\0"
+  "\0\377\266\270\247\377ttp\377\354\354\342\377\303\310\245\377\302\307"
+  "\244\377\302\307\244\377\302\306\244\377\300\305\242\377\302\306\244"
+  "\377\277\304\241\377\11\11\10\377\310\307\302\377\266\265\257\377\237"
+  "\235\226\377\237\235\226\377\237\235\226\377\220\216\206\377\227\225"
+  "\216\377\200}t\377HFA\377\0\0\0\376\34\34\26e33&'\0\0\0\377\246\251\230"
+  "\377\334\334\324\377\270\274\233\377\270\274\233\377\265\271\231\377"
+  "\263\267\227\377\263\267\227\377\260\265\225\377\260\265\225\377\257"
+  "\263\224\377\214\217v\377\10\11\7\377\237\235\226\377\237\235\226\377"
+  "YXT\377`^W\377\211\210\203\377\200}t\377vtk\377\3\3\3\376\5\5\4\3073"
+  "3'200&\24\0\0\0\377\236\237\221\377\345\346\332\377\255\261\222\377\251"
+  "\255\217\377\246\252\214\377\245\251\214\377\243\247\212\377\243\247"
+  "\212\377\241\245\210\377\1\1\1\377\1\1\1\377HFA\377\237\235\226\377`"
+  "^W\377CB\77\377('$\377640\377\237\235\226\377mkc\377HFA\377\1\1\1\357"
+  "\0\0\0\356,,!\10\0\0\0\377\343\345\331\377\300\303\257\377\224\230|\377"
+  "\217\223y\377\213\217u\377\212\216t\377\210\214s\377\210\214s\377\205"
+  "\211p\377\1\1\0\377\214\213\211\377\266\265\257\377\237\235\226\377Y"
+  "XT\377!\40\36\377\12\11\10\377\30\30\26\377\346\346\344\377\200}t\377"
+  "ec\\\377`^W\377\0\0\0\354\34\34\34\3""34)[\0\0\0\377\0\0\0\377\0\0\0"
+  "\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0"
+  "\0\377\0\0\0\377HFA\377\237\235\226\377\211\210\203\377640\377\26\26"
+  "\24\377\214\213\211\377\337\336\334\377ec\\\377HFA\377\0\0\0\354\0\0"
+  "\0\352\0\0\0\1""34(J34)T34)Y34(Z45)Z45)Z45)Z45)Z45)Z45)Z45)Z\36\37\30"
+  "{\1\1\0\367\260\257\251\377\200}t\377\266\265\257\377\346\346\344\377"
+  "\325\324\321\377\223\221\213\377ec\\\377\0\0\0\364\12\12\7A\34\34\34"
+  "\3\0\0\0\0""22(%24(834)B23(C34)D34)D34)D34)D34)D34)D34)D\0\0\0\365\266"
+  "\265\257\377\253\251\243\377\237\235\226\377\200}t\377\200}t\377vtk\377"
+  "vtk\377]\\U\377HFA\377\0\0\0\362\0\0\0\1\0\0\0\0""33\36\11""00&\24""1"
+  "1&\31""00$\31""33(\32""33(\32""33(\32""33(\32""33(\32""33(\32""33(\32"
+  "\0\0\0\363\1\1\1\313YXT\377\0\0\0\366HFA\377vtk\377HFA\377\0\0\0\363"
+  "IIC\377\0\0\0\307\0\0\0\362\0\0\0\0\0\0\0\0\0\0\0\1**\0\2\37\37\0\3\37"
+  "\37\0\3""88\34\3""88\34\3""88\34\3""88\34\3""88\34\3""88\34\3""88\34"
+  "\3\4\4\2&\0\0\0\362\0\0\0\362\2\2\1""5\0\0\0\343BA<\377\0\0\0\343\1\1"
+  "\0""5\0\0\0\362\0\0\0\362\0\0\0#\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\351\0\0\0\353\0\0\0\353\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"};
+
+
+/* GdkPixbuf RGBA C-Source image dump */
+
+static const guint8 stock_vim_session_new[] = 
+{ ""
+  /* Pixbuf magic (0x47646b50) */
+  "GdkP"
+  /* length: header (24) + pixel_data (2304) */
+  "\0\0\11\30"
+  /* pixdata_type (0x1010002) */
+  "\1\1\0\2"
+  /* rowstride (96) */
+  "\0\0\0`"
+  /* width (24) */
+  "\0\0\0\30"
+  /* height (24) */
+  "\0\0\0\30"
+  /* pixel_data: */
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0Y\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377"
+  "\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\202"
+  "\0\0\0\3\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\377\323\323\323\377\366\366\366\377\377\377\377\377"
+  "\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
+  "\377\377\377\377\377\377\377\377\377\377\377\371\371\371\377\332\332"
+  "\332\377XXX\377\0\0\0\301\0\0\0\6\0\0\0\1\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\366\366\366\377\377\377\377\377"
+  "\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
+  "\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
+  "\377\377\307\307\307\377\321\321\321\377\326\326\326\377\0\0\0\377\0"
+  "\0\0\10\0\0\0\1\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
+  "\377\377\377\377\377\377\377\377\377\377\377\377\376\376\376\377\377"
+  "\377\377\377\376\376\376\377\375\375\375\377\300\300\300\377\341\341"
+  "\341\377\360\360\360\377\233\233\233\377\0\0\0\377\0\0\0\11\0\0\0\1\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377\377\377\377"
+  "\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\376\376"
+  "\376\377\375\375\375\377\374\374\373\377\375\375\375\377\374\374\373"
+  "\377\373\373\373\377\257\257\256\377\351\351\351\377\377\377\377\377"
+  "\337\337\337\377\217\217\217\377\0\0\0\377\0\0\0\11\0\0\0\1\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377\377\377\377\377\377\377\377"
+  "\377\377\377\376\376\376\377\375\375\375\377\374\374\373\377\373\373"
+  "\373\377\372\372\371\377\373\373\373\377\372\372\371\377\371\371\370"
+  "\377\244\244\243\377\360\360\360\377\377\377\377\377\364\364\364\377"
+  "\317\317\317\377\242\242\242\377\0\0\0\264\0\0\0\10\0\0\0\1\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\377\377\377\377\377\376\376\376\377\375\375\375"
+  "\377\374\374\373\377\373\373\373\377\372\372\371\377\371\371\370\377"
+  "\370\370\367\377\371\371\370\377\370\370\367\377\370\367\366\377\236"
+  "\236\236\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0"
+  "\377\0\0\0\201\0\0\0\5\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377\377"
+  "\377\374\374\373\377\373\373\373\377\372\372\371\377\371\371\370\377"
+  "\370\370\367\377\370\367\366\377\367\366\365\377\370\367\366\377\367"
+  "\366\365\377\366\366\364\377\364\363\362\377\336\335\334\377\323\322"
+  "\320\377\267\267\265\377\237\236\235\377poo\377ebZ\377\0\0\0\377\0\0"
+  "\0\20\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377\377\377\372\372\371\377"
+  "\371\371\370\377\370\370\367\377\370\367\366\377\367\366\365\377\366"
+  "\366\364\377\365\364\363\377\366\366\364\377\365\364\363\377\364\363"
+  "\362\377\362\362\360\377\344\344\342\377\332\331\327\377\330\330\326"
+  "\377\315\314\312\377\257\256\254\377\210\204{\377\0\0\0\377\0\0\0\35"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377\377\377\370\370\367\377\370"
+  "\367\366\377\367\366\365\377\366\366\364\377\365\364\363\377\364\363"
+  "\362\377\363\363\361\377\364\363\362\377\363\363\361\377\362\362\360"
+  "\377\357\357\355\377\356\355\353\377\355\354\352\377\351\350\346\377"
+  "\325\324\323\377\304\303\302\377\217\212\201\377\0\0\0\377\0\0\0\40\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377\377\377\366\365\364\377\1\1"
+  "\1\377\1\1\1\377\1\1\1\377\363\363\361\377\362\362\360\377\361\361\357"
+  "\377\362\362\360\377\361\361\357\377\361\360\356\377\356\355\353\377"
+  "\354\353\351\377\352\351\347\377\345\344\342\377\344\343\340\377\322"
+  "\321\316\377\215\210~\377\0\0\0\377\0\0\0\40\0\0\0\0\0\0\0\0\0\0\0#\0"
+  "\0\0\377\15\15\15\377\303\302\301\377\6\6\6\377\335\334\332\377\6\6\6"
+  "\377\277\277\275\377\14\14\14\377\14\14\14\377\317\317\315\377\360\357"
+  "\355\377\357\356\354\377\354\353\351\377\350\347\345\377\345\344\341"
+  "\377\344\343\340\377\342\341\336\377\341\337\334\377\227\222\210\377"
+  "\0\0\0\377\0\0\0\40\0\0\0\0\0\0\0\0\0\0\0\362\352\352\352\377\262\262"
+  "\260\377\14\14\14\377HFA\377\237\235\226\377HFA\377\14\14\14\377\210"
+  "\207\201\377665\377\14\14\14\377\360\357\355\377\357\356\354\377\354"
+  "\353\351\377\350\347\345\377\345\344\341\377\344\343\340\377\342\341"
+  "\336\377\341\337\334\377\244\236\223\377\0\0\0\377\0\0\0\40\0\0\0\0\0"
+  "\0\0\0\0\0\0\362\235\234\230\377\221\220\212\377\237\235\226\377\237"
+  "\235\226\377\237\235\226\377\220\216\206\377\227\225\216\377\200}t\377"
+  "HFA\377\14\14\13\377\355\354\352\377\354\353\351\377\350\347\344\377"
+  "\347\346\343\377\343\342\337\377\342\340\335\377\341\340\334\377\340"
+  "\337\333\377\241\234\220\377\0\0\0\377\0\0\0\40\0\0\0\0\0\0\0\0\0\0\0"
+  "3\0\0\0\377\237\235\226\377\237\235\226\377YXT\377`^W\377\211\210\203"
+  "\377\200}t\377vtk\377\13\13\13\377\274\273\271\377\351\350\345\377\351"
+  "\350\345\377\345\344\341\377\346\344\341\377\343\342\336\377\337\336"
+  "\332\377\336\335\331\377\335\334\330\377\241\233\220\377\0\0\0\377\0"
+  "\0\0\40\0\0\0\0\0\0\0\375\0\0\0\375HFA\377\237\235\226\377`^W\377CB\77"
+  "\377('$\377640\377\237\235\226\377mkc\377HFA\377\31\31\31\377\22\22\21"
+  "\377\347\345\342\377\344\343\337\377\343\342\336\377\340\337\333\377"
+  "\336\335\331\377\335\334\330\377\334\333\327\377\241\233\220\377\0\0"
+  "\0\377\0\0\0\40\0\0\0\0\0\0\0\375\356\356\355\377\266\265\257\377\237"
+  "\235\226\377YXT\377!\40\36\377\12\11\10\377\30\30\26\377\346\346\344"
+  "\377\200}t\377ec\\\377`^W\377\21\21\21\377\344\343\337\377\342\341\335"
+  "\377\340\337\333\377\336\335\331\377\334\333\327\377\333\331\325\377"
+  "\331\327\323\377\237\231\215\377\0\0\0\377\0\0\0\40\0\0\0\0\0\0\0\375"
+  "\0\0\0\370HFA\377\237\235\226\377\211\210\203\377640\377\26\26\24\377"
+  "\214\213\211\377\337\336\334\377ec\\\377HFA\377\23\23\23\377\23\23\23"
+  "\377\341\340\334\377\341\340\334\377\336\335\331\377\335\333\327\377"
+  "\334\332\326\377\331\327\323\377\330\326\322\377\236\230\215\377\0\0"
+  "\0\377\0\0\0\40\0\0\0\0\0\0\0\0\0\0\0""3\0\0\0\377\260\257\251\377\200"
+  "}t\377\266\265\257\377\346\346\344\377\325\324\321\377\223\221\213\377"
+  "ec\\\377\13\13\13\377\263\262\257\377\341\340\334\377\337\336\332\377"
+  "\340\336\332\377\335\333\327\377\334\332\326\377\331\327\323\377\330"
+  "\326\321\377\327\325\321\377\235\227\213\377\0\0\0\377\0\0\0\40\0\0\0"
+  "\0\0\0\0\0\0\0\0\362\266\265\257\377\253\251\243\377\237\235\226\377"
+  "\200}t\377\200}t\377vtk\377vtk\377]\\U\377HFA\377\13\13\13\377\340\336"
+  "\332\377\336\334\330\377\336\334\330\377\334\332\326\377\334\332\326"
+  "\377\330\326\322\377\327\326\321\377\325\323\316\377\233\225\212\377"
+  "\0\0\0\377\0\0\0\40\0\0\0\0\0\0\0\0\0\0\0\362\0\0\0\377YXT\377\6\6\5"
+  "\377HFA\377vtk\377HFA\377\10\10\7\377IIC\377$#\40\377\10\7\7\377\242"
+  "\234\220\377\241\233\217\377\241\233\220\377\237\231\215\377\237\231"
+  "\215\377\235\227\214\377\235\227\214\377\233\226\212\377gcY\377\0\0\0"
+  "\377\0\0\0\40\0\0\0\0\0\0\0\0\0\0\0#\0\0\0\367\0\0\0\377\0\0\0\377\0"
+  "\0\0\377BA<\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0"
+  "\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0"
+  "\0\0\377\0\0\0\377\0\0\0q\0\0\0\30\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\2\0"
+  "\0\0\17\0\0\0\35\0\0\0\354\0\0\0\356\0\0\0\356\0\0\0\40\0\0\0\40\0\0"
+  "\0\40\0\0\0\40\0\0\0\40\0\0\0\40\0\0\0\40\0\0\0\40\0\0\0\40\0\0\0\40"
+  "\0\0\0\40\0\0\0\40\0\0\0\40\0\0\0\30\0\0\0\10\0\0\0\0"};
+
+
+/* GdkPixbuf RGBA C-Source image dump */
+
+static const guint8 stock_vim_session_save[] = 
+{ ""
+  /* Pixbuf magic (0x47646b50) */
+  "GdkP"
+  /* length: header (24) + pixel_data (2304) */
+  "\0\0\11\30"
+  /* pixdata_type (0x1010002) */
+  "\1\1\0\2"
+  /* rowstride (96) */
+  "\0\0\0`"
+  /* width (24) */
+  "\0\0\0\30"
+  /* height (24) */
+  "\0\0\0\30"
+  /* pixel_data: */
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\375"
+  "\0\0\0\375\0\0\0\375\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0#\0\0\0\362\0\0\0\362\0\0\0""3\0\0\0\370\272"
+  "\271\266\377\0\0\0\370\0\0\0""3\0\0\0\362\0\0\0\362\0\0\0#\0\0\0\0\0"
+  "\0\0\0\0\0\0U\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0"
+  "\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377mmm\377rrp\377"
+  "\0\0\0\377HFA\377\237\235\226\377HFA\377\0\0\0\377\210\207\201\377\0"
+  "\0\0\331\0\0\0\362\0\0\0\1\0\0\0\0\0\0\0\377\303\327\364\377\251\315"
+  "\345\377uuz\377\357\305\273\377\361\310\276\377\360\306\274\377\356\274"
+  "\262\377\356\276\265\377\356\301\270\377\355\277\266\377\13\11\10\377"
+  "\310\307\302\377\266\265\257\377\237\235\226\377\237\235\226\377\237"
+  "\235\226\377\220\216\206\377\227\225\216\377\200}t\377HFA\377\0\0\0\363"
+  "\0\0\0\4\0\0\0\0\0\0\0\377\273\326\350\377\212\252\305\377`_h\377\340"
+  "\215~\377\340\202n\377\340\200n\377\334zh\377\334\201q\377\332xh\377"
+  "\324\201s\377\251dX\377\12\5\5\377\237\235\226\377\237\235\226\377YX"
+  "T\377`^W\377\211\210\203\377\200}t\377vtk\377\0\0\0\377\0\0\0F\0\0\0"
+  "\11\0\0\0\0\0\0\0\377\272\325\351\377\210\247\303\377hfp\377\310\201"
+  "{\377\313|t\377\313zs\377\313{s\377\314|r\377\313}s\377\1\0\0\377\1\0"
+  "\0\377HFA\377\237\235\226\377`^W\377CB\77\377('$\377640\377\237\235\226"
+  "\377mkc\377HFA\377\0\0\0\346\0\0\0\354\0\0\0\0\0\0\0\377\266\323\347"
+  "\377\207\253\301\377sss\377\377\377\377\377\377\377\377\377\377\377\377"
+  "\377\377\377\377\377\377\377\377\377\377\377\377\377\2\2\2\377\214\213"
+  "\211\377\266\265\257\377\237\235\226\377YXT\377!\40\36\377\12\11\10\377"
+  "\30\30\26\377\346\346\344\377\200}t\377ec\\\377`^W\377\0\0\0\354\0\0"
+  "\0\0\0\0\0\377\271\323\347\377\205\244\277\377sss\377\377\377\377\377"
+  "\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
+  "\377\377\377\2\2\2\377\7\7\7\377HFA\377\237\235\226\377\211\210\203\377"
+  "640\377\26\26\24\377\214\213\211\377\337\336\334\377ec\\\377HFA\377\0"
+  "\0\0\354\0\0\0\352\0\0\0\0\0\0\0\377\271\323\346\377\204\243\277\377"
+  "sss\377\316\316\316\377\315\315\315\377\315\315\315\377\315\315\315\377"
+  "\315\315\315\377\315\315\315\377\315\315\315\377\244\244\244\377\12\12"
+  "\12\377\260\257\251\377\200}t\377\266\265\257\377\346\346\344\377\325"
+  "\324\321\377\223\221\213\377ec\\\377\0\0\0\377\0\0\0K\0\0\0\13\0\0\0"
+  "\0\0\0\0\377\267\322\347\377\202\240\273\377ccc\377\377\377\377\377\377"
+  "\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
+  "\377\377\377\377\377\377\15\15\15\377\266\265\257\377\253\251\243\377"
+  "\237\235\226\377\200}t\377\200}t\377vtk\377vtk\377]\\U\377HFA\377\0\0"
+  "\0\364\0\0\0\13\0\0\0\0\0\0\0\377\265\312\345\377\177\242\271\377sss"
+  "\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
+  "\377\377\377\377\377\377\377\377\377\377\377\377\15\15\15\377:::\377"
+  "YXT\377\12\12\12\377HFA\377vtk\377HFA\377\6\10\11\377IIC\377\0\0\0\377"
+  "\0\0\0\364\0\0\0\13\0\0\0\0\0\0\0\377\256\314\345\377}\240\266\377ss"
+  "s\377\316\316\316\377\315\315\315\377\315\315\315\377\315\315\315\377"
+  "\315\315\315\377\315\315\315\377\315\315\315\377\260\260\260\377\12\12"
+  "\12\377\12\12\12\377\244\244\244\377\26\26\26\377BA<\377\14\14\14\377"
+  "l\202\224\377\4\4\5\377\0\0\0\377\0\0\0=\0\0\0\13\0\0\0\0\0\0\0\377\260"
+  "\321\344\377\203\241\266\377s[[\377\377\377\377\377\377\377\377\377\377"
+  "\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
+  "\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
+  "\377\26\26\26\377\24\24\24\377\11\11\11\377\203\240\270\377Q\\d\377\0"
+  "\0\0\377\0\0\0\36\0\0\0\13\0\0\0\0\0\0\0\377\252\316\343\377{\233\262"
+  "\377z\216\232\377zzz\377sss\377sss\377sss\377sss\377sss\377kor\377oo"
+  "o\377sss\377sss\377sss\377sss\377iii\377ow~\377\206\242\271\377:Q]\377"
+  "\0\0\0\377\0\0\0\36\0\0\0\13\0\0\0\0\0\0\0\377\251\311\342\377t\224\257"
+  "\377\201\236\266\377\203\240\270\377\206\242\271\377\202\237\267\377"
+  "\177\235\266\377~\234\265\377\202\237\267\377y\230\262\377\206\242\271"
+  "\377\205\241\270\377\205\241\270\377\207\243\272\377\202\237\267\377"
+  "\214\247\275\377\203\240\270\377\212\245\273\3776JY\377\0\0\0\377\0\0"
+  "\0\36\0\0\0\13\0\0\0\0\0\0\0\377\253\304\342\377r\224\255\377o\220\254"
+  "\377q\222\256\377AJN\377BJQ\377R[c\377boy\377_lv\377\\iq\377Zfo\377X"
+  "ck\377Wcj\377R[c\377;S`\3779BK\377x\227\263\377\244\271\313\3776HS\377"
+  "\0\0\0\377\0\0\0\36\0\0\0\13\0\0\0\0\0\0\0\377\252\311\342\377p\221\252"
+  "\377o\217\247\377JSY\377\227\223\214\377\337\335\332\377\343\341\336"
+  "\377\353\352\350\377\353\352\350\377\352\351\347\377\337\335\332\377"
+  "\317\316\311\377\311\306\300\377\233\226\216\377Vah\377Kez\377Ts\214"
+  "\377\252\306\335\3774FN\377\0\0\0\377\0\0\0\36\0\0\0\13\0\0\0\0\0\0\0"
+  "\377\252\311\341\377l\216\246\377l\214\244\377@GM\377\332\330\323\377"
+  "\347\346\342\377ge^\377ROG\377ROG\377\331\327\324\377\307\305\277\377"
+  "\300\274\265\377\270\263\253\377\317\316\311\377CLT\377Mi\177\377Oo\204"
+  "\377\263\312\334\3771>I\377\0\0\0\377\0\0\0\36\0\0\0\13\0\0\0\0\0\0\0"
+  "\377\250\310\341\377k\215\246\377r\217\244\377@GM\377\342\341\335\377"
+  "\360\357\354\377ge^\377ROG\377ROG\377\315\312\306\377\302\277\271\377"
+  "\300\274\265\377\312\306\300\377\334\332\327\377KU]\377Ni\177\377Oo\204"
+  "\377\272\314\334\3771>I\377\0\0\0\377\0\0\0\36\0\0\0\13\0\0\0\0\0\0\0"
+  "\377\244\304\336\377i\213\243\377p\212\241\3778>C\377\340\336\332\377"
+  "\353\352\350\377QNF\377OLD\377OLD\377\307\304\276\377\300\274\265\377"
+  "\313\310\302\377\341\340\334\377\351\350\346\377GQX\377Nhy\377Ml\200"
+  "\377\243\303\333\3778\77C\377\0\0\0\377\0\0\0\36\0\0\0\13\0\0\0\0\0\0"
+  "\0\377w\211\231\377n\211\236\377e\205\234\37738<\377\327\324\320\377"
+  "\326\324\320\377NJC\377MIB\377MIB\377\300\274\265\377\321\316\311\377"
+  "\346\345\342\377\355\354\352\377\346\345\342\377EOU\377Has\377Mfx\377"
+  "\241\301\332\3777<@\377\0\0\0\377\0\0\0\36\0\0\0\13\0\0\0\0\0\0\0""5"
+  "\14\15\17\377N^j\377[n|\377O[b\377\244\240\231\377\300\274\265\377\270"
+  "\263\253\377\314\311\303\377\314\311\303\377\327\325\321\377\344\342"
+  "\340\377\352\351\347\377\335\333\327\377\270\265\260\377>GM\377Jav\377"
+  "J`p\377\233\303\330\3776<A\377\0\0\0\377\0\0\0\35\0\0\0\13\0\0\0\0\0"
+  "\0\0\4\0\0\0""9\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0"
+  "\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0"
+  "\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377(2>\377\0\0\0\377\0\0\0]\0\0\0"
+  "\30\0\0\0\11\0\0\0\0\0\0\0\1\0\0\0\4\0\0\0\16\0\0\0\30\0\0\0\35\0\0\0"
+  "\35\0\0\0\36\0\0\0\36\0\0\0\36\0\0\0\36\0\0\0\36\0\0\0\36\0\0\0\36\0"
+  "\0\0\36\0\0\0\36\0\0\0\36\0\0\0\36\0\0\0\36\0\0\0\36\0\0\0\35\0\0\0\30"
+  "\0\0\0\15\0\0\0\4"};
+
+
+/* GdkPixbuf RGBA C-Source image dump */
+
+static const guint8 stock_vim_shell[] = 
+{ ""
+  /* Pixbuf magic (0x47646b50) */
+  "GdkP"
+  /* length: header (24) + pixel_data (9216) */
+  "\0\0$\30"
+  /* pixdata_type (0x1010002) */
+  "\1\1\0\2"
+  /* rowstride (192) */
+  "\0\0\0\300"
+  /* width (48) */
+  "\0\0\0""0"
+  /* height (48) */
+  "\0\0\0""0"
+  /* pixel_data: */
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\1\0\0\0\2\0\0\0\4\0\0\0\7\0\0\0\11\0\0\0\12\0\0\0\13\0\0\0"
+  "\13\0\0\0\13\0\0\0\13\0\0\0\14\0\0\0\14\0\0\0\14\0\0\0\14\0\0\0\14\0"
+  "\0\0\14\0\0\0\14\0\0\0\14\0\0\0\14\0\0\0\14\0\0\0\14\0\0\0\14\0\0\0\14"
+  "\0\0\0\14\0\0\0\14\0\0\0\14\0\0\0\14\0\0\0\14\0\0\0\14\0\0\0\14\0\0\0"
+  "\14\0\0\0\14\0\0\0\14\0\0\0\14\0\0\0\14\0\0\0\14\0\0\0\14\0\0\0\13\0"
+  "\0\0\13\0\0\0\13\0\0\0\12\0\0\0\11\0\0\0\7\0\0\0\4\0\0\0\2\0\0\0\1\0"
+  "\0\0\0\0\0\0\0\0\0\0\2\0\0\0""7\2\2\2\377\1\1\1\377\0\0\0\377\0\0\0\377"
+  "\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377"
+  "\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377"
+  "\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377"
+  "\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377"
+  "\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377"
+  "\0\0\0\377\0\0\0K\0\0\0\14\0\0\0\7\0\0\0\2\0\0\0\1\0\0\0\0\0\0\0\4\0"
+  "\0\0\377\340\336\334\332\352\351\346\377\357\356\354\377\360\357\355"
+  "\377\361\360\356\377\362\361\357\377\360\360\355\377\361\360\355\377"
+  "\362\362\357\377\362\362\357\377\362\362\357\377\362\362\357\377\362"
+  "\362\357\377\362\362\357\377\362\362\357\377\361\361\356\377\356\356"
+  "\353\377\355\354\350\377\354\353\350\377\353\352\347\377\352\351\346"
+  "\377\351\350\344\377\350\347\344\377\346\345\341\377\346\344\340\377"
+  "\341\337\333\377\331\327\323\377\326\324\316\377\323\320\313\377\320"
+  "\315\307\377\314\311\304\377\311\306\301\377\306\303\276\377\302\300"
+  "\273\377\277\275\270\377\272\270\261\377\270\265\256\377\266\262\254"
+  "\377\260\254\246\377\215\211\202\340\0\0\0\377\0\0\0\32\0\0\0\16\0\0"
+  "\0\6\0\0\0\2\0\0\0\0\0\0\0\7\0\0\0\377\357\356\355\377\325\322\312\377"
+  "\327\324\314\377\331\326\316\377\332\327\317\377\333\330\321\377\334"
+  "\332\322\377\335\333\323\377\336\333\324\377\336\334\324\377\336\334"
+  "\324\377\336\333\323\377\336\334\324\377\336\334\324\377\336\333\324"
+  "\377\336\333\323\377\335\332\323\377\334\332\322\377\333\330\321\377"
+  "\332\326\316\377\331\325\315\377\327\323\313\377\324\321\311\377\322"
+  "\316\306\377\320\314\304\377\316\312\302\377\312\306\276\377\307\303"
+  "\273\377\303\277\266\377\300\273\263\377\273\267\257\377\267\263\253"
+  "\377\264\257\247\377\260\254\243\377\255\250\240\377\246\243\231\377"
+  "\244\237\227\377\241\234\224\377\236\231\220\377\202~w\377\0\0\0\377"
+  "\0\0\0)\0\0\0\26\0\0\0\12\0\0\0\3\0\0\0\0\0\0\0\11\0\0\0\377\357\356"
+  "\354\377\326\324\313\377\330\326\315\377\332\327\317\377\333\330\320"
+  "\377\335\332\322\377\336\333\323\377\336\334\324\377\337\335\325\377"
+  "\337\335\326\377\337\335\326\377\337\335\326\377\340\335\326\377\337"
+  "\335\325\377\337\333\324\377\336\332\323\377\334\331\322\377\333\330"
+  "\320\377\332\327\320\377\331\326\316\377\327\323\314\377\325\321\311"
+  "\377\323\317\310\377\321\315\305\377\316\313\303\377\315\310\300\377"
+  "\311\305\275\377\305\302\272\377\301\275\265\377\276\271\261\377\272"
+  "\266\255\377\266\262\252\377\262\256\245\377\256\252\241\377\251\245"
+  "\234\377\245\241\230\377\241\234\224\377\236\232\222\377\233\227\216"
+  "\377{xq\377\0\0\0\377\0\0\0""7\0\0\0\37\0\0\0\15\0\0\0\5\0\0\0\0\0\0"
+  "\0\12\0\0\0\377\360\357\355\377\327\324\315\377\331\326\316\377\310\306"
+  "\276\377\270\266\257\377\272\267\260\377\273\270\261\377\274\271\262"
+  "\377\274\271\263\377\274\271\263\377\274\271\262\377\273\270\262\377"
+  "\273\270\261\377\273\267\261\377\271\266\260\377\271\265\256\377\267"
+  "\264\255\377\266\263\254\377\265\262\252\377\263\260\250\377\261\257"
+  "\247\377\257\254\244\377\256\252\243\377\254\250\241\377\251\246\237"
+  "\377\247\243\234\377\244\240\230\377\241\235\225\377\235\231\221\377"
+  "\230\225\216\377\224\221\212\377\221\216\206\377\216\213\202\377\212"
+  "\207\200\377\206\202{\377\206\202{\377\237\232\221\377\233\230\216\377"
+  "\230\224\213\377yvn\377\0\0\0\377\0\0\0A\0\0\0%\0\0\0\20\0\0\0\5\0\0"
+  "\0\0\0\0\0\14\0\0\0\377\360\360\355\377\331\326\316\377\332\327\317\377"
+  "\267\265\255\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0"
+  "\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377"
+  "\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377"
+  "\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377"
+  "\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\254\250"
+  "\236\377\230\225\213\377\225\221\210\377wtl\377\0\0\0\377\0\0\0G\0\0"
+  "\0(\0\0\0\22\0\0\0\6\0\0\0\0\0\0\0\14\0\0\0\377\361\360\356\377\331\326"
+  "\316\377\332\327\317\377\267\264\255\377\0\0\0\377>C>\377BGB\377EIE\377"
+  "HMH\377JNJ\377LRL\377PTP\377QUQ\377RXR\377RXR\377SYS\377SXS\377SWS\377"
+  "QWQ\377QWQ\377NTN\377MRM\377LQL\377KQK\377JNJ\377HKH\377EIE\377DHD\377"
+  "\77D\77\377<A<\3777;7\377262\377/2/\377(+(\377$($\377\0\0\0\377\264\257"
+  "\245\377\226\221\210\377\222\215\204\377tqi\377\0\0\0\377\0\0\0I\0\0"
+  "\0*\0\0\0\23\0\0\0\7\0\0\0\0\0\0\0\14\0\0\0\377\360\360\355\377\327\324"
+  "\315\377\331\325\316\377\265\262\253\377\0\0\0\377595\377\235\236\235"
+  "\377\236\240\236\377\237\241\237\377\241\243\241\377\242\244\242\377"
+  "\243\245\243\377\241\243\241\377\231\234\231\377\222\225\222\377\213"
+  "\216\213\377\202\204\202\377y}y\377ptp\377ili\377^c^\377TYT\377KOK\377"
+  "AFA\377@D@\377\77C\77\377=A=\377;>;\3776;6\377383\377/2/\377+/+\377$"
+  "($\377!%!\377\35\40\35\377\0\0\0\377\261\254\242\377\222\215\204\377"
+  "\216\212\201\377qng\377\0\0\0\377\0\0\0K\0\0\0+\0\0\0\24\0\0\0\7\0\0"
+  "\0\0\0\0\0\14\0\0\0\377\355\354\351\377\325\321\312\377\327\323\314\377"
+  "\263\260\251\377\0\0\0\377BHB\377\244\246\244\377\246\251\246\377\247"
+  "\252\247\377\252\255\252\377\254\256\254\377\245\250\245\377\240\244"
+  "\240\377\231\235\231\377\223\227\223\377\214\220\214\377\205\212\205"
+  "\377|\201|\377u{u\377lpl\377did\377[_[\377X]X\377U[U\377SZS\377QUQ\377"
+  "QUQ\377LQL\377JPJ\377CHC\377>C>\3777<7\377020\377+/+\377&)&\377\0\0\0"
+  "\377\257\251\240\377\216\211\200\377\212\206~\377okd\377\0\0\0\377\0"
+  "\0\0K\0\0\0+\0\0\0\24\0\0\0\7\0\0\0\0\0\0\0\14\0\0\0\377\354\353\351"
+  "\377\323\317\307\377\323\321\311\377\261\256\246\377\0\0\0\377;>;\377"
+  "\237\242\237\377\242\244\242\377\243\245\243\377\240\242\240\377\231"
+  "\234\231\377\223\227\223\377\216\220\216\377\207\213\207\377\202\206"
+  "\202\377z}z\377rvr\377ini\377afa\377Y_Y\377RVR\377QUQ\377NRN\377LRL\377"
+  "KPK\377INI\377FKF\377DHD\377AFA\377:>:\3776;6\377040\377*.*\377%'%\377"
+  "\37\"\37\377\0\0\0\377\254\247\234\377\212\205}\377\206\202z\377kha\377"
+  "\0\0\0\377\0\0\0K\0\0\0,\0\0\0\24\0\0\0\7\0\0\0\0\0\0\0\14\0\0\0\377"
+  "\354\352\350\377\320\314\304\377\321\315\305\377\256\253\244\377\0\0"
+  "\0\377JMJ\377\250\252\250\377\247\252\247\377\242\244\242\377\235\240"
+  "\235\377\232\234\232\377\224\230\224\377\221\226\221\377\216\222\216"
+  "\377\210\215\210\377\203\207\203\377{\200{\377sys\377mrm\377jpj\377i"
+  "ni\377ele\377eje\377chc\377^d^\377\\c\\\377[`[\377W]W\377RYR\377KNK\377"
+  "EKE\377=C=\3779<9\377/4/\377(*(\377\0\0\0\377\251\244\231\377\206\202"
+  "y\377\203\177v\377hd]\377\0\0\0\377\0\0\0K\0\0\0,\0\0\0\24\0\0\0\7\0"
+  "\0\0\0\0\0\0\14\0\0\0\377\352\351\346\377\315\311\300\377\316\312\302"
+  "\377\254\251\241\377\0\0\0\377@D@\377\232\234\232\377\224\227\224\377"
+  "\217\222\217\377\212\215\212\377\206\212\206\377\201\205\201\377~\202"
+  "~\377y~y\377uzu\377nsn\377gmg\377djd\377chc\377`e`\377^d^\377\\b\\\377"
+  "Z_Z\377W]W\377VZV\377RXR\377PVP\377MRM\377GLG\377CGC\377:\77:\3775:5"
+  "\377-2-\377(+(\377!%!\377\0\0\0\377\246\241\226\377\202~u\377\177|s\377"
+  "eb[\377\0\0\0\377\0\0\0K\0\0\0,\0\0\0\24\0\0\0\7\0\0\0\0\0\0\0\14\0\0"
+  "\0\377\350\347\345\377\311\305\275\377\312\307\277\377\251\245\236\377"
+  "\0\0\0\377QTQ\377\226\231\226\377\222\225\222\377\215\222\215\377\213"
+  "\217\213\377\210\215\210\377\206\213\206\377\205\213\205\377\202\211"
+  "\202\377\202\211\202\377\200\206\200\377}\204}\377z\201z\377y\200y\377"
+  "x~x\377v|v\377tzt\377pup\377msm\377jqj\377hmh\377djd\377`f`\377Y_Y\377"
+  "TYT\377INI\377CJC\377:>:\377262\377).)\377\0\0\0\377\243\236\223\377"
+  "~zq\377{xo\377b_W\377\0\0\0\377\0\0\0K\0\0\0,\0\0\0\24\0\0\0\7\0\0\0"
+  "\0\0\0\0\14\0\0\0\377\346\344\342\377\304\300\267\377\307\303\273\377"
+  "\245\241\232\377\0\0\0\377EJE\377\201\205\201\377}\200}\377z~z\377uz"
+  "u\377rwr\377pup\377ntn\377ntn\377pvp\377pvp\377qwq\377qwq\377ntn\377"
+  "kqk\377ipi\377ioi\377dkd\377aga\377^c^\377[a[\377X^X\377TYT\377MSM\377"
+  "FJF\377@D@\3777<7\377/4/\377*-*\377\"&\"\377\0\0\0\377\240\232\217\377"
+  "yvm\377xtk\377_\\U\377\0\0\0\377\0\0\0K\0\0\0,\0\0\0\24\0\0\0\7\0\0\0"
+  "\0\0\0\0\14\0\0\0\377\336\335\331\377\300\275\264\377\303\277\267\377"
+  "\241\235\225\377\0\0\0\377WZW\377\201\205\201\377|\202|\377|\201|\377"
+  "{\200{\377z\177z\377x~x\377|\203|\377\202\210\202\377\205\213\205\377"
+  "\207\215\207\377\210\216\210\377\206\214\206\377\205\214\205\377\204"
+  "\212\204\377\201\206\201\377|\203|\377y\200y\377w|w\377rxr\377ovo\377"
+  "lql\377djd\377`f`\377W\\W\377NUN\377EIE\377>C>\377474\377+/+\377\0\0"
+  "\0\377\234\226\213\377uri\377spg\377\\YQ\377\0\0\0\377\0\0\0K\0\0\0,"
+  "\0\0\0\24\0\0\0\7\0\0\0\0\0\0\0\14\0\0\0\377\334\332\326\377\275\272"
+  "\260\377\277\272\261\377\235\231\221\377\0\0\0\377GMG\377jnj\377fif\377"
+  "cgc\377bfb\377bhb\377gmg\377lrl\377rxr\377u{u\377w}w\377x~x\377w~w\377"
+  "w}w\377u|u\377sxs\377qvq\377lrl\377ioi\377eke\377bgb\377^d^\377X]X\377"
+  "SWS\377IPI\377CHC\377:>:\377373\377+-+\377\"&\"\377\0\0\0\377\232\224"
+  "\211\377rne\377plc\377YUN\377\0\0\0\377\0\0\0K\0\0\0,\0\0\0\24\0\0\0"
+  "\7\0\0\0\0\0\0\0\14\0\0\0\377\330\327\323\377\270\264\253\377\272\266"
+  "\255\377\231\225\215\377\0\0\0\377W\\W\377ioi\377flf\377fmf\377nsn\377"
+  "sys\377z\201z\377\200\206\200\377\204\212\204\377\211\217\211\377\213"
+  "\221\213\377\214\223\214\377\214\222\214\377\213\221\213\377\211\220"
+  "\211\377\207\215\207\377\204\212\204\377\201\207\201\377}\205}\377y\200"
+  "y\377v{v\377qwq\377jqj\377bhb\377[`[\377PTP\377HNH\377;\77;\377272\377"
+  "+/+\377\0\0\0\377\227\221\205\377nja\377mg_\377VRK\377\0\0\0\377\0\0"
+  "\0K\0\0\0,\0\0\0\24\0\0\0\7\0\0\0\0\0\0\0\14\0\0\0\377\326\325\321\377"
+  "\264\260\247\377\265\261\250\377\224\221\211\377\0\0\0\377HMH\377OTO"
+  "\377QWQ\377W\\W\377^d^\377bhb\377ioi\377ouo\377sys\377v}v\377y\177y\377"
+  "{\202{\377{\201{\377z\200z\377y\200y\377w~w\377szs\377qwq\377ntn\377"
+  "jqj\377flf\377`e`\377Z`Z\377SYS\377KQK\377BGB\377;\77;\377161\377*,*"
+  "\377#%#\377\0\0\0\377\223\216\203\377jf]\377ie\\\377SPI\377\0\0\0\377"
+  "\0\0\0K\0\0\0,\0\0\0\24\0\0\0\7\0\0\0\0\0\0\0\14\0\0\0\377\323\322\317"
+  "\377\260\253\242\377\261\255\243\377\221\216\205\377\0\0\0\377X^X\377"
+  "[b[\377bfb\377fmf\377lrl\377rxr\377z\200z\377\200\205\200\377\205\213"
+  "\205\377\207\216\207\377\212\221\212\377\214\222\214\377\215\222\215"
+  "\377\213\222\213\377\212\221\212\377\210\217\210\377\207\214\207\377"
+  "\203\212\203\377\200\207\200\377|\204|\377w|w\377qwq\377lpl\377cic\377"
+  "Z_Z\377PUP\377GLG\377=B=\377171\377,/,\377\0\0\0\377\221\213\200\377"
+  "gcZ\377ebY\377PNF\377\0\0\0\377\0\0\0K\0\0\0,\0\0\0\24\0\0\0\7\0\0\0"
+  "\0\0\0\0\14\0\0\0\377\321\317\313\377\253\246\235\377\255\250\236\377"
+  "\215\211\201\377\0\0\0\377HMH\377KOK\377\331\333\331\377\241\243\241"
+  "\377bgb\377`f`\377flf\377kqk\377pwp\377tzt\377w}w\377w~w\377y\177y\377"
+  "x~x\377w}w\377u{u\377sys\377pwp\377nsn\377joj\377did\377_e_\377Y_Y\377"
+  "RWR\377HOH\377AEA\3779>9\377373\377)-)\377#'#\377\0\0\0\377\216\211|"
+  "\377d`W\377b^U\377NKD\377\0\0\0\377\0\0\0K\0\0\0,\0\0\0\24\0\0\0\7\0"
+  "\0\0\0\0\0\0\14\0\0\0\377\315\313\307\377\246\241\230\377\250\243\231"
+  "\377\210\205}\377\0\0\0\377TZT\377Y^Y\377\377\377\377\377\377\377\377"
+  "\377\360\361\360\377\277\301\277\377\206\213\206\377z\201z\377~\205~"
+  "\377\203\211\203\377\204\213\204\377\206\215\206\377\207\216\207\377"
+  "\207\215\207\377\205\214\205\377\205\214\205\377\203\211\203\377\201"
+  "\207\201\377}\204}\377x\200x\377szs\377msm\377gog\377_f_\377X]X\377M"
+  "TM\377DJD\377<A<\377272\377+/+\377\0\0\0\377\214\207z\377a]T\377_[R\377"
+  "KHA\377\0\0\0\377\0\0\0K\0\0\0,\0\0\0\24\0\0\0\7\0\0\0\0\0\0\0\14\0\0"
+  "\0\377\312\311\304\377\240\233\222\377\242\236\224\377\204\200x\377\0"
+  "\0\0\377DID\377IOI\377mpm\377\247\252\247\377\327\331\327\377\374\374"
+  "\374\377\373\373\373\377\314\316\314\377\226\233\226\377lrl\377ouo\377"
+  "pup\377pwp\377pwp\377pvp\377ouo\377nsn\377jqj\377fmf\377cic\377_c_\377"
+  "X_X\377TZT\377MSM\377EJE\377=A=\3776;6\377040\377(+(\377\"%\"\377\0\0"
+  "\0\377\212\204x\377^ZQ\377[XO\377HF\77\377\0\0\0\377\0\0\0K\0\0\0,\0"
+  "\0\0\24\0\0\0\7\0\0\0\0\0\0\0\14\0\0\0\377\305\303\276\377\233\226\215"
+  "\377\234\231\216\377\200|s\377\0\0\0\377QWQ\377UZU\377Z^Z\377]d]\377"
+  "bhb\377{\201{\377\312\314\312\377\377\377\377\377\377\377\377\377w}w"
+  "\377y~y\377y\201y\377{\202{\377z\202z\377z\202z\377y\200y\377x}x\377"
+  "szs\377qwq\377mtm\377ipi\377did\377\\b\\\377X\\X\377PUP\377EKE\377\77"
+  "D\77\377:=:\377151\377*.*\377\0\0\0\377\207\202u\377[WN\377YUL\377FC"
+  "<\377\0\0\0\377\0\0\0K\0\0\0,\0\0\0\24\0\0\0\7\0\0\0\0\0\0\0\14\0\0\0"
+  "\377\274\270\262\377\226\222\210\377\230\224\212\377{xo\377\0\0\0\377"
+  "BFB\377DJD\377dgd\377\223\226\223\377\272\275\272\377\367\367\367\377"
+  "\373\373\373\377\304\306\304\377\177\204\177\377`e`\377aha\377bhb\377"
+  "chc\377bhb\377bhb\377afa\377_d_\377[a[\377Y]Y\377TYT\377RWR\377MQM\377"
+  "HNH\377BHB\377>C>\3777;7\377262\377+/+\377$'$\377\40\"\40\377\0\0\0\377"
+  "\205\177r\377WTK\377URI\377DA:\377\0\0\0\377\0\0\0K\0\0\0,\0\0\0\24\0"
+  "\0\0\7\0\0\0\0\0\0\0\14\0\0\0\377\267\263\256\377\222\216\204\377\223"
+  "\216\204\377vsj\377\0\0\0\377LSL\377PTP\377\377\377\377\377\377\377\377"
+  "\377\351\351\351\377\244\250\244\377pvp\377eje\377fnf\377hoh\377jqj\377"
+  "jpj\377ipi\377jpj\377hnh\377glg\377flf\377did\377_e_\377]c]\377Y^Y\377"
+  "S[S\377MRM\377HLH\377CJC\377=B=\3777>7\377262\377.0.\377&*&\377\0\0\0"
+  "\377\203}o\377TQH\377ROF\377B>7\377\0\0\0\377\0\0\0K\0\0\0,\0\0\0\24"
+  "\0\0\0\7\0\0\0\0\0\0\0\14\0\0\0\377\261\256\251\377\215\210\177\377\216"
+  "\211\177\377sof\377\0\0\0\377:@:\377>C>\377\320\321\320\377\200\204\200"
+  "\377KOK\377JOJ\377LQL\377NSN\377PTP\377QVQ\377RWR\377\322\324\322\377"
+  "\365\365\365\377\372\373\372\377\372\372\372\377\372\372\372\377\307"
+  "\311\307\377w{w\377FLF\377BHB\377@D@\377>B>\3779>9\377595\377272\377"
+  "-2-\377).)\377&)&\377\"%\"\377\34\40\34\377\0\0\0\377\201|n\377QMD\377"
+  "OLC\377\77<5\377\0\0\0\377\0\0\0K\0\0\0,\0\0\0\24\0\0\0\7\0\0\0\0\0\0"
+  "\0\14\0\0\0\377\253\250\242\377\207\203y\377\211\205z\377okc\377\0\0"
+  "\0\377CIC\377EKE\377JPJ\377JPJ\377LSL\377PUP\377TYT\377T[T\377X]X\377"
+  "X^X\377W]W\377X^X\377X]X\377U\\U\377RXR\377QWQ\377NSN\377MRM\377JPJ\377"
+  "HKH\377BJB\377AEA\377=A=\3779=9\3776<6\377/5/\377.1.\377+.+\377&,&\377"
+  "!$!\377\0\0\0\377\177yl\377MJA\377LI@\377=:3\377\0\0\0\377\0\0\0K\0\0"
+  "\0,\0\0\0\24\0\0\0\7\0\0\0\0\0\0\0\14\0\0\0\377\251\246\240\377\202~"
+  "u\377\204\177u\377jf^\377\0\0\0\377585\3774:4\3776<6\3778=8\3779>9\377"
+  "=A=\377>C>\377\77C\77\377>B>\377@D@\377@E@\377@C@\377>C>\377<A<\377="
+  "B=\377:\77:\3779=9\3775:5\377393\377373\377030\377,0,\377*-*\377)+)\377"
+  "'+'\377$'$\377\40$\40\377\35\"\35\377\33\36\33\377\30\34\30\377\0\0\0"
+  "\377}xh\377KH\77\377KH>\377<:2\377\0\0\0\377\0\0\0K\0\0\0,\0\0\0\24\0"
+  "\0\0\7\0\0\0\0\0\0\0\14\0\0\0\377\244\241\232\377}yo\377\177{p\377fc"
+  "Z\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0"
+  "\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0"
+  "\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377"
+  "\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377"
+  "\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377|wg\377KH>\377KH>\377"
+  "<:2\377\0\0\0\377\0\0\0K\0\0\0,\0\0\0\24\0\0\0\7\0\0\0\0\0\0\0\14\0\0"
+  "\0\377\237\234\226\377ytj\377zuk\377\224\217\203\377\256\251\233\377"
+  "\260\251\234\377\257\253\235\377\261\253\235\377\261\253\235\377\261"
+  "\253\236\377\260\253\235\377\257\251\233\377\256\250\232\377\255\250"
+  "\231\377\253\245\230\377\252\243\225\377\250\242\224\377\247\240\222"
+  "\377\245\236\220\377\242\234\216\377\237\231\212\377\235\227\210\377"
+  "\233\226\206\377\231\223\204\377\230\222\203\377\225\217\200\377\223"
+  "\214}\377\221\211{\377\216\211w\377\215\206u\377\214\206t\377\212\204"
+  "r\377\210\202q\377\207\201o\377\206\200n\377\205\177m\377vqa\377KH>\377"
+  "KH>\377<:2\377\0\0\0\377\0\0\0K\0\0\0,\0\0\0\24\0\0\0\7\0\0\0\0\0\0\0"
+  "\14\0\0\0\377\235\232\224\377tpe\377uqg\377uqg\377uqf\377vrg\377vrh\377"
+  "uqg\377upf\377upf\377tpe\377sod\377rnc\377pla\377mi_\377mh^\377jf\\\377"
+  "hdY\377faW\377c_U\377a]S\377_ZQ\377]ZO\377[XM\377YVK\377XTI\377WSH\377"
+  "URG\377TPE\377RND\377PMC\377PLB\377NKA\377MJ@\377MI\77\377LI\77\377K"
+  "H>\377KH>\377KH>\377<92\377\0\0\0\377\0\0\0K\0\0\0,\0\0\0\24\0\0\0\7"
+  "\0\0\0\0\0\0\0\14\0\0\0\377\225\223\214\377oka\377qmc\377qmc\377qlb\377"
+  "rmc\377rnc\377rmb\377rlb\377qlb\377pka\377ok`\377nj_\377kg\\\377jeZ\377"
+  "idY\377fbW\377c`U\377b^T\377`\\R\377^ZO\377\\XM\377ZWL\377YUJ\377WSI"
+  "\377VSH\377URG\377TPE\377SOD\377QNC\377PLB\377OKA\377]YP\377okc\377n"
+  "kc\377ROF\377KH>\377KH>\377KH>\377=;3\377\0\0\0\377\0\0\0K\0\0\0,\0\0"
+  "\0\24\0\0\0\7\0\0\0\0\0\0\0\14\0\0\0\377\217\214\205\375kg]\377lh^\377"
+  "mi_\377mh^\377mi_\377mi^\377mi^\377ni_\377lh]\377kg\\\377jf[\377ieZ\377"
+  "gcX\377eaV\377d`U\377a]S\377`\\Q\377^ZO\377]YN\377\\XL\377ZVJ\377YUJ"
+  "\377XTI\377VSH\377UQG\377TPE\377SOE\377QNC\377PMC\377OLB\377OK@\377w"
+  "tl\377MI\77\377LI\77\377A>6\377KH>\377KH>\377KH>\377<:2\377\0\0\0\377"
+  "\0\0\0J\0\0\0+\0\0\0\24\0\0\0\7\0\0\0\0\0\0\0\13\0\0\0\377\215\213\202"
+  "\374heZ\377if[\377jf\\\377kf\\\377jf\\\377jf\\\377kf\\\377jf\\\377if"
+  "[\377idZ\377hcZ\377gbX\377eaV\377c_U\377b^T\377`\\Q\377^ZO\377]XN\377"
+  "\\XN\377ZVL\377YUJ\377WTI\377WSH\377URG\377TPF\377SOE\377RND\377PMC\377"
+  "OLB\377OK@\377NJ@\377MI\77\377@<4\377>;3\377KH>\377KH>\377KH>\377KH>"
+  "\377EB:\376\0\0\0\377\0\0\0G\0\0\0)\0\0\0\23\0\0\0\7\0\0\0\0\0\0\0\12"
+  "\0\0\0\377omf\343NLC\377PMF\377QNF\377QNF\377QNF\377QME\377QNF\377QN"
+  "F\377QME\377QME\377PLD\377OLC\377NJB\377LIA\377KI@\377JG>\377HE=\377"
+  "GC<\377GC<\377EA:\377C@8\377B\77""8\377B>7\377A>7\377@=5\377\77<4\377"
+  ">;3\377=:2\377<92\377<91\377;81\377:80\377:70\377:70\377970\377970\377"
+  "970\377:80\377\77<4\364\0\0\0\377\0\0\0A\0\0\0%\0\0\0\21\0\0\0\6\0\0"
+  "\0\0\0\0\0\11\0\0\0Y\0\0\0\377\0\0\0\377\0\0\0\377utr\366srl\377xvp\377"
+  "xwq\377}{v\377\201\177z\377\205\203\177\377\211\207\202\377\213\210\204"
+  "\377\217\216\212\377\221\217\213\377\222\220\214\377\220\216\213\377"
+  "\217\216\211\377\214\212\207\377\213\210\204\377\210\206\202\377\207"
+  "\204\201\377\203\201}\377\201\177z\377\177}x\377}{w\377yws\377wup\377"
+  "srl\377poi\377nlg\377ljf\377lid\377ljd\377lke\377mjd\377nkd\377GD>\372"
+  "\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\206\0\0\0""7\0\0\0\36\0\0\0\15\0"
+  "\0\0\5\0\0\0\0\0\0\0\6\0\0\0\20\0\0\0!\0\0\0""9\0\0\0\377fec\356LIC\374"
+  "LIB\377OMF\377USL\377YWQ\377^\\V\377db\\\377iga\377nkg\377qok\377qoj"
+  "\377omg\377nke\377jhc\377igb\377ge`\377eb]\377da\\\377`^X\377\\[T\377"
+  "YXQ\377VTM\377RPI\377MKD\377IG@\377FD<\377FC<\377DB:\377CA8\377DA8\377"
+  "D@8\377C@7\377.+%\362\0\0\0\377\0\0\0i\0\0\0U\0\0\0\77\0\0\0(\0\0\0\25"
+  "\0\0\0\11\0\0\0\3\0\0\0\0\0\0\0\4\0\0\0\12\0\0\0\25\0\0\0&\0\0\0n\0\0"
+  "\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0"
+  "\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377"
+  "\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377"
+  "\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377"
+  "\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\214"
+  "\0\0\0O\0\0\0<\0\0\0)\0\0\0\31\0\0\0\15\0\0\0\5\0\0\0\2\0\0\0\0\0\0\0"
+  "\2\0\0\0\5\0\0\0\14\0\0\0\25\0\0\0#\0\0\0""2\0\0\0B\0\0\0N\0\0\0V\0\0"
+  "\0Z\0\0\0\\\0\0\0\\\0\0\0\\\0\0\0\\\0\0\0\\\0\0\0\\\0\0\0\\\0\0\0]\0"
+  "\0\0]\0\0\0]\0\0\0]\0\0\0]\0\0\0]\0\0\0]\0\0\0]\0\0\0]\0\0\0]\0\0\0]"
+  "\0\0\0]\0\0\0]\0\0\0]\0\0\0\\\0\0\0\\\0\0\0\\\0\0\0\\\0\0\0\\\0\0\0["
+  "\0\0\0W\0\0\0O\0\0\0C\0\0\0""4\0\0\0$\0\0\0\27\0\0\0\15\0\0\0\6\0\0\0"
+  "\2\0\0\0\1\0\0\0\0\0\0\0\1\0\0\0\2\0\0\0\5\0\0\0\12\0\0\0\22\0\0\0\34"
+  "\0\0\0&\0\0\0/\0\0\0""5\0\0\0""9\0\0\0:\0\0\0:\0\0\0:\0\0\0:\0\0\0:\0"
+  "\0\0:\0\0\0:\0\0\0:\0\0\0:\0\0\0:\0\0\0:\0\0\0:\0\0\0:\0\0\0:\0\0\0:"
+  "\0\0\0:\0\0\0:\0\0\0:\0\0\0:\0\0\0:\0\0\0:\0\0\0:\0\0\0:\0\0\0:\0\0\0"
+  ":\0\0\0:\0\0\0""9\0\0\0""5\0\0\0""0\0\0\0(\0\0\0\35\0\0\0\23\0\0\0\12"
+  "\0\0\0\5\0\0\0\2\0\0\0\1\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\1\0\0\0\1\0\0"
+  "\0\4\0\0\0\7\0\0\0\14\0\0\0\22\0\0\0\27\0\0\0\32\0\0\0\34\0\0\0\35\0"
+  "\0\0\35\0\0\0\35\0\0\0\35\0\0\0\35\0\0\0\35\0\0\0\35\0\0\0\36\0\0\0\36"
+  "\0\0\0\36\0\0\0\36\0\0\0\36\0\0\0\36\0\0\0\36\0\0\0\36\0\0\0\36\0\0\0"
+  "\36\0\0\0\36\0\0\0\36\0\0\0\36\0\0\0\36\0\0\0\35\0\0\0\35\0\0\0\35\0"
+  "\0\0\35\0\0\0\35\0\0\0\35\0\0\0\33\0\0\0\27\0\0\0\22\0\0\0\15\0\0\0\10"
+  "\0\0\0\4\0\0\0\2\0\0\0\1\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\1\0\0\0\2\0\0\0\4\0\0\0\7\0\0\0\11\0\0\0\12\0\0\0\13\0\0\0"
+  "\13\0\0\0\13\0\0\0\13\0\0\0\13\0\0\0\14\0\0\0\14\0\0\0\14\0\0\0\14\0"
+  "\0\0\14\0\0\0\14\0\0\0\14\0\0\0\14\0\0\0\14\0\0\0\14\0\0\0\14\0\0\0\14"
+  "\0\0\0\14\0\0\0\14\0\0\0\14\0\0\0\14\0\0\0\14\0\0\0\14\0\0\0\14\0\0\0"
+  "\13\0\0\0\13\0\0\0\13\0\0\0\13\0\0\0\12\0\0\0\11\0\0\0\7\0\0\0\4\0\0"
+  "\0\2\0\0\0\1\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\1\0\0\0\1\0\0\0\2\0\0\0\2\0\0\0\2\0\0"
+  "\0\2\0\0\0\2\0\0\0\2\0\0\0\3\0\0\0\3\0\0\0\3\0\0\0\3\0\0\0\3\0\0\0\3"
+  "\0\0\0\3\0\0\0\3\0\0\0\3\0\0\0\3\0\0\0\3\0\0\0\3\0\0\0\3\0\0\0\3\0\0"
+  "\0\3\0\0\0\3\0\0\0\3\0\0\0\3\0\0\0\3\0\0\0\3\0\0\0\3\0\0\0\2\0\0\0\2"
+  "\0\0\0\2\0\0\0\2\0\0\0\2\0\0\0\1\0\0\0\1\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\1\0\0\0\1\0\0\0\1\0\0\0\1\0\0\0\1\0\0\0\1\0\0\0\1\0\0\0\1\0\0\0\1"
+  "\0\0\0\1\0\0\0\1\0\0\0\1\0\0\0\1\0\0\0\1\0\0\0\1\0\0\0\1\0\0\0\1\0\0"
+  "\0\1\0\0\0\1\0\0\0\1\0\0\0\1\0\0\0\1\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"};
+
+
+/* GdkPixbuf RGBA C-Source image dump */
+
+static const guint8 stock_vim_window_maximize[] = 
+{ ""
+  /* Pixbuf magic (0x47646b50) */
+  "GdkP"
+  /* length: header (24) + pixel_data (2304) */
+  "\0\0\11\30"
+  /* pixdata_type (0x1010002) */
+  "\1\1\0\2"
+  /* rowstride (96) */
+  "\0\0\0`"
+  /* width (24) */
+  "\0\0\0\30"
+  /* height (24) */
+  "\0\0\0\30"
+  /* pixel_data: */
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0"
+  "\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0"
+  "\0\0\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377\377\377\377"
+  "\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\0\0\0\377"
+  "\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\351"
+  "\351\351\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377\377\377"
+  "\354\354\354\377\354\354\354\377\354\354\354\377\0\0\0\377\377\266Z\377"
+  "\0\0\0\377\354\354\354\377\354\354\354\377\354\354\354\377\270\270\270"
+  "\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377\377\377\354\354"
+  "\354\377\354\354\354\377\0\0\0\377\377p8\377\377\302a\377\377\265Y\377"
+  "\0\0\0\377\354\354\354\377\354\354\354\377\270\270\270\377\0\0\0\377"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377\377\377\354\354\354\377\0\0\0"
+  "\377\377\\.\377\377\275^\377\377\306b\377\377\310c\377\377\277_\377\0"
+  "\0\0\377\354\354\354\377\270\270\270\377\0\0\0\377\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\377\377\377\377\377\354\354\354\377\0\0\0\377\244@\40\377\244"
+  "@\40\377\377\310c\377\226\\-\377\223W+\377\0\0\0\377\354\354\354\377"
+  "\270\270\270\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377\377"
+  "\377\354\354\354\377\354\354\354\377\354\354\354\377\0\0\0\377\377\306"
+  "c\377\0\0\0\377\354\354\354\377\354\354\354\377\354\354\354\377\270\270"
+  "\270\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377\377\377\354"
+  "\354\354\377\354\354\354\377\354\354\354\377\0\0\0\377\0\0\0\377\0\0"
+  "\0\377\354\354\354\377\354\354\354\377\354\354\354\377\270\270\270\377"
+  "\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\223"
+  "W+\0\377\277_\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377\377\377\354\354\354"
+  "\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377"
+  "\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377\270"
+  "\270\270\377\0\0\0\377\0\0\0\0\377\\.\0\244@\40\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\226\\-\0\377\310c\0\377\265Y\0\0\0\0\0\0\0\0\377\377\377"
+  "\377\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354"
+  "\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377"
+  "\354\354\354\377\270\270\270\377\0\0\0\377\377p8\0\377\275^\0\244@\40"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\377\306c\0\377\310c\0\377\306b\0\377\302a"
+  "\0\377\266Z\0\0\0\0\377\377\377\377\377\354\354\354\377\354\354\354\377"
+  "\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377\354"
+  "\354\354\377\354\354\354\377\354\354\354\377\270\270\270\377\0\0\0\377"
+  "\377\302a\0\377\306b\0\377\310c\0\377\306c\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\244@\40\0\377\275^\0\377p8\0\0\0\0\0\0\0\0\377\377\377\377\377\354\354"
+  "\354\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354"
+  "\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377"
+  "\270\270\270\377\0\0\0\377\377\265Y\0\377\310c\0\226\\-\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\244@\40\0\377\\.\0\0\0\0\0\0\0\0\0\0\0\0\377\377"
+  "\377\377\377\354\354\354\377\354\354\354\377\354\354\354\377\0\0\0\377"
+  "\0\0\0\377\0\0\0\377\354\354\354\377\354\354\354\377\354\354\354\377"
+  "\270\270\270\377\0\0\0\377\0\0\0\0\377\277_\0\223W+\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377\377"
+  "\377\354\354\354\377\354\354\354\377\354\354\354\377\0\0\0\377\377\306"
+  "c\377\0\0\0\377\354\354\354\377\354\354\354\377\354\354\354\377\270\270"
+  "\270\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377\377\377\354"
+  "\354\354\377\0\0\0\377\223W+\377\226\\-\377\377\310c\377\244@\40\377"
+  "\244@\40\377\0\0\0\377\354\354\354\377\270\270\270\377\0\0\0\377\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\377\377\377\377\377\354\354\354\377\0\0\0\377"
+  "\377\277_\377\377\310c\377\377\306b\377\377\275^\377\377\\.\377\0\0\0"
+  "\377\354\354\354\377\270\270\270\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\377\377\377\377\377\354\354\354\377\354\354\354\377\0\0\0\377\377"
+  "\265Y\377\377\302a\377\377p8\377\0\0\0\377\354\354\354\377\354\354\354"
+  "\377\270\270\270\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377"
+  "\377\377\354\354\354\377\354\354\354\377\354\354\354\377\0\0\0\377\377"
+  "\266Z\377\0\0\0\377\354\354\354\377\354\354\354\377\354\354\354\377\270"
+  "\270\270\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\344\344\344\377"
+  "\270\270\270\377\270\270\270\377\270\270\270\377\270\270\270\377\0\0"
+  "\0\377\270\270\270\377\270\270\270\377\270\270\270\377\270\270\270\377"
+  "\205\205\205\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\0\0\0\377\0"
+  "\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377"
+  "\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"};
+
+
+/* GdkPixbuf RGBA C-Source image dump */
+
+static const guint8 stock_vim_window_maximize_width[] = 
+{ ""
+  /* Pixbuf magic (0x47646b50) */
+  "GdkP"
+  /* length: header (24) + pixel_data (2304) */
+  "\0\0\11\30"
+  /* pixdata_type (0x1010002) */
+  "\1\1\0\2"
+  /* rowstride (96) */
+  "\0\0\0`"
+  /* width (24) */
+  "\0\0\0\30"
+  /* height (24) */
+  "\0\0\0\30"
+  /* pixel_data: */
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\377\306c\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\223W+\0\226"
+  "\\-\0\377\310c\0\244@\40\0\244@\40\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\277_\0\377\310"
+  "c\0\377\306b\0\377\275^\0\377\\.\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\265Y\0"
+  "\377\302a\0\377p8\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\266Z\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\0\0\0\377\0\0\0\377\0"
+  "\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377"
+  "\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377"
+  "\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
+  "\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
+  "\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
+  "\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
+  "\377\344\344\344\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\377\377\377\377\377\354\354\354\377\354\354\354\377\354\354\354\377"
+  "\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377\354"
+  "\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354"
+  "\354\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354"
+  "\377\270\270\270\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\377\377\377\377\377\354\354\354\377\354\354\354\377\0\0\0\377\0\0\0"
+  "\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377"
+  "\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377\0\0"
+  "\0\377\0\0\0\377\354\354\354\377\354\354\354\377\270\270\270\377\0\0"
+  "\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377\377\377\354"
+  "\354\354\377\0\0\0\377\377\\.\377\244@\40\377\354\354\354\377\354\354"
+  "\354\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354"
+  "\377\354\354\354\377\354\354\354\377\223W+\377\377\277_\377\0\0\0\377"
+  "\354\354\354\377\270\270\270\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\377\377\377\377\377\0\0\0\377\377p8\377\377\275^\377\244"
+  "@\40\377\0\0\0\377\0\0\0\377\354\354\354\377\354\354\354\377\354\354"
+  "\354\377\354\354\354\377\0\0\0\377\0\0\0\377\226\\-\377\377\310c\377"
+  "\377\265Y\377\0\0\0\377\270\270\270\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\377\0\0\0\377\377\266Z\377\377\302a\377\377\306b\377"
+  "\377\310c\377\377\306c\377\0\0\0\377\354\354\354\377\354\354\354\377"
+  "\354\354\354\377\354\354\354\377\0\0\0\377\377\306c\377\377\310c\377"
+  "\377\306b\377\377\302a\377\377\266Z\377\0\0\0\377\0\0\0\377\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377\377\377\0\0\0\377\377\265Y\377"
+  "\377\310c\377\226\\-\377\0\0\0\377\0\0\0\377\354\354\354\377\354\354"
+  "\354\377\354\354\354\377\354\354\354\377\0\0\0\377\0\0\0\377\244@\40"
+  "\377\377\275^\377\377p8\377\0\0\0\377\270\270\270\377\0\0\0\377\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377\377\377\354\354\354\377"
+  "\0\0\0\377\377\277_\377\223W+\377\354\354\354\377\354\354\354\377\354"
+  "\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354"
+  "\354\377\354\354\354\377\244@\40\377\377\\.\377\0\0\0\377\354\354\354"
+  "\377\270\270\270\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\377\377\377\377\377\354\354\354\377\354\354\354\377\0\0\0\377\0\0\0"
+  "\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377"
+  "\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377\0\0"
+  "\0\377\0\0\0\377\354\354\354\377\354\354\354\377\270\270\270\377\0\0"
+  "\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377\377\377\354"
+  "\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354"
+  "\354\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354"
+  "\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377"
+  "\354\354\354\377\354\354\354\377\354\354\354\377\270\270\270\377\0\0"
+  "\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\351\351\351\377\270"
+  "\270\270\377\270\270\270\377\270\270\270\377\270\270\270\377\270\270"
+  "\270\377\270\270\270\377\270\270\270\377\270\270\270\377\270\270\270"
+  "\377\270\270\270\377\270\270\270\377\270\270\270\377\270\270\270\377"
+  "\270\270\270\377\270\270\270\377\270\270\270\377\205\205\205\377\0\0"
+  "\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\0\0\0\377\0\0\0\377"
+  "\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377"
+  "\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377"
+  "\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377"
+  "p8\0\377\302a\0\377\265Y\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\\.\0\377\275^"
+  "\0\377\306b\0\377\310c\0\377\277_\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\244@\40\0\244@\40"
+  "\0\377\310c\0\226\\-\0\223W+\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\306"
+  "c\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0"};
+
+
+/* GdkPixbuf RGBA C-Source image dump */
+
+static const guint8 stock_vim_window_minimize[] = 
+{ ""
+  /* Pixbuf magic (0x47646b50) */
+  "GdkP"
+  /* length: header (24) + pixel_data (2304) */
+  "\0\0\11\30"
+  /* pixdata_type (0x1010002) */
+  "\1\1\0\2"
+  /* rowstride (96) */
+  "\0\0\0`"
+  /* width (24) */
+  "\0\0\0\30"
+  /* height (24) */
+  "\0\0\0\30"
+  /* pixel_data: */
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\377\377\306c\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\377\223W+\377\226\\-\377\377\310c\377\244@\40\377\244@\40\377\0\0\0"
+  "\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\377\377\277_\377\377\310c\377\377\306b\377\377\275^\377\377"
+  "\\.\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\265Y\377\377\302a\377\377p8\377"
+  "\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\266Z\377\0\0\0\377\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0"
+  "\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0"
+  "\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377"
+  "\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377"
+  "\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
+  "\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
+  "\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
+  "\377\377\377\377\377\377\377\377\377\377\377\344\344\344\377\0\0\0\377"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377\377\377\354"
+  "\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354"
+  "\354\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354"
+  "\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377"
+  "\354\354\354\377\354\354\354\377\270\270\270\377\0\0\0\377\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377\377\377\354\354\354"
+  "\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377"
+  "\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377\354"
+  "\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354"
+  "\354\377\354\354\354\377\270\270\270\377\0\0\0\377\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377\377\377\354\354\354\377\354"
+  "\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354"
+  "\354\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354"
+  "\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377"
+  "\354\354\354\377\270\270\270\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\377\377\377\377\377\354\354\354\377\354\354\354"
+  "\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377"
+  "\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377\354"
+  "\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354"
+  "\354\377\270\270\270\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\377\377\377\377\377\354\354\354\377\354\354\354\377\354"
+  "\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354"
+  "\354\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354"
+  "\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377"
+  "\270\270\270\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\377\377\377\377\377\354\354\354\377\354\354\354\377\354\354\354"
+  "\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377"
+  "\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377\354"
+  "\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377\270\270"
+  "\270\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377"
+  "\351\351\351\377\270\270\270\377\270\270\270\377\270\270\270\377\270"
+  "\270\270\377\270\270\270\377\270\270\270\377\270\270\270\377\270\270"
+  "\270\377\270\270\270\377\270\270\270\377\270\270\270\377\270\270\270"
+  "\377\270\270\270\377\270\270\270\377\270\270\270\377\205\205\205\377"
+  "\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\0\0\0\377"
+  "\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377"
+  "\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377"
+  "\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377"
+  "\266Z\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377p8\377\377\302"
+  "a\377\377\265Y\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\\.\377\377\275^\377"
+  "\377\306b\377\377\310c\377\377\277_\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\244@\40\377"
+  "\244@\40\377\377\310c\377\226\\-\377\223W+\377\0\0\0\377\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\377\377\306c\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"};
+
+
+/* GdkPixbuf RGBA C-Source image dump */
+
+static const guint8 stock_vim_window_minimize_width[] = 
+{ ""
+  /* Pixbuf magic (0x47646b50) */
+  "GdkP"
+  /* length: header (24) + pixel_data (2304) */
+  "\0\0\11\30"
+  /* pixdata_type (0x1010002) */
+  "\1\1\0\2"
+  /* rowstride (96) */
+  "\0\0\0`"
+  /* width (24) */
+  "\0\0\0\30"
+  /* height (24) */
+  "\0\0\0\30"
+  /* pixel_data: */
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377"
+  "\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377\377\377\377\377\377\377"
+  "\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
+  "\377\377\377\351\351\351\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\377\377\377\377\377\354\354\354\377\354\354\354"
+  "\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377"
+  "\270\270\270\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\377\377\377\377\377\354\354\354\377\354\354\354\377\354\354"
+  "\354\377\354\354\354\377\354\354\354\377\354\354\354\377\270\270\270"
+  "\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377"
+  "\377\377\377\377\354\354\354\377\354\354\354\377\354\354\354\377\354"
+  "\354\354\377\354\354\354\377\354\354\354\377\270\270\270\377\0\0\0\377"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377\377\377"
+  "\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377\354"
+  "\354\354\377\354\354\354\377\270\270\270\377\0\0\0\377\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377"
+  "\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377\377\377\354\354"
+  "\354\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354"
+  "\377\354\354\354\377\270\270\270\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\223W+\377\377"
+  "\277_\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\377\377\377\377\377\354\354"
+  "\354\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354"
+  "\377\354\354\354\377\270\270\270\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0"
+  "\377\377\\.\377\244@\40\377\0\0\0\0\0\0\0\0\0\0\0\377\0\0\0\377\226\\"
+  "-\377\377\310c\377\377\265Y\377\0\0\0\377\0\0\0\0\0\0\0\377\377\377\377"
+  "\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377"
+  "\354\354\354\377\354\354\354\377\270\270\270\377\0\0\0\377\0\0\0\0\0"
+  "\0\0\377\377p8\377\377\275^\377\244@\40\377\0\0\0\377\0\0\0\377\0\0\0"
+  "\377\377\306c\377\377\310c\377\377\306b\377\377\302a\377\377\266Z\377"
+  "\0\0\0\377\0\0\0\377\377\377\377\377\354\354\354\377\354\354\354\377"
+  "\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377\270"
+  "\270\270\377\0\0\0\377\0\0\0\377\377\266Z\377\377\302a\377\377\306b\377"
+  "\377\310c\377\377\306c\377\0\0\0\377\0\0\0\377\0\0\0\377\244@\40\377"
+  "\377\275^\377\377p8\377\0\0\0\377\0\0\0\0\0\0\0\377\377\377\377\377\354"
+  "\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354"
+  "\354\377\354\354\354\377\270\270\270\377\0\0\0\377\0\0\0\0\0\0\0\377"
+  "\377\265Y\377\377\310c\377\226\\-\377\0\0\0\377\0\0\0\377\0\0\0\0\0\0"
+  "\0\0\244@\40\377\377\\.\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\377\377\377"
+  "\377\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354"
+  "\377\354\354\354\377\354\354\354\377\270\270\270\377\0\0\0\377\0\0\0"
+  "\0\0\0\0\0\0\0\0\377\377\277_\377\223W+\377\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377"
+  "\377\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354"
+  "\377\354\354\354\377\354\354\354\377\270\270\270\377\0\0\0\377\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377\377\377"
+  "\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377\354"
+  "\354\354\377\354\354\354\377\270\270\270\377\0\0\0\377\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377\377\377\354\354\354"
+  "\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377"
+  "\354\354\354\377\270\270\270\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377\377\377\354\354\354\377\354\354"
+  "\354\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354"
+  "\377\270\270\270\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\377\377\377\377\377\354\354\354\377\354\354\354\377\354"
+  "\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377\270\270"
+  "\270\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\377\344\344\344\377\270\270\270\377\270\270\270\377\270\270\270\377"
+  "\270\270\270\377\270\270\270\377\270\270\270\377\205\205\205\377\0\0"
+  "\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\0\0\0\377"
+  "\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377"
+  "\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"};
+
+
+/* GdkPixbuf RGBA C-Source image dump */
+
+static const guint8 stock_vim_window_split[] = 
+{ ""
+  /* Pixbuf magic (0x47646b50) */
+  "GdkP"
+  /* length: header (24) + pixel_data (2304) */
+  "\0\0\11\30"
+  /* pixdata_type (0x1010002) */
+  "\1\1\0\2"
+  /* rowstride (96) */
+  "\0\0\0`"
+  /* width (24) */
+  "\0\0\0\30"
+  /* height (24) */
+  "\0\0\0\30"
+  /* pixel_data: */
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\377\377\377\0\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0"
+  "\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0"
+  "\0\377\0\0\0\377\0\0\0\377\377\377\377\0\344\344\344\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377"
+  "\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
+  "\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
+  "\377\377\377\377\377\377\377\377\344\344\344\377\0\0\0\377\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377"
+  "\377\0\0\0\0\377\377\377\377\377\354\354\354\377\354\354\354\377\354"
+  "\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354"
+  "\354\377\354\354\354\377\354\354\354\377\354\354\354\377\270\270\270"
+  "\377\0\0\0\377\0\0\0\0\344\344\344\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377\0\0\0\0\377\377\377\377\377\354"
+  "\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354"
+  "\354\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354"
+  "\377\354\354\354\377\270\270\270\377\0\0\0\377\0\0\0\0\270\270\270\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377"
+  "\0\0\0\0\377\377\377\377\377\354\354\354\377\354\354\354\377\354\354"
+  "\354\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354"
+  "\377\354\354\354\377\354\354\354\377\354\354\354\377\270\270\270\377"
+  "\0\0\0\377\0\0\0\0\270\270\270\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\377\377\377\0\0\0\0\377\377\377\377\377\354\354"
+  "\354\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354"
+  "\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377"
+  "\354\354\354\377\270\270\270\377\0\0\0\377\0\0\0\0\270\270\270\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377\0\0"
+  "\0\0\377\377\377\377\377\354\354\354\377\354\354\354\377\354\354\354"
+  "\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377"
+  "\354\354\354\377\354\354\354\377\354\354\354\377\270\270\270\377\0\0"
+  "\0\377\0\0\0\0\270\270\270\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\377\377\377\0\0\0\0\377\377\377\377\377\354\354\354"
+  "\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377"
+  "\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377\354"
+  "\354\354\377\270\270\270\377\0\0\0\377\0\0\0\0\270\270\270\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377\0\0\0\0"
+  "\377\351\351\351\377\270\270\270\377\270\270\270\377\270\270\270\377"
+  "\270\270\270\377\270\270\270\377\270\270\270\377\270\270\270\377\270"
+  "\270\270\377\270\270\270\377\270\270\270\377\205\205\205\377\0\0\0\377"
+  "\0\0\0\0\270\270\270\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\351\351\351\0\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0"
+  "\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0"
+  "\0\0\377\0\0\0\377\0\0\0\377\0\0\0\0\205\205\205\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377\0\0\0\0\377\0\0\0\377\0\0\0\377"
+  "\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377"
+  "\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\0\344\344\344\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377\0\0\0"
+  "\0\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
+  "\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
+  "\377\377\377\377\377\377\377\377\377\377\377\344\344\344\377\0\0\0\377"
+  "\0\0\0\0\270\270\270\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\377\377\377\0\0\0\0\377\377\377\377\377\354\354\354\377\354"
+  "\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354"
+  "\354\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354"
+  "\377\270\270\270\377\0\0\0\377\0\0\0\0\270\270\270\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377\0\0\0\0\377\377"
+  "\377\377\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354"
+  "\354\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354"
+  "\377\354\354\354\377\354\354\354\377\270\270\270\377\0\0\0\377\0\0\0"
+  "\0\270\270\270\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\377\377\377\0\0\0\0\377\377\377\377\377\354\354\354\377\354\354"
+  "\354\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354"
+  "\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377"
+  "\270\270\270\377\0\0\0\377\0\0\0\0\270\270\270\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377\0\0\0\0\377\377\377"
+  "\377\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354"
+  "\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377"
+  "\354\354\354\377\354\354\354\377\270\270\270\377\0\0\0\377\0\0\0\0\270"
+  "\270\270\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377"
+  "\377\377\0\0\0\0\377\377\377\377\377\354\354\354\377\354\354\354\377"
+  "\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377\354"
+  "\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377\270\270"
+  "\270\377\0\0\0\377\0\0\0\0\270\270\270\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\351\351\351\0\0\0\0\377\377\377\377\377"
+  "\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377\354"
+  "\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354"
+  "\354\377\354\354\354\377\270\270\270\377\0\0\0\377\0\0\0\0\205\205\205"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\377\351\351\351\377\270\270\270\377\270\270\270\377\270\270\270"
+  "\377\270\270\270\377\270\270\270\377\270\270\270\377\270\270\270\377"
+  "\270\270\270\377\270\270\270\377\270\270\270\377\205\205\205\377\0\0"
+  "\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377"
+  "\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377"
+  "\0\0\0\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"};
+
+
+/* GdkPixbuf RGBA C-Source image dump */
+
+static const guint8 stock_vim_window_split_vertical[] = 
+{ ""
+  /* Pixbuf magic (0x47646b50) */
+  "GdkP"
+  /* length: header (24) + pixel_data (2304) */
+  "\0\0\11\30"
+  /* pixdata_type (0x1010002) */
+  "\1\1\0\2"
+  /* rowstride (96) */
+  "\0\0\0`"
+  /* width (24) */
+  "\0\0\0\30"
+  /* height (24) */
+  "\0\0\0\30"
+  /* pixel_data: */
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377\0\0\0\0\0\377\377\377"
+  "\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377"
+  "\0\377\377\377\0\351\351\351\0\0\0\0\0\377\377\377\0\377\377\377\0\377"
+  "\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\351"
+  "\351\351\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\0\0\0\377"
+  "\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377"
+  "\0\0\0\377\0\0\0\0\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377"
+  "\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
+  "\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\351\351"
+  "\351\377\0\0\0\377\0\0\0\0\0\0\0\377\377\377\377\377\377\377\377\377"
+  "\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377"
+  "\377\377\377\351\351\351\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\377\377\377\377\377\354\354\354\377\354\354\354\377\354\354\354\377"
+  "\354\354\354\377\354\354\354\377\354\354\354\377\270\270\270\377\0\0"
+  "\0\377\0\0\0\0\0\0\0\377\377\377\377\377\354\354\354\377\354\354\354"
+  "\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377"
+  "\270\270\270\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377"
+  "\377\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354"
+  "\377\354\354\354\377\354\354\354\377\270\270\270\377\0\0\0\377\0\0\0"
+  "\0\0\0\0\377\377\377\377\377\354\354\354\377\354\354\354\377\354\354"
+  "\354\377\354\354\354\377\354\354\354\377\354\354\354\377\270\270\270"
+  "\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377\377\377\354"
+  "\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354"
+  "\354\377\354\354\354\377\270\270\270\377\0\0\0\377\0\0\0\0\0\0\0\377"
+  "\377\377\377\377\354\354\354\377\354\354\354\377\354\354\354\377\354"
+  "\354\354\377\354\354\354\377\354\354\354\377\270\270\270\377\0\0\0\377"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377\377\377\354\354\354\377\354"
+  "\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354"
+  "\354\377\270\270\270\377\0\0\0\377\0\0\0\0\0\0\0\377\377\377\377\377"
+  "\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377\354"
+  "\354\354\377\354\354\354\377\270\270\270\377\0\0\0\377\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\377\377\377\377\377\354\354\354\377\354\354\354\377"
+  "\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377\270"
+  "\270\270\377\0\0\0\377\0\0\0\0\0\0\0\377\377\377\377\377\354\354\354"
+  "\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377"
+  "\354\354\354\377\270\270\270\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\377\377\377\377\377\354\354\354\377\354\354\354\377\354\354\354"
+  "\377\354\354\354\377\354\354\354\377\354\354\354\377\270\270\270\377"
+  "\0\0\0\377\0\0\0\0\0\0\0\377\377\377\377\377\354\354\354\377\354\354"
+  "\354\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354"
+  "\377\270\270\270\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377"
+  "\377\377\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354"
+  "\354\377\354\354\354\377\354\354\354\377\270\270\270\377\0\0\0\377\0"
+  "\0\0\0\0\0\0\377\377\377\377\377\354\354\354\377\354\354\354\377\354"
+  "\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377\270\270"
+  "\270\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377\377\377"
+  "\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377\354"
+  "\354\354\377\354\354\354\377\270\270\270\377\0\0\0\377\0\0\0\0\0\0\0"
+  "\377\377\377\377\377\354\354\354\377\354\354\354\377\354\354\354\377"
+  "\354\354\354\377\354\354\354\377\354\354\354\377\270\270\270\377\0\0"
+  "\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377\377\377\354\354\354"
+  "\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377"
+  "\354\354\354\377\270\270\270\377\0\0\0\377\0\0\0\0\0\0\0\377\377\377"
+  "\377\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354"
+  "\377\354\354\354\377\354\354\354\377\270\270\270\377\0\0\0\377\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\377\377\377\377\377\354\354\354\377\354\354"
+  "\354\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354\354"
+  "\377\270\270\270\377\0\0\0\377\0\0\0\0\0\0\0\377\377\377\377\377\354"
+  "\354\354\377\354\354\354\377\354\354\354\377\354\354\354\377\354\354"
+  "\354\377\354\354\354\377\270\270\270\377\0\0\0\377\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\377\344\344\344\377\270\270\270\377\270\270\270\377\270"
+  "\270\270\377\270\270\270\377\270\270\270\377\270\270\270\377\205\205"
+  "\205\377\0\0\0\377\0\0\0\0\0\0\0\377\344\344\344\377\270\270\270\377"
+  "\270\270\270\377\270\270\270\377\270\270\270\377\270\270\270\377\270"
+  "\270\270\377\205\205\205\377\0\0\0\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0"
+  "\0\377\0\0\0\377\0\0\0\377\0\0\0\0\0\0\0\377\0\0\0\377\0\0\0\377\0\0"
+  "\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\377\377\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\344\344\344\0\0\0\0\0\344\344\344\0\270\270\270\0\270"
+  "\270\270\0\270\270\270\0\270\270\270\0\270\270\270\0\270\270\270\0\205"
+  "\205\205\0\0\0\0\0\344\344\344\0\270\270\270\0\270\270\270\0\270\270"
+  "\270\0\270\270\270\0\270\270\270\0\270\270\270\0\205\205\205\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
+  "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"};
+
+
