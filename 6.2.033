To: vim-dev@vim.org
Subject: Patch 6.2.033 (extra)
Fcc: outbox
From: Bram Moolenaar <Bram@moolenaar.net>
Mime-Version: 1.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 8bit
------------

Patch 6.2.033 (extra)
Problem:    Mac: Various compiler warnings.
Solution:   Don't include Classic-only headers in Unix version.
	    Remove references to several unused variables. (Ben Fowler)
	    Use int instead of unsigned short for pixel values, so that the
	    negative error values are recognized.
Files:	    src/gui_mac.c


*** ../vim-6.2.032/src/gui_mac.c	Sat May 17 15:30:40 2003
--- src/gui_mac.c	Fri Jul 25 22:21:05 2003
***************
*** 93,100 ****
--- 93,102 ----
  /* Include some file. TODO: move into os_mac.h */
  #include <Menus.h>
  #include <Resources.h>
+ #if !TARGET_API_MAC_CARBON
  #include <StandardFile.h>
  #include <Traps.h>
+ #endif
  #include <Balloons.h>
  #include <Processes.h>
  #ifdef USE_AEVENT
***************
*** 3140,3147 ****
  	{"Violet",	RGB(0x8D, 0x38, 0xC9)}, /*U*/
      };
  
!     unsigned short	r, g, b;
!     int			i;
  
      if (name[0] == '#' && strlen((char *) name) == 7)
      {
--- 3142,3149 ----
  	{"Violet",	RGB(0x8D, 0x38, 0xC9)}, /*U*/
      };
  
!     int		r, g, b;
!     int		i;
  
      if (name[0] == '#' && strlen((char *) name) == 7)
      {
***************
*** 5208,5231 ****
       * TODO: Add protection for 256 char max.
       */
  
!     CInfoPBRec  theCPB;
!     Str255      directoryName;
!     char_u      temporary[255];
!  /* char	filename[255]; */
!     char_u       fname[256];
!     char_u	*temporaryPtr = temporary;
!     char_u      *filenamePtr = fname;
!     OSErr       error;
      int		folder = 1;
  #ifdef USE_UNIXFILENAME
-     char	*p;
      SInt16	dfltVol_vRefNum;
!     SInt32      dfltVol_dirID;
      FSRef	refFile;
      OSStatus	status;
      UInt32	pathSize = 256;
      char_u	pathname[256];
      char_u	*path = pathname;
  #endif
  
  #ifdef USE_UNIXFILENAME
--- 5210,5232 ----
       * TODO: Add protection for 256 char max.
       */
  
!     CInfoPBRec	theCPB;
!     char_u	fname[256];
!     char_u	*filenamePtr = fname;
!     OSErr	error;
      int		folder = 1;
  #ifdef USE_UNIXFILENAME
      SInt16	dfltVol_vRefNum;
!     SInt32	dfltVol_dirID;
      FSRef	refFile;
      OSStatus	status;
      UInt32	pathSize = 256;
      char_u	pathname[256];
      char_u	*path = pathname;
+ #else
+     Str255	directoryName;
+     char_u	temporary[255];
+     char_u	*temporaryPtr = temporary;
  #endif
  
  #ifdef USE_UNIXFILENAME
***************
*** 5400,5408 ****
--- 5401,5412 ----
      STRCPY(&temporaryPtr[1], filenamePtr);
      temporaryPtr[0] = '/';
      STRCPY(filenamePtr, temporaryPtr);
+     {
+     char	*p;
      for (p = fname; *p; p++)
  	if (*p == ':')
  	    *p = '/';
+     }
  #endif
  
      return (vim_strsave (fname));
*** ../vim-6.2.032/src/version.c	Fri Jul 25 21:39:40 2003
--- src/version.c	Fri Jul 25 22:19:09 2003
***************
*** 632,633 ****
--- 632,635 ----
  {   /* Add new patch number below this line */
+ /**/
+     33,
  /**/

-- 
FIRST SOLDIER:  So they wouldn't be able to bring a coconut back anyway.
SECOND SOLDIER: Wait a minute! Suppose two swallows carried it together?
FIRST SOLDIER:  No, they'd have to have it on a line.
                 "Monty Python and the Holy Grail" PYTHON (MONTY) PICTURES LTD

 /// Bram Moolenaar -- Bram@Moolenaar.net -- http://www.Moolenaar.net   \\\
///          Creator of Vim - Vi IMproved -- http://www.Vim.org          \\\
\\\              Project leader for A-A-P -- http://www.A-A-P.org        ///
 \\\  Help AIDS victims, buy here: http://ICCF-Holland.org/click1.html  ///
