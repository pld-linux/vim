To: vim-dev@vim.org
Subject: Patch 6.2.446
Fcc: outbox
From: Bram Moolenaar <Bram@moolenaar.net>
Mime-Version: 1.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 8bit
------------

Patch 6.2.446 (after 6.2.404)
Problem:    Using library functions wcwidth() and iswprint() results in
	    display problems for Hebrew characters. (Ron Aaron)
Solution:   Disable the code to use the library functions, use our own.
Files:	    src/mbyte.c


*** ../vim-6.2.445/src/mbyte.c	Fri Apr  2 11:36:09 2004
--- src/mbyte.c	Sun Apr  4 16:28:21 2004
***************
*** 113,118 ****
--- 113,126 ----
  # include <wchar.h>
  #endif
  
+ #if 0
+ /* This has been disabled, because several people reported problems with the
+  * wcwidth() and iswprint() library functions, esp. for Hebrew. */
+ # ifdef __STDC_ISO_10646__
+ #  define USE_WCHAR_FUNCTIONS
+ # endif
+ #endif
+ 
  #if defined(FEAT_MBYTE) || defined(PROTO)
  
  static int enc_canon_search __ARGS((char_u *name));
***************
*** 1108,1114 ****
  
      if (c >= 0x100)
      {
! #ifdef __STDC_ISO_10646__
  	/*
  	 * Assume the library function wcwidth() works better than our own
  	 * stuff.  It should return 1 for ambiguous width chars!
--- 1116,1122 ----
  
      if (c >= 0x100)
      {
! #ifdef USE_WCHAR_FUNCTIONS
  	/*
  	 * Assume the library function wcwidth() works better than our own
  	 * stuff.  It should return 1 for ambiguous width chars!
***************
*** 1766,1772 ****
  utf_printable(c)
      int		c;
  {
! #ifdef __STDC_ISO_10646__
      /*
       * Assume the iswprint() library function works better than our own stuff.
       */
--- 1774,1780 ----
  utf_printable(c)
      int		c;
  {
! #ifdef USE_WCHAR_FUNCTIONS
      /*
       * Assume the iswprint() library function works better than our own stuff.
       */
*** ../vim-6.2.445/src/version.c	Sun Apr  4 16:20:34 2004
--- src/version.c	Sun Apr  4 16:27:31 2004
***************
*** 639,640 ****
--- 639,642 ----
  {   /* Add new patch number below this line */
+ /**/
+     446,
  /**/

-- 
Two fish in a tank. One says to the other:
"Do you know how to drive this thing?"

 /// Bram Moolenaar -- Bram@Moolenaar.net -- http://www.Moolenaar.net   \\\
///        Sponsor Vim, vote for features -- http://www.Vim.org/sponsor/ \\\
\\\              Project leader for A-A-P -- http://www.A-A-P.org        ///
 \\\  Buy at Amazon and help AIDS victims -- http://ICCF.nl/click1.html ///
